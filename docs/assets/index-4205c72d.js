import{s as i,e as $,g as B,S as p,T as R,a as A,Q as D,b as T,aL as W,V as E,u as v,aF as U,R as j,t as Q,j as n,B as b,ax as S,aH as _,h as F,aK as C,az as L,k as O}from"./index-a74e6323.js";import{C as Y}from"./index-91546547.js";const q=i("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),k=i("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),z=i("p",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",my:"15px",color:"$white500",fw:"400",ff:"$heading",fs:"20px",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",mt:"5px",">div":{border:"none"}},"@sm":{flexWrap:"wrap",span:{fs:"16px"}}}),K=i("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),P=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",">div":{border:"none"}}}),N=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",m:"5px 0 10px",w:"100%"}),h=i("div",{d:"flex",align:"center",justify:"space-between",gap:"10px",px:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),l=i("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"0px 0px 5px rgba(0, 0, 0, 0.9)",fs:"14px",ff:"$heading",fw:"400"}),I=$({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),V=i("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${I} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),H=async t=>await B({options:{code:p.TOOLS_MC,index_position:3,key_type:"i64",limit:"10000",scope:p.TOOLS_MC,table:R.tools,reverse:!0,lower_bound:t,upper_bound:t}}),G=()=>A({queryKey:[D.toolsMc],queryFn:()=>J(),staleTime:1e3*60*20,enabled:!!T.getState().user});async function J(){try{const t=T.getState().user;if(!t)return;const a=await H(t.name),s=await W();if(!a)return;const{getTemplates:c}=E,d=await c({template_id:a.map(({template_id:r})=>r).join(","),page:1,limit:100,order:"desc"});return a==null?void 0:a.map(r=>{const f=d.find(u=>u.template_id===String(r.template_id)),g=s==null?void 0:s.find(u=>u.template_id===r.template_id);return f?{...f.immutable_data,...r,...g}:r})}catch(t){console.log(t);return}}async function X(t,a){const{executeTransaction:s}=v(),c=Z(t,a);return!!await s(c)}function Z(t,a){return{actions:[{account:p.TOOLS_MC,name:"unstake",authorization:[{actor:t.name,permission:t.requestPermission}],data:{wallet:t.name,asset_ids:a}}]}}async function ee(t){const{executeTransaction:a}=v(),s=te(t);return!!await a(s)}function te(t){return{actions:[{account:p.TOOLS_MC,name:"claim",authorization:[{actor:t.name,permission:t.requestPermission}],data:{wallet:t.name}}]}}const oe=()=>{var w,y;const{data:t,isLoading:a}=G();U();const s=T(e=>e.user),[c,d]=j.useState(!1),[m,r]=j.useState(!1);async function f(e){if(s){d(!0);try{await X(s,[Number(e.asset_id)])&&(await F(2e3),await C(),await L("tool.worlds"),O.success("Tool unstaked"))}catch(o){console.error("Error staking tool",o)}finally{d(!1)}}}async function g(){if(s){r(!0);try{await ee(s)&&(await C(),await L("tool.worlds"),O.success("Tool unstaked"))}catch(e){console.error("Error staking tool",e)}finally{r(!1)}}}function u(e){const o=e.getFullYear(),M=e.getMonth()+1>9?e.getMonth()+1:`0${e.getMonth()+1}`;return`${e.getDate()>9?e.getDate():`0${e.getDate()}`}/${M}/${o}`}const x=t==null?void 0:t.reduce((e,o)=>e+Q(o.total_earned),0);return n.jsxs(q,{children:[n.jsx(k,{children:"CLAIM YOUR TLM"}),n.jsxs(z,{children:["Claimable TLM, earned by loaning: ",x==null?void 0:x.toFixed(4)," TLM",n.jsx(b,{disabled:m&&x===0,isLoading:m,onClick:g,rounded:!1,color:"solidBlue",children:"Claim TLM"})]}),n.jsx(k,{children:"YOUR STAKED TOOLS"}),n.jsx(K,{children:a?new Array(6).fill(0).map((e,o)=>n.jsx(V,{},o)):(y=(w=t==null?void 0:t.filter(e=>e.owned>0))==null?void 0:w.sort((e,o)=>S[e.rarity]-S[o.rarity]||_[e.shine]-_[o.shine]))==null?void 0:y.map((e,o)=>n.jsx(Y,{tool:e,children:n.jsxs(P,{children:[n.jsx(b,{disabled:c,isLoading:c,onClick:()=>f(e),rounded:!1,color:"solidBlue",children:"Unstake"}),n.jsxs(N,{children:[n.jsxs(h,{children:[n.jsx(l,{children:"Since"}),n.jsx(l,{children:u(new Date(e.last_mine))})]}),n.jsxs(h,{children:[n.jsx(l,{children:"Total"}),n.jsx(l,{children:e.total_earned})]}),n.jsxs(h,{children:[n.jsx(l,{children:"Uses"}),n.jsx(l,{children:e.total_mines})]})]})]})},o))})]})};export{oe as default};
