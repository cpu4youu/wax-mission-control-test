import{s as c,e as J,R as o,_ as M,u as C,r as S,n as we,j as a,h as f,B as U,q as ge,Q as he,z as xe}from"./index-4233004f.js";import{C as le}from"./index-72d4acb0.js";import{u as ye,r as P,s as V}from"./tools-query-567cd254.js";import{u as _e,f as Te,o as Q,g as Me,e as Le}from"./execute-mine-tool-contract-99344e44.js";import{u as ve,o as z}from"./user-miners-query-2232b294.js";import{u as R,s as be}from"./showTlmValueFromMine-6e3b95d8.js";import{o as je}from"./lands-query-7b8cd07b.js";import{u as De,o as K}from"./wallets-query-280e4f08.js";import{u as Ce,o as G,g as Se}from"./tool-query-18f89683.js";import{u as Re,o as $}from"./miner-claim-19e57ba7.js";import{f as $e,e as Ee,o as Ie,a as Ae,b as Be}from"./format-date-to-iso-42494c0a.js";import{F as ke}from"./index.esm-b406fa55.js";import{o as H}from"./toolov-query-4368270e.js";import{d as Ne,a as Oe,c as E}from"./mineCooldown-1522450d.js";import{s as Fe}from"./sleep-da79c358.js";import{i as Ue}from"./index-5204ef32.js";import"./adapters-4f9855f2.js";import"./axios-45629df5.js";import"./toast-options-cd83212c.js";import"./lands-1ec92124.js";import"./use-transaction-c9fafe9e.js";import"./index-87182a96.js";import"./iconBase-a27b7bfa.js";import"./index-d9bc612c.js";const Pe=c("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),Ve=c("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),Qe=J({"100%":{transform:"rotate(360deg)"}}),ze=c("button",{color:"$white500",svg:{ml:"10px",color:"$white500",w:"25px",h:"25px"},variants:{isLoading:{true:{pointerEvents:"none",opacity:"0.5",svg:{animation:`${Qe} 1s linear`,animationIterationCount:"infinite"}},false:{pointerEvents:"all",opacity:"1"}}}}),Ke=c("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),Ge=c("div",{d:"flex",align:"center",justify:"flex-start",gap:"5px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),He=c("div",{d:"flex",align:"center",justify:"flex-start",gap:"5px",w:"100%",color:"$white500",ff:"$heading",button:{w:"100%",minH:"30px",minW:"unset",maxW:"140px",">div":{minH:"30px",border:"none"}},"@sm":{flexWrap:"wrap"}}),Y=c("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),Ye=c("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),qe=c("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),Ze=c("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),q=c("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{filter:"drop-shadow(3px 5px 2px rgb(0 0 0 / 0.6))",w:"20px",h:"20px"}}),Z=c("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"2px 1px 4px rgba(0, 0, 0)",fs:"14px",ff:"$heading",fw:"400"}),Je=J({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Xe=c("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${Je} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),We=o.lazy(()=>M(()=>import("./pickaxe-4f73a83f.js"),["assets/pickaxe-4f73a83f.js","assets/index-4233004f.js","assets/index-55fec1ff.css"])),et=o.lazy(()=>M(()=>import("./settings-06365380.js"),["assets/settings-06365380.js","assets/index-4233004f.js","assets/index-55fec1ff.css"])),tt=o.lazy(()=>M(()=>import("./person-d39b4d3b.js"),["assets/person-d39b4d3b.js","assets/index-4233004f.js","assets/index-55fec1ff.css"])),nt=o.lazy(()=>M(()=>import("./atom-e194d7a9.js"),["assets/atom-e194d7a9.js","assets/index-4233004f.js","assets/index-55fec1ff.css"])),at=[{label:"Sort by rarity",value:"rarity"}],St=()=>{const{data:u}=_e(),{data:s}=De(),{data:h,isLoading:X,isFetching:W}=ve(),{data:L}=ye(),{data:m,isLoading:ee}=Ce(),{data:d}=Re(),i=C(e=>e.user),te=C(e=>e.updateMember),I=R(e=>e.isCalculating),ne=R(e=>e.updateIsCalculating),A=R(e=>e.updateMineButtonLoading),[B,ae]=o.useState([]),[l,re]=o.useState([]),[y,_]=o.useState(!1),[k]=o.useState(at[0]),[,v]=o.useState(!1),[b,ie]=o.useState("");async function se(){await z(),await G(),await K(),await $(),await H(),await Q()}async function oe(e){var t,n;if(!(!i||!u)){_(!0),A(!0);try{await je(),ne(!0);let r=0,p,x=[];if((e==null?void 0:e.tool_name)==="Certified Kol Digger"){const w=u==null?void 0:u.reduce((g,D)=>{const pe=Number(new Date(g.readyat));return Number(new Date(D.readyat))<pe?D:g},u[0]);r=w.asset_ids.length*e.pow,x=w.asset_ids.map(g=>Number(g)),p="1099512958237"}else{const[w]=await Se(`${e.template_id}`);r=w.pow,x=[w.next_asset_id];let g;try{[[,g]]=ge.getQueriesData([he.LANDS,"red",e])}catch{g=await Me(e)}p=(t=g.highestValue)==null?void 0:t.asset_id}await Le({user:i,difficulty:r,assets_ids:x,land_asset_id:p,old_bag_assets_ids:((n=L==null?void 0:L.userTools)==null?void 0:n.map(w=>Number(w.asset_id)))??[]})&&(await be(i==null?void 0:i.name),await z(),await K(),await $(),await G(),await H(),await Q())}catch(r){console.error("Error on MINE tool",r)}finally{A(!1),_(!1)}}}const T=S.useCallback(e=>{const t=((e==null?void 0:e.tool_name)==="Certified Kol Digger"?500:e.cooldown_seconds)*1.5;return Ne(t,{userTools:[e],allData:[]},h)},[h]),ce=S.useCallback(e=>{const t=Oe(E(T(e))),n=new Date(1e3*((e==null?void 0:e.last_use)??0)),r=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());return+new Date((h==null?void 0:h.last_mine)??"")>+new Date(r)?{type:"miner",cooldown:t}:{type:"tool",cooldown:t}},[T,h]),N=S.useCallback(async()=>{if(!(m!=null&&m.toolsOv)||!u)return[];const e=await Promise.all(m==null?void 0:m.toolsOv.filter(t=>{var r;const n=t.owned>0&&((t==null?void 0:t.tool_name)==="Certified Kol Digger"?!0:t.allowed===1)&&Te((i==null?void 0:i.total_points)??0,t);return((s==null?void 0:s.tempid_allow_list.length)??0)===0?n:n&&((r=s==null?void 0:s.tempid_allow_list)==null?void 0:r.some(p=>p===t.template_id))}).map(async t=>{if((t==null?void 0:t.tool_name)==="Certified Kol Digger"){const r=u==null?void 0:u.reduce((p,x)=>{const F=Number(new Date(p.readyat));return Number(new Date(x.readyat))<F?x:p},u[0]);return{...t,...r,last_use:+new Date(`${r.readyat}.000Z`)/1e3-r.cooldown_seconds}}const n=m.stakedTools.find(r=>r.template_id===t.template_id);return{...t,...n,last_use:+new Date(`${t.readyat}.000Z`)/1e3-t.cooldown_seconds}}));ae(e)},[m,u,s==null?void 0:s.tempid_allow_list,i==null?void 0:i.total_points]);o.useEffect(()=>{N()},[N]),o.useEffect(()=>{if(k.value==="rarity"){const e=B.sort((t,n)=>P[t.rarity]-P[n.rarity]||V[t.shine]-V[n.shine]);re(e)}},[B,k.value]),o.useEffect(()=>{const e=setInterval(()=>{l.every(t=>O(E(T(t)))==="MINE")?(v(t=>!t),clearInterval(e)):v(t=>!t)},1e3);return v(t=>!t),()=>clearInterval(e)},[l,T]);const de=e=>{if(f(e==null?void 0:e.deposit)===0&&f(e==null?void 0:e.trialtlm)>0)return"red";if(f(e==null?void 0:e.deposit)>=0)return"green"},ue=e=>{if(f(e==null?void 0:e.deposit)===0&&f(e==null?void 0:e.trialtlm)>0)return`- ${f(e==null?void 0:e.trialtlm)}`;if(f(e==null?void 0:e.deposit)>=0)return f(e==null?void 0:e.deposit)};async function fe(){if(!(i!=null&&i.name))return null;await Fe(500);const e=await xe(i==null?void 0:i.name);C.setState(t=>({...t,user:t.user?{...t.user,userTlm:e}:null})),await te(),await Ie(),await $(),await Ae(),await Be()}const j=o.useMemo(()=>new Date((d==null?void 0:d.timestamp)||new Date),[d==null?void 0:d.timestamp]);async function me(){if(i){_(!0);try{if(!await Ee(i))throw new Error("Claim Mines error from contract");await fe()}catch(e){console.log(e)}finally{_(!1)}}}const O=e=>{const t=e.days?`${e.days}d`:"",n=e.hours?`${e.hours}h`:"",r=e.minutes?`${e.minutes}m`:"";return`${t}${n}${r}${e.seconds}s`};return o.useEffect(()=>{const e=setInterval(()=>{const t=new Date(`${$e(j)}`),n=E(t),r=O(n);if(ie(r),!Ue(we,j)){clearInterval(e);return}},1e3);return()=>clearInterval(e)},[j]),a.jsxs(Pe,{children:[a.jsxs(Ve,{children:["LOAN TOOLS",a.jsx(ze,{isLoading:X||W,onClick:se,children:a.jsx(ke,{})})]}),a.jsxs(Ke,{children:[a.jsxs(Ge,{children:["Deposited TLM:"," ",a.jsxs(Y,{color:de(s),children:[ue(s)," TLM"," ",f(s==null?void 0:s.deposit)<0&&f(s==null?void 0:s.trialtlm)>0&&"(Deposit more TLM)"]})]}),a.jsxs(He,{children:["AW Mining Rewards:"," ",a.jsxs(Y,{color:"green",children:[(d==null?void 0:d.amount.replace(" TLM",""))??"0.0000"," TLM"]}),a.jsx(U,{isLoading:y,disabled:y||((d==null?void 0:d.amount)??0)===0||b!=="0s",onClick:me,rounded:!1,color:"solidBlue",noBorder:!0,children:b!=="0s"?b:"Claim"})]})]}),a.jsx(Ye,{children:ee?new Array(6).fill(0).map((e,t)=>a.jsx(Xe,{},t)):l==null?void 0:l.map((e,t)=>{const{cooldown:n,type:r}=ce(e);return a.jsx(le,{showShine:!0,showNumberBracket:!0,tool:e,children:a.jsxs(qe,{children:[a.jsxs(U,{isLoading:y||I,disabled:y||I||n!=="MINE",onClick:()=>oe(e),rounded:!1,color:"solidBlue",children:[n!=="MINE"?r==="miner"?a.jsx(tt,{}):a.jsx(et,{}):"",n==="MINE"?"Mine":n]}),a.jsxs(Ze,{children:[a.jsxs(q,{children:[a.jsx(We,{}),a.jsx(Z,{children:e.mining_power/10})]}),a.jsxs(q,{children:[a.jsx(nt,{}),a.jsx(Z,{children:e.nft_power/10})]})]})]})},t)})})]})};export{St as default};
