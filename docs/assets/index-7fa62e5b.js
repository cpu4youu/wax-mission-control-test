import{s as x,j as t,R as v,_ as C,e as H,h as K,S as m,k as T,T as S,m as P,l as F,Q as V,q as z,b as d,C as N,D as E,r as I,B as Y}from"./index-89d4724b.js";import{S as g}from"./styles-0e77f795.js";import{d as w}from"./defaultAvatar-09109c74.js";import{S as R}from"./index-9ca0ce0b.js";import{d as J}from"./use-transaction-203875d1.js";import{s as k}from"./sleep-da79c358.js";import{A as X}from"./axios-43b00e28.js";import{t as Z}from"./user-miners-query-307a5653.js";import{u as ee}from"./use-media-4f85126a.js";import"./index.esm-337cae26.js";import"./index-61adf3f0.js";import"./index-53e21840.js";import"./index-a87da05a.js";import"./iconBase-6aac7060.js";const te=x("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",gap:"20px",w:"100%",px:"40px",h2:{mt:"30px",color:"$white500",letterSpacing:"2px",textShadow:" 0px 4px 4px rgba(0, 0, 0, 0.5)"}}),ne=()=>t.jsx(te,{children:t.jsx("h2",{children:"No candidates to this planet"})}),oe=x("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",gap:"20px",w:"100%",px:"40px",".nfts":{w:"100%",h:"70px",br:"10px"}}),re=()=>t.jsxs(oe,{children:[t.jsx(g,{className:"nfts"}),t.jsx(g,{className:"nfts"}),t.jsx(g,{className:"nfts"}),t.jsx(g,{className:"nfts"})]}),ie=x("div",{d:"grid",gridTemplateColumns:"1.5fr 1.35fr 1.15fr 0.95fr",minH:"100px",bg:"rgba(0, 0, 0, .3)",w:"100%",padding:"5px 0","&:hover":{boxShadow:"0px 0px 15px rgba(255,255,255,0.5)"},"@sm":{padding:"0 5px 0 0",gap:"15px",gridTemplateColumns:"0.8fr 1.4fr 0.9fr"}}),se=x("div",{d:"flex",align:"center",justify:"space-around",gap:"50px",margin:"0 auto 0 45px",img:{br:"50%",h:"70px",w:"70px"},variants:{position:{true:{img:{border:"1px solid #EBB309"}},false:{img:{border:"1px solid #5F5F5F"}}}},"@sm":{gap:"0px",margin:"0 auto 0 15px",img:{h:"40px",w:"40px"}}}),ae=x("div",{d:"flex",align:"center",justify:"center",color:"$white500",w:"40px",fs:"24px",fw:"$bold",ff:"$heading","@sm":{fs:"20px"}}),le=x("span",{d:"flex",align:"center",justify:"center",textAlign:"center",color:"$white500",my:"auto",w:"100%",fw:"$bold",fs:"16px",ff:"$heading",lineHeight:"17px","@sm":{justify:"center",fs:"10px"}}),ce=x("span",{d:"flex",align:"center",justify:"center",color:"$white500",gap:"5px",w:"100%",fs:"20px",ff:"$heading","@sm":{d:"none"}}),pe=x("div",{d:"flex",align:"center",justify:"center",color:"$white500",gap:"10px",w:"100%",fs:"20px",ff:"$heading","@sm":{gap:"10px",fs:"10px"}}),xe=v.lazy(()=>C(()=>import("./bolt-6680bd0d.js"),["assets/bolt-6680bd0d.js","assets/index-89d4724b.js","assets/index-55fec1ff.css"])),ue=({data:e,position:o})=>{var p;const n=v.useRef(null);function r(){n!=null&&n.current&&(n.current.src=w)}return t.jsxs(ie,{children:[t.jsxs(se,{position:o<2,children:[t.jsx("img",{ref:n,src:(e==null?void 0:e.image)??w,onError:r,alt:"avatar user image"}),t.jsx(ae,{children:o+1})]}),t.jsx(le,{children:(e==null?void 0:e.givenName)??(e==null?void 0:e.candidate_name)}),t.jsx(ce,{children:e==null?void 0:e.candidate_name}),t.jsxs(pe,{children:[((p=e==null?void 0:e.votes)==null?void 0:p.toLocaleString("en-US"))??0,t.jsx(xe,{type:2})]})]})},fe=x("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",zIndex:"12",w:"100%"}),me=x("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),de=x("h2",{d:"flex",align:"center",justify:"center",gap:"10px",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),ge=x("a",{d:"flex",align:"center",justify:"center",color:"$white500",svg:{mt:"10px",w:"40px",h:"40px"},"@sm":{svg:{mt:"5px",w:"30px",h:"30px"}}}),he=x("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gridArea:"content",padding:"20px 20px 30px",gap:"7px",w:"100%",maxW:"1190px"}),we=x("h2",{d:"flex",align:"center",justify:"center",gap:"10px",color:"$white500",m:"30px 0 30px",w:"100%",svg:{w:"40px",h:"40px"},"@sm":{px:"10px"}}),ve=x("div",{d:"grid",gridTemplateColumns:"1.5fr 1.2fr 1fr 1fr",gridTemplateAreas:"'header header header header' 'content content content content'",mt:"50px",h:"40px",w:"100%",bg:"rgba(0, 0, 0, .3)","@sm":{gridTemplateColumns:"0.8fr 1.4fr 0.9fr"}}),y=x("span",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"20px",ff:"$heading",fw:"$bold",textShadow:"1px 1px 10px black",textAlign:"center",h:"40px","&:nth-child(4)":{pr:"10px"},"@sm":{fs:"10px",fw:"$normal",w:"100% !important"}}),_e=H({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),je=x("div",{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",w:"100%",gap:"30px",">button":{minWidth:"100%",height:"50px",fs:"20px"}}),ye=x("div",{display:"flex",alignItems:"flex-start",justifyContent:"center",w:"100%",gap:"30px","@sm":{flexWrap:"wrap"}}),L=x("div",{display:"flex",alignItems:"center",justifyContent:"flex-start",flexDirection:"column",padding:"40px",h:"100%",w:"100%",bg:"rgba(0, 0, 0, .3)",br:"10px","@md":{padding:"20px"},"@sm":{h:"max-content",padding:"20px"}}),M=x("div",{display:"flex",alignItems:"center",justifyContent:"space-between",h:"100%",w:"450px","@md":{w:"100%"}}),B=x("div",{d:"flex",align:"center",justify:"center",br:"9999999px",border:"5px solid grey",overflow:"hidden",position:"relative",w:"100px",h:"100px",img:{position:"absolute",inset:"-2px",w:"100px",h:"100px"},variants:{rarity:{Abundant:{borderColor:"#737373"},Common:{borderColor:"#232323"},Rare:{borderColor:"#3d74e9"},Epic:{borderColor:"#8719f0"},Legendary:{borderColor:"#da992e"},Mythical:{borderColor:"#d20066"}}},"@sm":{w:"80px",h:"80px",img:{w:"80px",h:"80px"}}}),b=x("div",{display:"flex",alignItems:"flex-start",justifyContent:"center",w:"450px",h:"230px",color:"$white500",mt:"20px",textAlign:"center",fs:"16px",ff:"$heading",maxH:"400px",overflow:"auto",strong:{fs:"26px"},".loading":{background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.15) ,rgba(255, 255, 255, 0.35))",backgroundSize:"400% 400%",animation:`${_e} 1.2s ease-in-out infinite`,h:"100%",w:"100%"},"@md":{w:"100%"},"@sm":{fs:"12px"}}),be={type:"ranking",planet:{label:"Naron",value:"naron"}},G=K((e,o)=>({voteFilters:be,updateVoteFilters:n=>Te(e,n),votePower:0,updateVotePower:n=>Se(e,n),votePowerValue:0,updateVotePowerValue:n=>Ve(e,n)}));function Te(e,o){e(n=>({...n,voteFilters:{...n.voteFilters,...o}}))}function Se(e,o){e(n=>({...n,votePower:o}))}function Ve(e,o){e(n=>({...n,votePowerValue:o}))}async function Ie(e,o,n,r){const{executeTransaction:p}=J(),s=Ce(e,o,n,r);return!!await p(s)}function Ce(e,o,n,r){return{actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:"cpu.mc",permission:"cosign"}],data:{wallet:e.name,type:4}},{account:m.VOTING_MC,name:"claimpower",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,claim_user_cpu:!0}},{account:m.VOTING_MC,name:"castvote",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,new_candidates:o,planet:n,votes:r}}]}}const Ne=async e=>await T({options:{code:m.DAO_WORLDS,index_position:1,limit:"1000",scope:e,table:S.CANDIDATES}}),Ee=async e=>await T({options:{code:m.VOTING_MC,index_position:3,key_type:"i64",limit:"1000",lower_bound:e,upper_bound:e,scope:m.VOTING_MC,table:S.CANDIDATES}}),O=X.create({baseURL:"https://api.alienworlds.io/v2/dao/"});O.interceptors.response.use(e=>e.data,e=>{var n,r;const o=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||e.message;return P.error(o,Z),Promise.reject(e)});const $e=async()=>await T({options:{code:m.VOTING_MC,index_position:1,limit:"1000",scope:m.VOTING_MC,table:S.blocklist}}),Ae=e=>F({queryKey:[V.CANDIDATES,e],queryFn:()=>Re(e||"eyeke"),staleTime:1e3*60*5});async function De(){return await z.invalidateQueries(V.CANDIDATES)}async function Re(e){try{const o=await Ne(e),n=await Ee(e),r=await O.get(`${e}/candidates?walletId=aa`);if(!n||!o)return[];const p=ke(n,o,r),s=await $e();return s!=null&&s.length?p.filter(a=>s==null?void 0:s.some(l=>l.wallet!==a.account)):p}catch(o){return console.log(o),null}}function ke(e,o,n){return o.filter(s=>s.is_active===1).map(s=>{const f=e.find(l=>l.wallet===s.candidate_name),a=n==null?void 0:n.find(l=>l.account===s.candidate_name);return{...s,...a,...f}}).sort((s,f)=>f.votes-s.votes)}const Le=async()=>{const e=await T({options:{code:m.VOTING_MC,index_position:1,limit:"1000",scope:m.VOTING_MC,table:S.CONFIG_MEMBERS}});return(e==null?void 0:e[0])??null},Me=()=>F({queryKey:[V.VOTES],queryFn:()=>Be(),staleTime:1e3*60*5,enabled:!!d.getState().user});async function Q(){return await z.invalidateQueries(V.VOTES)}async function Be(){const e=d.getState().user;if(!e)return{current_vote_power:0,max_vote_power:0};try{const o=await Le(),n=G.getState().updateVotePower,r=e==null?void 0:e.vote_power;let p=(e==null?void 0:e.last_voteclaim_shards)??0,s=(e==null?void 0:e.total_points)??0;if(!(e!=null&&e.total_points)){const l=await N(e.name);s=(l==null?void 0:l.total_points)??0}if(!(e!=null&&e.last_voteclaim_shards)){const l=await E(e.name);p=(l==null?void 0:l.last_voteclaim_shards)??0}let f=r+(s-p);const a=(o==null?void 0:o.max_votes)??0;return f>a&&(f=a),n(f),{current_vote_power:f,max_vote_power:a}}catch(o){return console.log(o),{current_vote_power:0,max_vote_power:0}}}const Pe=({candidates:e,isLoading:o})=>{const n=G(i=>i.votePower),r=d(i=>i.user),p=d(i=>i.updateMember),s=v.useRef(null),f=(e==null?void 0:e.map(i=>({label:i.givenName||i.candidate_name,value:i.candidate_name,...i})))??[],a=[{label:"None",value:"none"},...f],l=a==null?void 0:a[0],[c,U]=I.useState(l),[u,W]=I.useState(l);function $(i,h){h==="first"&&U(i),h==="second"&&W(i)}function A(){return[c==null?void 0:c.value,u==null?void 0:u.value].filter(i=>i!=="none")}async function q(){const i=A();if(!r||!i||((i==null?void 0:i.length)??0)===0||!n)return null;try{if(await Ie(r,i,"eyeke",Number(n))){if(await k(1200),await p(),await k(1e3),await De(),await Q(),r){const _=await N(r==null?void 0:r.name),j=await E(r==null?void 0:r.name);if(!_||!j)return;d.setState({user:{...r,total_points:_==null?void 0:_.total_points,member:j==null?void 0:j.member}})}P.success("Vote successfully registered")}}catch(h){console.log(h)}}function D(){s!=null&&s.current&&(s.current.src=w)}return t.jsxs(je,{children:[t.jsxs(ye,{children:[t.jsx(L,{children:t.jsxs(t.Fragment,{children:[t.jsxs(M,{children:[t.jsx(R,{isLoading:o,onSelected:i=>$(i,"first"),options:a==null?void 0:a.filter(i=>(i==null?void 0:i.value)!==(u==null?void 0:u.value)),title:"None",selected:{label:c==null?void 0:c.label,value:c==null?void 0:c.value},borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),t.jsx(B,{rarity:r==null?void 0:r.avatarrarity,children:t.jsx("img",{ref:s,onError:D,src:c!=null&&c.image?c.image:w,alt:""})})]}),((a==null?void 0:a.length)??0)>0?t.jsx(b,{children:o?t.jsx(g,{className:"loading"}):(c==null?void 0:c.description)||"This candidate doesn't have description"}):t.jsx(b,{children:t.jsx("strong",{children:"No candidates to this planet"})})]})}),t.jsx(L,{children:t.jsxs(t.Fragment,{children:[t.jsxs(M,{children:[t.jsx(R,{isLoading:o,onSelected:i=>$(i,"second"),options:a==null?void 0:a.filter(i=>(i==null?void 0:i.value)!==(c==null?void 0:c.value)),title:"None",selected:{label:u==null?void 0:u.label,value:u==null?void 0:u.value}}),t.jsx(B,{rarity:r==null?void 0:r.avatarrarity,children:t.jsx("img",{ref:s,onError:D,src:u!=null&&u.image?u.image:w,alt:""})})]}),((a==null?void 0:a.length)??0)>0?t.jsx(b,{children:o?t.jsx(g,{className:"loading"}):(u==null?void 0:u.description)||"This candidate doesn't have description"}):t.jsx(b,{children:t.jsx("strong",{children:"No candidates to this planet"})})]})})]}),t.jsx(Y,{onClick:q,disabled:n<=0||A().length===0,color:"solidBlue",noBorder:!0,rounded:!1,children:"Cast Vote"})]})},Fe=v.lazy(()=>C(()=>import("./bolt-6680bd0d.js"),["assets/bolt-6680bd0d.js","assets/index-89d4724b.js","assets/index-55fec1ff.css"])),ze=v.lazy(()=>C(()=>import("./info-builder-ef74074f.js"),["assets/info-builder-ef74074f.js","assets/index-89d4724b.js","assets/index-55fec1ff.css"])),nt=()=>{var f,a;const{isSmall:e}=ee(),{data:o}=Me(),{data:n,isLoading:r}=Ae("eyeke"),p=d(l=>l.user);async function s(){if(Q(),p){const l=await N(p==null?void 0:p.name),c=await E(p==null?void 0:p.name);if(!l||!c)return;d.setState({user:{...p,total_points:l==null?void 0:l.total_points,member:c==null?void 0:c.member}})}}return I.useEffect(()=>{s()},[]),t.jsxs(fe,{children:[t.jsxs(me,{children:[t.jsxs(de,{children:["Eyeke Voting",t.jsx(ge,{href:"https://medium.com/mining-matters/feature-spotlight-voting-db0d7d9354e6",target:"_blank",children:t.jsx(ze,{})})]}),t.jsx("img",{src:"/assets/background/bg-voting.jpeg",alt:""})]}),t.jsxs(he,{children:[t.jsxs(we,{children:[(f=o==null?void 0:o.current_vote_power)==null?void 0:f.toLocaleString("en-US")," /"," ",(a=o==null?void 0:o.max_vote_power)==null?void 0:a.toLocaleString("en-US")," ",t.jsx(Fe,{type:2})]}),t.jsx(Pe,{isLoading:r,candidates:n}),t.jsxs(ve,{children:[t.jsx(y,{children:"Rank"}),t.jsx(y,{children:"Candidate"}),!e&&t.jsx(y,{children:"Wallet"}),t.jsx(y,{children:"Votes"})]}),r?t.jsx(re,{}):(n==null?void 0:n.length)===0?t.jsx(ne,{}):n==null?void 0:n.map((l,c)=>t.jsx(ue,{position:c,data:l},l.candidate_name))]})]})};export{nt as default};
