import{s as i,e as U,aC as q,V as z,W as Y,aD as J,b as K,X as b,R as d,f as v,a1 as X,a2 as I,d as k,aw as N,aE as $,j as s,p as l,B as Z,av as W,a8 as ee,h as te,U as ae,aF as se,$ as ne,a0 as re,az as ie,aG as oe,aH as ce,aI as de,aJ as le,q as ue,Q as fe}from"./index-c9738f27.js";import{C as pe}from"./index-c3e626e5.js";import{P as xe}from"./pickaxe-fb803adc.js";const me=i("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),ge=i("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),we=i("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),he=i("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),ye=i("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),_e=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),je=i("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),F=i("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{filter:"drop-shadow(3px 5px 2px rgb(0 0 0 / 0.6))",w:"20px",h:"20px"}}),R=i("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"2px 1px 4px rgba(0, 0, 0)",fs:"14px",ff:"$heading",fw:"400"}),be=U({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),ve=i("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${be} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Te=[{label:"Sort by rarity",value:"rarity"}],Ee=()=>{const{data:a}=q(),{data:u}=z(),{data:f}=Y(),{data:c,isLoading:V}=J(),m=K(e=>e.user),T=b(e=>e.isCalculating),A=b(e=>e.updateIsCalculating),L=b(e=>e.updateMineButtonLoading),[S,O]=d.useState([]),[g,P]=d.useState([]),[C,M]=d.useState(!1),[E]=d.useState(Te[0]),[,y]=d.useState(!1);async function Q(e){try{const t=await Promise.all(ie.map(async p=>{const w=await oe(p);return{title:p,img:`/assets/planets/${p}.png`,data:(w==null?void 0:w.pool_buckets.map(x=>({...x,value_formatted:l(x==null?void 0:x.value)??0})))??[]}})),n=ce(t),r=await de(n,"red",e),o=le(r);return ue.setQueriesData([fe.LANDS,"red",e],{list:r,highestValue:o}),{list:r,highestValue:o}}catch(t){console.log(t);return}}async function G(e){var t,n,r;if(m){M(!0),L(!0);try{await ee(),A(!0),await te(500);const o=await Q(e);if(!((t=o==null?void 0:o.highestValue)!=null&&t.asset_id))throw new Error("No land found");const p=(n=o.highestValue)==null?void 0:n.asset_id,w=(u==null?void 0:u.current_land)===p?void 0:p,{getAssetByAssetId:x}=ae,H=await x(String(e.next_asset_id)),D=f==null?void 0:f.allData.find(j=>j.template_id===Number(H.template.template_id));if(!D)return;await se({user:m,next_tool:[D],assets_ids:[e.next_asset_id],land_asset_id:w,old_bag_assets_ids:((r=f==null?void 0:f.userTools)==null?void 0:r.map(j=>Number(j.asset_id)))??[]})&&(await ne(m==null?void 0:m.name),await re())}catch(o){console.error("Error on MINE tool",o)}finally{L(!1),M(!1)}}}const h=v.useCallback(e=>{const t=e.cooldown_seconds*1.6;return X(t,{userTools:[e],allData:[]},u)},[u]),_=v.useCallback(e=>I(k(h(e))),[h]),B=v.useCallback(async()=>{if(!(c!=null&&c.toolsOv))return[];const e=await Promise.all(c==null?void 0:c.toolsOv.filter(t=>{var n;return((a==null?void 0:a.tempid_allow_list.length)??0)===0?t.owned>0&&t.allowed===1:t.owned>0&&t.allowed===1&&((n=a==null?void 0:a.tempid_allow_list)==null?void 0:n.some(r=>r===t.template_id))}).map(async t=>{const n=c.stakedTools.find(r=>r.template_id===t.template_id);return{...t,...n,last_use:+new Date(`${t.readyat}.000Z`)/1e3-t.cooldown_seconds}}));O(e)},[c]);return d.useEffect(()=>{B()},[B]),d.useEffect(()=>{if(E.value==="rarity"){const e=S.sort((t,n)=>N[t.rarity]-N[n.rarity]||$[t.shine]-$[n.shine]);P(e)}},[S,E.value]),d.useEffect(()=>{const e=setInterval(()=>{g.every(t=>I(k(h(t)))==="MINE")?(y(t=>!t),clearInterval(e)):y(t=>!t)},1e3);return y(t=>!t),()=>clearInterval(e)},[g,u,h]),console.log(a),s.jsxs(me,{children:[s.jsx(ge,{children:"LOAN TOOLS"}),s.jsxs(we,{children:["Deposited TLM:"," ",s.jsxs(he,{color:l(a==null?void 0:a.deposit)>=0?"green":"red",children:[l(a==null?void 0:a.deposit)>=0?l(a==null?void 0:a.deposit).toFixed(4):`- ${l(a==null?void 0:a.trialtlm).toFixed(4)}`," ","TLM"," ",l(a==null?void 0:a.deposit)<0&&l(a==null?void 0:a.trialtlm)>0&&"(Deposit more TLM)"]})]}),s.jsx(ye,{children:V?new Array(6).fill(0).map((e,t)=>s.jsx(ve,{},t)):g==null?void 0:g.map((e,t)=>s.jsx(pe,{showNumberBracket:!0,tool:e,children:s.jsxs(_e,{children:[s.jsx(Z,{isLoading:C||T,disabled:C||T||_(e)!=="MINE",onClick:()=>G(e),rounded:!1,color:"solidBlue",children:_(e)==="MINE"?"Mine":_(e)}),s.jsxs(je,{children:[s.jsxs(F,{children:[s.jsx(xe,{}),s.jsx(R,{children:e.mining_power})]}),s.jsxs(F,{children:[s.jsx(W,{}),s.jsx(R,{children:e.pow})]})]})]})},t))})]})};export{Ee as default};
