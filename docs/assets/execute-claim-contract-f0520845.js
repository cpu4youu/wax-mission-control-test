import{S as s}from"./index-8120c00c.js";import{c as u}from"./checkIfHasCpuOnAccount-21305020.js";import{u as c,g as m}from"./showTlmValueFromMine-6637f26d.js";import{s as p}from"./sleep-da79c358.js";import{d as f}from"./use-transaction-28c90eaf.js";async function _(t){const{executeTransaction:o}=f(),n=c.getState().nonce;if(!(n!=null&&n.rand_str))return await m(),!1;const a=n.rand_str,e=await l(t,a);if(!await o(e,{broadcast:!0,sign:!0}))return!1;await p(500);const i=c.getState().updateNonce;return i(void 0),!0}async function l(t,o){const n=await u(),a={actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:"cpu.mc",permission:"cosign"}],data:{wallet:t.name,type:0}},{account:s.M__FEDERATION,name:"mine",authorization:[{actor:t.name,permission:"active"}],data:{miner:t.name,nonce:o,notify:"notify.mc"}}]};return n||a.actions[0].authorization.unshift({actor:t.name,permission:t.authorization.permission}),a}async function z(t,o){if(!o)return _(t);const{executeTransaction:n}=f(),a=c.getState().nonce;if(!(a!=null&&a.rand_str))return await m(),!1;const e=a.rand_str,r=await g(t,e,o),i=await n(r,{broadcast:!0,sign:!0});if(!i)return!1;await p(500);const d=c.getState().updateNonce;return d(void 0),!!i}async function g(t,o,n){const a=await u(),e={max_net_usage_words:5e3,actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:"cpu.mc",permission:"cosign"}],data:{wallet:t.name,type:1}},{account:s.M__FEDERATION,name:"setland",authorization:[{actor:t.name,permission:"active"}],data:{account:t.name,land_id:n}},{account:s.M__FEDERATION,name:"mine",authorization:[{actor:t.name,permission:"active"}],data:{miner:t.name,nonce:o,notify:"notify.mc"}}]};return a||e.actions[0].authorization.unshift({actor:t.name,permission:"active"}),e}export{z as a,_ as e};
