import{s as l,e as ae,S as oe,u as ie,x as de,W as le,V as ce,U as pe,b as S,f as p,j as s,B as j,m as L,L as M,aq as E,n as _,a0 as I}from"./index-10910224.js";import{S as xe}from"./index-c64d9cf6.js";import{u as ue}from"./index-39f38608.js";import{u as me,o as R}from"./inventory-query-ddfb9bfd.js";import{u as fe}from"./mine-query-13affc41.js";import{e as ge}from"./execute-add-favorites-land-contract copy-dbf901bd.js";import{e as q}from"./execute-equip-tools-contract-a8167d5c.js";import{options as v}from"./index-bbc6f4f4.js";import"./index.esm-1372eb61.js";import"./index-37374bc8.js";import"./Combination-b6597974.js";import"./gradient-border-2e9a4e8d.js";import"./info-builder-8b04a960.js";import"./index-ce2ed121.js";import"./index.esm-e64ee05a.js";const he=l("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",maxW:"1190px"}),we=l("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",mt:"30px",mb:"30px",button:{h:"50px",w:"100%",maxW:"230px",div:{fs:"16px",border:"none",br:"10px"}},w:"100%","@sm":{button:{w:"100%",maxW:"100%"}}});l("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}});const je=l("div",{d:"flex",align:"center",justify:"center",direction:"column",margin:"auto",w:"100%","@md":{d:"flex",padding:"0 20px",flexWrap:"wrap"},"@sm":{padding:"0 10px"}}),N=l("h3",{mr:"auto",mb:"25px",fs:"29px",fw:"$bold",ff:"$heading",color:"$white500","@sm":{fs:"18px"}}),Te=l("div",{d:"flex",align:"flex-start",justify:"flex-start",gap:"20px",mt:"25px",mb:"25px","@md":{flexWrap:"wrap"}}),be=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"230px",button:{h:"55px",w:"100%",minW:"100%",maxW:"100%",padding:"0px",mt:"8px",div:{fs:"16px",border:"none",br:"10px"}},"@md":{m:"auto"},"@sm":{}}),ye=l("img",{position:"absolute",top:"-25px",left:"-25px",w:"75px",h:"75px"}),Se=l("img",{w:"100%",h:"114px"}),Le=l("div",{d:"flex",align:"center",justify:"center",gap:"2px 10px",flexWrap:"wrap",padding:"10px",w:"78%",br:"10px",bg:"rgba(255, 255, 255, 0.03)","@md":{w:"100%"},"@sm":{padding:"5px 0px"}}),Q=l("div",{d:"grid",gridTemplateColumns:"1fr 1fr",gap:"1px 7px",w:"100%","@sm":{gridTemplateColumns:"1fr"}}),h=l("div",{d:"grid",gridTemplateColumns:"4fr 1fr",gap:"2px",w:"100%",span:{padding:"10px",bg:"rgba(255, 255, 255, 0.06)",color:"$white500",fs:"16px",fw:"$bold",ff:"$heading",w:"100%"},"@sm":{span:{fs:"12px"}}}),_e=l("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",mb:"25px",">div":{d:"flex",align:"flex-start",justify:"flex-start",w:"100%",button:{w:"100%",maxW:"440px"}}}),ve=l("div",{d:"flex",direction:"column",w:"100%",">button":{h:"55px",w:"100%",maxW:"340px",padding:"0px",div:{fs:"16px",br:"10px"}}}),Ce=l("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"20px",mt:"25px",w:"100%"}),H=l("div",{d:"flex",direction:"column",gap:"6px",img:{w:"220px",h:"325px"},">button":{h:"35px",w:"100%",minW:"100%",br:"10px",padding:"0px",div:{fs:"16px",br:"10px"}},"@sm":{w:"46%",img:{w:"100%",h:"auto"}}}),Be=ae({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),z=l("div",{d:"flex",w:"200px",h:"330px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Be} 1.2s ease-in-out infinite`,"@sm":{h:"230px",w:"46%"}});async function Pe(w,m){const{executeTransaction:e}=ie(),C=ke(w,m);return!!await e(C)}function ke(w,m){return{actions:[{account:oe.MEMBERS_MC,name:"addfavtools",authorization:[{actor:w.name,permission:w.requestPermission}],data:{wallet:w.name,asset_ids:m}}]}}const Ge=()=>{var A,$;const w=de(),{data:m}=fe(),{data:e,isLoading:C}=le(),{data:b,isLoading:D}=me("tool.worlds",!0,!0),{data:a}=ce(),{data:y}=pe(),d=S(n=>n.user),[f,g]=p.useState(!1),[G,O]=p.useState(v.find(n=>n.value===(d==null?void 0:d.miningType))??v[1]),x=p.useMemo(()=>y==null?void 0:y.find(n=>n.landtype_id===(a==null?void 0:a.cardid)),[y,a==null?void 0:a.cardid]),o=p.useMemo(()=>{var t,r,i,c,T,F;return[((r=(t=e==null?void 0:e.userTools)==null?void 0:t[0])==null?void 0:r.cooldown_seconds)??0,((c=(i=e==null?void 0:e.userTools)==null?void 0:i[1])==null?void 0:c.cooldown_seconds)??0,((F=(T=e==null?void 0:e.userTools)==null?void 0:T[2])==null?void 0:F.cooldown_seconds)??0].toSorted((te,re)=>re-te)},[e==null?void 0:e.userTools]),u=p.useCallback(()=>{const n=(x==null?void 0:x.cooldown_mod)??0;return!(o!=null&&o[0])||!o?0:!(o!=null&&o[1])&&!(o!=null&&o[2])?o[0]*(n/10):o!=null&&o[2]?(o[0]+o[1])*(n/10):(o[0]+o[1]/2)*(n/10)},[o,x]),B=p.useMemo(()=>((e==null?void 0:e.userTools)||[]).reduce((t,r)=>{const i=r==null?void 0:r.rarity;return t[i]?{...t,[i]:t[i]+(Number(r==null?void 0:r.mining_power)??0)}:{...t,[i]:(r==null?void 0:r.mining_power)??0}},{}),[e==null?void 0:e.userTools]),W=p.useCallback(()=>Object.keys(B).map(n=>{const t=B[n]*((x==null?void 0:x.mining_power_mod)??0)/1e4;return{rarity:n,percentage:(t>=.8?.8:t)*100}}).filter(n=>n.percentage>0),[B,x]),P=p.useCallback(()=>W().reduce((t,r)=>{var c;const i=r.percentage/100*(((c=m==null?void 0:m.pool_buckets.find(T=>(T==null?void 0:T.key)===r.rarity))==null?void 0:c.formattedValue)??0);return t+i},0),[W,m==null?void 0:m.pool_buckets]),k=p.useCallback(()=>{var t;return(((t=e==null?void 0:e.userTools)==null?void 0:t.reduce((r,i)=>r+(i==null?void 0:i.nft_power),0))??0)*((x==null?void 0:x.nft_power_mod)??0)/100},[x,e==null?void 0:e.userTools]),V=p.useMemo(()=>u()/60,[u]),Y=p.useMemo(()=>P()/(u()>=0?u():1)*3600,[P,u]),K=p.useMemo(()=>k()/(u()>=0?u():1)*3600,[k,u]),J=p.useMemo(()=>3600/(u()>=0?u():1),[u]);function U(n){ue.setState({selectedPage:n})}async function X(){if(!(!(a!=null&&a.current_land)||!d)){g(!0);try{if(await ge(d,a==null?void 0:a.current_land)){await L(1e3);const t=await M(d==null?void 0:d.name);S.setState(r=>({...r,user:r.user?{...r.user,...t}:null})),await E(),_.success("Current Land added to favorites")}}catch(n){console.error(n)}finally{g(!1)}}}async function Z(){var n,t;if(!(!(e!=null&&e.userTools)||!d)){g(!0);try{if(await Pe(d,(t=(n=e==null?void 0:e.userTools)==null?void 0:n.map(({asset_id:i})=>i))==null?void 0:t.join(","))){await L(1e3);const i=await M(d==null?void 0:d.name);S.setState(c=>({...c,user:c.user?{...c.user,...i}:null})),await E(),_.success("Current Tools added to favorites")}}catch(r){console.error(r)}finally{g(!1)}}}async function ee(n){var t;if(!(!(e!=null&&e.userTools)||!d)){g(!0);try{const r=(t=e==null?void 0:e.userTools)==null?void 0:t.map(({asset_id:c})=>Number(c));await q(d,[...r,Number(n.asset_id)])&&(await L(1e3),await I(),await R("tool.worlds"),_.success("Tool added to current setup"))}catch(r){console.error(r)}finally{g(!1)}}}async function ne(n){var t;if(!(!(e!=null&&e.userTools)||!d)){g(!0);try{const r=(t=e==null?void 0:e.userTools)==null?void 0:t.filter(({asset_id:c})=>c!==n.asset_id).map(({asset_id:c})=>Number(c));await q(d,r)&&(await L(1e3),await I(),await R("tool.worlds"),_.success("Tool removed from current setup"))}catch(r){console.error(r)}finally{g(!1)}}}function se(n){S.setState(t=>({...t,user:t.user?{...t.user,miningType:(n==null?void 0:n.value)??"gold"}:null})),O(n??v[1]),localStorage.setItem("miningType",(n==null?void 0:n.value)??"gold")}return s.jsxs(he,{children:[s.jsxs(we,{children:[s.jsx(j,{color:"solidBlue",onClick:()=>U("selection"),children:"Land Selection"}),s.jsx(j,{color:"solidBlue",onClick:()=>U("favorites"),children:"Favorites"}),s.jsx(j,{color:"solidBlue",onClick:()=>w("/tool-tactician"),children:"Tools Tactician"})]}),s.jsxs(je,{children:[s.jsx(N,{children:"Current Selection"}),s.jsxs(Te,{children:[s.jsxs(be,{children:[s.jsx(ye,{src:`/assets/planets/${a==null?void 0:a.planetName.toLowerCase()}.png`,alt:a==null?void 0:a.planetName,title:a==null?void 0:a.planetName}),s.jsx(Se,{src:`/assets/lands/${a==null?void 0:a.landName}.webp`,alt:a==null?void 0:a.landName,title:a==null?void 0:a.landName}),s.jsx(j,{noBorder:!0,isLoading:f,disabled:f,color:"gradientYellow",onClick:X,children:"Add to favorites"})]}),s.jsxs(Le,{children:[s.jsxs(Q,{children:[s.jsxs(h,{children:[s.jsx("span",{children:"Cooldown"}),s.jsxs("span",{children:[Math.round(V)," min"]})]}),s.jsxs(h,{children:[s.jsx("span",{children:"Mines per hour"}),s.jsx("span",{children:J.toLocaleString("US-en")})]}),s.jsxs(h,{children:[s.jsx("span",{children:"Shards per mine"}),s.jsx("span",{children:k().toLocaleString("US-en")})]}),s.jsxs(h,{children:[s.jsx("span",{children:"Shards per hour"}),s.jsx("span",{children:K.toLocaleString("US-en")})]})]}),s.jsxs(Q,{children:[s.jsxs(h,{children:[s.jsx("span",{children:"Estimated average TLM per mine"}),s.jsx("span",{children:P().toLocaleString("US-en")})]}),s.jsxs(h,{children:[s.jsx("span",{children:"Estimated average TLM per hour"}),s.jsx("span",{children:Y.toLocaleString("US-en")})]}),s.jsxs(h,{children:[s.jsx("span",{children:"Commission"}),s.jsxs("span",{children:[((a==null?void 0:a.commission)??0)/100," %"]})]}),s.jsxs(h,{children:[s.jsx("span",{}),s.jsx("span",{})]})]})]})]}),s.jsxs(_e,{children:[s.jsx(N,{children:"Mine Button"}),s.jsx(xe,{borderColor1:"#FFB31F",borderColor2:"#FFB800",className:"select",title:"",selected:G,options:v,onSelected:se})]}),s.jsxs(ve,{children:[s.jsx(N,{children:"Tools"}),s.jsx(j,{noBorder:!0,color:"gradientYellow",onClick:Z,isLoading:f,disabled:f,children:"Add current setup to favorites"}),s.jsxs(Ce,{children:[C?Array.from({length:3}).map((n,t)=>s.jsx(z,{},t)):(A=e==null?void 0:e.userTools)==null?void 0:A.map(n=>s.jsxs(H,{children:[s.jsx("img",{loading:"lazy",src:`https://ipfs.alienworlds.io/ipfs/${n.img}`,alt:n.name,title:n.name}),s.jsx(j,{isLoading:f,disabled:f,onClick:()=>ne(n),noBorder:!0,children:"Unequip"})]},n.asset_id)),D?Array.from({length:7}).map((n,t)=>s.jsx(z,{},t)):($=b==null?void 0:b.filter(n=>{var t;return!((t=e==null?void 0:e.userTools)!=null&&t.some(({asset_id:r})=>r===n.asset_id))}))==null?void 0:$.map(n=>{var t;return s.jsxs(H,{children:[s.jsx("img",{src:`https://ipfs.alienworlds.io/ipfs/${n.data.img}`,alt:n.data.name,title:n.data.name}),s.jsx(j,{isLoading:f,disabled:f||((t=e==null?void 0:e.userTools)==null?void 0:t.length)===3,onClick:()=>ee(n),noBorder:!0,color:"solidBlue",children:"Equip"})]},n.asset_id)})]})]})]})]})};export{Ge as default};
