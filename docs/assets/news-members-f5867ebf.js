import{k as c,S as s,T as l,i as _,l as M,q as w,Q as u,n as S}from"./index-842551e9.js";import{i as E}from"./index-21d98e6b.js";const d=async()=>await c({options:{code:s.USPTS_WORLDS,index_position:1,limit:"10000",reverse:!0,key_type:"i64",scope:s.USPTS_WORLDS,table:l.LEVEL_OFFERS}}),y=async e=>{var t,n;let a=!1,o;const i=[];for(;!a;){const r=await _.get_table_rows({code:s.MEMBERS_MC,index_position:1,limit:"10000",key_type:"i64",scope:s.MEMBERS_MC,table:l.MEMBERS,lower_bound:e??o,upper_bound:e,json:!0});a=!r.more,i.push(...r.rows.slice(0,-1)),o=((n=(t=r.rows)==null?void 0:t[r.rows.length-1])==null?void 0:n.wallet)??""}return i},f=async e=>await c({options:{code:s.MEMBERS_MC,limit:"10000",reverse:!0,scope:s.MEMBERS_MC,table:l.suplog,index_position:2,lower_bound:e,upper_bound:e}}),v=()=>M({queryKey:[u.NEWS_MEMBERS],queryFn:()=>g(),staleTime:1e3*60*60});async function T(){return await w.invalidateQueries(u.NEWS_MEMBERS)}async function g(){try{const e=await y(),a=await d();if(!e||!a)return null;const o=await m(e,a);return console.log(o),o}catch(e){return console.log(e),null}}async function m(e,a){const o=e==null?void 0:e.filter(t=>t.trial&&!t.flagged&&E(S,new Date(t.next_review)));return(await Promise.all(o.map(async t=>{var r;return{...await f(t.wallet),...t,avatar:t.avatar.split(";")[0],avatarCollection:t.avatar.split(";")[1],newMemberLevel:((r=a.find(p=>t.mcp_start>=p.required))==null?void 0:r.level)??1}}))).sort((t,n)=>n.member_id-t.member_id)}export{T as o,v as u};
