import{s as p,i as $e,k as ze,u as be,j as a,e as Ve,t as Pe,r as S,h as ve,q as je,Q as Me,R as Y,_ as X,B as Qe}from"./index-27a86a37.js";import{a as We}from"./index.esm-576e87af.js";import{F as Ge}from"./index.esm-f3976eda.js";import{f as Ke}from"./format-currency-usd-c3f487ff.js";import{f as ie}from"./formatNumber-be910684.js";import{a as ye,c as H,d as A}from"./mineCooldown-12c3d020.js";import{u as Ue}from"./use-wharfkit-f1040bee.js";import{u as Be}from"./use-media-5f9e67e2.js";import{a as qe,e as Ce}from"./execute-claim-contract-0e629c96.js";import{u as $,g as He,s as oe}from"./showTlmValueFromMine-77b4f503.js";import{s as k}from"./sleep-da79c358.js";import{u as Ye,o as De}from"./lands-query-ef5327f6.js";import{c as se,a as Le}from"./calculateShardsByLand-0f159702.js";import{u as Xe,r as Se,o as Ee}from"./tools-query-b8263576.js";import{u as Ze,o as Te}from"./user-miners-query-b633dad6.js";import{u as Je,o as et}from"./lands-query-9b5bfcb3.js";import{u as tt,o as nt}from"./get-user-settings-assets-query-8c895648.js";import{u as at,o as it}from"./wallets-query-8372772e.js";import{u as ot,o as st,g as rt}from"./tool-query-4d5b591d.js";import{u as lt,f as ct,o as dt,g as pt,e as ft}from"./execute-mine-tool-contract-f1cbcaf6.js";import{o as mt}from"./miner-claim-37085ec2.js";import{o as ut}from"./toolov-query-e6a820fa.js";import"./iconBase-853790c7.js";import"./index-5752e27c.js";import"./index-dbd5f782.js";import"./use-transaction-1533d77c.js";import"./toast-options-c01c4e1b.js";import"./lands-8d770e9a.js";import"./adapters-4dbbe042.js";import"./axios-45629df5.js";const gt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",my:"auto","@sm":{ml:"auto",my:"auto"}}),xt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",cursor:"pointer",mr:"auto",position:"relative"}),ht=p("img",{w:"100%",h:"60px",mb:"10px",objectFit:"contain","@sm":{w:"80px",h:"80px"}}),wt=p("div",{d:"flex",align:"center",justify:"center",zIndex:3,position:"absolute",bottom:"-10px",left:"0px",w:"30px",h:"30px",br:"10px","-webkit-text-stroke":"1px white",letterSpacing:"1px",color:"#00D1FF",fw:"900",fs:"20px",ff:"$heading",border:"2px solid white",background:"#D9D9D9",backdropFilter:"blur(15px)"}),yt=p("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%","@sm":{d:"none"}}),Tt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",mb:"10px",minW:"200px",w:"100%"}),bt=p("div",{d:"flex",align:"center",justify:"center",position:"relative",boxShadow:"2px 2px 10px #000000",w:"100%",h:"10px",br:"3px",bg:"#595959"}),_t=p("div",{d:"flex",align:"center",justify:"center",position:"absolute",left:"0px",maxW:"200px",h:"10px",br:"3px",bg:"linear-gradient(90deg, #07A3DD 0%, rgba(0, 186, 255, 0.5) 100%)","&::after":{content:"",position:"absolute",right:"-2px",h:"14px",w:"7px",br:"50%",bg:"$white500",filter:"blur(2px)"}}),vt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",ff:"$heading",fw:"$thin",fs:"12px",color:"$white500","@md":{ml:"auto",fs:"10px"}}),jt=p("div",{d:"flex",align:"center",justify:"space-between",w:"100%","@md":{fs:"12px"}}),Mt=p("button",{d:"flex",align:"center",justify:"center",ff:"$body",fs:"14px",fw:"$normal",color:"$red500",cursor:"pointer","&:hover":{textShadow:"1px 1px 2px red"},"@md":{fs:"12px"}}),Ct=()=>{const i=$e(),{data:h}=ze(),l=be(v=>v.user),{unAuthorize:N}=Ue(),{isSmall:E}=Be(),s=h==null?void 0:h.find(v=>v.level===(l==null?void 0:l.level)),R=((l==null?void 0:l.experience)??0)/((s==null?void 0:s.xp_to_level_up)??100)*100;return a.jsxs(gt,{children:[a.jsx(xt,{onClick:()=>i(E?"/user-settings":"/menu"),children:a.jsx(ht,{src:"/assets/icons/logo.webp",alt:"avatar icon"})}),a.jsxs(yt,{children:[a.jsxs(Tt,{children:[a.jsx(wt,{children:(l==null?void 0:l.level)??1}),a.jsx(bt,{children:a.jsx(_t,{style:{width:`${R}%`}})})]}),a.jsxs(jt,{children:[!E&&a.jsx(Mt,{onClick:N,children:"Logout"}),a.jsxs(vt,{children:[(l==null?void 0:l.experience)??0,"/",(s==null?void 0:s.xp_to_level_up)??100," ",!E&&"XP"]})]})]})]})},Dt=p("div",{d:"flex",align:"center",justify:"space-between",w:"100%",position:"relative",zIndex:20,bg:"$blue700"}),Lt=p("div",{d:"flex",align:"center",justify:"space-between",zIndex:20,w:"100%",px:"30px",h:"140px","@media(max-width:1224px)":{minW:"100%"},"@md":{px:"15px"},"@sm":{}}),St=p("div",{d:"flex",align:"center",justify:"center",gap:"20px",">a":{d:"flex",align:"center",justify:"center",svg:{h:"28px",w:"28px"}},svg:{color:"$white500",h:"22px",w:"22px"},zIndex:30,button:{"&:disabled":{opacity:.5}},"@sm":{order:-1,justify:"space-between",w:"max-content",button:{d:"none","&:last-of-type":{d:"flex",zIndex:2,svg:{h:"35px",w:"35px"}}}},"@xxsm":{">a":{top:"10px",position:"absolute"}}}),Et=Ve({"100%":{transform:"rotate(360deg)"}}),Rt=p("button",{color:"$white500",svg:{ml:"10px",color:"$white500",w:"25px",h:"25px"},variants:{isLoading:{true:{pointerEvents:"none",opacity:"0.5",svg:{animation:`${Et} 1s linear`,animationIterationCount:"infinite"}},false:{pointerEvents:"all",opacity:"1"}}}}),$t=p("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"3px",w:"100%",">button":{h:"30px",minW:"150px",fs:"20px"},span:{textTransform:"uppercase",color:"$white500",fs:"10px",fw:"$bold",ff:"$heading"},"@sm":{w:"max-content",position:"absolute",left:"50%",transform:"translateX(-50%)"}}),Bt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"10px",width:"310px","@md":{width:"max-content",margin:"0",gap:"7px"},"@sm":{d:"none"}});p("button",{d:"flex",align:"center",justify:"center",ml:"10px"});const Ft=p("div",{d:"flex",align:"flex-end",justify:"center",gap:"20px",mt:"20px"}),re=p("div",{d:"flex",align:"center",justify:"space-between",direction:"column",color:"$white500",w:"max-content",fs:"14px",svg:{w:"25px",h:"25px"}}),le=p("div",{d:"flex",align:"center",justify:"center",direction:"column",padding:"5px",w:"35px",h:"35px",border:"1px solid $white500",borderRadius:"$full"}),It=p("div",{d:"flex",align:"center",justify:"center",">button>div":{d:"flex",align:"center",justify:"center"},"@sm":{gap:"10px",">button>div":{direction:"column"}}}),At=p("div",{d:"flex",align:"center",justify:"center",gap:"5px",ml:"10px",fs:"20px",ff:"$body",color:"$white500",path:{fill:"$white500"}}),kt=p("p",{ff:"$heading",fs:"20px",fw:"$bold",textShadow:"1px 1px 2px black",color:"$yellow500"});function Nt(){const{isSmall:i}=Be(),h=$e(),{data:l,isLoading:N,isFetching:E}=Ze(),{data:s,isLoading:R,isFetching:v}=Xe(),{data:O}=Je(),{data:z,isLoading:ce}=Ye(),{data:b}=tt(),{data:g,isFetching:de}=at(),{data:j,isLoading:Z,isFetching:Q}=ot(),{data:m,isFetching:pe}=lt(),e=be(t=>t.user),fe=be(t=>t.updateAuth),V=$(t=>t.nonce),_=$(t=>t.updateIsCalculating),me=$(t=>t.isMineButtonLoading),W=$(t=>t.updateMineButtonLoading),G=$(t=>t.isCalculating),K=$(t=>t.updateNonce),ue=$(t=>t.hashExpire),ge=$(t=>t.updateHashExpire),J=$(t=>t.updateMineCooldown),U=Pe(t=>t.currentWeek),[xe,F]=S.useState(new Date),[q,M]=S.useState(!1),[u,ee]=S.useState(void 0),[C,w]=S.useState(null),d=!(e!=null&&e.isMember)||(e==null?void 0:e.flagged),_e=async()=>{if(!e)return null;M(!0),_(!0);try{if(!await qe(e))throw new Error("MINE error from contract");await oe(e==null?void 0:e.name)}catch(t){console.log(t)}finally{await k(800),_(!1),await P(),M(!1)}},Fe=async()=>{var t,f;M(!0);try{await De(),_(!0),await k(1e3);const[[o,D]]=je.getQueriesData(Me.LANDS),x=((t=z==null?void 0:z.highestValue)==null?void 0:t.asset_id)||((f=D.highestValue)==null?void 0:f.asset_id);if(!e||!x)return null;await Ce(e,x)&&(await oe(e==null?void 0:e.name),await P())}catch(o){console.log(o)}finally{_(!1),M(!1)}},te=({delay:t})=>{var x,y,n,c,r,T,L,I,ae;const f=(t??0)/10;if(((x=s==null?void 0:s.userTools)==null?void 0:x.length)===1){const B=f*(((n=(y=s==null?void 0:s.userTools)==null?void 0:y[0])==null?void 0:n.delay)??0);return A(B,s,l,F)}const o=(c=s==null?void 0:s.userTools)==null?void 0:c.sort((B,Oe)=>Oe.delay-B.delay);if(((r=s==null?void 0:s.userTools)==null?void 0:r.length)===2){const B=f*((((T=o==null?void 0:o[0])==null?void 0:T.delay)??0)+(((L=o==null?void 0:o[1])==null?void 0:L.delay)??0)/2);return A(B,s,l,F)}const D=f*((((I=o==null?void 0:o[0])==null?void 0:I.delay)??0)+(((ae=o==null?void 0:o[1])==null?void 0:ae.delay)??0));return A(D,s,l,F)},ne=()=>{var x,y;if(!O||!(b!=null&&b.favoriteLands))return null;let t=[];const f=b==null?void 0:b.favoriteLands.filter(([n])=>ye(H(te({delay:n.delay})))==="MINE");if(f.length>0)t=f;else{const n=Math.min(...b.favoriteLands.map(([r])=>H(te({delay:r.delay})).difference));t=b.favoriteLands.filter(([r])=>H(te({delay:r.delay})).difference===n)}if((e==null?void 0:e.miningType)==="orange"){const n=Math.max(...t.map(([r])=>se({land:r})));return{...(x=t.filter(([r])=>se({land:r})===n).flatMap(([r])=>r))==null?void 0:x[0]}}const o=Math.max(...t.map(([n])=>Le({landCardId:n.cardid,landsType:O,userTools:s==null?void 0:s.userTools})));return{...(y=t.filter(([n])=>Le({landCardId:n.cardid,landsType:O,userTools:s==null?void 0:s.userTools})===o).flatMap(([n])=>n).sort((n,c)=>se({land:c})-se({land:n})))==null?void 0:y[0]}},Ie=async()=>{M(!0);try{_(!0),await k(500);const t=ne();if(console.log("bestFavoriteLand",t),!e)return null;await Ce(e,t==null?void 0:t.assetId)&&(await oe(e==null?void 0:e.name),await P(),await we())}catch(t){console.log(t)}finally{_(!1),M(!1)}},he=S.useCallback(async()=>{if(!j||!m)return null;const t=await Promise.all(j==null?void 0:j.toolsOv.filter(n=>{var r;const c=n.owned>0&&((n==null?void 0:n.tool_name)==="Certified Kol Digger"?!0:n.allowed===1)&&ct((e==null?void 0:e.total_points)??0,n);return((g==null?void 0:g.tempid_allow_list.length)??0)===0?c:c&&((r=g==null?void 0:g.tempid_allow_list)==null?void 0:r.some(T=>T===n.template_id))}).map(async n=>{if((n==null?void 0:n.tool_name)==="Certified Kol Digger"){const r=m==null?void 0:m.reduce((T,L)=>{const I=Number(new Date(T.readyat));return Number(new Date(L.readyat))<I?L:T},m[0]);return{...n,...r,last_use:+new Date(`${r.readyat}.000Z`)/1e3-r.cooldown_seconds}}const c=j.stakedTools.find(r=>r.template_id===n.template_id);return{...n,...c,last_use:+new Date(`${n.readyat}.000Z`)/1e3-n.cooldown_seconds}})),f=t==null?void 0:t.filter(n=>{const c=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6;return ye(H(A(c,{userTools:[n],allData:[]},l)))==="MINE"});let o=null;f.length>0?o=f.sort((n,c)=>Se[n.rarity]-Se[c.rarity]||c.mining_power-n.mining_power)[0]:o=t==null?void 0:t.reduce((n,c)=>{const r=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6,L=+A(r,{userTools:[n],allData:[]},l),I=((c==null?void 0:c.tool_name)==="Certified Kol Digger"?500:c.cooldown_seconds)*1.6,B=+A(I,{userTools:[c],allData:[]},l);return B<L?{...c,cooldownSec:B}:{...n,cooldownSec:L}},t[0]);const D=((o==null?void 0:o.tool_name)==="Certified Kol Digger"?500:o.cooldown_seconds)*1.5,y=A(D,{userTools:[o],allData:[]},l);return F(y),o},[m,l,j,e,g]),Ae=async()=>{var t,f;M(!0);try{const o=await he();if(!o||!e||!m)return;await De(),_(!0),await k(500);let D=0,x,y=[];if((o==null?void 0:o.tool_name)==="Certified Kol Digger"){const c=m==null?void 0:m.reduce((r,T)=>{const L=Number(new Date(r.readyat));return Number(new Date(T.readyat))<L?T:r},m[0]);D=c.asset_ids.length*o.pow,y=c.asset_ids.map(r=>Number(r)),x="1099512958237"}else{const[c]=await rt(`${o.template_id}`);D=c.pow,y=[c.next_asset_id];let r;try{[[,r]]=je.getQueriesData([Me.LANDS,"red",o])}catch{r=await pt(o)}x=(t=r.highestValue)==null?void 0:t.asset_id}await ft({user:e,difficulty:D,assets_ids:y,land_asset_id:x,old_bag_assets_ids:((f=s==null?void 0:s.userTools)==null?void 0:f.map(c=>Number(c.asset_id)))??[]})&&(await k(800),await oe(e==null?void 0:e.name),await P())}catch(o){console.log(o)}finally{W(!1),_(!1),M(!1)}},P=async()=>{if(await Te(),await Ee(),(e==null?void 0:e.miningType)==="red"){await ke(),await k(1e3),he();return}},ke=async()=>{await Te(),await it(),await mt(),await st(),await ut(),await dt()},Ne=()=>{const t=ye(u);return J(t),t},we=async()=>{await Ee(),await et(),await Te(),await nt()};return{user:e,miners:l,mTools:m,tools:s,toolsLoaning:j,toolsWallets:g,bestLand:C,cooldown:Ne,handleRefreshLands:we,playSound:async()=>{const t=new Audio("https://play.alienworlds.io/sounds/aw-mining-claim-sfx-02.mp3");i&&await k(1e3),t.play()},textAboveButton:()=>{var t;return d?"Not a Member":(e==null?void 0:e.miningType)==="green"?"Favorites (shards)":(e==null?void 0:e.miningType)==="orange"?"Favorites (TLM)":(e==null?void 0:e.miningType)==="gold"?"Mining":(e==null?void 0:e.miningType)==="blue"?"Mine Maximizer":(e==null?void 0:e.miningType)==="red"?`Deposit: ${ve(g==null?void 0:g.deposit).toFixed(4)} TLM`:`Deposit: ${(ve((t=e==null?void 0:e.HqMember)==null?void 0:t.deposit)+((e==null?void 0:e.tlm_deposit)??0)/1e4).toFixed(4)} TLM`},textBelowButton:()=>d?"Become a member to use mine":(e==null?void 0:e.miningType)==="red"?"Tool Loaning":(e==null?void 0:e.miningType)==="gold"||(e==null?void 0:e.miningType)==="blue"?`${l!=null&&l.name?l==null?void 0:l.name:""}`:`${C!=null&&C.name?C==null?void 0:C.name:""}`,buttonOnClick:async()=>{if(d)return h("/membership");if(!(V!=null&&V.rand_str)&&!G){_(!0),await He();const t=new Date;ge(t.setMinutes(t.getMinutes()+1))}return(e==null?void 0:e.miningType)==="red"?(await P(),Ae(),null):(e==null?void 0:e.miningType)==="blue"?(Fe(),null):(e==null?void 0:e.miningType)==="gold"?(_e(),null):(e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange"?(await we(),Ie(),null):_e()},loading:()=>{const t=((u==null?void 0:u.seconds)??0)<0&&((u==null?void 0:u.minutes)??0)<0&&((u==null?void 0:u.hours)??0)<0,f=(e==null?void 0:e.miningType)==="red"?Z:!1;return G||q||me||ce||R||Q||v||N||E||de||pe||!u||t||f},miningType:()=>(e==null?void 0:e.miningType)==="gold"?"gradientYellow":(e==null?void 0:e.miningType)==="orange"?(w(ne()),"gradientOrange"):(e==null?void 0:e.miningType)==="green"?(w(ne()),"gradientGreen"):(e==null?void 0:e.miningType)==="blue"?"gradientBlue":(e==null?void 0:e.miningType)==="red"?"gradientRed":"gradientYellow",minersFetching:E,toolFetching:v,land:z,updateAuth:fe,updateNonce:K,hashExpire:ue,currentWeek:U,expireDate:xe,setToolCooldown:ee,isSmall:i,favorites:b,landsType:O,setExpireDate:F,setBestLand:w,isDisableToMine:d,toolCooldown:u,updateMineCooldown:J,handleRefetch:P,navigate:h,selectBestLandOnFavorites:ne,getBestToolOnTooLoaning:he,calcCooldown:te,nonce:V}}const Re=Y.lazy(()=>X(()=>import("./tlm-966e3314.js"),["assets/tlm-966e3314.js","assets/index-27a86a37.js","assets/index-55fec1ff.css"])),Ot=Y.lazy(()=>X(()=>import("./star-ffaccbbd.js"),["assets/star-ffaccbbd.js","assets/index-27a86a37.js","assets/index-55fec1ff.css"])),zt=Y.lazy(()=>X(()=>import("./atom-8c918397.js"),["assets/atom-8c918397.js","assets/index-27a86a37.js","assets/index-55fec1ff.css"])),Vt=Y.lazy(()=>X(()=>import("./quest-031d8a8f.js"),["assets/quest-031d8a8f.js","assets/index-27a86a37.js","assets/index-55fec1ff.css"])),Pt=Y.lazy(()=>X(()=>import("./open-menu-1e02d2a7.js"),["assets/open-menu-1e02d2a7.js","assets/index-27a86a37.js","assets/index-55fec1ff.css"])),Cn=()=>{var ee,C;const{user:i,miners:h,mTools:l,tools:N,toolsLoaning:E,toolsWallets:s,bestLand:R,cooldown:v,playSound:O,textAboveButton:z,textBelowButton:ce,buttonOnClick:b,loading:g,miningType:de,updateNonce:j,hashExpire:Z,currentWeek:Q,expireDate:m,setToolCooldown:pe,isSmall:e,favorites:fe,landsType:V,setExpireDate:_,setBestLand:me,isDisableToMine:W,handleRefetch:G,navigate:K,selectBestLandOnFavorites:ue,getBestToolOnTooLoaning:ge,calcCooldown:J,nonce:U}=Nt(),xe=()=>W?a.jsx("span",{style:{fontSize:"15px"},children:"Membership"}):U!=null&&U.rand_str&&v()==="MINE"?"Submit":v();S.useEffect(()=>{let w=(h==null?void 0:h.delay)??0;if((i==null?void 0:i.miningType)==="blue"&&(w=15),((i==null?void 0:i.miningType)==="green"||(i==null?void 0:i.miningType)==="orange")&&R&&(w=R==null?void 0:R.delay),(i==null?void 0:i.miningType)==="red"){ge();return}J({delay:w})},[R,l,N,E,s,i]),S.useEffect(()=>{const w=setInterval(()=>{const d=H(m);pe(d),((i==null?void 0:i.miningType)==="orange"||(i==null?void 0:i.miningType)==="green")&&me(ue()),(d==null?void 0:d.hours)===0&&(d==null?void 0:d.minutes)===0&&(d==null?void 0:d.seconds)===1&&O(),(d==null?void 0:d.hours)===0&&(d==null?void 0:d.minutes)===0&&(d==null?void 0:d.seconds)===0&&clearInterval(w)},1e3);return()=>clearInterval(w)},[m,e,fe,V,h,N,i]),S.useEffect(()=>{const w=setInterval(()=>{Z-new Date().getTime()<0&&j(void 0)},3e3);return()=>clearInterval(w)},[Z,j]),S.useEffect(()=>{setInterval(async()=>{await G()},6e4)},[h,l,_,E,s,i]);const F=S.useMemo(()=>de(),[i==null?void 0:i.miningType]),q=g(),M=W?!1:q,u=W?!1:q||v()!=="MINE";return a.jsx(Dt,{children:a.jsxs(Lt,{children:[a.jsx(Ct,{}),a.jsxs(St,{children:[a.jsx(Rt,{disabled:!(i!=null&&i.member),onClick:()=>G(),isLoading:q,children:a.jsx(Ge,{})}),a.jsxs($t,{children:[a.jsx("span",{children:z()}),a.jsx(Qe,{onClick:()=>b(),disabled:u,color:F,isLoading:M,children:xe()}),a.jsx("span",{children:ce()})]}),a.jsx("button",{onClick:()=>K("/user-settings"),children:a.jsx(We,{})}),a.jsx("button",{onClick:()=>K("/menu"),children:a.jsx(Pt,{})})]}),a.jsxs(Bt,{children:[a.jsxs(Ft,{children:[a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Vt,{})}),ie(((ee=i==null?void 0:i.userWeekly)==null?void 0:ee.total_quest_points)??0,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Ot,{})}),ie((i==null?void 0:i.mcPoints)??0,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(zt,{color:"#F6A800"})}),ie(((i==null?void 0:i.redeemable_points)??0)/10,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Re,{})}),ie(Number((C=i==null?void 0:i.userTlm)==null?void 0:C.balance)??0,1)]})]}),a.jsx(It,{children:a.jsx("button",{onClick:()=>K("/week-reward"),children:a.jsxs("div",{children:[a.jsx(kt,{children:"Prize Pool"}),a.jsxs(At,{children:[Ke((Q==null?void 0:Q.initial_prize_pool_formatted)??0),a.jsx(Re,{})]})]})})})]})]})})};export{Cn as Header};
