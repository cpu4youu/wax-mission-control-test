import{s as r,e as G,aC as Y,V as z,W as H,aD as K,b as X,X as w,R as o,f as y,a1 as Z,a2 as k,d as I,aw as B,aE as N,j as s,p as l,B as J,av as W,a7 as ee,h as te,q as ae,Q as se,U as ne,aF as re,$ as ie,a0 as oe}from"./index-1930b603.js";import{C as de}from"./index-d648899b.js";import{P as ce}from"./pickaxe-caca6261.js";const le=r("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),ue=r("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),fe=r("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),pe=r("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),xe=r("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),me=r("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),ge=r("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),$=r("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{filter:"drop-shadow(3px 5px 2px rgb(0 0 0 / 0.6))",w:"20px",h:"20px"}}),F=r("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"2px 1px 4px rgba(0, 0, 0)",fs:"14px",ff:"$heading",fw:"400"}),he=G({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),we=r("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${he} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),ye=[{label:"Sort by rarity",value:"rarity"}],ve=()=>{const{data:a}=Y(),{data:d}=z(),{data:c}=H(),{data:i,isLoading:A}=K(),u=X(e=>e.user),_=w(e=>e.isCalculating),O=w(e=>e.updateIsCalculating),j=w(e=>e.updateMineButtonLoading),[b,Q]=o.useState([]),[f,R]=o.useState([]),[T,v]=o.useState(!1),[S]=o.useState(ye[0]),[,m]=o.useState(!1);async function V(e){var t,n,x;if(u){v(!0),j(!0);try{await ee(),O(!0),await te(500);const[[C,M]]=ae.getQueriesData([se.LANDS,"red",e]);if(!((t=M.highestValue)!=null&&t.asset_id))throw new Error("No land found");const E=(n=M.highestValue)==null?void 0:n.asset_id,P=(d==null?void 0:d.current_land)===E?void 0:E,{getAssetByAssetId:U}=ne,q=await U(String(e.next_asset_id)),D=c==null?void 0:c.allData.find(h=>h.template_id===Number(q.template.template_id));if(!D)return;await re({user:u,next_tool:[D],assets_ids:[e.next_asset_id],land_asset_id:P,old_bag_assets_ids:((x=c==null?void 0:c.userTools)==null?void 0:x.map(h=>Number(h.asset_id)))??[]})&&(await ie(u==null?void 0:u.name),await oe())}catch(C){console.error("Error on MINE tool",C)}finally{j(!1),v(!1)}}}const p=y.useCallback(e=>{const t=e.cooldown_seconds*1.6;return Z(t,{userTools:[e],allData:[]},d)},[d]),g=y.useCallback(e=>k(I(p(e))),[p]),L=y.useCallback(async()=>{if(!(i!=null&&i.toolsOv))return[];const e=await Promise.all(i==null?void 0:i.toolsOv.filter(t=>t.owned>0&&t.allowed===1&&i.stakedTools.some(n=>n.template_id===t.template_id)).map(async t=>{const n=i.stakedTools.find(x=>x.template_id===t.template_id);return{...t,...n,last_use:+new Date(`${t.readyat}.000Z`)/1e3-t.cooldown_seconds}}));Q(e)},[i]);return o.useEffect(()=>{L()},[L]),o.useEffect(()=>{if(S.value==="rarity"){const e=b.sort((t,n)=>B[t.rarity]-B[n.rarity]||N[t.shine]-N[n.shine]);R(e)}},[b,S.value]),o.useEffect(()=>{const e=setInterval(()=>{f.every(t=>k(I(p(t)))==="MINE")?(m(t=>!t),clearInterval(e)):m(t=>!t)},1e3);return m(t=>!t),()=>clearInterval(e)},[f,d,p]),s.jsxs(le,{children:[s.jsx(ue,{children:"LOAN TOOLS"}),s.jsxs(fe,{children:["Deposited TLM:"," ",s.jsxs(pe,{color:l(a==null?void 0:a.deposit)>=0?"green":"red",children:[l(a==null?void 0:a.deposit)>=0?l(a==null?void 0:a.deposit).toFixed(4):`- ${l(a==null?void 0:a.trialtlm).toFixed(4)}`," ","TLM"," ",l(a==null?void 0:a.deposit)<0&&l(a==null?void 0:a.trialtlm)>0&&"(Deposit more TLM)"]})]}),s.jsx(xe,{children:A?new Array(6).fill(0).map((e,t)=>s.jsx(we,{},t)):f==null?void 0:f.map((e,t)=>s.jsx(de,{showNumberBracket:!0,tool:e,children:s.jsxs(me,{children:[s.jsx(J,{isLoading:T||_,disabled:T||_||g(e)!=="MINE",onClick:()=>V(e),rounded:!1,color:"solidBlue",children:g(e)==="MINE"?"Mine":g(e)}),s.jsxs(ge,{children:[s.jsxs($,{children:[s.jsx(ce,{}),s.jsx(F,{children:e.mining_power})]}),s.jsxs($,{children:[s.jsx(W,{}),s.jsx(F,{children:e.pow})]})]})]})},t))})]})};export{ve as default};
