import{s as n,e as G,m as Y,aE as q,aF as z,W as H,X as K,b as X,Y as E,R as o,f as j,a2 as J,a3 as M,d as D,aG as Z,ax as N,j as s,t as u,B as W,aw as ee,a8 as te,h as ae,q as se,Q as re,V as ne,aH as ie,az as oe,a0 as ce}from"./index-4339d15f.js";import{S as de}from"./index-8eb93c6a.js";import{C as le}from"./index-e0908056.js";import{P as ue}from"./pickaxe-52c8f1d1.js";import"./index.esm-665717f8.js";import"./index-a1ccb693.js";import"./index-3d948859.js";import"./index-50c90bbb.js";import"./gradient-border-92a8bc61.js";const pe=n("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),fe=n("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),me=n("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),xe=n("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),ge=n("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),he=n("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),we=n("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),k=n("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),B=n("p",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"14px",ff:"$heading",fw:"400"}),ye=G({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),be=n("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${ye} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),w=[{label:"Sort by rarity",value:"rarity"}],Me=()=>{const{data:x,isLoading:$}=Y("tool.worlds"),{data:c}=q(),{data:a}=z(),{data:d}=H(),{data:i}=K(),p=X(e=>e.user),S=E(e=>e.isCalculating),A=E(e=>e.updateIsCalculating),[T,Q]=o.useState([]),[f,R]=o.useState([]),[v,C]=o.useState(!1),[L,V]=o.useState(w[0]),[,y]=o.useState(!1);async function P(e){var t;if(p){C(!0);try{await te(),A(!0),await ae(500);const[[r,m]]=se.getQueriesData(re.LANDS),h=(t=m.highestValue)==null?void 0:t.asset_id,l=(d==null?void 0:d.current_land)===h?void 0:h,{getAssetByAssetId:O}=ne,U=await O(String(e.next_asset_id)),I=i==null?void 0:i.allData.find(_=>_.template_id===Number(U.template.template_id));if(!l||!(i!=null&&i.userTools)||!I)return;await ie({user:p,next_tool:[I],assets_ids:[e.next_asset_id],land_asset_id:l,old_bag_assets_ids:i.userTools.map(_=>Number(_.asset_id))})&&(await oe("tool.worlds"),await ce(p==null?void 0:p.name))}catch(r){console.error("Error staking tool",r)}finally{C(!1)}}}const g=j.useCallback(e=>{const t=e.delay*1.6;return J(t,{userTools:[e],allData:[]},d)},[i,d]),b=j.useCallback(e=>M(D(g(e))),[g]),F=j.useCallback(async()=>{if(!x)return[];const e=await Promise.all(x.filter(t=>c==null?void 0:c.some(r=>r.template_id===Number(t.template.template_id))).map(async t=>{const r=c==null?void 0:c.find(l=>l.template_id===Number(t.template.template_id)),m=x.find(l=>Number(l.template.template_id)===Number((r==null?void 0:r.template_id)||0)),h=await Z((m==null?void 0:m.asset_id)??"");return{asset_id:t.asset_id,...t.data,...r,...h}}));Q(e)},[c,x]);return o.useEffect(()=>{F()},[F]),o.useEffect(()=>{if(L.value==="rarity"){const e=T.sort((t,r)=>N[t.rarity]-N[r.rarity]);R(e)}},[T,L.value]),o.useEffect(()=>{const e=setInterval(()=>{f.every(t=>M(D(g(t)))==="MINE")?(y(t=>!t),clearInterval(e)):y(t=>!t)},1e3);return y(t=>!t),()=>clearInterval(e)},[f,d,g]),s.jsxs(pe,{children:[s.jsx(fe,{children:"LOAN TOOLS"}),s.jsxs(me,{children:["Deposited TLM:"," ",s.jsxs(xe,{color:u(a==null?void 0:a.deposit)>=0?"green":"red",children:[u(a==null?void 0:a.deposit)>=0?u(a==null?void 0:a.deposit).toFixed(4):`- ${u(a==null?void 0:a.trialtlm).toFixed(4)}`," ","TLM"," ",u(a==null?void 0:a.deposit)<0&&u(a==null?void 0:a.trialtlm)>0&&"(Deposit more TLM)"]})]}),s.jsx(de,{title:"",selected:w[0],onSelected:e=>V(e||w[0]),options:w,borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),s.jsx(ge,{children:$?new Array(6).fill(0).map((e,t)=>s.jsx(be,{},t)):f==null?void 0:f.map((e,t)=>s.jsx(le,{tool:e,children:s.jsxs(he,{children:[s.jsx(W,{isLoading:v||S,disabled:v||S||b(e)!=="MINE",onClick:()=>P(e),rounded:!1,color:"solidBlue",children:b(e)==="MINE"?"Mine":b(e)}),s.jsxs(we,{children:[s.jsxs(k,{children:[s.jsx(ue,{}),s.jsx(B,{children:e.mining_power})]}),s.jsxs(k,{children:[s.jsx(ee,{}),s.jsx(B,{children:e.pow})]})]})]})},t))})]})};export{Me as default};
