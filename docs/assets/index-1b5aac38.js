import{s as n,e as G,m as Y,aE as q,aF as z,W as H,X as K,b as X,Y as E,R as o,f as _,a2 as J,a3 as M,d as D,aG as Z,ax as k,j as r,t as l,B as W,aw as ee,a8 as te,h as ae,q as se,Q as re,V as ne,aH as ie,az as oe,a0 as ce}from"./index-82d41943.js";import{S as de}from"./index-2b07f475.js";import{C as le}from"./index-686daa53.js";import{P as ue}from"./pickaxe-81d7c6bf.js";import"./index.esm-9ef977b7.js";import"./index-c47324d8.js";import"./index-c61f273e.js";import"./index-3a7552f6.js";import"./gradient-border-727e1eac.js";const pe=n("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),fe=n("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),xe=n("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),me=n("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),ge=n("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),we=n("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),he=n("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),B=n("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),N=n("p",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"14px",ff:"$heading",fw:"400"}),ye=G({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),be=n("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${ye} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),m=[{label:"Sort by rarity",value:"rarity"}],Me=()=>{const{data:c,isLoading:$}=Y("tool.worlds"),{data:g}=q(),{data:a}=z(),{data:d}=H(),{data:i}=K(),u=X(e=>e.user),j=E(e=>e.isCalculating),A=E(e=>e.updateIsCalculating),[S,Q]=o.useState([]),[p,R]=o.useState([]),[T,C]=o.useState(!1),[v,V]=o.useState(m[0]),[,w]=o.useState(!1);async function O(e){var t;if(u){C(!0);try{await te(),A(!0),await ae(500);const[[s,y]]=se.getQueriesData(re.LANDS),x=(t=y.highestValue)==null?void 0:t.asset_id,F=(d==null?void 0:d.current_land)===x?void 0:x,{getAssetByAssetId:P}=ne,U=await P(String(e.next_asset_id)),I=i==null?void 0:i.allData.find(b=>b.template_id===Number(U.template.template_id));if(!F||!(i!=null&&i.userTools)||!I)return;await ie({user:u,next_tool:[I],assets_ids:[e.next_asset_id],land_asset_id:F,old_bag_assets_ids:i.userTools.map(b=>Number(b.asset_id))})&&(await oe("tool.worlds"),await ce(u==null?void 0:u.name))}catch(s){console.error("Error staking tool",s)}finally{C(!1)}}}const f=_.useCallback(e=>{const t=e.delay*1.6;return J(t,{userTools:[e],allData:[]},d)},[i,d]),h=_.useCallback(e=>M(D(f(e))),[f]),L=_.useCallback(async()=>{if(!g)return[];const e=await Promise.all(g.filter(t=>(c==null?void 0:c.some(s=>t.template_id===Number(s.template.template_id)))&&t.owned>0).map(async t=>{const s=c==null?void 0:c.find(x=>t.template_id===Number(x.template.template_id)),y=await Z((s==null?void 0:s.asset_id)??"");return{...s==null?void 0:s.data,...y,...t,asset_id:(s==null?void 0:s.asset_id)??""}}));Q(e)},[g,c]);return o.useEffect(()=>{L()},[L]),o.useEffect(()=>{if(v.value==="rarity"){const e=S.sort((t,s)=>k[t.rarity]-k[s.rarity]);R(e)}},[S,v.value]),o.useEffect(()=>{const e=setInterval(()=>{p.every(t=>M(D(f(t)))==="MINE")?(w(t=>!t),clearInterval(e)):w(t=>!t)},1e3);return w(t=>!t),()=>clearInterval(e)},[p,d,f]),r.jsxs(pe,{children:[r.jsx(fe,{children:"LOAN TOOLS"}),r.jsxs(xe,{children:["Deposited TLM:"," ",r.jsxs(me,{color:l(a==null?void 0:a.deposit)>=0?"green":"red",children:[l(a==null?void 0:a.deposit)>=0?l(a==null?void 0:a.deposit).toFixed(4):`- ${l(a==null?void 0:a.trialtlm).toFixed(4)}`," ","TLM"," ",l(a==null?void 0:a.deposit)<0&&l(a==null?void 0:a.trialtlm)>0&&"(Deposit more TLM)"]})]}),r.jsx(de,{title:"",selected:m[0],onSelected:e=>V(e||m[0]),options:m,borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),r.jsx(ge,{children:$?new Array(6).fill(0).map((e,t)=>r.jsx(be,{},t)):p==null?void 0:p.map((e,t)=>r.jsx(le,{showNumberBracket:!0,tool:e,children:r.jsxs(we,{children:[r.jsx(W,{isLoading:T||j,disabled:T||j||h(e)!=="MINE",onClick:()=>O(e),rounded:!1,color:"solidBlue",children:h(e)==="MINE"?"Mine":h(e)}),r.jsxs(he,{children:[r.jsxs(B,{children:[r.jsx(ue,{}),r.jsx(N,{children:e.mining_power})]}),r.jsxs(B,{children:[r.jsx(ee,{}),r.jsx(N,{children:e.pow})]})]})]})},t))})]})};export{Me as default};
