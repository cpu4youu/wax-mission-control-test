import{s as l,e as le,S as ce,u as pe,w as xe,X as me,W as ue,a7 as fe,b as S,h as p,j as n,B as T,aH as R,k as C,O as Q,aI as q,l as _,a5 as H}from"./index-f096d9c2.js";import{S as ge}from"./index-84b216e6.js";import{u as he}from"./index-b5e00c18.js";import{u as we,o as D}from"./inventory-query-f54b412b.js";import{u as je}from"./mine-query-914c09e2.js";import{e as Te}from"./execute-add-favorites-land-contract copy-022bc204.js";import{e as O}from"./execute-equip-tools-contract-adc90d92.js";import{options as v}from"./index-73f527c3.js";import{T as ye}from"./index-621abaf6.js";import{u as be}from"./get-planet-config-0b53884d.js";import"./index.esm-92153c78.js";import"./index-f8746427.js";import"./index-3e6ed889.js";import"./index-f46a2b3d.js";import"./gradient-border-1eb82d90.js";import"./info-builder-05441b81.js";import"./index-a6610ff0.js";import"./index.esm-fda94a5d.js";const Se=l("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",maxW:"1190px"}),Ce=l("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",mt:"30px",mb:"30px",button:{h:"50px",w:"100%",maxW:"230px",div:{fs:"16px",border:"none",br:"10px"}},w:"100%","@sm":{button:{w:"100%",maxW:"100%"}}});l("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}});const _e=l("div",{d:"flex",align:"center",justify:"center",direction:"column",margin:"auto",w:"100%","@md":{d:"flex",padding:"0 20px",flexWrap:"wrap"},"@sm":{padding:"0 10px"}}),N=l("h3",{mr:"auto",mb:"25px",fs:"29px",fw:"$bold",ff:"$heading",color:"$white500","@sm":{fs:"18px"}}),ve=l("div",{d:"flex",align:"flex-start",justify:"flex-start",gap:"20px",mt:"25px",mb:"25px","@md":{flexWrap:"wrap"}}),Le=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"230px","button:first-child":{position:"absolute",top:"-25px",left:"-25px",w:"75px",h:"75px"},"button:last-child":{h:"55px",w:"100%",minW:"100%",maxW:"100%",padding:"0px",mt:"8px",div:{fs:"16px",border:"none",br:"10px"}},"@md":{m:"auto"},"@sm":{}}),Be=l("img",{w:"75px",h:"75px"}),Pe=l("img",{w:"100%",h:"114px"}),ke=l("div",{d:"flex",align:"center",justify:"center",gap:"2px 10px",flexWrap:"wrap",padding:"10px",w:"78%",br:"10px",bg:"rgba(255, 255, 255, 0.03)","@md":{w:"100%"},"@sm":{padding:"5px 0px"}}),z=l("div",{d:"grid",gridTemplateColumns:"1fr 1fr",gap:"1px 7px",w:"100%","@sm":{gridTemplateColumns:"1fr"}}),h=l("div",{d:"grid",gridTemplateColumns:"4fr 1fr",gap:"2px",w:"100%",span:{padding:"10px",bg:"rgba(255, 255, 255, 0.06)",color:"$white500",fs:"16px",fw:"$bold",ff:"$heading",w:"100%"},"@sm":{span:{fs:"12px"}}}),Ne=l("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",mb:"25px",">div":{d:"flex",align:"flex-start",justify:"flex-start",w:"100%",button:{w:"100%",maxW:"440px"}}}),We=l("div",{d:"flex",direction:"column",w:"100%",">button":{h:"55px",w:"100%",maxW:"340px",padding:"0px",div:{fs:"16px",br:"10px"}}}),$e=l("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"20px",mt:"25px",w:"100%"}),G=l("div",{d:"flex",direction:"column",gap:"6px",img:{w:"220px",h:"325px"},">button":{h:"35px",w:"100%",minW:"100%",br:"10px",padding:"0px",div:{fs:"16px",br:"10px"}},"@sm":{w:"46%",img:{w:"100%",h:"auto"}}}),Ae=le({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Y=l("div",{d:"flex",w:"200px",h:"330px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Ae} 1.2s ease-in-out infinite`,"@sm":{h:"230px",w:"46%"}});async function Fe(w,j){const{executeTransaction:u}=pe(),s=Ue(w,j);return!!await u(s)}function Ue(w,j){return{actions:[{account:ce.MEMBERS_MC,name:"addfavtools",authorization:[{actor:w.name,permission:w.requestPermission}],data:{wallet:w.name,asset_ids:j}}]}}const nn=()=>{var F,U,I;const w=xe(),{data:j}=be(),{data:u}=je(),{data:s,isLoading:W}=me(),{data:L,isLoading:K}=we("tool.worlds",!0,!0),{data:t}=ue(),{data:b}=fe(),d=S(e=>e.user),[f,g]=p.useState(!1),[V,X]=p.useState(v.find(e=>e.value===(d==null?void 0:d.miningType))??v[1]),x=p.useMemo(()=>b==null?void 0:b.find(e=>e.landtype_id===(t==null?void 0:t.cardid)),[b,t==null?void 0:t.cardid]),r=p.useMemo(()=>{var a,o,i,c,y,E;return[((o=(a=s==null?void 0:s.userTools)==null?void 0:a[0])==null?void 0:o.cooldown_seconds)??0,((c=(i=s==null?void 0:s.userTools)==null?void 0:i[1])==null?void 0:c.cooldown_seconds)??0,((E=(y=s==null?void 0:s.userTools)==null?void 0:y[2])==null?void 0:E.cooldown_seconds)??0].toSorted((ie,de)=>de-ie)},[s==null?void 0:s.userTools]),m=p.useCallback(()=>{const e=(x==null?void 0:x.cooldown_mod)??0;return!(r!=null&&r[0])||!r?0:!(r!=null&&r[1])&&!(r!=null&&r[2])?r[0]*(e/10):r!=null&&r[2]?(r[0]+r[1])*(e/10):(r[0]+r[1]/2)*(e/10)},[r,x]),B=p.useMemo(()=>((s==null?void 0:s.userTools)||[]).reduce((a,o)=>{const i=o==null?void 0:o.rarity;return a[i]?{...a,[i]:a[i]+(Number(o==null?void 0:o.mining_power)??0)}:{...a,[i]:(o==null?void 0:o.mining_power)??0}},{}),[s==null?void 0:s.userTools]),$=p.useCallback(()=>Object.keys(B).map(e=>{const a=B[e]*((x==null?void 0:x.mining_power_mod)??0)/1e4;return{rarity:e,percentage:(a>=.8?.8:a)*100}}).filter(e=>e.percentage>0),[B,x]),P=p.useCallback(()=>$().reduce((a,o)=>{var c;const i=o.percentage/100*(((c=u==null?void 0:u.pool_buckets.find(y=>(y==null?void 0:y.key)===o.rarity))==null?void 0:c.formattedValue)??0);return a+i},0),[$,u==null?void 0:u.pool_buckets]),k=p.useCallback(()=>{var a;return(((a=s==null?void 0:s.userTools)==null?void 0:a.reduce((o,i)=>o+(i==null?void 0:i.nft_power),0))??0)*((x==null?void 0:x.nft_power_mod)??0)/100},[x,s==null?void 0:s.userTools]),J=p.useMemo(()=>m()/60,[m]),M=p.useMemo(()=>P()/(m()>=0?m():1)*3600,[P,m]),Z=p.useMemo(()=>k()/(m()>=0?m():1)*3600,[k,m]),ee=p.useMemo(()=>3600/(m()>=0?m():1),[m]);function A(e){he.setState({selectedPage:e})}async function ne(){if(!(!(t!=null&&t.current_land)||!d)){g(!0);try{if(await Te(d,t==null?void 0:t.current_land)){await C(1e3);const a=await Q(d==null?void 0:d.name);S.setState(o=>({...o,user:o.user?{...o.user,...a}:null})),await q(),_.success("Current Land added to favorites")}}catch(e){console.error(e)}finally{g(!1)}}}async function se(){var e,a;if(!(!(s!=null&&s.userTools)||!d)){g(!0);try{if(await Fe(d,(a=(e=s==null?void 0:s.userTools)==null?void 0:e.map(({asset_id:i})=>i))==null?void 0:a.join(","))){await C(1e3);const i=await Q(d==null?void 0:d.name);S.setState(c=>({...c,user:c.user?{...c.user,...i}:null})),await q(),_.success("Current Tools added to favorites")}}catch(o){console.error(o)}finally{g(!1)}}}async function te(e){var a;if(!(!(s!=null&&s.userTools)||!d)){g(!0);try{const o=(a=s==null?void 0:s.userTools)==null?void 0:a.map(({asset_id:c})=>Number(c));await O(d,[...o,Number(e.asset_id)])&&(await C(1e3),await H(),await D("tool.worlds"),_.success("Tool added to current setup"))}catch(o){console.error(o)}finally{g(!1)}}}async function ae(e){var a;if(!(!(s!=null&&s.userTools)||!d)){g(!0);try{const o=(a=s==null?void 0:s.userTools)==null?void 0:a.filter(({asset_id:c})=>c!==e.asset_id).map(({asset_id:c})=>Number(c));await O(d,o)&&(await C(1e3),await H(),await D("tool.worlds"),_.success("Tool removed from current setup"))}catch(o){console.error(o)}finally{g(!1)}}}function oe(e){S.setState(a=>({...a,user:a.user?{...a.user,miningType:(e==null?void 0:e.value)??"gold"}:null})),X(e??v[1]),localStorage.setItem("miningType",(e==null?void 0:e.value)??"gold")}const re=()=>{var e;return((t==null?void 0:t.commission)??0)/100===0?(((e=j==null?void 0:j[(t==null?void 0:t.planetName.toLowerCase())||""])==null?void 0:e[1])??0)/100:((t==null?void 0:t.commission)??0)/100};return n.jsxs(Se,{children:[n.jsxs(Ce,{children:[n.jsx(T,{color:"solidBlue",onClick:()=>A("selection"),children:"Land Selection"}),n.jsx(T,{color:"solidBlue",onClick:()=>A("favorites"),children:"Favorites"}),n.jsx(T,{color:"solidBlue",onClick:()=>w("/tool-tactician"),children:"Tools Tactician"})]}),n.jsxs(_e,{children:[n.jsx(N,{children:"Current Selection"}),n.jsxs(ve,{children:[n.jsxs(Le,{children:[n.jsx(ye,{disabled:!(t!=null&&t.x)||!(t!=null&&t.y),delayDuration:10,text:`x: ${t==null?void 0:t.x}, y: ${t==null?void 0:t.y}`,children:n.jsx(Be,{src:`/assets/planets/${t==null?void 0:t.planetName.toLowerCase()}.png`,alt:t==null?void 0:t.planetName,title:t==null?void 0:t.planetName})}),n.jsx(Pe,{src:`/assets/lands/${t==null?void 0:t.landName}.webp`,alt:t==null?void 0:t.landName,title:t==null?void 0:t.landName}),n.jsx(T,{noBorder:!0,isLoading:f,disabled:f,color:"gradientYellow",onClick:ne,children:"Add to favorites"})]}),n.jsxs(ke,{children:[n.jsxs(z,{children:[n.jsxs(h,{children:[n.jsx("span",{children:"Cooldown"}),n.jsxs("span",{children:[Math.round(J)," min"]})]}),n.jsxs(h,{children:[n.jsx("span",{children:"Mines per hour"}),n.jsx("span",{children:ee.toLocaleString("US-en")})]}),n.jsxs(h,{children:[n.jsx("span",{children:"Shards per mine"}),n.jsx("span",{children:k().toLocaleString("US-en")})]}),n.jsxs(h,{children:[n.jsx("span",{children:"Shards per hour"}),n.jsx("span",{children:Z.toLocaleString("US-en")})]})]}),n.jsxs(z,{children:[n.jsxs(h,{children:[n.jsx("span",{children:"Estimated average TLM per mine"}),n.jsx("span",{children:P().toLocaleString("US-en")})]}),n.jsxs(h,{children:[n.jsx("span",{children:"Estimated average TLM per hour"}),n.jsx("span",{children:M.toLocaleString("US-en")})]}),n.jsxs(h,{children:[n.jsx("span",{children:"Commission"}),n.jsxs("span",{children:[re()," %"]})]}),n.jsxs(h,{children:[n.jsx("span",{}),n.jsx("span",{})]})]})]})]}),n.jsxs(Ne,{children:[n.jsx(N,{children:"Mine Button"}),n.jsx(ge,{borderColor1:"#FFB31F",borderColor2:"#FFB800",className:"select",title:"",selected:V,options:v,onSelected:oe})]}),n.jsxs(We,{children:[n.jsx(N,{children:"Tools"}),n.jsx(T,{noBorder:!0,color:"gradientYellow",onClick:se,isLoading:f,disabled:f,children:"Add current setup to favorites"}),n.jsxs($e,{children:[W?Array.from({length:3}).map((e,a)=>n.jsx(Y,{},a)):(U=(F=s==null?void 0:s.userTools)==null?void 0:F.sort((e,a)=>R[e.rarity]-R[a.rarity]||e.delay-a.delay||e.toolname.localeCompare(a.toolname)))==null?void 0:U.map(e=>n.jsxs(G,{children:[n.jsx("img",{loading:"lazy",src:`https://ipfs.alienworlds.io/ipfs/${e.img}`,alt:e.name,title:e.name}),n.jsx(T,{isLoading:f,disabled:f,onClick:()=>ae(e),noBorder:!0,children:"Unequip"})]},e.asset_id)),K?Array.from({length:7}).map((e,a)=>n.jsx(Y,{},a)):(I=L==null?void 0:L.filter(e=>{var a;return!((a=s==null?void 0:s.userTools)!=null&&a.some(({asset_id:o})=>o===e.asset_id))}))==null?void 0:I.map(e=>{var a;return n.jsxs(G,{children:[n.jsx("img",{src:`https://ipfs.alienworlds.io/ipfs/${e.data.img}`,alt:e.data.name,title:e.data.name}),n.jsx(T,{isLoading:f,disabled:f||((a=s==null?void 0:s.userTools)==null?void 0:a.length)===3,onClick:()=>te(e),noBorder:!0,color:"solidBlue",children:"Equip"})]},e.asset_id)})]})]})]})]})};export{nn as default};
