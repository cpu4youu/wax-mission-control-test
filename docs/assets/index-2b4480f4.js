import{s as r,e as U,aC as q,V as G,W as Y,aD as z,b as H,X as w,R as o,f as y,a1 as K,a2 as k,d as E,aw as I,aE as B,j as s,p as l,B as X,av as Z,a7 as J,h as W,q as ee,Q as te,U as ae,aF as se,$ as ne,a0 as re}from"./index-903a7dfd.js";import{C as ie}from"./index-579d7e47.js";import{P as oe}from"./pickaxe-4d85f9fc.js";const de=r("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),ce=r("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),le=r("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),ue=r("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),pe=r("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),fe=r("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),xe=r("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),$=r("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{filter:"drop-shadow(3px 5px 2px rgb(0 0 0 / 0.6))",w:"20px",h:"20px"}}),F=r("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"2px 1px 4px rgba(0, 0, 0)",fs:"14px",ff:"$heading",fw:"400"}),me=U({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),ge=r("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${me} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),he=[{label:"Sort by rarity",value:"rarity"}],be=()=>{const{data:a}=q(),{data:c}=G(),{data:d}=Y(),{data:i,isLoading:N}=z(),u=H(e=>e.user),j=w(e=>e.isCalculating),A=w(e=>e.updateIsCalculating),_=w(e=>e.updateMineButtonLoading),[b,O]=o.useState([]),[p,Q]=o.useState([]),[T,v]=o.useState(!1),[S]=o.useState(he[0]),[,x]=o.useState(!1);async function R(e){var t;if(u){v(!0),_(!0);try{await J(),A(!0),await W(500);const[[n,g]]=ee.getQueriesData([te.LANDS,"red",e]),C=(t=g.highestValue)==null?void 0:t.asset_id,M=(c==null?void 0:c.current_land)===C?void 0:C,{getAssetByAssetId:V}=ae,P=await V(String(e.next_asset_id)),D=d==null?void 0:d.allData.find(h=>h.template_id===Number(P.template.template_id));if(!M||!(d!=null&&d.userTools)||!D)return;await se({user:u,next_tool:[D],assets_ids:[e.next_asset_id],land_asset_id:M,old_bag_assets_ids:d.userTools.map(h=>Number(h.asset_id))})&&(await ne(u==null?void 0:u.name),await re())}catch(n){console.error("Error staking tool",n)}finally{_(!1),v(!1)}}}const f=y.useCallback(e=>{const t=e.delay*1.6;return K(t,{userTools:[e],allData:[]},c)},[c]),m=y.useCallback(e=>k(E(f(e))),[f]),L=y.useCallback(async()=>{if(!(i!=null&&i.toolsOv))return[];const e=await Promise.all(i==null?void 0:i.toolsOv.filter(t=>t.owned>0&&i.stakedTools.some(n=>n.template_id===t.template_id)).map(async t=>{const n=i.stakedTools.find(g=>g.template_id===t.template_id);return{...t,...n,last_use:+new Date(`${t.readyat}.000Z`)/1e3-t.cooldown_seconds}}));O(e)},[i]);return o.useEffect(()=>{L()},[L]),o.useEffect(()=>{if(S.value==="rarity"){const e=b.sort((t,n)=>I[t.rarity]-I[n.rarity]||B[t.shine]-B[n.shine]);Q(e)}},[b,S.value]),o.useEffect(()=>{const e=setInterval(()=>{p.every(t=>k(E(f(t)))==="MINE")?(x(t=>!t),clearInterval(e)):x(t=>!t)},1e3);return x(t=>!t),()=>clearInterval(e)},[p,c,f]),s.jsxs(de,{children:[s.jsx(ce,{children:"LOAN TOOLS"}),s.jsxs(le,{children:["Deposited TLM:"," ",s.jsxs(ue,{color:l(a==null?void 0:a.deposit)>=0?"green":"red",children:[l(a==null?void 0:a.deposit)>=0?l(a==null?void 0:a.deposit).toFixed(4):`- ${l(a==null?void 0:a.trialtlm).toFixed(4)}`," ","TLM"," ",l(a==null?void 0:a.deposit)<0&&l(a==null?void 0:a.trialtlm)>0&&"(Deposit more TLM)"]})]}),s.jsx(pe,{children:N?new Array(6).fill(0).map((e,t)=>s.jsx(ge,{},t)):p==null?void 0:p.map((e,t)=>s.jsx(ie,{showNumberBracket:!0,tool:e,children:s.jsxs(fe,{children:[s.jsx(X,{isLoading:T||j,disabled:T||j||m(e)!=="MINE",onClick:()=>R(e),rounded:!1,color:"solidBlue",children:m(e)==="MINE"?"Mine":m(e)}),s.jsxs(xe,{children:[s.jsxs($,{children:[s.jsx(oe,{}),s.jsx(F,{children:e.mining_power})]}),s.jsxs($,{children:[s.jsx(Z,{}),s.jsx(F,{children:e.pow})]})]})]})},t))})]})};export{be as default};
