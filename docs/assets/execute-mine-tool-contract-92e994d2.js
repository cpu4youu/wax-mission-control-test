import{i as p,S as n,T,k as d,q as l,Q as u,f as y}from"./index-32f1a13a.js";import{r as m}from"./tools-query-03018607.js";import{g,r as h,a as _}from"./lands-query-cb563f22.js";import{p as M,g as w}from"./lands-3656e7d1.js";import{g as S,u as O}from"./showTlmValueFromMine-3ff75534.js";import{s as v}from"./sleep-da79c358.js";import{u as E}from"./use-transaction-dab29f08.js";const N=async()=>await p({options:{code:n.TOOLS_MC,index_position:1,limit:"10000",scope:n.TOOLS_MC,table:T.mtools}})||[],q=()=>d({queryKey:[u.mToolsUseState],queryFn:()=>R(),staleTime:1e3*60*20});async function x(){await l.invalidateQueries([u.mToolsUseState])}async function R(){try{return await N()}catch(a){console.log(a);return}}function I(a,t){return a<2840?t.tool_name==="Certified Kol Digger":t.tool_name==="Certified Kol Digger"?!1:a<9650?m[t.rarity]>=3:a<28430?m[t.rarity]>=2:a<78530?m[t.rarity]>=1:m[t.rarity]>=0}async function K(a){try{const t=await Promise.all(M.map(async i=>{const r=await w(i);return{title:i,img:`/assets/planets/${i}.png`,data:(r==null?void 0:r.pool_buckets.map(s=>({...s,value_formatted:y(s==null?void 0:s.value)??0})))??[]}})),c=g(t),e=await h(c,"red",a),o=_(e);return l.setQueriesData([u.LANDS,"red",a],{list:e,highestValue:o}),{list:e,highestValue:o}}catch(t){console.log(t);return}}async function U({user:a,assets_ids:t,land_asset_id:c,difficulty:e,old_bag_assets_ids:o}){const{executeTransaction:i}=E(),r=await S(e);if(!r)return!1;const s=await z(a,t,r,o,c);if(!await i(s,!0))return!1;await v(500);const f=O.getState().updateNonce;return f(void 0),!0}async function z(a,t,c,e,o){return{actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:a.name,permission:"active"}],data:{wallet:a.name,type:2}},{account:n.M__FEDERATION,name:"setland",authorization:[{actor:a.name,permission:"active"}],data:{account:a.name,land_id:o}},{account:n.TOOLS_MC,name:"renttools",authorization:[{actor:a.name,permission:"active"}],data:{wallet:a.name,tools:t}},{account:n.M__FEDERATION,name:"setbag",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{account:a.name,items:t}},{account:n.M__FEDERATION,name:"mine",authorization:[{actor:a.name,permission:"active"}],data:{miner:a.name,nonce:c,notify:"notify.mc"}},{account:"atomicassets",name:"transfer",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{from:a.name,memo:"Returntool",to:"tools.mc",asset_ids:t}},{account:n.M__FEDERATION,name:"setbag",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{account:a.name,items:e}}]}}export{U as e,I as f,K as g,x as o,q as u};
