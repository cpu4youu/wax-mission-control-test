import{s as d,e as oe,S as D,u as G,W as ie,V as ce,U as le,b as S,f as u,j as n,B as h,m as v,L as E,n as C,a0 as F}from"./index-8e68c522.js";import{S as de}from"./index-18e169d6.js";import{u as pe}from"./index-3f339131.js";import{u as ue,o as R}from"./inventory-query-efd45f52.js";import{u as xe}from"./mine-query-efa7bc92.js";import{o as I,e as q}from"./execute-equip-tools-contract-84ac2af6.js";import{options as _}from"./index-1aa53962.js";import"./index.esm-036276f5.js";import"./index-c218b61e.js";import"./Combination-403d319a.js";import"./gradient-border-6facd800.js";import"./index-56658081.js";import"./index.esm-e1111fbd.js";const me=d("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",maxW:"1190px"}),fe=d("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",mt:"30px",mb:"30px",button:{h:"50px",w:"100%",maxW:"230px",div:{fs:"16px",border:"none",br:"10px"}},w:"100%","@sm":{button:{w:"100%",maxW:"100%"}}});d("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}});const ge=d("div",{d:"flex",align:"center",justify:"center",direction:"column",margin:"auto",w:"100%","@md":{d:"flex",padding:"0 20px",flexWrap:"wrap"},"@sm":{padding:"0 10px"}}),W=d("h3",{mr:"auto",mb:"25px",fs:"29px",fw:"$bold",ff:"$heading",color:"$white500","@sm":{fs:"18px"}}),he=d("div",{d:"flex",align:"flex-start",justify:"flex-start",gap:"20px",mt:"25px",mb:"25px","@md":{flexWrap:"wrap"}}),we=d("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"230px",button:{h:"55px",w:"100%",minW:"100%",maxW:"100%",mt:"8px",div:{fs:"16px",border:"none",br:"10px"}},"@md":{m:"auto"},"@sm":{}}),je=d("img",{position:"absolute",top:"-25px",left:"-25px",w:"75px",h:"75px"}),Te=d("img",{w:"100%",h:"114px"}),be=d("div",{d:"flex",align:"center",justify:"center",gap:"2px 10px",flexWrap:"wrap",padding:"10px",w:"78%",br:"10px",bg:"rgba(255, 255, 255, 0.03)","@md":{w:"100%"},"@sm":{padding:"5px 0px"}}),Q=d("div",{d:"grid",gridTemplateColumns:"1fr 1fr",gap:"1px 7px",w:"100%","@sm":{gridTemplateColumns:"1fr"}}),w=d("div",{d:"grid",gridTemplateColumns:"4fr 1fr",gap:"2px",w:"100%",span:{padding:"10px",bg:"rgba(255, 255, 255, 0.06)",color:"$white500",fs:"16px",fw:"$bold",ff:"$heading",w:"100%"},"@sm":{span:{fs:"12px"}}}),ye=d("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",mb:"25px",">div":{d:"flex",align:"flex-start",justify:"flex-start",w:"100%",button:{w:"100%",maxW:"440px"}}}),Se=d("div",{d:"flex",direction:"column",w:"100%",">button":{h:"55px",w:"100%",maxW:"340px",div:{fs:"16px",br:"10px"}}}),ve=d("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"20px",mt:"25px",w:"100%"}),z=d("div",{d:"flex",direction:"column",gap:"6px",img:{w:"200px",h:"auto"},">button":{h:"35px",w:"100%",minW:"100%",br:"10px",div:{fs:"16px",br:"10px"}},"@sm":{w:"46%",img:{w:"100%",h:"auto"}}}),Ce=oe({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),H=d("div",{d:"flex",w:"200px",h:"330px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Ce} 1.2s ease-in-out infinite`,"@sm":{h:"230px",w:"46%"}});async function _e(c,e){const{executeTransaction:j}=G(),T=Le(c,e);return!!await j(T)}function Le(c,e){return{actions:[{account:D.MEMBERS_MC,name:"addfavtools",authorization:[{actor:c.name,permission:c.requestPermission}],data:{wallet:c.name,asset_ids:e}}]}}async function Pe(c,e){const{executeTransaction:j}=G(),T=ke(c,e);return!!await j(T)}function ke(c,e){return{actions:[{account:D.MEMBERS_MC,name:"addfavland",authorization:[{actor:c.name,permission:c.requestPermission}],data:{wallet:c.name,asset_id:e}}]}}const ze=()=>{var U,$;const{data:c}=xe(),{data:e,isLoading:j}=ie(),{data:T,isLoading:L}=ue("tool.worlds"),{data:r}=ce(),{data:y}=le(),l=S(s=>s.user),[f,g]=u.useState(!1),[O,V]=u.useState(_.find(s=>s.value===(l==null?void 0:l.miningType))??_[1]),x=u.useMemo(()=>y==null?void 0:y.find(s=>s.landtype_id===(r==null?void 0:r.cardid)),[y,r==null?void 0:r.cardid]),o=u.useMemo(()=>{var t,a,i,p,b,A;return[((a=(t=e==null?void 0:e.userTools)==null?void 0:t[0])==null?void 0:a.cooldown_seconds)??0,((p=(i=e==null?void 0:e.userTools)==null?void 0:i[1])==null?void 0:p.cooldown_seconds)??0,((A=(b=e==null?void 0:e.userTools)==null?void 0:b[2])==null?void 0:A.cooldown_seconds)??0].toSorted((ae,re)=>re-ae)},[e==null?void 0:e.userTools]),m=u.useCallback(()=>{const s=(x==null?void 0:x.cooldown_mod)??0;return!(o!=null&&o[0])||!o?0:!(o!=null&&o[1])&&!(o!=null&&o[2])?o[0]*(s/10):o!=null&&o[2]?(o[0]+o[1])*(s/10):(o[0]+o[1]/2)*(s/10)},[o,x]),P=u.useMemo(()=>((e==null?void 0:e.userTools)||[]).reduce((t,a)=>{const i=a==null?void 0:a.rarity;return t[i]?{...t,[i]:t[i]+(Number(a==null?void 0:a.mining_power)??0)}:{...t,[i]:(a==null?void 0:a.mining_power)??0}},{}),[e==null?void 0:e.userTools]),M=u.useCallback(()=>Object.keys(P).map(s=>{const t=P[s]*((x==null?void 0:x.mining_power_mod)??0)/1e4;return{rarity:s,percentage:(t>=.8?.8:t)*100}}).filter(s=>s.percentage>0),[P,x]),k=u.useCallback(()=>M().reduce((t,a)=>{var p;const i=a.percentage/100*(((p=c==null?void 0:c.pool_buckets.find(b=>(b==null?void 0:b.key)===a.rarity))==null?void 0:p.formattedValue)??0);return t+i},0),[M,c==null?void 0:c.pool_buckets]),B=u.useCallback(()=>{var t;return(((t=e==null?void 0:e.userTools)==null?void 0:t.reduce((a,i)=>a+(i==null?void 0:i.nft_power),0))??0)*((x==null?void 0:x.nft_power_mod)??0)/100},[x,e==null?void 0:e.userTools]),K=u.useMemo(()=>m()/60,[m]),J=u.useMemo(()=>k()/(m()>=0?m():1)*3600,[k,m]),X=u.useMemo(()=>B()/(m()>=0?m():1)*3600,[B,m]),Y=u.useMemo(()=>3600/(m()>=0?m():1),[m]);function N(s){pe.setState({selectedPage:s})}async function Z(){if(!(!(r!=null&&r.current_land)||!l)){g(!0);try{if(await Pe(l,r==null?void 0:r.current_land)){await v(1e3);const t=await E(l==null?void 0:l.name);S.setState(a=>({...a,user:a.user?{...a.user,...t}:null})),await I(),C.success("Current Land added to favorites")}}catch(s){console.error(s)}finally{g(!1)}}}async function ee(){var s,t;if(!(!(e!=null&&e.userTools)||!l)){g(!0);try{if(await _e(l,(t=(s=e==null?void 0:e.userTools)==null?void 0:s.map(({asset_id:i})=>i))==null?void 0:t.join(","))){await v(1e3);const i=await E(l==null?void 0:l.name);S.setState(p=>({...p,user:p.user?{...p.user,...i}:null})),await I(),C.success("Current Tools added to favorites")}}catch(a){console.error(a)}finally{g(!1)}}}async function ne(s){var t;if(!(!(e!=null&&e.userTools)||!l)){g(!0);try{const a=(t=e==null?void 0:e.userTools)==null?void 0:t.map(({asset_id:p})=>Number(p));await q(l,[...a,Number(s.asset_id)])&&(await v(1e3),await F(),await R("tool.worlds"),C.success("Tool added to current setup"))}catch(a){console.error(a)}finally{g(!1)}}}async function se(s){var t;if(!(!(e!=null&&e.userTools)||!l)){g(!0);try{const a=(t=e==null?void 0:e.userTools)==null?void 0:t.filter(({asset_id:p})=>p!==s.asset_id).map(({asset_id:p})=>Number(p));await q(l,a)&&(await v(1e3),await F(),await R("tool.worlds"),C.success("Tool removed from current setup"))}catch(a){console.error(a)}finally{g(!1)}}}function te(s){S.setState(t=>({...t,user:t.user?{...t.user,miningType:(s==null?void 0:s.value)??"gold"}:null})),V(s??_[1]),localStorage.setItem("miningType",(s==null?void 0:s.value)??"gold")}return n.jsxs(me,{children:[n.jsxs(fe,{children:[n.jsx(h,{color:"eleventh",onClick:()=>N("selection"),children:"Land Selection"}),n.jsx(h,{color:"eleventh",onClick:()=>N("favorites"),children:"Favorites"}),n.jsx(h,{color:"eleventh",onClick:console.log,children:"Events"}),n.jsx(h,{color:"eleventh",onClick:console.log,children:"Tools Tactician"})]}),n.jsxs(ge,{children:[n.jsx(W,{children:"Current Selection"}),n.jsxs(he,{children:[n.jsxs(we,{children:[n.jsx(je,{src:`/assets/planets/${r==null?void 0:r.planetName.toLowerCase()}.png`,alt:r==null?void 0:r.planetName,title:r==null?void 0:r.planetName}),n.jsx(Te,{src:`/assets/lands/${r==null?void 0:r.landName}.webp`,alt:r==null?void 0:r.landName,title:r==null?void 0:r.landName}),n.jsx(h,{noBorder:!0,isLoading:f,disabled:f,color:"secondary",onClick:Z,children:"Add to favorites"})]}),n.jsxs(be,{children:[n.jsxs(Q,{children:[n.jsxs(w,{children:[n.jsx("span",{children:"Cooldown"}),n.jsxs("span",{children:[K," min"]})]}),n.jsxs(w,{children:[n.jsx("span",{children:"Mines per hour"}),n.jsx("span",{children:Y.toLocaleString("US-en")})]}),n.jsxs(w,{children:[n.jsx("span",{children:"Shards per mine"}),n.jsx("span",{children:B().toLocaleString("US-en")})]}),n.jsxs(w,{children:[n.jsx("span",{children:"Shards per hour"}),n.jsx("span",{children:X.toLocaleString("US-en")})]})]}),n.jsxs(Q,{children:[n.jsxs(w,{children:[n.jsx("span",{children:"Estimated average TLM per mine"}),n.jsx("span",{children:k().toLocaleString("US-en")})]}),n.jsxs(w,{children:[n.jsx("span",{children:"Estimated average TLM per hour"}),n.jsx("span",{children:J.toLocaleString("US-en")})]}),n.jsxs(w,{children:[n.jsx("span",{children:"Commission"}),n.jsxs("span",{children:[((r==null?void 0:r.commission)??0)/100," %"]})]}),n.jsxs(w,{children:[n.jsx("span",{}),n.jsx("span",{})]})]})]})]}),n.jsxs(ye,{children:[n.jsx(W,{children:"Mine Button"}),n.jsx(de,{borderColor1:"#FFB31F",borderColor2:"#FFB800",className:"select",title:"",selected:O,options:_,onSelected:te})]}),n.jsxs(Se,{children:[n.jsx(W,{children:"Tools"}),n.jsx(h,{noBorder:!0,color:"secondary",onClick:ee,isLoading:f,disabled:f,children:"Add current setup to favorites"}),n.jsxs(ve,{children:[j?Array.from({length:3}).map((s,t)=>n.jsx(H,{},t)):(U=e==null?void 0:e.userTools)==null?void 0:U.map(s=>n.jsxs(z,{children:[n.jsx("img",{loading:"lazy",src:`https://ipfs.alienworlds.io/ipfs/${s.img}`,alt:s.name,title:s.name}),n.jsx(h,{isLoading:f,disabled:f,onClick:()=>se(s),noBorder:!0,children:"Unequip"})]},s.asset_id)),L?Array.from({length:7}).map((s,t)=>n.jsx(H,{},t)):($=T==null?void 0:T.filter(s=>{var t;return!((t=e==null?void 0:e.userTools)!=null&&t.some(({asset_id:a})=>a===s.asset_id))}))==null?void 0:$.map(s=>{var t;return n.jsxs(z,{children:[n.jsx("img",{src:`https://ipfs.alienworlds.io/ipfs/${s.data.img}`,alt:s.data.name,title:s.data.name}),n.jsx(h,{isLoading:f,disabled:f||((t=e==null?void 0:e.userTools)==null?void 0:t.length)===3,onClick:()=>ne(s),noBorder:!0,color:"eleventh",children:"Equip"})]},s.asset_id)})]})]})]})]})};export{ze as default};
