import{b as y,a as S,q as g,Q as _,am as h,av as b,aw as L,t as N,S as E,u as R}from"./index-c286d439.js";const O=()=>{const e=y.getState().user;return S({queryKey:[_.UserSettingsAssets],queryFn:()=>D(),staleTime:1e3*60*60,enabled:!!e})};async function U(){return await g.invalidateQueries(_.UserSettingsAssets)}async function D(){try{const{getAssets:e}=h,a=y.getState().user,s=a==null?void 0:a.usrsettings.filter(n=>n.key.includes("toolset")),t=a==null?void 0:a.usrsettings.filter(n=>n.key.includes("land")),i=s==null?void 0:s.flatMap(({value:n})=>n.split(",")),o=t==null?void 0:t.map(({value:n})=>n.split(","));if(!i||!o)return{favoriteTools:[],favoriteLands:[]};const l=await e({limit:100,ids:i.join(",")}),u=s==null?void 0:s.map(({value:n})=>n.split(",").map(d=>{const r=l.find(({asset_id:c})=>c===d);return{...r.data,assetId:r.asset_id}})),m=await e({limit:100,ids:o.join(",")}),f=await Promise.all(b.map(async n=>{const d=await L(n);return{title:n,img:`/assets/planets/${n}.png`,data:(d==null?void 0:d.pool_buckets.map(r=>({...r,value_formatted:N(r==null?void 0:r.value)??0})))??[]}})),p=await Promise.all(t==null?void 0:t.map(async({value:n})=>await Promise.all(n.split(",").map(async d=>{const r=m.find(({asset_id:A})=>A===d),c=r.data.name.split(" on "),T=M(f),v=await k(T,c[0]),w=q(v);return{...r.data,assetId:r.asset_id,estimated_tlm:w,planetName:c[1]||"",landName:c[0]||""}}))));return{favoriteTools:u,favoriteLands:p}}catch(e){return console.log(e),{favoriteTools:[],favoriteLands:[]}}}function M(e){return e.reduce((a,s)=>(s.data.forEach(t=>{var i,o;!a[t.key]&&t.value_formatted>0&&(a[t.key]={data:[]}),(o=(i=a[t.key])==null?void 0:i.data)==null||o.push({title:s.title,img:s.img,value:t.value,value_formatted:t.value_formatted})}),a),{})}function Q(){var a;const e=g.getQueryData(_.TOOLS);return(a=e==null?void 0:e.userTools)==null?void 0:a.reduce((s,t)=>{const i=t==null?void 0:t.rarity;return s[i]?{...s,[i]:s[i]+(Number(t==null?void 0:t.mining_power)??0)}:{...s,[i]:(t==null?void 0:t.mining_power)??0}},{})}async function k(e,a){const s=Q();if(console.log({grouped:s}),!s)return;const t=[],i=Object.keys(s).map((o,l)=>{const u=g.getQueryData(_.LANDSTYPE),m=u==null?void 0:u.find(f=>f.landname===a);return e==null?void 0:e[o].data.map(f=>{const p=s[o]*((m==null?void 0:m.mining_power_mod)??0)/1e4,n=(p>=.8?.8:p)*f.value_formatted;return l===0&&t.push({estimated_tlm:0}),{formatted_estimated_tlm:`${n.toFixed(5)} TLM`,estimated_tlm:n}})});return i==null?void 0:i.reduce((o,l)=>(l==null||l.forEach((u,m)=>{o[m]={...o[m],estimated_tlm:o[m].estimated_tlm+u.estimated_tlm,formatted_estimated_tlm:`${(o[m].estimated_tlm+u.estimated_tlm).toFixed(5)} TLM`}}),o),t)}function q(e){return e==null?void 0:e.reduce((a,s)=>s.value_formatted>a.value_formatted?s:a)}async function C(e,a){const{executeTransaction:s}=R(),t=P(e,a);return!!await s(t)}function P(e,a){return{actions:[{account:E.M__FEDERATION,name:"setbag",authorization:[{actor:e.name,permission:e.requestPermission}],data:{account:e.name,items:a}}]}}export{C as e,U as o,O as u};
