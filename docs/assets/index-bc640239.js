import{s as a,j as t,R as F,e as P,c as q,S as g,u as z,g as S,T as C,ab as K,l as Q,aw as Y,a as R,Q as y,q as B,b,h as T,B as G,k as U,m as J}from"./index-cfc2ea6e.js";import{S as f}from"./styles-1e7aa047.js";import{B as L}from"./bolt-e2d24a16.js";import{d as w}from"./defaultAvatar-62a48bdd.js";import{S as D}from"./index-8fc0612e.js";import{I as X}from"./info-builder-6bbe8b83.js";import"./index.esm-49952ed0.js";import"./index-693f7ed6.js";import"./index-8ef4322c.js";import"./index-010d486a.js";import"./gradient-border-9c891d58.js";const Z=a("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",gap:"20px",w:"100%",px:"40px",h2:{mt:"30px",color:"$white500",letterSpacing:"2px",textShadow:" 0px 4px 4px rgba(0, 0, 0, 0.5)"}}),O=()=>t.jsx(Z,{children:t.jsx("h2",{children:"No candidates to this planet"})}),ee=a("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",gap:"20px",w:"100%",px:"40px",".nfts":{w:"100%",h:"70px",br:"10px"}}),te=()=>t.jsxs(ee,{children:[t.jsx(f,{className:"nfts"}),t.jsx(f,{className:"nfts"}),t.jsx(f,{className:"nfts"}),t.jsx(f,{className:"nfts"})]}),ne=a("div",{d:"grid",gridTemplateColumns:"1.5fr 1.35fr 1.15fr 0.95fr",minH:"100px",bg:"rgba(0, 0, 0, .3)",w:"100%",padding:"5px 0","&:hover":{boxShadow:"0px 0px 15px rgba(255,255,255,0.5)"},"@sm":{padding:"0 5px 0 0",gap:"15px",gridTemplateColumns:"0.8fr 1.4fr 0.9fr"}}),re=a("div",{d:"flex",align:"center",justify:"space-around",gap:"50px",margin:"0 auto 0 45px",img:{br:"50%",h:"70px",w:"70px"},variants:{position:{true:{img:{border:"1px solid #EBB309"}},false:{img:{border:"1px solid #5F5F5F"}}}},"@sm":{gap:"0px",margin:"0 auto 0 15px",img:{h:"40px",w:"40px"}}}),se=a("div",{d:"flex",align:"center",justify:"center",color:"$white500",w:"40px",fs:"24px",fw:"$bold",ff:"$heading","@sm":{fs:"20px"}}),oe=a("span",{d:"flex",align:"center",justify:"center",textAlign:"center",color:"$white500",my:"auto",w:"100%",fw:"$bold",fs:"16px",ff:"$heading",lineHeight:"17px","@sm":{justify:"center",fs:"10px"}}),ie=a("span",{d:"flex",align:"center",justify:"center",color:"$white500",gap:"5px",w:"100%",fs:"20px",ff:"$heading","@sm":{d:"none"}}),ae=a("div",{d:"flex",align:"center",justify:"center",color:"$white500",gap:"10px",w:"100%",fs:"20px",ff:"$heading","@sm":{gap:"10px",fs:"10px"}}),le=({data:e,position:r})=>{var l;const n=F.useRef(null);function o(){n!=null&&n.current&&(n.current.src=w)}return t.jsxs(ne,{children:[t.jsxs(re,{position:r<2,children:[t.jsx("img",{ref:n,src:(e==null?void 0:e.image)??w,onError:o,alt:"avatar user image"}),t.jsx(se,{children:r+1})]}),t.jsx(oe,{children:(e==null?void 0:e.givenName)??(e==null?void 0:e.candidate_name)}),t.jsx(ie,{children:e==null?void 0:e.candidate_name}),t.jsxs(ae,{children:[((l=e==null?void 0:e.votes)==null?void 0:l.toLocaleString("en-US"))??0,t.jsx(L,{type:2})]})]})};P({"0%":{transform:"rotate(360deg)"},"100%":{transform:" rotate(0deg)"}});const ce=a("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",zIndex:"12",w:"100%"}),pe=a("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),xe=a("h2",{d:"flex",align:"center",justify:"center",gap:"10px",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),ue=a("a",{d:"flex",align:"center",justify:"center",color:"$white500",svg:{mt:"10px",w:"40px",h:"40px"},"@sm":{svg:{mt:"5px",w:"30px",h:"30px"}}}),de=a("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gridArea:"content",padding:"20px 20px 30px",gap:"7px",w:"100%",maxW:"1190px"}),fe=a("h2",{d:"flex",align:"center",justify:"center",gap:"10px",color:"$white500",m:"30px 0 30px",w:"100%",svg:{w:"40px",h:"40px"},"@sm":{px:"10px"}}),ge=a("div",{d:"grid",gridTemplateColumns:"1.5fr 1.2fr 1fr 1fr",gridTemplateAreas:"'header header header header' 'content content content content'",mt:"50px",h:"40px",w:"100%",bg:"rgba(0, 0, 0, .3)","@sm":{gridTemplateColumns:"0.8fr 1.4fr 0.9fr"}}),j=a("span",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"20px",ff:"$heading",fw:"$bold",textShadow:"1px 1px 10px black",textAlign:"center",h:"40px","&:nth-child(4)":{pr:"10px"},"@sm":{fs:"10px",fw:"$normal",w:"100% !important"}}),me=P({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),he=a("div",{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",w:"100%",gap:"30px",">button":{minWidth:"100%",height:"50px",fs:"20px"}}),we=a("div",{display:"flex",alignItems:"flex-start",justifyContent:"center",w:"100%",gap:"30px","@sm":{flexWrap:"wrap"}}),M=a("div",{display:"flex",alignItems:"center",justifyContent:"flex-start",flexDirection:"column",padding:"40px",h:"100%",w:"100%",bg:"rgba(0, 0, 0, .3)",br:"10px","@md":{padding:"20px"},"@sm":{h:"max-content",padding:"20px"}}),k=a("div",{display:"flex",alignItems:"center",justifyContent:"space-between",h:"100%",w:"450px","@md":{w:"100%"}}),A=a("div",{d:"flex",align:"center",justify:"center",br:"9999999px",border:"5px solid grey",overflow:"hidden",position:"relative",w:"100px",h:"100px",img:{position:"absolute",inset:"-2px",w:"100px",h:"100px"},variants:{rarity:{Abundant:{borderColor:"#737373"},Common:{borderColor:"#232323"},Rare:{borderColor:"#3d74e9"},Epic:{borderColor:"#8719f0"},Legendary:{borderColor:"#da992e"},Mythical:{borderColor:"#d20066"}}},"@sm":{w:"80px",h:"80px",img:{w:"80px",h:"80px"}}}),v=a("div",{display:"flex",alignItems:"flex-start",justifyContent:"center",w:"450px",h:"230px",color:"$white500",mt:"20px",textAlign:"center",fs:"16px",ff:"$heading",maxH:"400px",overflow:"auto",strong:{fs:"26px"},".loading":{background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.15) ,rgba(255, 255, 255, 0.35))",backgroundSize:"400% 400%",animation:`${me} 1.2s ease-in-out infinite`,h:"100%",w:"100%"},"@md":{w:"100%"},"@sm":{fs:"12px"}}),je={type:"ranking",planet:{label:"Naron",value:"naron"}},_=q((e,r)=>({voteFilters:je,updateVoteFilters:n=>ve(e,n),votePower:0,updateVotePower:n=>be(e,n),votePowerValue:0,updateVotePowerValue:n=>ye(e,n)}));function ve(e,r){e(n=>({...n,voteFilters:{...n.voteFilters,...r}}))}function be(e,r){e(n=>({...n,votePower:r}))}function ye(e,r){e(n=>({...n,votePowerValue:r}))}async function Te(e,r,n,o){const{executeTransaction:l}=z(),x=_e(e,r,n,o);return!!await l(x)}function _e(e,r,n,o){return{actions:[{account:g.HQ_MU,name:"castvote",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,new_candidates:r,planet:n,votes:o}}]}}const Se=async e=>await S({options:{code:g.DAO_WORLDS,index_position:1,limit:"1000",scope:e,table:C.CANDIDATES}}),Ce=async e=>await S({options:{code:g.HQ_MU,index_position:3,key_type:"i64",limit:"1000",lower_bound:e,upper_bound:e,scope:g.HQ_MU,table:C.CANDIDATES}}),H=K.create({baseURL:"https://api.alienworlds.io/v2/dao/"});H.interceptors.response.use(e=>e.data,e=>{var n,o;const r=((o=(n=e.response)==null?void 0:n.data)==null?void 0:o.message)||e.message;return Q.error(r,Y),Promise.reject(e)});const $e=e=>R({queryKey:[y.CANDIDATES,e],queryFn:()=>Ee(e||"naron"),staleTime:1e3*60*60});async function Ve(){return await B.invalidateQueries(y.CANDIDATES)}async function Ee(e){try{const r=await Se(e),n=await Ce(e),o=await H.get(`${e}/candidates?walletId=aa`);return!n||!r?[]:Ne(n,r,o)}catch(r){return console.log(r),null}}function Ne(e,r,n){return r.filter(x=>x.is_active===1).map(x=>{const u=e.find(c=>c.wallet===x.candidate_name),m=n==null?void 0:n.find(c=>c.account===x.candidate_name);return{...x,...m,...u}}).sort((x,u)=>u.votes-x.votes)}const Ie=async()=>{const e=await S({options:{code:g.HQ_MU,index_position:1,limit:"1000",scope:g.HQ_MU,table:C.CONFIG_MEMBERS}});return(e==null?void 0:e[0])??null},Ue=()=>R({queryKey:[y.VOTES],queryFn:()=>Me(),staleTime:1e3*60*60,enabled:!!b.getState().user});async function De(){return await B.invalidateQueries(y.VOTES)}async function Me(){const e=b.getState().user;if(!e)return 0;try{const r=await Ie(),n=_.getState().updateVotePower,o=new Date,x=Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds())/1e3,m=new Date((e==null?void 0:e.last_vote)??o).getTime()/1e3,d=(x-m)/86400,i=((e==null?void 0:e.vote_power)??0)*Math.pow(1+(Number(r==null?void 0:r.decay_per_day)??0)*-1,Math.floor(d));return n(i),i}catch(r){return console.log(r),0}}const ke=({candidates:e,isLoading:r})=>{const n=_(s=>s.voteFilters),o=_(s=>s.votePowerValue),l=b(s=>s.user),x=b(s=>s.updateMember),u=F.useRef(null),m=(e==null?void 0:e.map(s=>({label:s.givenName||s.candidate_name,value:s.candidate_name,...s})))??[],c=[{label:"None",value:"none"},...m],d=c==null?void 0:c[0],[i,$]=T.useState(d),[p,V]=T.useState(d);function E(s,h){h==="first"&&$(s),h==="second"&&V(s)}function N(){return[i==null?void 0:i.value,p==null?void 0:p.value].filter(s=>s!=="none")}async function W(){const s=N();if(!l||!s||((s==null?void 0:s.length)??0)===0||!n.planet.value||!o)return null;try{await Te(l,s,n.planet.value,Number(o))&&(await U(1200),await x(),await U(800),await Ve(),await De(),Q.success("Vote successfully registered"))}catch(h){console.log(h)}}function I(){u!=null&&u.current&&(u.current.src=w)}return T.useEffect(()=>{$(d),V(d)},[n]),t.jsxs(he,{children:[t.jsxs(we,{children:[t.jsx(M,{children:t.jsxs(t.Fragment,{children:[t.jsxs(k,{children:[t.jsx(D,{isLoading:r,onSelected:s=>E(s,"first"),options:c==null?void 0:c.filter(s=>(s==null?void 0:s.value)!==(p==null?void 0:p.value)),title:"None",selected:{label:i==null?void 0:i.label,value:i==null?void 0:i.value},borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),t.jsx(A,{rarity:l==null?void 0:l.avatarrarity,children:t.jsx("img",{ref:u,onError:I,src:i!=null&&i.image?i.image:w,alt:""})})]}),((c==null?void 0:c.length)??0)>0?t.jsx(v,{children:r?t.jsx(f,{className:"loading"}):(i==null?void 0:i.description)||"This candidate doesn't have description"}):t.jsx(v,{children:t.jsx("strong",{children:"No candidates to this planet"})})]})}),t.jsx(M,{children:t.jsxs(t.Fragment,{children:[t.jsxs(k,{children:[t.jsx(D,{isLoading:r,onSelected:s=>E(s,"second"),options:c==null?void 0:c.filter(s=>(s==null?void 0:s.value)!==(i==null?void 0:i.value)),title:"None",selected:{label:p==null?void 0:p.label,value:p==null?void 0:p.value}}),t.jsx(A,{rarity:l==null?void 0:l.avatarrarity,children:t.jsx("img",{ref:u,onError:I,src:p!=null&&p.image?p.image:w,alt:""})})]}),((c==null?void 0:c.length)??0)>0?t.jsx(v,{children:r?t.jsx(f,{className:"loading"}):(p==null?void 0:p.description)||"This candidate doesn't have description"}):t.jsx(v,{children:t.jsx("strong",{children:"No candidates to this planet"})})]})})]}),t.jsx(G,{onClick:W,disabled:o<=0||N().length===0,color:"solidBlue",noBorder:!0,rounded:!1,children:"Cast Vote"})]})},Ke=()=>{const{isSmall:e}=J(),{data:r}=Ue(),{data:n,isLoading:o}=$e("eyeke");return t.jsxs(ce,{children:[t.jsxs(pe,{children:[t.jsxs(xe,{children:["Eyeke Voting",t.jsx(ue,{href:"https://medium.com/@miningmatters/ae7416e78f75",target:"_blank",children:t.jsx(X,{})})]}),t.jsx("img",{src:"/assets/background/bg-voting.jpeg",alt:""})]}),t.jsxs(de,{children:[t.jsxs(fe,{children:[r==null?void 0:r.toLocaleString("en-US")," / 150,000 ",t.jsx(L,{type:2})]}),t.jsx(ke,{isLoading:o,candidates:n}),t.jsxs(ge,{children:[t.jsx(j,{children:"Rank"}),t.jsx(j,{children:"Candidate"}),!e&&t.jsx(j,{children:"Wallet"}),t.jsx(j,{children:"Votes"})]}),o?t.jsx(te,{}):(n==null?void 0:n.length)===0?t.jsx(O,{}):n==null?void 0:n.map((l,x)=>t.jsx(le,{position:x,data:l},l.candidate_name))]})]})};export{Ke as default};
