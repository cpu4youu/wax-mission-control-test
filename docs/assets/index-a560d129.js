import{k as I,S as b,T as U,l as W,Q as w,b as C,q as A,e as k,s,j as e,F as L,R as h,_ as S,r as l,x as T,n as z,B as F}from"./index-931a8df2.js";import{a as G}from"./user-miners-query-3e21941b.js";import{a as P}from"./mineCooldown-bba5bd65.js";import{d as Y}from"./use-transaction-5242264b.js";import{s as H}from"./sleep-da79c358.js";import{i as R}from"./index-9d0c2436.js";import{i as Q}from"./index-6d6161a0.js";const q=async n=>await I({options:{code:b.GAME_MC,index_position:1,limit:"10000",scope:b.GAME_MC,table:U.PLAYERS,lower_bound:n,upper_bound:n}}),$=[{label:"prodone",value:0},{label:"prodtwo",value:1},{label:"prodthree",value:2},{label:"prodfour",value:3},{label:"prodfive",value:4},{label:"prodsix",value:5}],V=()=>W({queryKey:[w.MCP_PLAYERS],queryFn:()=>J(),staleTime:1e3*60*60,enabled:!!C.getState().user});async function K(){return A.removeQueries(w.MCP_PLAYERS),await A.invalidateQueries(w.MCP_PLAYERS)}async function J(){const n=C.getState().user;if(!n)return null;try{const i=await q(n.name);return i?Z(i):null}catch(i){return console.log(i),null}}async function Z(n){var u,p;const i=(p=(u=n==null?void 0:n[0])==null?void 0:u.buildings)==null?void 0:p.sort((c,x)=>$.findIndex(r=>r.label===c.buildingid)-$.findIndex(r=>r.label===x.buildingid)),{getAssetByAssetId:t}=G,d=await Promise.all(i.map(async c=>({...c,staked_asset_ids:await Promise.all(c.staked_asset_ids.map(async x=>{var f;const r=await t(x);return{...r,img:`https://ipfs.alienworlds.io/ipfs/${(f=r==null?void 0:r.data)==null?void 0:f.img}`}}))})));return{...n[0],buildings:d}}const X=k({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),ee=s("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%","@sm":{padding:"0 15px"}}),te=s("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",maxW:"1190px","@md":{d:"flex",flexWrap:"wrap"}}),ne=s("h2",{d:"flex",align:"center",justify:"center",my:"40px",textAlign:"center",color:"$white500",fs:"30px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),se=s("div",{d:"flex",align:"center",justify:"flex-start",gap:"10px",w:"100%"}),N=s("button",{d:"flex",align:"flex-start",justify:"center",padding:"10px 20px",color:"$white500",ff:"$heading",fs:"18px",variants:{isActive:{true:{fw:"bold",bg:"rgba(0, 0, 0, 0.26)"}}},"@sm":{flexWrap:"wrap"}}),ae=s("div",{d:"flex",align:"flex-start",justify:"center",gap:"0px",padding:"50px",bg:"rgba(0, 0, 0, 0.26)",w:"100%",img:{width:"100%",maxW:"510px"},"@sm":{padding:"0px",flexWrap:"wrap"}}),re=s("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"0px",w:"100%",button:{h:"50px",w:"300px",div:{fs:"18px",border:"none"}},"@sm":{mt:"20px"}}),ie=s("div",{d:"flex",align:"center",justify:"center",position:"relative",w:"100%",maxW:"400px",mb:"30px",color:"$white500",fs:"30px",fw:"bold",ff:"$heading",textAlign:"center",gap:"10px"}),oe=s("div",{mb:"30px",w:"100%",maxW:"550px",textAlign:"center",color:"$white500",fs:"18px",ff:"$body",gap:"10px"}),le=s("div",{d:"flex",align:"center",justify:"center",mb:"30px",w:"100%",maxW:"550px",textAlign:"center",color:"$white500",fs:"18px",fw:"bold",ff:"$body",gap:"10px"});s("div",{mt:"10px",w:"100%",height:"200px",background:"linear-gradient( -90deg, rgba(3, 16, 32, 0.40), rgba(3, 16, 32, 0.75) ,rgba(3, 16, 32, 0.40))",br:"10px",backgroundSize:"400% 400%",animation:`${X} 1.2s ease-in-out infinite`});const ce=async()=>await I({options:{code:b.GAME_MC,index_position:1,reverse:!0,limit:"10000",scope:b.GAME_MC,table:U.SEASON}}),de=()=>W({queryKey:[w.SEASON],queryFn:()=>pe(),staleTime:1e3*60*60});async function ue(){return await A.invalidateQueries(w.SEASON)}async function pe(){try{const n=await ce();return n||null}catch(n){return console.log(n),null}}async function xe(n){const{executeTransaction:i}=Y(),t=fe(n);return!!await i(t)}function fe(n){return{actions:[{account:b.GAME_MC,name:"regplayer",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name}}]}}const ge=s("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",h:"calc(100vh - 165px)","@sm":{padding:"0 15px"}}),me=s("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),be=s("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),we=s("div",{d:"flex",align:"center",justify:"center",direction:"column",margin:"auto",w:"100%",maxW:"1190px","@md":{d:"flex",flexWrap:"wrap"}}),E=()=>e.jsxs(ge,{children:[e.jsxs(me,{children:[e.jsx(be,{children:"Outpost Builder"}),e.jsx("img",{src:"/assets/background/bg-mcp-builder.jpeg",alt:""})]}),e.jsx(we,{children:e.jsx(L,{size:"lg",colorSchema:"light"})})]}),he=h.lazy(()=>S(()=>import("./index-795aadec.js").then(n=>n.i),["assets/index-795aadec.js","assets/index-931a8df2.js","assets/index-55fec1ff.css","assets/mineCooldown-bba5bd65.js","assets/index-6d6161a0.js","assets/index-e2c70cf8.js","assets/use-transaction-5242264b.js","assets/user-miners-query-3e21941b.js","assets/axios-43b00e28.js","assets/sleep-da79c358.js","assets/mcpFormatNumber-1b3dda04.js","assets/index-b456ef6f.js","assets/index-ea857b18.js","assets/index-1ba61ba4.js","assets/use-media-96c87cc6.js","assets/index-37b9468d.js"])),Se=h.lazy(()=>S(()=>import("./index-061c103f.js"),["assets/index-061c103f.js","assets/index-931a8df2.js","assets/index-55fec1ff.css"])),_e=h.lazy(()=>S(()=>import("./index-57099487.js"),["assets/index-57099487.js","assets/index-931a8df2.js","assets/index-55fec1ff.css","assets/mcpFormatNumber-1b3dda04.js"])),ye=h.lazy(()=>S(()=>import("./star-cd7d36f5.js"),["assets/star-cd7d36f5.js","assets/index-931a8df2.js","assets/index-55fec1ff.css"])),je=()=>{var D,M;const{data:n,isLoading:i}=V(),{data:t}=de(),d=C(a=>a.user),[u,p]=l.useState({title:"",nextSeason:e.jsx("br",{}),disabled:!1}),[c,x]=l.useState(!1),[r,f]=l.useState("newSeason"),g=l.useCallback(()=>{var m,O;if(!(t!=null&&t[0]))return;const a=new Date,o=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());if(R(new Date(o),new Date(t[0].season_start))){const{days:_,hours:y,minutes:j,seconds:v}=P(new Date((m=t==null?void 0:t[0])==null?void 0:m.season_start));p({title:"NEW SEASON STARTING SOON",nextSeason:`Next season starting in ${_} days ${y} hours and ${j} minutes ${v} seconds`,disabled:!0});return}if(Q(new Date(o),new Date(t[0].season_end))){p({title:"WE ARE WRAPPING UP THE PREVIOUS SEASON. RETURNING NFTS, SENDING PRIZES, ....",nextSeason:e.jsx("br",{}),disabled:!0});return}if(T(new Date(o),{start:new Date(t[0].season_start),end:new Date(t[0].season_end)})){const{days:_,hours:y,minutes:j,seconds:v}=P(new Date((O=t==null?void 0:t[0])==null?void 0:O.season_end));p({title:`SEASON ENDS IN ${_} DAYS ${y} HOURS ${j} MINUTES ${v} SECONDS`,nextSeason:e.jsx("br",{}),disabled:!1});return}},[t]),B=l.useCallback(async()=>{if(d){x(!0);try{await xe(d)&&(await H(6e3),await K(),await ue())}catch(a){console.log(a)}finally{x(!1)}}},[d]);return l.useEffect(()=>{g()},[g]),l.useEffect(()=>{if(!(t!=null&&t[0]))return;const a=setInterval(()=>{const o=new Date,m=new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds());R(new Date(m),new Date(t[0].season_start))&&g(),T(new Date(m),{start:new Date(t[0].season_start),end:new Date(t[0].season_end)})&&(g(),n&&t&&clearInterval(a))},1e3);return()=>clearInterval(a)},[t,n,g]),i?e.jsx(E,{}):n&&t&&T(new Date(z),{start:new Date(t[0].season_start),end:new Date(t[0].season_end)})?e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(he,{season:t[0]})}):e.jsx(l.Suspense,{fallback:e.jsx(E,{}),children:e.jsxs(ee,{children:[e.jsx(Se,{}),e.jsxs(te,{children:[e.jsx(ne,{children:u.title}),e.jsxs(se,{children:[e.jsx(N,{onClick:()=>f("newSeason"),isActive:r==="newSeason",children:"New Season"}),(D=t==null?void 0:t[0])!=null&&D.new_season_prepared||(M=t==null?void 0:t[0])!=null&&M.ranking_cleared?e.jsx(N,{onClick:()=>f("prevSeason"),isActive:r==="prevSeason",children:"Previous Season"}):""]}),e.jsx(ae,{children:r==="prevSeason"?e.jsx(_e,{}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/assets/mcp/mcp-builder.png",alt:""}),e.jsxs(re,{children:[e.jsxs(ie,{children:["WELCOME TO ",e.jsx("br",{})," OUTPOST BUILDER"]}),e.jsxs(oe,{children:["Mission Control needs YOU to help gain more resources. Build an outpost on a remote planet in this seasonal idle building game. Ramp up your production and deliver resources to Mission Control in exchange for ",e.jsx(ye,{}),".",e.jsx("br",{})," ",e.jsx("br",{}),"Who will manage to to deliver the most resources to Mission Control? Who will take up the challenge for the top of the leaderboard this season?",e.jsx("br",{})," ",e.jsx("br",{}),"Ready? Then what are you waiting for?"]}),e.jsx(le,{children:u.nextSeason}),e.jsx(F,{isLoading:c,color:"solidBlue",disabled:c||u.disabled,rounded:!1,onClick:B,children:"START NOW !"})]})]})})]})]})})},Oe=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));export{E as L,de as a,$ as b,Oe as i,K as o,V as u};
