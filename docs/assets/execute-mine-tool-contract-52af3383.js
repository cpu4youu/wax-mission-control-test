import{i as T,S as n,T as d,k as p,q as l,Q as u,f as g}from"./index-adc1ff3a.js";import{r as m}from"./tools-query-76a20a7c.js";import{g as y,r as h,a as _}from"./lands-query-a3b988af.js";import{p as M,g as S}from"./lands-84e963ec.js";import{g as w,u as O}from"./showTlmValueFromMine-0577e0d0.js";import{s as E}from"./sleep-da79c358.js";import{u as N}from"./use-transaction-f145f4c1.js";const R=async()=>await T({options:{code:n.TOOLS_MC,index_position:1,limit:"10000",scope:n.TOOLS_MC,table:d.mtools}})||[],q=()=>p({queryKey:[u.mToolsUseState],queryFn:()=>v(),staleTime:1e3*60*20});async function x(){await l.invalidateQueries([u.mToolsUseState])}async function v(){try{return await R()}catch(a){console.log(a);return}}function I(a,t){return a<2840?t.tool_name==="Certified Kol Digger":t.tool_name==="Certified Kol Digger"?!1:a<9650?m[t.rarity]>=3:a<28430?m[t.rarity]>=2:a<78530?m[t.rarity]>=1:m[t.rarity]>=0}async function K(a){try{const t=await Promise.all(M.map(async r=>{const i=await S(r);return{title:r,img:`/assets/planets/${r}.png`,data:(i==null?void 0:i.pool_buckets.map(s=>({...s,value_formatted:g(s==null?void 0:s.value)??0})))??[]}})),c=y(t),e=await h(c,"red",a),o=_(e);return l.setQueriesData([u.LANDS,"red",a],{list:e,highestValue:o}),{list:e,highestValue:o}}catch(t){console.log(t);return}}async function U({user:a,assets_ids:t,land_asset_id:c,difficulty:e,old_bag_assets_ids:o}){const{executeTransaction:r}=N(),i=await w(e);if(!i)return!1;const s=await b(a,t,i,o,c);if(!await r(s,{broadcast:!0,sign:!0},!1))return!1;await E(500);const f=O.getState().updateNonce;return f(void 0),!0}async function b(a,t,c,e,o){return{actions:[{account:n.M__FEDERATION,name:"setland",authorization:[{actor:a.name,permission:"active"}],data:{account:a.name,land_id:o}},{account:n.TOOLS_MC,name:"renttools",authorization:[{actor:a.name,permission:"active"}],data:{wallet:a.name,tools:t}},{account:n.M__FEDERATION,name:"setbag",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{account:a.name,items:t}},{account:n.M__FEDERATION,name:"mine",authorization:[{actor:a.name,permission:"active"}],data:{miner:a.name,nonce:c,notify:"notify.mc"}},{account:"atomicassets",name:"transfer",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{from:a.name,memo:"Returntool",to:"tools.mc",asset_ids:t}},{account:n.M__FEDERATION,name:"setbag",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{account:a.name,items:e}}]}}export{U as e,I as f,K as g,x as o,q as u};
