import{s as l,j as t,R as A,e as z,c as U,S as d,u as O,g as b,T as y,ab as W,l as M,aw as q,a as B,Q as _,q as D,b as v,h as C,B as H,k as I,m as K}from"./index-5a8305d3.js";import{S as g}from"./styles-eafd66f5.js";import{B as R}from"./bolt-33bfcc75.js";import{d as h}from"./defaultAvatar-538077d9.js";import{S as V}from"./index-95ebbf91.js";import{I as Y}from"./info-builder-9f3817df.js";import"./index.esm-8f4fc33d.js";import"./index-d01ca17f.js";import"./index-7eb97b11.js";import"./index-2d788380.js";import"./gradient-border-1d0f2162.js";const J=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",gap:"20px",w:"100%",px:"40px",h2:{mt:"30px",color:"$white500",letterSpacing:"2px",textShadow:" 0px 4px 4px rgba(0, 0, 0, 0.5)"}}),X=()=>t.jsx(J,{children:t.jsx("h2",{children:"No candidates to this planet"})}),Z=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",gap:"20px",w:"100%",px:"40px",".nfts":{w:"100%",h:"70px",br:"10px"}}),ee=()=>t.jsxs(Z,{children:[t.jsx(g,{className:"nfts"}),t.jsx(g,{className:"nfts"}),t.jsx(g,{className:"nfts"}),t.jsx(g,{className:"nfts"})]}),te=l("div",{d:"grid",gridTemplateColumns:"1.5fr 1.35fr 1.15fr 0.95fr",minH:"100px",bg:"rgba(0, 0, 0, .3)",w:"100%",padding:"5px 0","&:hover":{boxShadow:"0px 0px 15px rgba(255,255,255,0.5)"},"@sm":{padding:"0 5px 0 0",gap:"15px",gridTemplateColumns:"0.8fr 1.4fr 0.9fr"}}),ne=l("div",{d:"flex",align:"center",justify:"space-around",gap:"50px",margin:"0 auto 0 45px",img:{br:"50%",h:"70px",w:"70px"},variants:{position:{true:{img:{border:"1px solid #EBB309"}},false:{img:{border:"1px solid #5F5F5F"}}}},"@sm":{gap:"0px",margin:"0 auto 0 15px",img:{h:"40px",w:"40px"}}}),oe=l("div",{d:"flex",align:"center",justify:"center",color:"$white500",w:"40px",fs:"24px",fw:"$bold",ff:"$heading","@sm":{fs:"20px"}}),re=l("span",{d:"flex",align:"center",justify:"center",textAlign:"center",color:"$white500",my:"auto",w:"100%",fw:"$bold",fs:"16px",ff:"$heading",lineHeight:"17px","@sm":{justify:"center",fs:"10px"}}),se=l("span",{d:"flex",align:"center",justify:"center",color:"$white500",gap:"5px",w:"100%",fs:"20px",ff:"$heading","@sm":{d:"none"}}),ie=l("div",{d:"flex",align:"center",justify:"center",color:"$white500",gap:"10px",w:"100%",fs:"20px",ff:"$heading","@sm":{gap:"10px",fs:"10px"}}),ae=({data:e,position:o})=>{var x;const n=A.useRef(null);function s(){n!=null&&n.current&&(n.current.src=h)}return t.jsxs(te,{children:[t.jsxs(ne,{position:o<2,children:[t.jsx("img",{ref:n,src:(e==null?void 0:e.image)??h,onError:s,alt:"avatar user image"}),t.jsx(oe,{children:o+1})]}),t.jsx(re,{children:(e==null?void 0:e.givenName)??(e==null?void 0:e.candidate_name)}),t.jsx(se,{children:e==null?void 0:e.candidate_name}),t.jsxs(ie,{children:[((x=e==null?void 0:e.votes)==null?void 0:x.toLocaleString("en-US"))??0,t.jsx(R,{type:2})]})]})},le=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",zIndex:"12",w:"100%"}),ce=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),pe=l("h2",{d:"flex",align:"center",justify:"center",gap:"10px",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),xe=l("a",{d:"flex",align:"center",justify:"center",color:"$white500",svg:{mt:"10px",w:"40px",h:"40px"},"@sm":{svg:{mt:"5px",w:"30px",h:"30px"}}}),ue=l("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gridArea:"content",padding:"20px 20px 30px",gap:"7px",w:"100%",maxW:"1190px"}),de=l("h2",{d:"flex",align:"center",justify:"center",gap:"10px",color:"$white500",m:"30px 0 30px",w:"100%",svg:{w:"40px",h:"40px"},"@sm":{px:"10px"}}),fe=l("div",{d:"grid",gridTemplateColumns:"1.5fr 1.2fr 1fr 1fr",gridTemplateAreas:"'header header header header' 'content content content content'",mt:"50px",h:"40px",w:"100%",bg:"rgba(0, 0, 0, .3)","@sm":{gridTemplateColumns:"0.8fr 1.4fr 0.9fr"}}),w=l("span",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"20px",ff:"$heading",fw:"$bold",textShadow:"1px 1px 10px black",textAlign:"center",h:"40px","&:nth-child(4)":{pr:"10px"},"@sm":{fs:"10px",fw:"$normal",w:"100% !important"}}),ge=z({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),me=l("div",{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",w:"100%",gap:"30px",">button":{minWidth:"100%",height:"50px",fs:"20px"}}),he=l("div",{display:"flex",alignItems:"flex-start",justifyContent:"center",w:"100%",gap:"30px","@sm":{flexWrap:"wrap"}}),$=l("div",{display:"flex",alignItems:"center",justifyContent:"flex-start",flexDirection:"column",padding:"40px",h:"100%",w:"100%",bg:"rgba(0, 0, 0, .3)",br:"10px","@md":{padding:"20px"},"@sm":{h:"max-content",padding:"20px"}}),E=l("div",{display:"flex",alignItems:"center",justifyContent:"space-between",h:"100%",w:"450px","@md":{w:"100%"}}),k=l("div",{d:"flex",align:"center",justify:"center",br:"9999999px",border:"5px solid grey",overflow:"hidden",position:"relative",w:"100px",h:"100px",img:{position:"absolute",inset:"-2px",w:"100px",h:"100px"},variants:{rarity:{Abundant:{borderColor:"#737373"},Common:{borderColor:"#232323"},Rare:{borderColor:"#3d74e9"},Epic:{borderColor:"#8719f0"},Legendary:{borderColor:"#da992e"},Mythical:{borderColor:"#d20066"}}},"@sm":{w:"80px",h:"80px",img:{w:"80px",h:"80px"}}}),j=l("div",{display:"flex",alignItems:"flex-start",justifyContent:"center",w:"450px",h:"230px",color:"$white500",mt:"20px",textAlign:"center",fs:"16px",ff:"$heading",maxH:"400px",overflow:"auto",strong:{fs:"26px"},".loading":{background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.15) ,rgba(255, 255, 255, 0.35))",backgroundSize:"400% 400%",animation:`${ge} 1.2s ease-in-out infinite`,h:"100%",w:"100%"},"@md":{w:"100%"},"@sm":{fs:"12px"}}),we={type:"ranking",planet:{label:"Naron",value:"naron"}},L=U((e,o)=>({voteFilters:we,updateVoteFilters:n=>je(e,n),votePower:0,updateVotePower:n=>ve(e,n),votePowerValue:0,updateVotePowerValue:n=>be(e,n)}));function je(e,o){e(n=>({...n,voteFilters:{...n.voteFilters,...o}}))}function ve(e,o){e(n=>({...n,votePower:o}))}function be(e,o){e(n=>({...n,votePowerValue:o}))}async function ye(e,o,n,s){const{executeTransaction:x}=O(),i=_e(e,o,n,s);return!!await x(i)}function _e(e,o,n,s){return{actions:[{account:d.VOTING_MC,name:"claimpower",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,claim_user_cpu:!0}},{account:d.VOTING_MC,name:"castvote",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,new_candidates:o,planet:n,votes:s}}]}}const Te=async e=>await b({options:{code:d.DAO_WORLDS,index_position:1,limit:"1000",scope:e,table:y.CANDIDATES}}),Se=async e=>await b({options:{code:d.VOTING_MC,index_position:3,key_type:"i64",limit:"1000",lower_bound:e,upper_bound:e,scope:d.VOTING_MC,table:y.CANDIDATES}}),F=W.create({baseURL:"https://api.alienworlds.io/v2/dao/"});F.interceptors.response.use(e=>e.data,e=>{var n,s;const o=((s=(n=e.response)==null?void 0:n.data)==null?void 0:s.message)||e.message;return M.error(o,q),Promise.reject(e)});const Ne=async()=>await b({options:{code:d.VOTING_MC,index_position:1,limit:"1000",scope:d.VOTING_MC,table:y.blocklist}}),Ce=e=>B({queryKey:[_.CANDIDATES,e],queryFn:()=>Ve(e||"eyeke"),staleTime:1e3*60*5});async function Ie(){return await D.invalidateQueries(_.CANDIDATES)}async function Ve(e){try{const o=await Te(e),n=await Se(e),s=await F.get(`${e}/candidates?walletId=aa`);if(!n||!o)return[];const x=$e(n,o,s),i=await Ne();return x.filter(a=>i==null?void 0:i.some(f=>f.wallet!==a.account))}catch(o){return console.log(o),null}}function $e(e,o,n){return o.filter(i=>i.is_active===1).map(i=>{const u=e.find(f=>f.wallet===i.candidate_name),a=n==null?void 0:n.find(f=>f.account===i.candidate_name);return{...i,...a,...u}}).sort((i,u)=>u.votes-i.votes)}const Ee=async()=>{const e=await b({options:{code:d.VOTING_MC,index_position:1,limit:"1000",scope:d.VOTING_MC,table:y.CONFIG_MEMBERS}});return(e==null?void 0:e[0])??null},ke=()=>B({queryKey:[_.VOTES],queryFn:()=>Me(),staleTime:1e3*60*5,enabled:!!v.getState().user});async function Ae(){return await D.invalidateQueries(_.VOTES)}async function Me(){const e=v.getState().user;if(!e)return{current_vote_power:0,max_vote_power:0};try{const o=await Ee(),n=L.getState().updateVotePower,s=e==null?void 0:e.vote_power,x=e==null?void 0:e.last_voteclaim_shards,i=(e==null?void 0:e.total_points)??0,u=s+(i-x),a=(o==null?void 0:o.max_votes)??0;return u>a,n(u),{current_vote_power:u,max_vote_power:a}}catch(o){return console.log(o),{current_vote_power:0,max_vote_power:0}}}const Be=({candidates:e,isLoading:o})=>{const n=L(r=>r.votePower),s=v(r=>r.user),x=v(r=>r.updateMember),i=A.useRef(null),u=(e==null?void 0:e.map(r=>({label:r.givenName||r.candidate_name,value:r.candidate_name,...r})))??[],a=[{label:"None",value:"none"},...u],f=a==null?void 0:a[0],[c,P]=C.useState(f),[p,G]=C.useState(f);function T(r,m){m==="first"&&P(r),m==="second"&&G(r)}function S(){return[c==null?void 0:c.value,p==null?void 0:p.value].filter(r=>r!=="none")}async function Q(){const r=S();if(!s||!r||((r==null?void 0:r.length)??0)===0||!n)return null;try{await ye(s,r,"eyeke",Number(n))&&(await I(1200),await x(),await I(1e3),await Ie(),await Ae(),M.success("Vote successfully registered"))}catch(m){console.log(m)}}function N(){i!=null&&i.current&&(i.current.src=h)}return t.jsxs(me,{children:[t.jsxs(he,{children:[t.jsx($,{children:t.jsxs(t.Fragment,{children:[t.jsxs(E,{children:[t.jsx(V,{isLoading:o,onSelected:r=>T(r,"first"),options:a==null?void 0:a.filter(r=>(r==null?void 0:r.value)!==(p==null?void 0:p.value)),title:"None",selected:{label:c==null?void 0:c.label,value:c==null?void 0:c.value},borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),t.jsx(k,{rarity:s==null?void 0:s.avatarrarity,children:t.jsx("img",{ref:i,onError:N,src:c!=null&&c.image?c.image:h,alt:""})})]}),((a==null?void 0:a.length)??0)>0?t.jsx(j,{children:o?t.jsx(g,{className:"loading"}):(c==null?void 0:c.description)||"This candidate doesn't have description"}):t.jsx(j,{children:t.jsx("strong",{children:"No candidates to this planet"})})]})}),t.jsx($,{children:t.jsxs(t.Fragment,{children:[t.jsxs(E,{children:[t.jsx(V,{isLoading:o,onSelected:r=>T(r,"second"),options:a==null?void 0:a.filter(r=>(r==null?void 0:r.value)!==(c==null?void 0:c.value)),title:"None",selected:{label:p==null?void 0:p.label,value:p==null?void 0:p.value}}),t.jsx(k,{rarity:s==null?void 0:s.avatarrarity,children:t.jsx("img",{ref:i,onError:N,src:p!=null&&p.image?p.image:h,alt:""})})]}),((a==null?void 0:a.length)??0)>0?t.jsx(j,{children:o?t.jsx(g,{className:"loading"}):(p==null?void 0:p.description)||"This candidate doesn't have description"}):t.jsx(j,{children:t.jsx("strong",{children:"No candidates to this planet"})})]})})]}),t.jsx(H,{onClick:Q,disabled:n<=0||S().length===0,color:"solidBlue",noBorder:!0,rounded:!1,children:"Cast Vote"})]})},qe=()=>{var x,i;const{isSmall:e}=K(),{data:o}=ke(),{data:n,isLoading:s}=Ce("eyeke");return t.jsxs(le,{children:[t.jsxs(ce,{children:[t.jsxs(pe,{children:["Eyeke Voting",t.jsx(xe,{href:"https://medium.com/mining-matters/feature-spotlight-voting-db0d7d9354e6",target:"_blank",children:t.jsx(Y,{})})]}),t.jsx("img",{src:"/assets/background/bg-voting.jpeg",alt:""})]}),t.jsxs(ue,{children:[t.jsxs(de,{children:[(x=o==null?void 0:o.current_vote_power)==null?void 0:x.toLocaleString("en-US")," /"," ",(i=o==null?void 0:o.max_vote_power)==null?void 0:i.toLocaleString("en-US")," ",t.jsx(R,{type:2})]}),t.jsx(Be,{isLoading:s,candidates:n}),t.jsxs(fe,{children:[t.jsx(w,{children:"Rank"}),t.jsx(w,{children:"Candidate"}),!e&&t.jsx(w,{children:"Wallet"}),t.jsx(w,{children:"Votes"})]}),s?t.jsx(ee,{}):(n==null?void 0:n.length)===0?t.jsx(X,{}):n==null?void 0:n.map((u,a)=>t.jsx(ae,{position:a,data:u},u.candidate_name))]})]})};export{qe as default};
