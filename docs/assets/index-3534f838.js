import{s as i,e as G,a as P,q as N,Q as g,g as Z,S as d,T as K,u as Y,G as J,R as E,_ as A,b as h,f as c,j as t,m as X,d as ee,B as te,h as L,o as se,k as ne}from"./index-8a138b4c.js";import{u as re,L as ie}from"./index-fbba17e0.js";import{g as oe}from"./emporium-tasks-8caed375.js";import{a as ae}from"./index.esm-2ad2ad10.js";import{A as M}from"./atom-a96c28b9.js";const ce=i("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%"}),le=i("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0},"@md":{h:"105px",img:{h:"105px"}},"@sm":{h:"65px",img:{h:"65px"}}}),pe=i("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.8)",w:"100%","@sm":{fs:"24px"}}),ue=i("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",maxW:"1095px","@md":{px:"30px"},"@sm":{px:"15px"}}),de=i("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",mt:"48px"}),xe=i("h3",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",color:"$white500",fs:"32px","@sm":{fs:"24px"}}),me=i("p",{d:"inline-block",w:"100%",maxW:"811px",mt:"18px",mr:"auto",fs:"16px",fw:"$thin",ff:"$body",color:"$white500",span:{textDecoration:"underline"},"@sm":{mt:"10px",fs:"14px"}}),fe=i("div",{d:"flex",align:"center",justify:"center",direction:"column",mt:"18px",w:"100%"}),he=i("h3",{d:"flex",align:"center",justify:"space-between",gap:"10px",w:"100%",color:"$white500",fs:"18px",span:{fs:"32px"},button:{d:"flex",align:"center",justify:"center",gap:"6px",color:"$white500",fw:"$bold",fs:"25px"},"@sm":{fs:"16px",span:{fs:"28px"}}}),ge=i("div",{d:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"15px",flexWrap:"wrap",mt:"18px",w:"100%","@sm":{gap:"5px"}}),ye=i("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gap:"5px",position:"relative",w:"100%",h:"100%",pb:"5px",border:"3px solid rgba(255, 255, 255, 0.4)",img:{w:"100%",h:"100%",maxH:"135px",objectFit:"cover"},">button":{fs:"18px",padding:"0px",mt:"auto",mx:"auto",w:"95%",minW:"95%",maxW:"95%",minH:"35px",div:{minH:"35px"}},variants:{isSelected:{true:{">button":{color:"black"}}}},"@sm":{">button":{fs:"14px"}}}),we=i("div",{d:"flex",align:"center",justify:"center",gap:"10px",position:"absolute",top:"3px",left:"10px",color:"$white500",fs:"24px",fw:"$bold",ff:"$heading",svg:{w:"38px",h:"38px",ml:"-5px",path:{fill:"rgb(246, 168, 0)"}},"@sm":{fs:"16px",left:"5px",top:"0px",svg:{w:"25px",h:"25px"}}}),be=i("h4",{d:"flex",align:"center",justify:"center",direction:"column",padding:"3px 5px",color:"$white500",fs:"18px",ff:"$heading","@sm":{fs:"14px"}}),_e=i("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gap:"10px",w:"100%",my:"10px",pl:"5px",color:"$white500",fs:"13px",ff:"$body",">svg":{w:"20px",h:"20px"},"@sm":{fs:"12px"}}),je=i("p",{w:"100%",my:"auto",pl:"5px",color:"$white500",fs:"13px",ff:"$body",svg:{verticalAlign:"sub",w:"16px",h:"16px",my:"auto",mx:"3px","&:last-of-type":{mr:"3px",w:"19px",h:"19px",path:{fill:"rgb(246, 168, 0)"}}},"@sm":{fs:"12px"}}),Te=i("p",{w:"100%",pl:"5px",color:"$white500",fs:"14px",ff:"$body",span:{display:"inline-flex",align:"center",gap:"3px"},svg:{verticalAlign:"sub",w:"16px",h:"16px",mr:"3px"},"@sm":{fs:"12px"}}),ve=G({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Se=i("div",{d:"flex",w:"100%",maxW:"260px",h:"325px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${ve} 1.2s ease-in-out infinite`,"@sm":{h:"215px",w:"100%"}}),Ce=()=>P({queryKey:[g.Tasks],queryFn:()=>Le(),staleTime:1e3*60*60});async function $e(){return await N.removeQueries([g.Tasks])}async function Le(){try{const n=await oe("active");return n||[]}catch(n){return console.log(n),[]}}const Me=async()=>{const n=await Z({options:{code:d.EMPORIUM,index_position:1,limit:"10000",scope:d.EMPORIUM,table:K.CONFIG}});return n?n[0]:null},ke=()=>P({queryKey:[g.TasksConfig],queryFn:()=>Pe(),staleTime:1e3*60*60});async function Pe(){try{return await Me()}catch(n){return console.log(n),null}}async function Ee(n,p,r,o){const{executeTransaction:x}=Y(),m=await Ae(n,p,r,o);return!!await x(m,{broadcast:!0,sign:!0})}async function Ae(n,p,r,o){return o==="tlm"?{actions:[{account:d.ALIEN_WORLDS,name:"transfer",authorization:[{actor:n.name,permission:n.requestPermission}],data:{from:n.name,memo:`complete task,${p}`,quantity:`${r.toFixed(4)} TLM`,to:"emporium.mc"}}]}:{actions:[{account:d.EMPORIUM,name:"finishtask",authorization:[{actor:n.name,permission:n.requestPermission}],data:{wallet:n.name,task_id:p,currency_amount:r}}]}}function Ie(n){return J({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468-59.015.042-113.223-20.53-155.822-54.911-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184 0-101.705-82.311-184-184-184-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"}}]})(n)}const k=E.lazy(()=>A(()=>import("./tlm-45429db8.js"),["assets/tlm-45429db8.js","assets/index-8a138b4c.js","assets/index-55fec1ff.css"])),De=E.lazy(()=>A(()=>import("./star-6ccfabd8.js"),["assets/star-6ccfabd8.js","assets/index-8a138b4c.js","assets/index-55fec1ff.css"])),ze=()=>{const{data:n,isLoading:p}=Ce(),{data:r}=ke(),o=h(e=>e.user),x=h(e=>e.updateMcPoints),m=h(e=>e.updateTLM),y=re(e=>e.onChangePage),[u,w]=c.useState(void 0),[I,D]=c.useState(""),[b,_]=c.useState(!1),[f,U]=c.useState([]);async function B(e){if(!(!o||!e.current_price)){_(!0);try{await Ee(o,e.task_id,e.current_price,e.task_type)&&(await L(1500),await j(),e.task_type==="tlm"&&await m(),e.task_type==="qp"&&await se(),await x(),ne.success("Task completed successfully"))}catch(s){console.error(s)}finally{_(!1)}}}async function j(){await L(1e3),await $e()}function R(e){if(e.task_id===u){B(e);return}w(e.task_id)}function q(){w(void 0)}const T=c.useCallback(()=>{const e=new Date(new Date().toUTCString().substring(0,25)),s=(r==null?void 0:r.progressupdate_seconds)??0,a=Math.floor(e.getTime()/1e3);return new Date((Math.floor(a/s)*s+s)*1e3)},[r==null?void 0:r.progressupdate_seconds]),v=c.useCallback(e=>{const s=e.minutes>0?`${e.minutes>9?e.minutes:`0${e.minutes}`}`:"00",a=e.seconds>9?e.seconds:`0${e.seconds}`,l=e.hours>9?e.hours:`0${e.hours}`;return e.hours>0?`${l}:${s}:${a}`:`${s}:${a}`},[]),S=c.useCallback(e=>{const s=new Date(new Date().toUTCString().substring(0,25)),a=(r==null?void 0:r.progressupdate_seconds)??1,l=(r==null?void 0:r.tick_percent_decrease)??1,F=Math.floor(s.getTime()/1e3),z=Math.floor(new Date(e==null?void 0:e.timestamp_created).getTime()/1e3),O=Math.floor(z/a)*a,H=Math.floor(F/a)*a-O,Q=Math.floor(H/a),V=l*-1/100,$=e.currency_start*Math.pow(1+V,Q);return e.task_type==="tlm"?Math.ceil($/1e4):Math.floor($)},[r]),C=c.useCallback(e=>{switch(e){case"qp":return t.jsx(X,{});case"mcp":return t.jsx(De,{});case"tlm":return t.jsx(k,{});default:return t.jsx(k,{})}},[]),W=c.useCallback((e,s=0)=>{var a,l;return e==="mcp"?((o==null?void 0:o.mcPoints)??0)<s:e==="tlm"?(Number((a=o==null?void 0:o.userTlm)==null?void 0:a.balance)??0)<s:e==="qp"?(((l=o==null?void 0:o.userWeekly)==null?void 0:l.total_quest_points)??0)<s:!0},[o]);return c.useEffect(()=>{if(n){const e=n.map(s=>({...s,current_price:S(s)}));U(e)}},[n,S]),c.useEffect(()=>{const e=setInterval(()=>{const s=ee(T());D(v(s)),s.minutes===0&&s.seconds===1&&j()},1e3);return()=>clearInterval(e)},[r,v,T]),t.jsx(c.Suspense,{fallback:t.jsx(ie,{}),children:t.jsxs(ce,{children:[t.jsxs(le,{children:[t.jsx(pe,{children:"Zappâ€™s Zap Emporium"}),t.jsx("img",{src:"/assets/background/bg-emporium.webp",alt:""})]}),t.jsxs(ue,{children:[t.jsxs(de,{children:[t.jsx(xe,{children:"Zapp's Tasks"}),t.jsxs(me,{children:["Zapp is currently trying to advance various pressing issues. Assist him in finishing tasks! Zapp will reward the helping player with Alien Worlds Shards he found on his journeys. Since he consistently dedicates time to these tasks, each one becomes easier to complete over time. Once a task is finished by ",t.jsx("u",{children:"any"})," player, it will be replaced by a new one."]})]}),t.jsxs(fe,{children:[t.jsxs(he,{children:[t.jsxs("p",{children:["Next Task Progress: ",t.jsx("span",{children:I})]}),t.jsxs("button",{onClick:()=>y("history"),children:[t.jsx(Ie,{}),"History"]})]}),t.jsx(ge,{children:p?Array.from({length:8}).map((e,s)=>t.jsx(Se,{},s)):f==null?void 0:f.map(e=>{var s;return t.jsxs(ye,{isSelected:u===e.task_id,children:[t.jsxs(we,{children:[(e.shards/10).toLocaleString("en-US")," ",t.jsx(M,{})]}),t.jsx("img",{src:`/assets/tasks/${e.image}.jpeg`,title:e.title,alt:e.title}),u!==e.task_id&&t.jsx(be,{children:e.title}),u===e.task_id?t.jsxs(_e,{children:[t.jsx(ae,{size:30,color:"#fff",onClick:q}),t.jsxs(je,{children:["Are you sure you want to spend"," ",t.jsxs(t.Fragment,{children:[(s=e==null?void 0:e.current_price)==null?void 0:s.toLocaleString("en-US"),C(e.task_type)]}),"to complete the task and gain"," ",(e.shards/10).toLocaleString("en-US"),t.jsx(M,{}),"?"]})]}):t.jsx(Te,{children:e.description.split("[currency]").flatMap(a=>{var l;return[a,t.jsxs("span",{children:[(l=e==null?void 0:e.current_price)==null?void 0:l.toLocaleString("en-US"),C(e.task_type)]},a)]}).slice(0,-1)}),t.jsx(te,{disabled:b||W(e.task_type,e.current_price),isLoading:b,onClick:()=>R(e),color:u===e.task_id?"gradientYellow":"solidBlue",noBorder:!0,rounded:!1,children:u===e.task_id?"Confirm":e.button})]},e.task_id)})})]})]})]})})};export{ze as default};
