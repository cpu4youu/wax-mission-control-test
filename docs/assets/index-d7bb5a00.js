import{s as d,i as $e,k as Ne,u as _e,j as a,e as Oe,t as ze,r as D,h as je,q as Me,Q as Ce,R as U,_ as q,B as Pe}from"./index-ad4900e9.js";import{a as Qe}from"./index.esm-60e55412.js";import{F as Ve}from"./index.esm-6235a041.js";import{f as We}from"./format-currency-usd-c3f487ff.js";import{f as ae}from"./formatNumber-be910684.js";import{a as Te,c as K,d as O}from"./mineCooldown-7508d309.js";import{u as Ge}from"./use-wharfkit-205163d2.js";import{u as Be}from"./use-media-21c2d043.js";import{a as Ke,e as De}from"./execute-claim-contract-ff98ee80.js";import{u as I,g as Se,s as ie}from"./showTlmValueFromMine-b6a301e0.js";import{s as W}from"./sleep-da79c358.js";import{u as Ue,o as Le}from"./lands-query-deed193e.js";import{c as oe,a as se}from"./calculateShardsByLand-da954307.js";import{u as qe,r as Ee,o as Re}from"./tools-query-74ba461c.js";import{u as He,o as be}from"./user-miners-query-e7fc4c80.js";import{u as Ye,o as Xe}from"./lands-query-5fac5963.js";import{u as Ze,o as Je}from"./get-user-settings-assets-query-4538bf94.js";import{u as et,o as tt}from"./wallets-query-f42a2389.js";import{u as nt,o as at,g as it}from"./tool-query-a5d61919.js";import{u as ot,f as st,o as rt,g as lt,e as ct}from"./execute-mine-tool-contract-26b3c1fe.js";import{o as dt}from"./miner-claim-3418791b.js";import{o as pt}from"./toolov-query-448e1663.js";import"./iconBase-155f1866.js";import"./index-d6c01ef9.js";import"./index-bb4c5c3f.js";import"./use-transaction-33190dba.js";import"./toast-options-11be26c8.js";import"./lands-7cec739a.js";import"./adapters-ddfd409f.js";import"./axios-45629df5.js";const ft=d("div",{d:"flex",align:"center",justify:"center",direction:"column",my:"auto","@sm":{ml:"auto",my:"auto"}}),mt=d("div",{d:"flex",align:"center",justify:"center",direction:"column",cursor:"pointer",mr:"auto",position:"relative"}),ut=d("img",{w:"100%",h:"60px",mb:"10px",objectFit:"contain","@sm":{w:"80px",h:"80px"}}),xt=d("div",{d:"flex",align:"center",justify:"center",zIndex:3,position:"absolute",bottom:"-10px",left:"0px",w:"30px",h:"30px",br:"10px","-webkit-text-stroke":"1px white",letterSpacing:"1px",color:"#00D1FF",fw:"900",fs:"20px",ff:"$heading",border:"2px solid white",background:"#D9D9D9",backdropFilter:"blur(15px)"}),gt=d("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%","@sm":{d:"none"}}),ht=d("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",mb:"10px",minW:"200px",w:"100%"}),yt=d("div",{d:"flex",align:"center",justify:"center",position:"relative",boxShadow:"2px 2px 10px #000000",w:"100%",h:"10px",br:"3px",bg:"#595959"}),wt=d("div",{d:"flex",align:"center",justify:"center",position:"absolute",left:"0px",maxW:"200px",h:"10px",br:"3px",bg:"linear-gradient(90deg, #07A3DD 0%, rgba(0, 186, 255, 0.5) 100%)","&::after":{content:"",position:"absolute",right:"-2px",h:"14px",w:"7px",br:"50%",bg:"$white500",filter:"blur(2px)"}}),Tt=d("div",{d:"flex",align:"center",justify:"center",direction:"column",ff:"$heading",fw:"$thin",fs:"12px",color:"$white500","@md":{ml:"auto",fs:"10px"}}),bt=d("div",{d:"flex",align:"center",justify:"space-between",w:"100%","@md":{fs:"12px"}}),_t=d("button",{d:"flex",align:"center",justify:"center",ff:"$body",fs:"14px",fw:"$normal",color:"$red500",cursor:"pointer","&:hover":{textShadow:"1px 1px 2px red"},"@md":{fs:"12px"}}),vt=()=>{const i=$e(),{data:w}=Ne(),l=_e(L=>L.user),{unAuthorize:z}=Ge(),{isSmall:$}=Be(),o=w==null?void 0:w.find(L=>L.level===(l==null?void 0:l.level)),S=((l==null?void 0:l.experience)??0)/((o==null?void 0:o.xp_to_level_up)??100)*100;return a.jsxs(ft,{children:[a.jsx(mt,{onClick:()=>i($?"/user-settings":"/menu"),children:a.jsx(ut,{src:"/assets/icons/logo.webp",alt:"avatar icon"})}),a.jsxs(gt,{children:[a.jsxs(ht,{children:[a.jsx(xt,{children:(l==null?void 0:l.level)??1}),a.jsx(yt,{children:a.jsx(wt,{style:{width:`${S}%`}})})]}),a.jsxs(bt,{children:[!$&&a.jsx(_t,{onClick:z,children:"Logout"}),a.jsxs(Tt,{children:[(l==null?void 0:l.experience)??0,"/",(o==null?void 0:o.xp_to_level_up)??100," ",!$&&"XP"]})]})]})]})},jt=d("div",{d:"flex",align:"center",justify:"space-between",w:"100%",position:"relative",zIndex:20,bg:"$blue700"}),Mt=d("div",{d:"flex",align:"center",justify:"space-between",zIndex:20,w:"100%",px:"30px",h:"140px","@media(max-width:1224px)":{minW:"100%"},"@md":{px:"15px"},"@sm":{}}),Ct=d("div",{d:"flex",align:"center",justify:"center",gap:"20px",">a":{d:"flex",align:"center",justify:"center",svg:{h:"28px",w:"28px"}},svg:{color:"$white500",h:"22px",w:"22px"},zIndex:30,button:{"&:disabled":{opacity:.5}},"@sm":{order:-1,justify:"space-between",w:"max-content",button:{d:"none","&:last-of-type":{d:"flex",zIndex:2,svg:{h:"35px",w:"35px"}}}},"@xxsm":{">a":{top:"10px",position:"absolute"}}}),Dt=Oe({"100%":{transform:"rotate(360deg)"}}),St=d("button",{color:"$white500",svg:{ml:"10px",color:"$white500",w:"25px",h:"25px"},variants:{isLoading:{true:{pointerEvents:"none",opacity:"0.5",svg:{animation:`${Dt} 1s linear`,animationIterationCount:"infinite"}},false:{pointerEvents:"all",opacity:"1"}}}}),Lt=d("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"3px",w:"100%",">button":{h:"30px",minW:"150px",fs:"20px"},span:{textTransform:"uppercase",color:"$white500",fs:"10px",fw:"$bold",ff:"$heading"},"@sm":{w:"max-content",position:"absolute",left:"50%",transform:"translateX(-50%)"}}),Et=d("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"10px",width:"310px","@md":{width:"max-content",margin:"0",gap:"7px"},"@sm":{d:"none"}});d("button",{d:"flex",align:"center",justify:"center",ml:"10px"});const Rt=d("div",{d:"flex",align:"flex-end",justify:"center",gap:"20px",mt:"20px"}),re=d("div",{d:"flex",align:"center",justify:"space-between",direction:"column",color:"$white500",w:"max-content",fs:"14px",svg:{w:"25px",h:"25px"}}),le=d("div",{d:"flex",align:"center",justify:"center",direction:"column",padding:"5px",w:"35px",h:"35px",border:"1px solid $white500",borderRadius:"$full"}),It=d("div",{d:"flex",align:"center",justify:"center",">button>div":{d:"flex",align:"center",justify:"center"},"@sm":{gap:"10px",">button>div":{direction:"column"}}}),$t=d("div",{d:"flex",align:"center",justify:"center",gap:"5px",ml:"10px",fs:"20px",ff:"$body",color:"$white500",path:{fill:"$white500"}}),Bt=d("p",{ff:"$heading",fs:"20px",fw:"$bold",textShadow:"1px 1px 2px black",color:"$yellow500"});function At(){const{isSmall:i}=Be(),w=$e(),{data:l,isLoading:z,isFetching:$}=He(),{data:o,isLoading:S,isFetching:L}=qe(),{data:B}=Ye(),{data:ce,isLoading:de}=Ue(),{data:b}=Ze(),{data:h}=et(),{data:E,isLoading:pe}=nt(),{data:u}=ot(),e=_e(t=>t.user),H=_e(t=>t.updateAuth),_=I(t=>t.nonce),T=I(t=>t.updateIsCalculating),fe=I(t=>t.isMineButtonLoading),me=I(t=>t.updateMineButtonLoading),Y=I(t=>t.isCalculating),ue=I(t=>t.updateNonce),xe=I(t=>t.hashExpire),X=I(t=>t.updateHashExpire),P=I(t=>t.updateMineCooldown),Z=ze(t=>t.currentWeek),[G,F]=D.useState(new Date),[ge,M]=D.useState(!1),[m,he]=D.useState(void 0),[R,Q]=D.useState(null),V=!(e!=null&&e.isMember)||(e==null?void 0:e.flagged),J=async()=>{if(!e)return null;M(!0),T(!0);try{if(!await Ke(e))throw new Error("MINE error from contract");await ie(e==null?void 0:e.name)}catch(t){console.log(t)}finally{await W(800),T(!1),await te(),M(!1)}},ee=async()=>{var t;M(!0);try{await Le(),T(!0),await W(500);const[[f,s]]=Me.getQueriesData(Ce.LANDS),v=(t=s.highestValue)==null?void 0:t.asset_id;if(!e||!v)return null;if(!(_!=null&&_.rand_str)){await Se();const x=new Date;X(x.setMinutes(x.getMinutes()+1))}await De(e,v)&&(await ie(e==null?void 0:e.name),await te())}catch(f){console.log(f)}finally{T(!1),M(!1)}},k=({delay:t})=>{var j,x,n,c,r,g,C,N,ne;const f=(t??0)/10;if(((j=o==null?void 0:o.userTools)==null?void 0:j.length)===1){const A=f*(((n=(x=o==null?void 0:o.userTools)==null?void 0:x[0])==null?void 0:n.delay)??0);return O(A,o,l,F)}const s=(c=o==null?void 0:o.userTools)==null?void 0:c.sort((A,ke)=>ke.delay-A.delay);if(((r=o==null?void 0:o.userTools)==null?void 0:r.length)===2){const A=f*((((g=s==null?void 0:s[0])==null?void 0:g.delay)??0)+(((C=s==null?void 0:s[1])==null?void 0:C.delay)??0)/2);return O(A,o,l,F)}const v=f*((((N=s==null?void 0:s[0])==null?void 0:N.delay)??0)+(((ne=s==null?void 0:s[1])==null?void 0:ne.delay)??0));return O(v,o,l,F)},y=()=>{var j,x;if(!B||!(b!=null&&b.favoriteLands))return null;let t=[];const f=b==null?void 0:b.favoriteLands.filter(([n])=>Te(K(k({delay:n.delay})))==="MINE");if(f.length>0)t=f;else{const n=Math.min(...b.favoriteLands.map(([r])=>K(k({delay:r.delay})).difference));t=b.favoriteLands.filter(([r])=>K(k({delay:r.delay})).difference===n)}if((e==null?void 0:e.miningType)==="orange"){const n=Math.max(...t.map(([r])=>oe({land:r})));return{...(j=t.filter(([r])=>oe({land:r})===n).flatMap(([r])=>r).sort((r,g)=>se({landCardId:g.cardid,landsType:B,userTools:o==null?void 0:o.userTools})-se({landCardId:r.cardid,landsType:B,userTools:o==null?void 0:o.userTools})))==null?void 0:j[0]}}const s=Math.max(...t.map(([n])=>se({landCardId:n.cardid,landsType:B,userTools:o==null?void 0:o.userTools})));return{...(x=t.filter(([n])=>se({landCardId:n.cardid,landsType:B,userTools:o==null?void 0:o.userTools})===s).sort(([n],[c])=>oe({land:c})-oe({land:n})).flatMap(([n])=>n))==null?void 0:x[0]}},p=async()=>{M(!0);try{T(!0),await W(500);const t=y();if(!e)return null;await De(e,t==null?void 0:t.assetId)&&(await ie(e==null?void 0:e.name),await te())}catch(t){console.log(t)}finally{T(!1),M(!1)}},ye=async()=>{await at(),await be(),await tt(),await dt(),await pt(),await rt()},we=D.useCallback(async()=>{if(!E||!u)return null;const t=await Promise.all(E==null?void 0:E.toolsOv.filter(n=>{var r;const c=n.owned>0&&((n==null?void 0:n.tool_name)==="Certified Kol Digger"?!0:n.allowed===1)&&st((e==null?void 0:e.total_points)??0,n);return((h==null?void 0:h.tempid_allow_list.length)??0)===0?c:c&&((r=h==null?void 0:h.tempid_allow_list)==null?void 0:r.some(g=>g===n.template_id))}).map(async n=>{if((n==null?void 0:n.tool_name)==="Certified Kol Digger"){const r=u==null?void 0:u.reduce((g,C)=>{const N=Number(new Date(g.readyat));return Number(new Date(C.readyat))<N?C:g},u[0]);return{...n,...r,last_use:+new Date(`${r.readyat}.000Z`)/1e3-r.cooldown_seconds}}const c=E.stakedTools.find(r=>r.template_id===n.template_id);return{...n,...c,last_use:+new Date(`${n.readyat}.000Z`)/1e3-n.cooldown_seconds}})),f=t==null?void 0:t.filter(n=>{const c=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6;return Te(K(O(c,{userTools:[n],allData:[]},l)))==="MINE"});let s=null;f.length>0?s=f.sort((n,c)=>Ee[n.rarity]-Ee[c.rarity]||c.mining_power-n.mining_power)[0]:s=t==null?void 0:t.reduce((n,c)=>{const r=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6,C=+O(r,{userTools:[n],allData:[]},l),N=((c==null?void 0:c.tool_name)==="Certified Kol Digger"?500:c.cooldown_seconds)*1.6,A=+O(N,{userTools:[c],allData:[]},l);return A<C?{...c,cooldownSec:A}:{...n,cooldownSec:C}},t[0]);const v=((s==null?void 0:s.tool_name)==="Certified Kol Digger"?500:s.cooldown_seconds)*1.5,x=O(v,{userTools:[s],allData:[]},l);return F(x),s},[u,l,E,e,h]),Ae=async()=>{var t,f;M(!0);try{const s=await we();if(!s||!e||!u)return;await Le(),T(!0),await W(500);let v=0,j,x=[];if((s==null?void 0:s.tool_name)==="Certified Kol Digger"){const c=u==null?void 0:u.reduce((r,g)=>{const C=Number(new Date(r.readyat));return Number(new Date(g.readyat))<C?g:r},u[0]);v=c.asset_ids.length*s.pow,x=c.asset_ids.map(r=>Number(r)),j="1099512958237"}else{const[c]=await it(`${s.template_id}`);v=c.pow,x=[c.next_asset_id];let r;try{[[,r]]=Me.getQueriesData([Ce.LANDS,"red",s])}catch{r=await lt(s)}j=(t=r.highestValue)==null?void 0:t.asset_id}await ct({user:e,difficulty:v,assets_ids:x,land_asset_id:j,old_bag_assets_ids:((f=o==null?void 0:o.userTools)==null?void 0:f.map(c=>Number(c.asset_id)))??[]})&&(await ie(e==null?void 0:e.name),await ye())}catch(s){console.log(s)}finally{me(!1),T(!1),M(!1)}},te=async()=>{if(await be(),await Re(),(e==null?void 0:e.miningType)==="red"){await ye(),await W(500),we();return}},Fe=()=>{const t=Te(m);return P(t),t},ve=async()=>{await Re(),await Xe(),await be(),await Je()};return{user:e,miners:l,mTools:u,tools:o,toolsLoaning:E,toolsWallets:h,bestLand:R,cooldown:Fe,handleRefreshLands:ve,playSound:async()=>{const t=new Audio("https://play.alienworlds.io/sounds/aw-mining-claim-sfx-02.mp3");i&&await W(1e3),t.play()},textAboveButton:()=>{var t;return V?"Not a Member":(e==null?void 0:e.miningType)==="green"?"Favorites (shards)":(e==null?void 0:e.miningType)==="orange"?"Favorites (TLM)":(e==null?void 0:e.miningType)==="gold"?"Mining":(e==null?void 0:e.miningType)==="blue"?"Mine Maximizer":(e==null?void 0:e.miningType)==="red"?`Deposit: ${je(h==null?void 0:h.deposit).toFixed(4)} TLM`:`Deposit: ${(je((t=e==null?void 0:e.HqMember)==null?void 0:t.deposit)+((e==null?void 0:e.tlm_deposit)??0)/1e4).toFixed(4)} TLM`},textBelowButton:()=>V?"Become a member to use mine":(e==null?void 0:e.miningType)==="red"?"Tool Loaning":(e==null?void 0:e.miningType)==="gold"||(e==null?void 0:e.miningType)==="blue"?`${l!=null&&l.name?l==null?void 0:l.name:""}`:`${R!=null&&R.name?R==null?void 0:R.name:""}`,buttonOnClick:async()=>{if(V)return w("/membership");if((e==null?void 0:e.miningType)==="red")return await ye(),Ae(),null;if(!(_!=null&&_.rand_str)&&!Y){T(!0),((e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange")&&await ve(),await Se();const t=new Date;X(t.setMinutes(t.getMinutes()+1))}return(e==null?void 0:e.miningType)==="blue"?(ee(),null):(e==null?void 0:e.miningType)==="gold"?(J(),null):(e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange"?(p(),null):J()},loading:()=>{const t=((m==null?void 0:m.seconds)??0)<0&&((m==null?void 0:m.minutes)??0)<0&&((m==null?void 0:m.hours)??0)<0,f=(e==null?void 0:e.miningType)==="red"?pe:!1;return Y||ge||z||S||!m||t||de||fe||f},miningType:()=>(e==null?void 0:e.miningType)==="gold"?"gradientYellow":(e==null?void 0:e.miningType)==="orange"?(Q(y()),"gradientOrange"):(e==null?void 0:e.miningType)==="green"?(Q(y()),"gradientGreen"):(e==null?void 0:e.miningType)==="blue"?"gradientBlue":(e==null?void 0:e.miningType)==="red"?"gradientRed":"gradientYellow",minersFetching:$,toolFetching:L,land:ce,updateAuth:H,updateNonce:ue,hashExpire:xe,currentWeek:Z,expireDate:G,setToolCooldown:he,isSmall:i,favorites:b,landsType:B,setExpireDate:F,setBestLand:Q,isDisableToMine:V,toolCooldown:m,updateMineCooldown:P,handleRefetch:te,navigate:w,selectBestLandOnFavorites:y,getBestToolOnTooLoaning:we,calcCooldown:k,nonce:_}}const Ie=U.lazy(()=>q(()=>import("./tlm-a93b711c.js"),["assets/tlm-a93b711c.js","assets/index-ad4900e9.js","assets/index-55fec1ff.css"])),Ft=U.lazy(()=>q(()=>import("./star-8c8e4026.js"),["assets/star-8c8e4026.js","assets/index-ad4900e9.js","assets/index-55fec1ff.css"])),kt=U.lazy(()=>q(()=>import("./atom-3fb8642f.js"),["assets/atom-3fb8642f.js","assets/index-ad4900e9.js","assets/index-55fec1ff.css"])),Nt=U.lazy(()=>q(()=>import("./quest-70b18d10.js"),["assets/quest-70b18d10.js","assets/index-ad4900e9.js","assets/index-55fec1ff.css"])),Ot=U.lazy(()=>q(()=>import("./open-menu-6c790717.js"),["assets/open-menu-6c790717.js","assets/index-ad4900e9.js","assets/index-55fec1ff.css"])),vn=()=>{var ee,k;const{user:i,miners:w,mTools:l,tools:z,toolsLoaning:$,toolsWallets:o,bestLand:S,cooldown:L,playSound:B,textAboveButton:ce,textBelowButton:de,buttonOnClick:b,loading:h,miningType:E,minersFetching:pe,toolFetching:u,updateNonce:e,hashExpire:H,currentWeek:_,expireDate:T,setToolCooldown:fe,isSmall:me,favorites:Y,landsType:ue,setExpireDate:xe,setBestLand:X,isDisableToMine:P,handleRefetch:Z,navigate:G,selectBestLandOnFavorites:F,getBestToolOnTooLoaning:ge,calcCooldown:M,nonce:m}=At(),he=()=>P?a.jsx("span",{style:{fontSize:"15px"},children:"Membership"}):m!=null&&m.rand_str&&L()==="MINE"?"Submit":L();D.useEffect(()=>{let y=(w==null?void 0:w.delay)??0;if((i==null?void 0:i.miningType)==="blue"&&(y=15),((i==null?void 0:i.miningType)==="green"||(i==null?void 0:i.miningType)==="orange")&&S&&(y=S==null?void 0:S.delay),(i==null?void 0:i.miningType)==="red"){ge();return}M({delay:y})},[S,l,z,$,o,i]),D.useEffect(()=>{const y=setInterval(()=>{const p=K(T);fe(p),((i==null?void 0:i.miningType)==="orange"||(i==null?void 0:i.miningType)==="green")&&X(F()),(p==null?void 0:p.hours)===0&&(p==null?void 0:p.minutes)===0&&(p==null?void 0:p.seconds)===1&&B(),(p==null?void 0:p.hours)===0&&(p==null?void 0:p.minutes)===0&&(p==null?void 0:p.seconds)===0&&clearInterval(y)},1e3);return()=>clearInterval(y)},[T,me,Y,ue,w,z,i]),D.useEffect(()=>{const y=setInterval(()=>{H-new Date().getTime()<0&&e(void 0)},3e3);return()=>clearInterval(y)},[H,e]),D.useEffect(()=>{setInterval(async()=>{await Z()},6e4)},[w,l,xe,$,o,i]);const R=D.useMemo(()=>E(),[i==null?void 0:i.miningType]),Q=h(),V=P?!1:Q,J=P?!1:Q||L()!=="MINE";return a.jsx(jt,{children:a.jsxs(Mt,{children:[a.jsx(vt,{}),a.jsxs(Ct,{children:[a.jsx(St,{disabled:!(i!=null&&i.member),onClick:()=>Z(),isLoading:pe||u,children:a.jsx(Ve,{})}),a.jsxs(Lt,{children:[a.jsx("span",{children:ce()}),a.jsx(Pe,{onClick:()=>b(),disabled:J,color:R,isLoading:V,children:he()}),a.jsx("span",{children:de()})]}),a.jsx("button",{onClick:()=>G("/user-settings"),children:a.jsx(Qe,{})}),a.jsx("button",{onClick:()=>G("/menu"),children:a.jsx(Ot,{})})]}),a.jsxs(Et,{children:[a.jsxs(Rt,{children:[a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Nt,{})}),ae(((ee=i==null?void 0:i.userWeekly)==null?void 0:ee.total_quest_points)??0,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Ft,{})}),ae((i==null?void 0:i.mcPoints)??0,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(kt,{color:"#F6A800"})}),ae(((i==null?void 0:i.redeemable_points)??0)/10,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Ie,{})}),ae(Number((k=i==null?void 0:i.userTlm)==null?void 0:k.balance)??0,1)]})]}),a.jsx(It,{children:a.jsx("button",{onClick:()=>G("/week-reward"),children:a.jsxs("div",{children:[a.jsx(Bt,{children:"Prize Pool"}),a.jsxs($t,{children:[We((_==null?void 0:_.initial_prize_pool_formatted)??0),a.jsx(Ie,{})]})]})})})]})]})})};export{vn as Header};
