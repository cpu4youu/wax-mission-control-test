import{s as p,i as Ie,k as ze,u as _e,j as a,e as Ve,t as Pe,r as L,h as je,q as Me,Q as Ce,R as Y,_ as X,B as Qe}from"./index-8e02403b.js";import{a as We}from"./index.esm-978ab894.js";import{F as Ge}from"./index.esm-dd1be00b.js";import{f as Ke}from"./format-currency-usd-c3f487ff.js";import{f as ie}from"./formatNumber-be910684.js";import{a as Te,c as H,d as k}from"./mineCooldown-e4300c84.js";import{u as Ue}from"./use-wharfkit-0bd5a009.js";import{u as $e}from"./use-media-99bb3027.js";import{a as qe,e as Se}from"./execute-claim-contract-4209ee24.js";import{u as I,g as He,s as oe}from"./showTlmValueFromMine-2b6e6249.js";import{s as N}from"./sleep-da79c358.js";import{u as Ye,o as De}from"./lands-query-ea8ad0a6.js";import{c as se,a as re}from"./calculateShardsByLand-e8d681b0.js";import{u as Xe,r as Le,o as Ee}from"./tools-query-21a648a2.js";import{u as Ze,o as be}from"./user-miners-query-7cc5199f.js";import{u as Je,o as et}from"./lands-query-00854ee6.js";import{u as tt,o as nt}from"./get-user-settings-assets-query-9e8220bd.js";import{u as at,o as it}from"./wallets-query-8c33d71c.js";import{u as ot,o as st,g as rt}from"./tool-query-8aad6d3b.js";import{u as lt,f as ct,o as dt,g as pt,e as ft}from"./execute-mine-tool-contract-5e17db7d.js";import{o as ut}from"./miner-claim-367c1a9f.js";import{o as mt}from"./toolov-query-2d4b335c.js";import"./iconBase-0a5e779d.js";import"./index-da1990f8.js";import"./index-6b3df081.js";import"./use-transaction-5fbdb395.js";import"./toast-options-3ad77d9c.js";import"./lands-ef9eedb6.js";import"./adapters-7799d19a.js";import"./axios-45629df5.js";const gt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",my:"auto","@sm":{ml:"auto",my:"auto"}}),xt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",cursor:"pointer",mr:"auto",position:"relative"}),ht=p("img",{w:"100%",h:"60px",mb:"10px",objectFit:"contain","@sm":{w:"80px",h:"80px"}}),wt=p("div",{d:"flex",align:"center",justify:"center",zIndex:3,position:"absolute",bottom:"-10px",left:"0px",w:"30px",h:"30px",br:"10px","-webkit-text-stroke":"1px white",letterSpacing:"1px",color:"#00D1FF",fw:"900",fs:"20px",ff:"$heading",border:"2px solid white",background:"#D9D9D9",backdropFilter:"blur(15px)"}),yt=p("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%","@sm":{d:"none"}}),Tt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",mb:"10px",minW:"200px",w:"100%"}),bt=p("div",{d:"flex",align:"center",justify:"center",position:"relative",boxShadow:"2px 2px 10px #000000",w:"100%",h:"10px",br:"3px",bg:"#595959"}),_t=p("div",{d:"flex",align:"center",justify:"center",position:"absolute",left:"0px",maxW:"200px",h:"10px",br:"3px",bg:"linear-gradient(90deg, #07A3DD 0%, rgba(0, 186, 255, 0.5) 100%)","&::after":{content:"",position:"absolute",right:"-2px",h:"14px",w:"7px",br:"50%",bg:"$white500",filter:"blur(2px)"}}),vt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",ff:"$heading",fw:"$thin",fs:"12px",color:"$white500","@md":{ml:"auto",fs:"10px"}}),jt=p("div",{d:"flex",align:"center",justify:"space-between",w:"100%","@md":{fs:"12px"}}),Mt=p("button",{d:"flex",align:"center",justify:"center",ff:"$body",fs:"14px",fw:"$normal",color:"$red500",cursor:"pointer","&:hover":{textShadow:"1px 1px 2px red"},"@md":{fs:"12px"}}),Ct=()=>{const i=Ie(),{data:w}=ze(),l=_e(v=>v.user),{unAuthorize:O}=Ue(),{isSmall:E}=$e(),o=w==null?void 0:w.find(v=>v.level===(l==null?void 0:l.level)),R=((l==null?void 0:l.experience)??0)/((o==null?void 0:o.xp_to_level_up)??100)*100;return a.jsxs(gt,{children:[a.jsx(xt,{onClick:()=>i(E?"/user-settings":"/menu"),children:a.jsx(ht,{src:"/assets/icons/logo.webp",alt:"avatar icon"})}),a.jsxs(yt,{children:[a.jsxs(Tt,{children:[a.jsx(wt,{children:(l==null?void 0:l.level)??1}),a.jsx(bt,{children:a.jsx(_t,{style:{width:`${R}%`}})})]}),a.jsxs(jt,{children:[!E&&a.jsx(Mt,{onClick:O,children:"Logout"}),a.jsxs(vt,{children:[(l==null?void 0:l.experience)??0,"/",(o==null?void 0:o.xp_to_level_up)??100," ",!E&&"XP"]})]})]})]})},St=p("div",{d:"flex",align:"center",justify:"space-between",w:"100%",position:"relative",zIndex:20,bg:"$blue700"}),Dt=p("div",{d:"flex",align:"center",justify:"space-between",zIndex:20,w:"100%",px:"30px",h:"140px","@media(max-width:1224px)":{minW:"100%"},"@md":{px:"15px"},"@sm":{}}),Lt=p("div",{d:"flex",align:"center",justify:"center",gap:"20px",">a":{d:"flex",align:"center",justify:"center",svg:{h:"28px",w:"28px"}},svg:{color:"$white500",h:"22px",w:"22px"},zIndex:30,button:{"&:disabled":{opacity:.5}},"@sm":{order:-1,justify:"space-between",w:"max-content",button:{d:"none","&:last-of-type":{d:"flex",zIndex:2,svg:{h:"35px",w:"35px"}}}},"@xxsm":{">a":{top:"10px",position:"absolute"}}}),Et=Ve({"100%":{transform:"rotate(360deg)"}}),Rt=p("button",{color:"$white500",svg:{ml:"10px",color:"$white500",w:"25px",h:"25px"},variants:{isLoading:{true:{pointerEvents:"none",opacity:"0.5",svg:{animation:`${Et} 1s linear`,animationIterationCount:"infinite"}},false:{pointerEvents:"all",opacity:"1"}}}}),It=p("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"3px",w:"100%",">button":{h:"30px",minW:"150px",fs:"20px"},span:{textTransform:"uppercase",color:"$white500",fs:"10px",fw:"$bold",ff:"$heading"},"@sm":{w:"max-content",position:"absolute",left:"50%",transform:"translateX(-50%)"}}),$t=p("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"10px",width:"310px","@md":{width:"max-content",margin:"0",gap:"7px"},"@sm":{d:"none"}});p("button",{d:"flex",align:"center",justify:"center",ml:"10px"});const Bt=p("div",{d:"flex",align:"flex-end",justify:"center",gap:"20px",mt:"20px"}),le=p("div",{d:"flex",align:"center",justify:"space-between",direction:"column",color:"$white500",w:"max-content",fs:"14px",svg:{w:"25px",h:"25px"}}),ce=p("div",{d:"flex",align:"center",justify:"center",direction:"column",padding:"5px",w:"35px",h:"35px",border:"1px solid $white500",borderRadius:"$full"}),Ft=p("div",{d:"flex",align:"center",justify:"center",">button>div":{d:"flex",align:"center",justify:"center"},"@sm":{gap:"10px",">button>div":{direction:"column"}}}),At=p("div",{d:"flex",align:"center",justify:"center",gap:"5px",ml:"10px",fs:"20px",ff:"$body",color:"$white500",path:{fill:"$white500"}}),kt=p("p",{ff:"$heading",fs:"20px",fw:"$bold",textShadow:"1px 1px 2px black",color:"$yellow500"});function Nt(){const{isSmall:i}=$e(),w=Ie(),{data:l,isLoading:O,isFetching:E}=Ze(),{data:o,isLoading:R,isFetching:v}=Xe(),{data:$}=Je(),{data:z,isLoading:de}=Ye(),{data:b}=tt(),{data:x,isFetching:pe}=at(),{data:j,isLoading:Z,isFetching:Q}=ot(),{data:u,isFetching:fe}=lt(),e=_e(t=>t.user),ue=_e(t=>t.updateAuth),V=I(t=>t.nonce),_=I(t=>t.updateIsCalculating),me=I(t=>t.isMineButtonLoading),W=I(t=>t.updateMineButtonLoading),G=I(t=>t.isCalculating),K=I(t=>t.updateNonce),ge=I(t=>t.hashExpire),xe=I(t=>t.updateHashExpire),J=I(t=>t.updateMineCooldown),U=Pe(t=>t.currentWeek),[he,F]=L.useState(new Date),[q,M]=L.useState(!1),[m,ee]=L.useState(void 0),[C,y]=L.useState(null),d=!(e!=null&&e.isMember)||(e==null?void 0:e.flagged),ve=async()=>{if(!e)return null;M(!0),_(!0);try{if(!await qe(e))throw new Error("MINE error from contract");await oe(e==null?void 0:e.name)}catch(t){console.log(t)}finally{await N(800),_(!1),await P(),M(!1)}},Be=async()=>{var t,f;M(!0);try{await De(),_(!0),await N(1e3);const[[s,S]]=Me.getQueriesData(Ce.LANDS),h=((t=z==null?void 0:z.highestValue)==null?void 0:t.asset_id)||((f=S.highestValue)==null?void 0:f.asset_id);if(!e||!h)return null;await Se(e,h)&&(await oe(e==null?void 0:e.name),await P())}catch(s){console.log(s)}finally{_(!1),M(!1)}},te=({delay:t})=>{var h,T,n,c,r,g,D,A,ae;const f=(t??0)/10;if(((h=o==null?void 0:o.userTools)==null?void 0:h.length)===1){const B=f*(((n=(T=o==null?void 0:o.userTools)==null?void 0:T[0])==null?void 0:n.delay)??0);return k(B,o,l,F)}const s=(c=o==null?void 0:o.userTools)==null?void 0:c.sort((B,Oe)=>Oe.delay-B.delay);if(((r=o==null?void 0:o.userTools)==null?void 0:r.length)===2){const B=f*((((g=s==null?void 0:s[0])==null?void 0:g.delay)??0)+(((D=s==null?void 0:s[1])==null?void 0:D.delay)??0)/2);return k(B,o,l,F)}const S=f*((((A=s==null?void 0:s[0])==null?void 0:A.delay)??0)+(((ae=s==null?void 0:s[1])==null?void 0:ae.delay)??0));return k(S,o,l,F)},ne=()=>{var h,T;if(!$||!(b!=null&&b.favoriteLands))return null;let t=[];const f=b==null?void 0:b.favoriteLands.filter(([n])=>Te(H(te({delay:n.delay})))==="MINE");if(f.length>0)t=f;else{const n=Math.min(...b.favoriteLands.map(([r])=>H(te({delay:r.delay})).difference));t=b.favoriteLands.filter(([r])=>H(te({delay:r.delay})).difference===n)}if((e==null?void 0:e.miningType)==="orange"){const n=Math.max(...t.map(([r])=>se({land:r})));return{...(h=t.filter(([r])=>se({land:r})===n).flatMap(([r])=>r).sort((r,g)=>se({land:r})-se({land:g})))==null?void 0:h[0]}}const s=Math.max(...t.map(([n])=>re({landCardId:n.cardid,landsType:$,userTools:o==null?void 0:o.userTools})));return{...(T=t.filter(([n])=>re({landCardId:n.cardid,landsType:$,userTools:o==null?void 0:o.userTools})===s).flatMap(([n])=>n).sort((n,c)=>re({landCardId:c.cardid,landsType:$,userTools:o==null?void 0:o.userTools})-re({landCardId:n.cardid,landsType:$,userTools:o==null?void 0:o.userTools})))==null?void 0:T[0]}},Fe=async()=>{M(!0);try{_(!0),await N(500);const t=ne();if(console.log("bestFavoriteLand",t),!e)return null;await Se(e,t==null?void 0:t.assetId)&&(await oe(e==null?void 0:e.name),await P(),await ye())}catch(t){console.log(t)}finally{_(!1),M(!1)}},we=L.useCallback(async()=>{if(!j||!u)return null;const t=await Promise.all(j==null?void 0:j.toolsOv.filter(n=>{var r;const c=n.owned>0&&((n==null?void 0:n.tool_name)==="Certified Kol Digger"?!0:n.allowed===1)&&ct((e==null?void 0:e.total_points)??0,n);return((x==null?void 0:x.tempid_allow_list.length)??0)===0?c:c&&((r=x==null?void 0:x.tempid_allow_list)==null?void 0:r.some(g=>g===n.template_id))}).map(async n=>{if((n==null?void 0:n.tool_name)==="Certified Kol Digger"){const r=u==null?void 0:u.reduce((g,D)=>{const A=Number(new Date(g.readyat));return Number(new Date(D.readyat))<A?D:g},u[0]);return{...n,...r,last_use:+new Date(`${r.readyat}.000Z`)/1e3-r.cooldown_seconds}}const c=j.stakedTools.find(r=>r.template_id===n.template_id);return{...n,...c,last_use:+new Date(`${n.readyat}.000Z`)/1e3-n.cooldown_seconds}})),f=t==null?void 0:t.filter(n=>{const c=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6;return Te(H(k(c,{userTools:[n],allData:[]},l)))==="MINE"});let s=null;f.length>0?s=f.sort((n,c)=>Le[n.rarity]-Le[c.rarity]||c.mining_power-n.mining_power)[0]:s=t==null?void 0:t.reduce((n,c)=>{const r=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6,D=+k(r,{userTools:[n],allData:[]},l),A=((c==null?void 0:c.tool_name)==="Certified Kol Digger"?500:c.cooldown_seconds)*1.6,B=+k(A,{userTools:[c],allData:[]},l);return B<D?{...c,cooldownSec:B}:{...n,cooldownSec:D}},t[0]);const S=((s==null?void 0:s.tool_name)==="Certified Kol Digger"?500:s.cooldown_seconds)*1.5,T=k(S,{userTools:[s],allData:[]},l);return F(T),s},[u,l,j,e,x]),Ae=async()=>{var t,f;M(!0);try{const s=await we();if(!s||!e||!u)return;await De(),_(!0),await N(500);let S=0,h,T=[];if((s==null?void 0:s.tool_name)==="Certified Kol Digger"){const c=u==null?void 0:u.reduce((r,g)=>{const D=Number(new Date(r.readyat));return Number(new Date(g.readyat))<D?g:r},u[0]);S=c.asset_ids.length*s.pow,T=c.asset_ids.map(r=>Number(r)),h="1099512958237"}else{const[c]=await rt(`${s.template_id}`);S=c.pow,T=[c.next_asset_id];let r;try{[[,r]]=Me.getQueriesData([Ce.LANDS,"red",s])}catch{r=await pt(s)}h=(t=r.highestValue)==null?void 0:t.asset_id}await ft({user:e,difficulty:S,assets_ids:T,land_asset_id:h,old_bag_assets_ids:((f=o==null?void 0:o.userTools)==null?void 0:f.map(c=>Number(c.asset_id)))??[]})&&(await N(800),await oe(e==null?void 0:e.name),await P())}catch(s){console.log(s)}finally{W(!1),_(!1),M(!1)}},P=async()=>{if(await be(),await Ee(),(e==null?void 0:e.miningType)==="red"){await ke(),await N(1e3),we();return}},ke=async()=>{await be(),await it(),await ut(),await st(),await mt(),await dt()},Ne=()=>{const t=Te(m);return J(t),t},ye=async()=>{await Ee(),await et(),await be(),await nt()};return{user:e,miners:l,mTools:u,tools:o,toolsLoaning:j,toolsWallets:x,bestLand:C,cooldown:Ne,handleRefreshLands:ye,playSound:async()=>{const t=new Audio("https://play.alienworlds.io/sounds/aw-mining-claim-sfx-02.mp3");i&&await N(1e3),t.play()},textAboveButton:()=>{var t;return d?"Not a Member":(e==null?void 0:e.miningType)==="green"?"Favorites (shards)":(e==null?void 0:e.miningType)==="orange"?"Favorites (TLM)":(e==null?void 0:e.miningType)==="gold"?"Mining":(e==null?void 0:e.miningType)==="blue"?"Mine Maximizer":(e==null?void 0:e.miningType)==="red"?`Deposit: ${je(x==null?void 0:x.deposit).toFixed(4)} TLM`:`Deposit: ${(je((t=e==null?void 0:e.HqMember)==null?void 0:t.deposit)+((e==null?void 0:e.tlm_deposit)??0)/1e4).toFixed(4)} TLM`},textBelowButton:()=>d?"Become a member to use mine":(e==null?void 0:e.miningType)==="red"?"Tool Loaning":(e==null?void 0:e.miningType)==="gold"||(e==null?void 0:e.miningType)==="blue"?`${l!=null&&l.name?l==null?void 0:l.name:""}`:`${C!=null&&C.name?C==null?void 0:C.name:""}`,buttonOnClick:async()=>{if(d)return w("/membership");if(!(V!=null&&V.rand_str)&&!G){_(!0),await He();const t=new Date;xe(t.setMinutes(t.getMinutes()+1))}return(e==null?void 0:e.miningType)==="red"?(await P(),Ae(),null):(e==null?void 0:e.miningType)==="blue"?(Be(),null):(e==null?void 0:e.miningType)==="gold"?(ve(),null):(e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange"?(await ye(),Fe(),null):ve()},loading:()=>{const t=((m==null?void 0:m.seconds)??0)<0&&((m==null?void 0:m.minutes)??0)<0&&((m==null?void 0:m.hours)??0)<0,f=(e==null?void 0:e.miningType)==="red"?Z:!1;return G||q||me||de||R||Q||v||O||E||pe||fe||!m||t||f},miningType:()=>(e==null?void 0:e.miningType)==="gold"?"gradientYellow":(e==null?void 0:e.miningType)==="orange"?(y(ne()),"gradientOrange"):(e==null?void 0:e.miningType)==="green"?(y(ne()),"gradientGreen"):(e==null?void 0:e.miningType)==="blue"?"gradientBlue":(e==null?void 0:e.miningType)==="red"?"gradientRed":"gradientYellow",minersFetching:E,toolFetching:v,land:z,updateAuth:ue,updateNonce:K,hashExpire:ge,currentWeek:U,expireDate:he,setToolCooldown:ee,isSmall:i,favorites:b,landsType:$,setExpireDate:F,setBestLand:y,isDisableToMine:d,toolCooldown:m,updateMineCooldown:J,handleRefetch:P,navigate:w,selectBestLandOnFavorites:ne,getBestToolOnTooLoaning:we,calcCooldown:te,nonce:V}}const Re=Y.lazy(()=>X(()=>import("./tlm-0de29e7b.js"),["assets/tlm-0de29e7b.js","assets/index-8e02403b.js","assets/index-55fec1ff.css"])),Ot=Y.lazy(()=>X(()=>import("./star-0299fd5b.js"),["assets/star-0299fd5b.js","assets/index-8e02403b.js","assets/index-55fec1ff.css"])),zt=Y.lazy(()=>X(()=>import("./atom-b079e538.js"),["assets/atom-b079e538.js","assets/index-8e02403b.js","assets/index-55fec1ff.css"])),Vt=Y.lazy(()=>X(()=>import("./quest-9c71c9eb.js"),["assets/quest-9c71c9eb.js","assets/index-8e02403b.js","assets/index-55fec1ff.css"])),Pt=Y.lazy(()=>X(()=>import("./open-menu-d0a105b0.js"),["assets/open-menu-d0a105b0.js","assets/index-8e02403b.js","assets/index-55fec1ff.css"])),Cn=()=>{var ee,C;const{user:i,miners:w,mTools:l,tools:O,toolsLoaning:E,toolsWallets:o,bestLand:R,cooldown:v,playSound:$,textAboveButton:z,textBelowButton:de,buttonOnClick:b,loading:x,miningType:pe,updateNonce:j,hashExpire:Z,currentWeek:Q,expireDate:u,setToolCooldown:fe,isSmall:e,favorites:ue,landsType:V,setExpireDate:_,setBestLand:me,isDisableToMine:W,handleRefetch:G,navigate:K,selectBestLandOnFavorites:ge,getBestToolOnTooLoaning:xe,calcCooldown:J,nonce:U}=Nt(),he=()=>W?a.jsx("span",{style:{fontSize:"15px"},children:"Membership"}):U!=null&&U.rand_str&&v()==="MINE"?"Submit":v();L.useEffect(()=>{let y=(w==null?void 0:w.delay)??0;if((i==null?void 0:i.miningType)==="blue"&&(y=15),((i==null?void 0:i.miningType)==="green"||(i==null?void 0:i.miningType)==="orange")&&R&&(y=R==null?void 0:R.delay),(i==null?void 0:i.miningType)==="red"){xe();return}J({delay:y})},[R,l,O,E,o,i]),L.useEffect(()=>{const y=setInterval(()=>{const d=H(u);fe(d),((i==null?void 0:i.miningType)==="orange"||(i==null?void 0:i.miningType)==="green")&&me(ge()),(d==null?void 0:d.hours)===0&&(d==null?void 0:d.minutes)===0&&(d==null?void 0:d.seconds)===1&&$(),(d==null?void 0:d.hours)===0&&(d==null?void 0:d.minutes)===0&&(d==null?void 0:d.seconds)===0&&clearInterval(y)},1e3);return()=>clearInterval(y)},[u,e,ue,V,w,O,i]),L.useEffect(()=>{const y=setInterval(()=>{Z-new Date().getTime()<0&&j(void 0)},3e3);return()=>clearInterval(y)},[Z,j]),L.useEffect(()=>{setInterval(async()=>{await G()},6e4)},[w,l,_,E,o,i]);const F=L.useMemo(()=>pe(),[i==null?void 0:i.miningType]),q=x(),M=W?!1:q,m=W?!1:q||v()!=="MINE";return a.jsx(St,{children:a.jsxs(Dt,{children:[a.jsx(Ct,{}),a.jsxs(Lt,{children:[a.jsx(Rt,{disabled:!(i!=null&&i.member),onClick:()=>G(),isLoading:q,children:a.jsx(Ge,{})}),a.jsxs(It,{children:[a.jsx("span",{children:z()}),a.jsx(Qe,{onClick:()=>b(),disabled:m,color:F,isLoading:M,children:he()}),a.jsx("span",{children:de()})]}),a.jsx("button",{onClick:()=>K("/user-settings"),children:a.jsx(We,{})}),a.jsx("button",{onClick:()=>K("/menu"),children:a.jsx(Pt,{})})]}),a.jsxs($t,{children:[a.jsxs(Bt,{children:[a.jsxs(le,{children:[a.jsx(ce,{children:a.jsx(Vt,{})}),ie(((ee=i==null?void 0:i.userWeekly)==null?void 0:ee.total_quest_points)??0,1)]}),a.jsxs(le,{children:[a.jsx(ce,{children:a.jsx(Ot,{})}),ie((i==null?void 0:i.mcPoints)??0,1)]}),a.jsxs(le,{children:[a.jsx(ce,{children:a.jsx(zt,{color:"#F6A800"})}),ie(((i==null?void 0:i.redeemable_points)??0)/10,1)]}),a.jsxs(le,{children:[a.jsx(ce,{children:a.jsx(Re,{})}),ie(Number((C=i==null?void 0:i.userTlm)==null?void 0:C.balance)??0,1)]})]}),a.jsx(Ft,{children:a.jsx("button",{onClick:()=>K("/week-reward"),children:a.jsxs("div",{children:[a.jsx(kt,{children:"Prize Pool"}),a.jsxs(At,{children:[Ke((Q==null?void 0:Q.initial_prize_pool_formatted)??0),a.jsx(Re,{})]})]})})})]})]})})};export{Cn as Header};
