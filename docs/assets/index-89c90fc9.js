import{s as f,g as S,S as l,T as A,a as v,Q as x,b as m,i as z,n as D,q as N,u as E,R as I,_ as U,O as J,f as B,d as X,j as e,p as Q,B as g,o as tt,h as et,ak as nt}from"./index-9e8ef54b.js";import{I as y}from"./info-builder-f3697759.js";import{i as $}from"./index-f1690a5f.js";const st=f("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"100%","@sm":{px:"0px"}}),at=f("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),ot=f("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),rt=f("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"20px",w:"100%",maxWidth:"1330px",mt:"40px",px:"15px",bg:"rgba(3, 16, 32,  .55)",br:"22px",padding:"20px 35px","@sm":{padding:"20px"}}),T=f("div",{d:"grid",gridTemplateColumns:"2fr 1fr 2fr",gap:"15px",w:"100%",padding:"10px 40px ",br:"10px",bg:"rgba(255,255,255,0.03)",">div:nth-child(2)":{maxW:"180px"},"@sm":{d:"flex",align:"center",justify:"center",direction:"column",padding:"10px 10px ",maxH:"100%",button:{h:"30px",minW:"100%",maxW:"100%"}}}),M=f("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",color:"$white500",mr:"auto","@sm":{w:"100%",justify:"space-between",direction:"row"}}),_=f("div",{d:"flex",align:"flex-start",justify:"flex-start",ff:"$heading",fs:"14px",w:"100%","@md":{fs:"12px"},"@sm":{fs:"11px",fw:"$bold"}}),j=f("div",{d:"flex",align:"flex-start",justify:"flex-start",ff:"$heading",fs:"24px",w:"100%",svg:{m:"auto 5px",w:"20px",h:"20px"},"@md":{fs:"18px"},"@sm":{justify:"space-between",w:"max-content",fw:"$bold",fs:"12px",svg:{w:"15px",h:"15px"}}}),b=f("div",{d:"flex",align:"center",justify:"center",gap:"10px",padding:"5px 20px 5px 10px",w:"100%",svg:{color:"$white500",w:"25px",h:"25px",mr:"auto"},"@sm":{d:"none"}}),L=f("span",{w:"100%",color:"$white500",textAlign:"center",fs:"14px",ff:"$heading",svg:{verticalAlign:"sub",w:"23px",h:"23px"},"@lg":{fs:"12px"},"@md":{fs:"10px"},"@sm":{}}),it=async()=>await S({options:{code:l.HQ_MU,index_position:1,limit:"1000",scope:l.HQ_MU,table:A.TLMDROPS}})??null,ct=async t=>await S({options:{code:l.HQ_MU,index_position:3,limit:"1000",key_type:"i64",scope:l.HQ_MU,table:A.TLMBIDS,lower_bound:t,upper_bound:t}})??null,lt=()=>v({queryKey:[x.SPECIAL_MINING],queryFn:()=>dt(),staleTime:1e3*60*60*24,enabled:!!m.getState().user});async function ut(){return await N.invalidateQueries(x.SPECIAL_MINING)}async function dt(){const t=m.getState().user;if(!t)return null;try{const n=await ct(t.name),r=await it();return n?n==null?void 0:n.reduce((c,u)=>{const o=r==null?void 0:r.find(R=>R.index===u.pool_index&&z(D,new Date(R.endtime)));if(!o)return c;const d=((u==null?void 0:u.total_bid)??0)/((o==null?void 0:o.total_power)??1),P=(o==null?void 0:o.rewards.replace(" TLM",""))??"1";return c+d*Number(P)},0):0}catch(n){return console.log(n),null}}const mt=async t=>{const n=await S({options:{code:l.M__FEDERATION,index_position:1,limit:"1000",scope:l.M__FEDERATION,table:A.MINERCLAIM,lower_bound:t,upper_bound:t}});return(n==null?void 0:n[0])??null},ft=()=>v({queryKey:[x.MINER_CLAIM],queryFn:()=>pt(),staleTime:1e3*60*60*24,enabled:!!m.getState().user});async function xt(){return await N.invalidateQueries(x.MINER_CLAIM)}async function pt(){const t=m.getState().user;if(!t)return null;try{return await mt(t.name)}catch(n){return console.log(n),null}}const ht=async t=>{const n=await S({options:{code:l.M__FEDERATION,index_position:1,limit:"1000",scope:l.M__FEDERATION,table:A.LANDCOMMS,lower_bound:t,upper_bound:t}});return(n==null?void 0:n[0])??null},wt=()=>v({queryKey:[x.LAND_COMMS],queryFn:()=>yt(),staleTime:1e3*60*60*24,enabled:!!m.getState().user});async function gt(){return await N.invalidateQueries(x.LAND_COMMS)}async function yt(){const t=m.getState().user;if(!t)return null;try{return await ht(t.name)}catch(n){return console.log(n),null}}const Tt=async t=>{const n=await S({options:{code:l.AWLNDRATINGS,index_position:1,limit:"1000",scope:l.AWLNDRATINGS,table:A.PAYOUTS,lower_bound:t,upper_bound:t}});return(n==null?void 0:n[0])??null},Mt=()=>v({queryKey:[x.PAYOUTS],queryFn:()=>jt(),staleTime:1e3*60*60*24,enabled:!!m.getState().user});async function _t(){return await N.invalidateQueries(x.PAYOUTS)}async function jt(){const t=m.getState().user;if(!t)return null;try{return await Tt(t.name)}catch(n){return console.log(n),null}}async function bt(t){const{executeTransaction:n}=E(),r=Lt(t);return!!await n(r)}function Lt(t){return{actions:[{account:l.M__FEDERATION,name:"claimmines",authorization:[{actor:t.name,permission:t.requestPermission}],data:{receiver:t.name}}]}}async function Ct(t){const{executeTransaction:n}=E(),r=St(t);return!!await n(r)}function St(t){return{actions:[{account:l.M__FEDERATION,name:"claimcomms",authorization:[{actor:t.name,permission:t.requestPermission}],data:{receiver:t.name}}]}}async function At(t){const{executeTransaction:n}=E(),r=Et(t);return!!await n(r)}function Et(t){return{actions:[{account:l.AWLNDRATINGS,name:"claimpay",authorization:[{actor:t.name,permission:t.requestPermission}],data:{receiver:t.name}}]}}async function Rt(t,n,r){const{executeTransaction:i}=E(),c=$t(n,r,t);return!!await i(c)}function $t(t,n,r){return{actions:n.map(c=>({account:l.MISSION_CONTROL,name:"claimweek",authorization:[{actor:r.name,permission:r.requestPermission}],data:{wallet:r.name,week_id:c,boost_percentage:t}}))}}function H(t){const n=t.getFullYear(),r=t.getMonth()+1>9?t.getMonth()+1:`0${t.getMonth()+1}`,i=t.getDate()>9?t.getDate():`0${t.getDate()}`,c=t.getHours()>9?t.getHours():`0${t.getHours()}`,u=t.getMinutes()>9?t.getMinutes():`0${t.getMinutes()}`,o=t.getSeconds()>9?t.getSeconds():`0${t.getSeconds()}`;return`${n}-${r}-${i}T${c}:${u}:${o}`}async function Dt(t,n){const{executeTransaction:r}=E(),i=It(t,n);return!!await r(i)}function It(t,n){return{actions:[{account:l.HQ_MU,name:"withdrawtlm",authorization:[{actor:t.name,permission:t.requestPermission}],data:{wallet:t.name}},{account:l.MEMBERS_MC,name:"withdrawdepo",authorization:[{actor:t.name,permission:t.requestPermission}],data:{wallet:t.name,amount:n}}]}}const vt={addTLM:!1,withdrawTLM:!1,claimTLM:!1,claimMines:!1,claimComms:!1,claimPay:!1,weekReward:!1},C=I.lazy(()=>U(()=>import("./tlm-94a078bd.js"),["assets/tlm-94a078bd.js","assets/index-9e8ef54b.js","assets/index-55fec1ff.css"])),Nt=I.lazy(()=>U(()=>import("./star-f9303a11.js"),["assets/star-f9303a11.js","assets/index-9e8ef54b.js","assets/index-55fec1ff.css"])),Ft=()=>{var F,O;const t=m(s=>s.user),n=m(s=>s.updateMember),r=J(s=>s.weeklies);lt();const{data:i}=ft(),{data:c}=wt(),{data:u}=Mt(),[o,d]=I.useState(vt),[P,R]=I.useState(""),W=r==null?void 0:r.reduce((s,a)=>{const w=((a==null?void 0:a.initial_prize_pool_formatted)??0)*((a==null?void 0:a.total_quest_points)??1)/((a==null?void 0:a.total_quest_points_week)??1);return a.week_id&&a.total_quest_points_user_week>0&&$(new Date,new Date(a==null?void 0:a.expiresDate))&&z(new Date,new Date((a==null?void 0:a.end_date)??""))?{total:s.total+w,weeks:[...s.weeks,a.week_id]}:{total:s.total,weeks:[...s.weeks]}},{total:0,weeks:[]});async function G(){if(t){d({...o,claimMines:!0});try{if(!await bt(t))throw new Error("Claim Mines error from contract");await h()}catch(s){console.log(s)}finally{d({...o,claimMines:!1})}}}async function V(){if(t){d({...o,claimComms:!0});try{if(!await Ct(t))throw new Error("Claim Comms error from contract");await h()}catch(s){console.log(s)}finally{d({...o,claimComms:!1})}}}async function Y(){if(t){d({...o,claimPay:!0});try{if(!await At(t))throw new Error("Claim Pay error from contract");await h()}catch(s){console.log(s)}finally{d({...o,claimPay:!1})}}}async function K(){if(t){d({...o,weekReward:!1});try{if(!await Rt(t,0,W.weeks))throw new Error("Week Reward error from contract");await h(),await tt()}catch(s){console.log(s)}finally{d({...o,weekReward:!1})}}}async function h(){if(!(t!=null&&t.name))return null;await et(500);const s=await nt(t==null?void 0:t.name);m.setState(a=>({...a,user:a.user?{...a.user,userTlm:s}:null})),await n(),await ut(),await xt(),await gt(),await _t()}async function k(s){if(t){d({...o,withdrawTLM:!0});try{if(!await Dt(t,s))throw new Error("Withdrawn TLM error from contract");await h()}catch(a){console.log(a)}finally{d({...o,withdrawTLM:!1})}}}const Z=s=>{const a=s.days?`${s.days}d`:"",w=s.hours?`${s.hours}h`:"",q=s.minutes?`${s.minutes}m`:"";return`${a}${w}${q}${s.seconds}s`},p=B.useMemo(()=>new Date((i==null?void 0:i.timestamp)||new Date),[i==null?void 0:i.timestamp]);return B.useEffect(()=>{const s=setInterval(()=>{const a=new Date(`${H(p)}`),w=X(a),q=Z(w);R(q)},1e3);return()=>clearInterval(s)},[p]),e.jsxs(st,{children:[e.jsxs(at,{children:[e.jsx(ot,{children:"The Vault"}),e.jsx("img",{src:"/assets/background/bg-the-vault.webp",alt:""})]}),e.jsxs(rt,{children:[e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(_,{children:"Deposited TLM"}),e.jsxs(j,{children:[(Q((F=t==null?void 0:t.HqMember)==null?void 0:F.deposit)+((t==null?void 0:t.tlm_deposit)??0)/1e4).toFixed(4),e.jsx(C,{})]})]}),e.jsx(g,{rounded:!1,color:"solidBlue",isLoading:o.withdrawTLM,disabled:Q((O=t==null?void 0:t.HqMember)==null?void 0:O.deposit)+((t==null?void 0:t.tlm_deposit)??0)/1e4===0,onClick:()=>k((t==null?void 0:t.tlm_deposit)??0),children:"Withdraw"}),e.jsxs(b,{children:[e.jsx(y,{}),e.jsx(L,{children:"Deposits are currently unused"})]})]}),e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(_,{children:"Alien Worlds Mining Rewards"}),e.jsxs(j,{children:[(i==null?void 0:i.amount.replace(" TLM",""))??"0.0000"," ",e.jsx(C,{})]})]}),e.jsx(g,{isLoading:o.claimMines,disabled:((i==null?void 0:i.amount)??0)===0||$(D,p),onClick:G,rounded:!1,color:"solidBlue",children:$(D,p)?P:"Claim"}),e.jsxs(b,{children:[e.jsx(y,{}),e.jsxs(L,{children:["Earned by mining in Alien Worlds",$(D,p)&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),`Available on ${new Date(`${H(p)}.000Z`).toLocaleString()}`]})]})]})]}),e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(_,{children:"Alien Worlds Land Commission"}),e.jsxs(j,{children:[(c==null?void 0:c.comms.replace(" TLM",""))??"0.0000"," ",e.jsx(C,{})]})]}),e.jsx(g,{isLoading:o.claimComms,disabled:((c==null?void 0:c.comms)??0)===0,onClick:V,rounded:!1,color:"solidBlue",children:"Claim"}),e.jsxs(b,{children:[e.jsx(y,{}),e.jsx(L,{children:"Earned by mining in Alien Worlds"})]})]}),e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(_,{children:"Alien Worlds DTAL"}),e.jsxs(j,{children:[(u==null?void 0:u.payoutAmount.replace(" TLM",""))??"0.0000"," ",e.jsx(C,{})]})]}),e.jsx(g,{isLoading:o.claimPay,disabled:((u==null?void 0:u.payoutAmount)??0)===0,onClick:Y,rounded:!1,color:"solidBlue",children:"Claim"}),e.jsxs(b,{children:[e.jsx(y,{}),e.jsx(L,{children:"Earned daily by owning lands in Alien Worlds"})]})]}),e.jsxs(T,{children:[e.jsxs(M,{children:[e.jsx(_,{children:"Mission Control Weekly Rewards"}),e.jsxs(j,{children:[W.total.toFixed(4)," ",e.jsx(C,{})]})]}),e.jsx(g,{isLoading:o.weekReward,disabled:W.total===0,onClick:K,rounded:!1,color:"solidBlue",children:"Claim"}),e.jsxs(b,{children:[e.jsx(y,{}),e.jsxs(L,{children:["Earned by playing Mission Control, costs ",e.jsx(Nt,{})," to claim"]})]})]})]})]})};export{Ft as default};
