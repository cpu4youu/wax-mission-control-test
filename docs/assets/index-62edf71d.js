import{s as r,e as U,m as G,aE as Y,aF as q,W as z,X as H,b as K,Y as E,R as o,f as b,a2 as X,a3 as M,d as D,aG as J,ax as k,aH as F,j as n,t as l,B as Z,aw as W,a8 as ee,h as te,q as ae,Q as se,V as ne,aI as re,az as ie,a0 as oe}from"./index-a74e6323.js";import{C as ce}from"./index-91546547.js";import{P as de}from"./pickaxe-90efe154.js";const le=r("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),ue=r("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),pe=r("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),fe=r("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),xe=r("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),me=r("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),ge=r("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),N=r("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{filter:"drop-shadow(3px 5px 2px rgb(0 0 0 / 0.6))",w:"20px",h:"20px"}}),B=r("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"2px 1px 4px rgba(0, 0, 0)",fs:"14px",ff:"$heading",fw:"400"}),he=U({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),we=r("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${he} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),ye=[{label:"Sort by rarity",value:"rarity"}],ve=()=>{const{data:c,isLoading:$}=G("tool.worlds"),{data:m}=Y(),{data:a}=q(),{data:d}=z(),{data:i}=H(),u=K(e=>e.user),_=E(e=>e.isCalculating),A=E(e=>e.updateIsCalculating),[j,Q]=o.useState([]),[p,R]=o.useState([]),[T,S]=o.useState(!1),[v,be]=o.useState(ye[0]),[,g]=o.useState(!1);async function O(e){var t;if(u){S(!0);try{await ee(),A(!0),await te(500);const[[s,w]]=ae.getQueriesData(se.LANDS),x=(t=w.highestValue)==null?void 0:t.asset_id,L=(d==null?void 0:d.current_land)===x?void 0:x,{getAssetByAssetId:V}=ne,P=await V(String(e.next_asset_id)),I=i==null?void 0:i.allData.find(y=>y.template_id===Number(P.template.template_id));if(!L||!(i!=null&&i.userTools)||!I)return;await re({user:u,next_tool:[I],assets_ids:[e.next_asset_id],land_asset_id:L,old_bag_assets_ids:i.userTools.map(y=>Number(y.asset_id))})&&(await ie("tool.worlds"),await oe(u==null?void 0:u.name))}catch(s){console.error("Error staking tool",s)}finally{S(!1)}}}const f=b.useCallback(e=>{const t=e.delay*1.6;return X(t,{userTools:[e],allData:[]},d)},[i,d]),h=b.useCallback(e=>M(D(f(e))),[f]),C=b.useCallback(async()=>{if(!m)return[];const e=await Promise.all(m.filter(t=>(c==null?void 0:c.some(s=>t.template_id===Number(s.template.template_id)))&&t.owned>0).map(async t=>{const s=c==null?void 0:c.find(x=>t.template_id===Number(x.template.template_id)),w=await J((s==null?void 0:s.asset_id)??"");return{...s==null?void 0:s.data,...w,...t,asset_id:(s==null?void 0:s.asset_id)??""}}));Q(e)},[m,c]);return o.useEffect(()=>{C()},[C]),o.useEffect(()=>{if(v.value==="rarity"){const e=j.sort((t,s)=>k[t.rarity]-k[s.rarity]||F[t.shine]-F[s.shine]);R(e)}},[j,v.value]),o.useEffect(()=>{const e=setInterval(()=>{p.every(t=>M(D(f(t)))==="MINE")?(g(t=>!t),clearInterval(e)):g(t=>!t)},1e3);return g(t=>!t),()=>clearInterval(e)},[p,d,f]),n.jsxs(le,{children:[n.jsx(ue,{children:"LOAN TOOLS"}),n.jsxs(pe,{children:["Deposited TLM:"," ",n.jsxs(fe,{color:l(a==null?void 0:a.deposit)>=0?"green":"red",children:[l(a==null?void 0:a.deposit)>=0?l(a==null?void 0:a.deposit).toFixed(4):`- ${l(a==null?void 0:a.trialtlm).toFixed(4)}`," ","TLM"," ",l(a==null?void 0:a.deposit)<0&&l(a==null?void 0:a.trialtlm)>0&&"(Deposit more TLM)"]})]}),n.jsx(xe,{children:$?new Array(6).fill(0).map((e,t)=>n.jsx(we,{},t)):p==null?void 0:p.map((e,t)=>n.jsx(ce,{showNumberBracket:!0,tool:e,children:n.jsxs(me,{children:[n.jsx(Z,{isLoading:T||_,disabled:T||_||h(e)!=="MINE",onClick:()=>O(e),rounded:!1,color:"solidBlue",children:h(e)==="MINE"?"Mine":h(e)}),n.jsxs(ge,{children:[n.jsxs(N,{children:[n.jsx(de,{}),n.jsx(B,{children:e.mining_power})]}),n.jsxs(N,{children:[n.jsx(W,{}),n.jsx(B,{children:e.pow})]})]})]})},t))})]})};export{ve as default};
