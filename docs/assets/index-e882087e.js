import{S as v,s,R as L,_ as R,u as g,t as f,r as j,n as u,j as o,B as _,o as T,D as b,f as C}from"./index-8e02403b.js";import{A as E}from"./index.esm-674628aa.js";import{u as M}from"./use-transaction-5fbdb395.js";import{t as A}from"./toast-options-3ad77d9c.js";import{s as $}from"./sleep-da79c358.js";import{i as H}from"./index-300cef15.js";import{i as S}from"./index-da1990f8.js";import"./iconBase-0a5e779d.js";async function P(i,a,r){const{executeTransaction:c}=M(),p=B(a,r,i);return!!await c(p)}function B(i,a,r){return{actions:[{account:v.MISSION_CONTROL,name:"claimweek",authorization:[{actor:r.name,permission:r.authorization.permission}],data:{wallet:r.name,week_id:a,boost_percentage:i}}]}}async function N(i,a){const{executeTransaction:r}=M(),c=y(a,i);return!!await r(c)}function y(i,a){return{actions:[{account:v.MISSION_CONTROL,name:"claimweektlm",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,week_id:i}}]}}const F=s("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",zIndex:"12",w:"100%",maxW:"1190px"}),V=s("h2",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",fs:"40px",w:"100%",mt:"60px","@sm":{fs:"26px"}}),q=s("div",{d:"flex",align:"center",justify:"center",padding:"5px 20px 5px 10px",border:"1px solid rgba(0, 0, 0, 0.4)",br:"13px",bg:"$blue100",w:"100%",h:"85px",mt:"60px",svg:{color:"$white500",w:"25px",h:"25px",mr:"auto"},"@sm":{d:"none"}}),G=s("span",{w:"100%",color:"$white500",textAlign:"center",fs:"16px",fw:"$bold",ff:"$heading","@lg":{fs:"12px"},"@md":{fs:"10px"},"@sm":{}}),U=s("div",{d:"flex",align:"center",justify:"space-between",gap:"20px",w:"100%",mt:"30px","@md":{direction:"column",padding:"0 20px"}}),Q=s("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",w:"100%",mt:"auto",">p":{color:"$white500",textAlign:"center",fs:"16px",fw:"$bold",ff:"$heading"},">button":{maxW:"200px",minW:"200px",minH:"40px",maxH:"40px",div:{gap:"5px",fs:"20px",minH:"40px",maxH:"40px"}},"@md":{direction:"column",padding:"0 20px"}}),J=s("div",{d:"flex",align:"center",justify:"center",direction:"column",maxW:"255px",h:"386px",padding:"15px",br:"18px",bg:"rgb(3 16 32 / 70%)",">button":{mt:"auto",maxW:"200px",minW:"200px",opacity:"1 !important",minH:"40px",maxH:"40px",div:{gap:"5px",fs:"20px",minH:"40px",maxH:"40px"}},variants:{order:{0:{order:3,"@md":{order:0}},1:{order:2,"@md":{order:1}},2:{order:1,"@md":{order:2}},3:{order:0,"@md":{order:3}}}},"@md":{h:"auto",w:"100%",maxW:"100%"}}),K=s("h4",{d:"flex",align:"center",justify:"center",color:"$white500",textTransform:"uppercase",fs:"24px",mb:"50px",w:"100%"}),X=s("span",{d:"flex",align:"center",justify:"center",color:"$white500",textAlign:"center",ff:"$heading",fs:"18px",mb:"10px",w:"100%","@md":{mb:"20px"}}),Y=s("span",{textAlign:"center",ff:"$heading",fw:"$bold",fs:"18px",color:"$white500",mb:"auto",w:"100%",span:{color:"#F6A800"},"@md":{mb:"20px"}}),Z=L.lazy(()=>R(()=>import("./star-0299fd5b.js"),["assets/star-0299fd5b.js","assets/index-8e02403b.js","assets/index-55fec1ff.css"])),I=L.lazy(()=>R(()=>import("./tlm-0de29e7b.js"),["assets/tlm-0de29e7b.js","assets/index-8e02403b.js","assets/index-55fec1ff.css"])),st=()=>{const i=g(t=>t.user);g(t=>t.updateAuth);const a=f(t=>t.settings),r=f(t=>t.weeklies),c=f(t=>t.currentWeek),p=f(t=>t.claimWeeks),h=f(t=>t.updateClaimWeeks),[m,l]=j.useState(!1),x=j.useMemo(()=>{const t=r==null?void 0:r.filter(e=>e.total_quest_points_user_week>0&&H(u,new Date(e==null?void 0:e.expiresDate))&&S(u,new Date((e==null?void 0:e.end_date)??"")));return[0,1,2,3].map(e=>({week_id:((c==null?void 0:c.week_id)??0)-(e+1),isAfter:!0,userTLM:0})).map(e=>{const n=t.find(({week_id:w})=>e.week_id===w);if(n){const w=((n==null?void 0:n.initial_prize_pool_formatted)??0)*((n==null?void 0:n.total_quest_points)??1)/((n==null?void 0:n.total_quest_points_week)??1);if(!(p==null?void 0:p.find(z=>z===`${n==null?void 0:n.week_id}`)))return{...n,userTLM:w,isAfter:S(u,(n==null?void 0:n.expiresDate)??u)}}return e})},[r,c,p]);async function D(t){if(!i||!((t??0)>=0))return null;l(!0);try{if(!await P(i,0,`${t}`))throw new Error("Purchase error from contract");await $(3e3),await T(),await b(),h([...p,`${t}`]),l(!1),C.success("Claim successfully!",A)}catch(d){console.log(d),l(!1)}}async function O(t){if(!i||!((t??0)>=0))return null;l(!0);try{if(!await N(i,`${t}`))throw new Error("Purchase error from contract");await $(3e3),await T(),await b(),h([...p,`${t}`]),l(!1),C.success("Claim successfully!",A)}catch(d){console.log(d),l(!1)}}return o.jsxs(F,{children:[o.jsx(V,{children:"Weekly Rewards"}),o.jsxs(q,{children:[o.jsx(E,{}),o.jsx(G,{children:"Rewards are available for a maximum of 4 weeks. Any unclaimed rewards are returned to Mission Control."})]}),o.jsx(U,{children:x&&x.length>0&&(x==null?void 0:x.map((t,d)=>o.jsxs(J,{order:d,children:[o.jsxs(K,{children:["Week ",t.week_id]}),!(t!=null&&t.isAfter)&&o.jsxs(Y,{children:["Total reward of the week:"," ",o.jsxs("span",{children:[t.userTLM.toFixed(4)," ",o.jsx(I,{})]})]}),o.jsx(X,{children:t!=null&&t.isAfter?"These rewards were either already claimed by you, or you did not participate in this week.":"To claim your reward, you have two options:"}),t!=null&&t.isAfter?o.jsx(_,{color:"gradientBlack",disabled:!0,isLoading:m,children:"Claimed"}):o.jsxs(Q,{children:[o.jsx("p",{children:"CLAIM USING"}),o.jsxs(_,{color:"gradientPink",isLoading:m,disabled:m||((i==null?void 0:i.mcPoints)??0)<((a==null?void 0:a.cost_nftpoints_claim)??0),onClick:()=>D(t==null?void 0:t.week_id),children:[(a==null?void 0:a.cost_nftpoints_claim.toLocaleString("en-US",{maximumFractionDigits:0}))??0," ",o.jsx(Z,{color:"#fff"})]}),o.jsxs(_,{disabled:m,color:"gradientBlue",isLoading:m,onClick:()=>O(t==null?void 0:t.week_id),children:[(t.userTLM/2).toFixed(4)," ",o.jsx(I,{color:"#fff"})]})]})]},t.week_id)))})]})};export{st as default};
