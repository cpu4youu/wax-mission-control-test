import{s as d,e as ie,S as D,u as G,x as ce,W as de,V as le,U as pe,b as v,f as x,j as s,B as T,m as _,L as F,n as C,a0 as E}from"./index-dcee1366.js";import{S as ue}from"./index-22d3fe07.js";import{u as xe}from"./index-2338c4f5.js";import{u as me,o as R}from"./inventory-query-2b40edc5.js";import{u as fe}from"./mine-query-928bdc22.js";import{o as I,e as q}from"./execute-equip-tools-contract-39344230.js";import{options as L}from"./index-5d649c47.js";import"./index.esm-883828d7.js";import"./index-f393ed05.js";import"./Combination-41913609.js";import"./gradient-border-12d412a3.js";import"./index-1afdc549.js";import"./index.esm-0fe1b3e6.js";const ge=d("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",maxW:"1190px"}),he=d("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",mt:"30px",mb:"30px",button:{h:"50px",w:"100%",maxW:"230px",div:{fs:"16px",border:"none",br:"10px"}},w:"100%","@sm":{button:{w:"100%",maxW:"100%"}}});d("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}});const we=d("div",{d:"flex",align:"center",justify:"center",direction:"column",margin:"auto",w:"100%","@md":{d:"flex",padding:"0 20px",flexWrap:"wrap"},"@sm":{padding:"0 10px"}}),M=d("h3",{mr:"auto",mb:"25px",fs:"29px",fw:"$bold",ff:"$heading",color:"$white500","@sm":{fs:"18px"}}),Te=d("div",{d:"flex",align:"flex-start",justify:"flex-start",gap:"20px",mt:"25px",mb:"25px","@md":{flexWrap:"wrap"}}),je=d("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"230px",button:{h:"55px",w:"100%",minW:"100%",maxW:"100%",mt:"8px",div:{fs:"16px",border:"none",br:"10px"}},"@md":{m:"auto"},"@sm":{}}),be=d("img",{position:"absolute",top:"-25px",left:"-25px",w:"75px",h:"75px"}),ye=d("img",{w:"100%",h:"114px"}),Se=d("div",{d:"flex",align:"center",justify:"center",gap:"2px 10px",flexWrap:"wrap",padding:"10px",w:"78%",br:"10px",bg:"rgba(255, 255, 255, 0.03)","@md":{w:"100%"},"@sm":{padding:"5px 0px"}}),Q=d("div",{d:"grid",gridTemplateColumns:"1fr 1fr",gap:"1px 7px",w:"100%","@sm":{gridTemplateColumns:"1fr"}}),w=d("div",{d:"grid",gridTemplateColumns:"4fr 1fr",gap:"2px",w:"100%",span:{padding:"10px",bg:"rgba(255, 255, 255, 0.06)",color:"$white500",fs:"16px",fw:"$bold",ff:"$heading",w:"100%"},"@sm":{span:{fs:"12px"}}}),ve=d("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",mb:"25px",">div":{d:"flex",align:"flex-start",justify:"flex-start",w:"100%",button:{w:"100%",maxW:"440px"}}}),_e=d("div",{d:"flex",direction:"column",w:"100%",">button":{h:"55px",w:"100%",maxW:"340px",div:{fs:"16px",br:"10px"}}}),Ce=d("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"20px",mt:"25px",w:"100%"}),z=d("div",{d:"flex",direction:"column",gap:"6px",img:{w:"220px",h:"325px"},">button":{h:"35px",w:"100%",minW:"100%",br:"10px",padding:"0px",div:{fs:"16px",br:"10px"}},"@sm":{w:"46%",img:{w:"100%",h:"auto"}}}),Le=ie({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),H=d("div",{d:"flex",w:"200px",h:"330px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${Le} 1.2s ease-in-out infinite`,"@sm":{h:"230px",w:"46%"}});async function Pe(u,p){const{executeTransaction:e}=G(),b=ke(u,p);return!!await e(b)}function ke(u,p){return{actions:[{account:D.MEMBERS_MC,name:"addfavtools",authorization:[{actor:u.name,permission:u.requestPermission}],data:{wallet:u.name,asset_ids:p}}]}}async function Be(u,p){const{executeTransaction:e}=G(),b=Me(u,p);return!!await e(b)}function Me(u,p){return{actions:[{account:D.MEMBERS_MC,name:"addfavland",authorization:[{actor:u.name,permission:u.requestPermission}],data:{wallet:u.name,asset_id:p}}]}}const De=()=>{var U,$;const u=ce(),{data:p}=fe(),{data:e,isLoading:b}=de(),{data:y,isLoading:O}=me("tool.worlds",!0),{data:r}=le(),{data:S}=pe(),c=v(n=>n.user),[g,h]=x.useState(!1),[V,K]=x.useState(L.find(n=>n.value===(c==null?void 0:c.miningType))??L[1]),m=x.useMemo(()=>S==null?void 0:S.find(n=>n.landtype_id===(r==null?void 0:r.cardid)),[S,r==null?void 0:r.cardid]),o=x.useMemo(()=>{var t,a,i,l,j,A;return[((a=(t=e==null?void 0:e.userTools)==null?void 0:t[0])==null?void 0:a.cooldown_seconds)??0,((l=(i=e==null?void 0:e.userTools)==null?void 0:i[1])==null?void 0:l.cooldown_seconds)??0,((A=(j=e==null?void 0:e.userTools)==null?void 0:j[2])==null?void 0:A.cooldown_seconds)??0].toSorted((re,oe)=>oe-re)},[e==null?void 0:e.userTools]),f=x.useCallback(()=>{const n=(m==null?void 0:m.cooldown_mod)??0;return!(o!=null&&o[0])||!o?0:!(o!=null&&o[1])&&!(o!=null&&o[2])?o[0]*(n/10):o!=null&&o[2]?(o[0]+o[1])*(n/10):(o[0]+o[1]/2)*(n/10)},[o,m]),P=x.useMemo(()=>((e==null?void 0:e.userTools)||[]).reduce((t,a)=>{const i=a==null?void 0:a.rarity;return t[i]?{...t,[i]:t[i]+(Number(a==null?void 0:a.mining_power)??0)}:{...t,[i]:(a==null?void 0:a.mining_power)??0}},{}),[e==null?void 0:e.userTools]),N=x.useCallback(()=>Object.keys(P).map(n=>{const t=P[n]*((m==null?void 0:m.mining_power_mod)??0)/1e4;return{rarity:n,percentage:(t>=.8?.8:t)*100}}).filter(n=>n.percentage>0),[P,m]),k=x.useCallback(()=>N().reduce((t,a)=>{var l;const i=a.percentage/100*(((l=p==null?void 0:p.pool_buckets.find(j=>(j==null?void 0:j.key)===a.rarity))==null?void 0:l.formattedValue)??0);return t+i},0),[N,p==null?void 0:p.pool_buckets]),B=x.useCallback(()=>{var t;return(((t=e==null?void 0:e.userTools)==null?void 0:t.reduce((a,i)=>a+(i==null?void 0:i.nft_power),0))??0)*((m==null?void 0:m.nft_power_mod)??0)/100},[m,e==null?void 0:e.userTools]),J=x.useMemo(()=>f()/60,[f]),X=x.useMemo(()=>k()/(f()>=0?f():1)*3600,[k,f]),Y=x.useMemo(()=>B()/(f()>=0?f():1)*3600,[B,f]),Z=x.useMemo(()=>3600/(f()>=0?f():1),[f]);function W(n){xe.setState({selectedPage:n})}async function ee(){if(!(!(r!=null&&r.current_land)||!c)){h(!0);try{if(await Be(c,r==null?void 0:r.current_land)){await _(1e3);const t=await F(c==null?void 0:c.name);v.setState(a=>({...a,user:a.user?{...a.user,...t}:null})),await I(),C.success("Current Land added to favorites")}}catch(n){console.error(n)}finally{h(!1)}}}async function ne(){var n,t;if(!(!(e!=null&&e.userTools)||!c)){h(!0);try{if(await Pe(c,(t=(n=e==null?void 0:e.userTools)==null?void 0:n.map(({asset_id:i})=>i))==null?void 0:t.join(","))){await _(1e3);const i=await F(c==null?void 0:c.name);v.setState(l=>({...l,user:l.user?{...l.user,...i}:null})),await I(),C.success("Current Tools added to favorites")}}catch(a){console.error(a)}finally{h(!1)}}}async function se(n){var t;if(!(!(e!=null&&e.userTools)||!c)){h(!0);try{const a=(t=e==null?void 0:e.userTools)==null?void 0:t.map(({asset_id:l})=>Number(l));await q(c,[...a,Number(n.asset_id)])&&(await _(1e3),await E(),await R("tool.worlds"),C.success("Tool added to current setup"))}catch(a){console.error(a)}finally{h(!1)}}}async function te(n){var t;if(!(!(e!=null&&e.userTools)||!c)){h(!0);try{const a=(t=e==null?void 0:e.userTools)==null?void 0:t.filter(({asset_id:l})=>l!==n.asset_id).map(({asset_id:l})=>Number(l));await q(c,a)&&(await _(1e3),await E(),await R("tool.worlds"),C.success("Tool removed from current setup"))}catch(a){console.error(a)}finally{h(!1)}}}function ae(n){v.setState(t=>({...t,user:t.user?{...t.user,miningType:(n==null?void 0:n.value)??"gold"}:null})),K(n??L[1]),localStorage.setItem("miningType",(n==null?void 0:n.value)??"gold")}return s.jsxs(ge,{children:[s.jsxs(he,{children:[s.jsx(T,{color:"eleventh",onClick:()=>W("selection"),children:"Land Selection"}),s.jsx(T,{color:"eleventh",onClick:()=>W("favorites"),children:"Favorites"}),s.jsx(T,{color:"eleventh",onClick:()=>u("/tool-tactician"),children:"Tools Tactician"})]}),s.jsxs(we,{children:[s.jsx(M,{children:"Current Selection"}),s.jsxs(Te,{children:[s.jsxs(je,{children:[s.jsx(be,{src:`/assets/planets/${r==null?void 0:r.planetName.toLowerCase()}.png`,alt:r==null?void 0:r.planetName,title:r==null?void 0:r.planetName}),s.jsx(ye,{src:`/assets/lands/${r==null?void 0:r.landName}.webp`,alt:r==null?void 0:r.landName,title:r==null?void 0:r.landName}),s.jsx(T,{noBorder:!0,isLoading:g,disabled:g,color:"secondary",onClick:ee,children:"Add to favorites"})]}),s.jsxs(Se,{children:[s.jsxs(Q,{children:[s.jsxs(w,{children:[s.jsx("span",{children:"Cooldown"}),s.jsxs("span",{children:[Math.round(J)," min"]})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Mines per hour"}),s.jsx("span",{children:Z.toLocaleString("US-en")})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Shards per mine"}),s.jsx("span",{children:B().toLocaleString("US-en")})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Shards per hour"}),s.jsx("span",{children:Y.toLocaleString("US-en")})]})]}),s.jsxs(Q,{children:[s.jsxs(w,{children:[s.jsx("span",{children:"Estimated average TLM per mine"}),s.jsx("span",{children:k().toLocaleString("US-en")})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Estimated average TLM per hour"}),s.jsx("span",{children:X.toLocaleString("US-en")})]}),s.jsxs(w,{children:[s.jsx("span",{children:"Commission"}),s.jsxs("span",{children:[((r==null?void 0:r.commission)??0)/100," %"]})]}),s.jsxs(w,{children:[s.jsx("span",{}),s.jsx("span",{})]})]})]})]}),s.jsxs(ve,{children:[s.jsx(M,{children:"Mine Button"}),s.jsx(ue,{borderColor1:"#FFB31F",borderColor2:"#FFB800",className:"select",title:"",selected:V,options:L,onSelected:ae})]}),s.jsxs(_e,{children:[s.jsx(M,{children:"Tools"}),s.jsx(T,{noBorder:!0,color:"secondary",onClick:ne,isLoading:g,disabled:g,children:"Add current setup to favorites"}),s.jsxs(Ce,{children:[b?Array.from({length:3}).map((n,t)=>s.jsx(H,{},t)):(U=e==null?void 0:e.userTools)==null?void 0:U.map(n=>s.jsxs(z,{children:[s.jsx("img",{loading:"lazy",src:`https://ipfs.alienworlds.io/ipfs/${n.img}`,alt:n.name,title:n.name}),s.jsx(T,{isLoading:g,disabled:g,onClick:()=>te(n),noBorder:!0,children:"Unequip"})]},n.asset_id)),O?Array.from({length:7}).map((n,t)=>s.jsx(H,{},t)):($=y==null?void 0:y.filter(n=>{var t;return!((t=e==null?void 0:e.userTools)!=null&&t.some(({asset_id:a})=>a===n.asset_id))}))==null?void 0:$.map(n=>{var t;return s.jsxs(z,{children:[s.jsx("img",{src:`https://ipfs.alienworlds.io/ipfs/${n.data.img}`,alt:n.data.name,title:n.data.name}),s.jsx(T,{isLoading:g,disabled:g||((t=e==null?void 0:e.userTools)==null?void 0:t.length)===3,onClick:()=>se(n),noBorder:!0,color:"eleventh",children:"Equip"})]},n.asset_id)})]})]})]})]})};export{De as default};
