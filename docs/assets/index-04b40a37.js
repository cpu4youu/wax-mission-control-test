import{s as f,g,S as u,T as h,a as R,Q as x,b as d,i as P,n as v,q as I,u as D,R as N,_ as Q,K as B,j as t,B as T,o as U,h as H,ai as z}from"./index-86b94dab.js";import{I as _}from"./info-builder-6ce224b5.js";import{i as $}from"./index-741bcc73.js";const G=f("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"100%","@sm":{px:"0px"}}),K=f("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),Y=f("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),V=f("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"20px",w:"100%",maxWidth:"1330px",mt:"40px",px:"15px",bg:"rgba(3, 16, 32,  .55)",br:"22px",padding:"20px 35px","@sm":{padding:"20px"}}),M=f("div",{d:"grid",gridTemplateColumns:"2fr 1fr 2fr",gap:"15px",w:"100%",padding:"10px 40px ",br:"10px",bg:"rgba(255,255,255,0.03)",">div:nth-child(2)":{maxW:"180px"},"@sm":{d:"flex",align:"center",justify:"center",direction:"column",padding:"10px 10px ",maxH:"100%",button:{h:"30px",minW:"100%",maxW:"100%"}}}),b=f("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",color:"$white500",mr:"auto","@sm":{w:"100%",justify:"space-between",direction:"row"}}),j=f("div",{d:"flex",align:"flex-start",justify:"flex-start",ff:"$heading",fs:"14px",w:"100%","@md":{fs:"12px"},"@sm":{fs:"11px",fw:"$bold"}}),C=f("div",{d:"flex",align:"flex-start",justify:"flex-start",ff:"$heading",fs:"24px",w:"100%",svg:{m:"auto 5px",w:"20px",h:"20px"},"@md":{fs:"18px"},"@sm":{justify:"space-between",w:"max-content",fw:"$bold",fs:"12px",svg:{w:"15px",h:"15px"}}}),S=f("div",{d:"flex",align:"center",justify:"center",gap:"10px",padding:"5px 20px 5px 10px",w:"100%",svg:{color:"$white500",w:"25px",h:"25px",mr:"auto"},"@sm":{d:"none"}}),A=f("span",{w:"100%",color:"$white500",textAlign:"center",fs:"14px",ff:"$heading","@lg":{fs:"12px"},"@md":{fs:"10px"},"@sm":{}}),k=async()=>await g({options:{code:u.HQ_MU,index_position:1,limit:"1000",scope:u.HQ_MU,table:h.TLMDROPS}})??null,Z=async e=>await g({options:{code:u.HQ_MU,index_position:3,limit:"1000",key_type:"i64",scope:u.HQ_MU,table:h.TLMBIDS,lower_bound:e,upper_bound:e}})??null,J=()=>R({queryKey:[x.SPECIAL_MINING],queryFn:()=>ee(),staleTime:1e3*60*60*24,enabled:!!d.getState().user});async function X(){return await I.invalidateQueries(x.SPECIAL_MINING)}async function ee(){const e=d.getState().user;if(!e)return null;try{const n=await Z(e.name),r=await k();return n?n==null?void 0:n.reduce((c,l)=>{const a=r==null?void 0:r.find(y=>y.index===l.pool_index&&P(v,new Date(y.endtime)));if(!a)return c;const m=((l==null?void 0:l.total_bid)??0)/((a==null?void 0:a.total_power)??1),p=(a==null?void 0:a.rewards.replace(" TLM",""))??"1";return c+m*Number(p)},0):0}catch(n){return console.log(n),null}}const ne=async e=>{const n=await g({options:{code:u.M__FEDERATION,index_position:1,limit:"1000",scope:u.M__FEDERATION,table:h.MINERCLAIM,lower_bound:e,upper_bound:e}});return(n==null?void 0:n[0])??null},te=()=>R({queryKey:[x.MINER_CLAIM],queryFn:()=>ae(),staleTime:1e3*60*60*24,enabled:!!d.getState().user});async function se(){return await I.invalidateQueries(x.MINER_CLAIM)}async function ae(){const e=d.getState().user;if(!e)return null;try{return await ne(e.name)}catch(n){return console.log(n),null}}const ie=async e=>{const n=await g({options:{code:u.M__FEDERATION,index_position:1,limit:"1000",scope:u.M__FEDERATION,table:h.LANDCOMMS,lower_bound:e,upper_bound:e}});return(n==null?void 0:n[0])??null},re=()=>R({queryKey:[x.LAND_COMMS],queryFn:()=>ce(),staleTime:1e3*60*60*24,enabled:!!d.getState().user});async function oe(){return await I.invalidateQueries(x.LAND_COMMS)}async function ce(){const e=d.getState().user;if(!e)return null;try{return await ie(e.name)}catch(n){return console.log(n),null}}const le=async e=>{const n=await g({options:{code:u.AWLNDRATINGS,index_position:1,limit:"1000",scope:u.AWLNDRATINGS,table:h.PAYOUTS,lower_bound:e,upper_bound:e}});return(n==null?void 0:n[0])??null},ue=()=>R({queryKey:[x.PAYOUTS],queryFn:()=>me(),staleTime:1e3*60*60*24,enabled:!!d.getState().user});async function de(){return await I.invalidateQueries(x.PAYOUTS)}async function me(){const e=d.getState().user;if(!e)return null;try{return await le(e.name)}catch(n){return console.log(n),null}}async function fe(e){const{executeTransaction:n}=D(),r=xe(e);return!!await n(r)}function xe(e){return{actions:[{account:u.M__FEDERATION,name:"claimmines",authorization:[{actor:e.name,permission:e.requestPermission}],data:{receiver:e.name}}]}}async function pe(e){const{executeTransaction:n}=D(),r=ge(e);return!!await n(r)}function ge(e){return{actions:[{account:u.M__FEDERATION,name:"claimcomms",authorization:[{actor:e.name,permission:e.requestPermission}],data:{receiver:e.name}}]}}async function he(e){const{executeTransaction:n}=D(),r=ye(e);return!!await n(r)}function ye(e){return{actions:[{account:u.AWLNDRATINGS,name:"claimpay",authorization:[{actor:e.name,permission:e.requestPermission}],data:{receiver:e.name}}]}}async function we(e,n,r){const{executeTransaction:o}=D(),c=Te(n,r,e);return!!await o(c)}function Te(e,n,r){return{actions:n.map(c=>({account:u.MISSION_CONTROL,name:"claimweek",authorization:[{actor:r.name,permission:r.requestPermission}],data:{wallet:r.name,week_id:c,boost_percentage:e}}))}}function _e(e){const n=e.getFullYear(),r=e.getMonth()+1>9?e.getMonth()+1:`0${e.getMonth()+1}`,o=e.getDate()>9?e.getDate():`0${e.getDate()}`,c=e.getHours()>9?e.getHours():`0${e.getHours()}`,l=e.getMinutes()>9?e.getMinutes():`0${e.getMinutes()}`,a=e.getSeconds()>9?e.getSeconds():`0${e.getSeconds()}`;return`${n}-${r}-${o}T${c}:${l}:${a}`}const Me={addTLM:!1,withdrawTLM:!1,claimTLM:!1,claimMines:!1,claimComms:!1,claimPay:!1,weekReward:!1},L=N.lazy(()=>Q(()=>import("./tlm-7d6b3dd9.js"),["assets/tlm-7d6b3dd9.js","assets/index-86b94dab.js","assets/index-55fec1ff.css"])),Se=()=>{const e=d(s=>s.user),n=d(s=>s.updateMember),r=B(s=>s.weeklies);J();const{data:o}=te(),{data:c}=re(),{data:l}=ue();N.useRef(null);const[a,m]=N.useState(Me),p=r==null?void 0:r.reduce((s,i)=>{const q=((i==null?void 0:i.initial_prize_pool_formatted)??0)*((i==null?void 0:i.total_quest_points)??1)/((i==null?void 0:i.total_quest_points_week)??1);return i.week_id&&i.total_quest_points_user_week>0&&$(new Date,new Date(i==null?void 0:i.expiresDate))&&P(new Date,new Date((i==null?void 0:i.end_date)??""))?{total:s.total+q,weeks:[...s.weeks,i.week_id]}:{total:s.total,weeks:[...s.weeks]}},{total:0,weeks:[]});async function y(){if(e){m({...a,claimMines:!0});try{if(!await fe(e))throw new Error("Claim Mines error from contract");await w()}catch(s){console.log(s)}finally{m({...a,claimMines:!1})}}}async function W(){if(e){m({...a,claimComms:!0});try{if(!await pe(e))throw new Error("Claim Comms error from contract");await w()}catch(s){console.log(s)}finally{m({...a,claimComms:!1})}}}async function F(){if(e){m({...a,claimPay:!0});try{if(!await he(e))throw new Error("Claim Pay error from contract");await w()}catch(s){console.log(s)}finally{m({...a,claimPay:!1})}}}async function O(){if(e){m({...a,weekReward:!1});try{if(!await we(e,0,p.weeks))throw new Error("Week Reward error from contract");await w(),await U()}catch(s){console.log(s)}finally{m({...a,weekReward:!1})}}}async function w(){if(!(e!=null&&e.name))return null;await H(500);const s=await z(e==null?void 0:e.name);d.setState(i=>({...i,user:i.user?{...i.user,userTlm:s}:null})),await n(),await X(),await se(),await oe(),await de()}const E=new Date((o==null?void 0:o.timestamp)||new Date);return t.jsxs(G,{children:[t.jsxs(K,{children:[t.jsx(Y,{children:"The Vault"}),t.jsx("img",{src:"/assets/background/bg-the-vault.webp",alt:""})]}),t.jsxs(V,{children:[t.jsxs(M,{children:[t.jsxs(b,{children:[t.jsx(j,{children:"Alien Worlds Mining Rewards"}),t.jsxs(C,{children:[(o==null?void 0:o.amount.replace(" TLM",""))??"0.0000"," ",t.jsx(L,{})]})]}),t.jsx(T,{isLoading:a.claimMines,disabled:((o==null?void 0:o.amount)??0)===0||$(v,E),onClick:y,rounded:!1,color:"solidBlue",children:"Claim"}),t.jsxs(S,{children:[t.jsx(_,{}),t.jsxs(A,{children:["Earned by mining in Alien Worlds",$(v,E)&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),`Available on ${new Date(`${_e(E)}.000Z`).toLocaleString()}`]})]})]})]}),t.jsxs(M,{children:[t.jsxs(b,{children:[t.jsx(j,{children:"Alien Worlds Land Commission"}),t.jsxs(C,{children:[(c==null?void 0:c.comms.replace(" TLM",""))??"0.0000"," ",t.jsx(L,{})]})]}),t.jsx(T,{isLoading:a.claimComms,disabled:((c==null?void 0:c.comms)??0)===0,onClick:W,rounded:!1,color:"solidBlue",children:"Claim"}),t.jsxs(S,{children:[t.jsx(_,{}),t.jsx(A,{children:"Earned by mining in Alien Worlds"})]})]}),t.jsxs(M,{children:[t.jsxs(b,{children:[t.jsx(j,{children:"Alien Worlds DTAL"}),t.jsxs(C,{children:[(l==null?void 0:l.payoutAmount.replace(" TLM",""))??"0.0000"," ",t.jsx(L,{})]})]}),t.jsx(T,{isLoading:a.claimPay,disabled:((l==null?void 0:l.payoutAmount)??0)===0,onClick:F,rounded:!1,color:"solidBlue",children:"Claim"}),t.jsxs(S,{children:[t.jsx(_,{}),t.jsx(A,{children:"Earned daily by owning lands in Alien Worlds"})]})]}),t.jsxs(M,{children:[t.jsxs(b,{children:[t.jsx(j,{children:"Mission Control Weekly Rewards"}),t.jsxs(C,{children:[p.total.toFixed(4)," ",t.jsx(L,{})]})]}),t.jsx(T,{isLoading:a.weekReward,disabled:p.total===0,onClick:O,rounded:!1,color:"solidBlue",children:"Claim"}),t.jsxs(S,{children:[t.jsx(_,{}),t.jsx(A,{children:"Earned daily by owning lands in Alien Worlds"})]})]})]})]})};export{Se as default};
