import{X as A,y as J,Y as h,ak as ee,aj as se,s as f,e as G,i as te,S as W,T as ae,k as ne,q as re,Q as Y,al as oe,R as g,_ as x,b as ie,r as p,j as n,B as ce}from"./index-32f1a13a.js";import{a as le}from"./adapters-12260191.js";import{i as ue}from"./index-4c850814.js";import{i as de}from"./index-6f71351d.js";import{d as E,a as z,c as fe}from"./mineCooldown-ae378b0b.js";import{s as he}from"./sleep-da79c358.js";import{u as $,g as pe,s as ge}from"./showTlmValueFromMine-3ff75534.js";import{a as xe}from"./execute-claim-contract-ba71d557.js";import{u as we,o as Q}from"./user-miners-query-684d9f23.js";import{u as me,o as ye}from"./tools-query-03018607.js";import{F as _e}from"./index.esm-bfdf0d63.js";import"./axios-45629df5.js";import"./toast-options-f4332434.js";import"./index-b0130426.js";import"./use-transaction-dab29f08.js";import"./iconBase-6bc96114.js";function Te(s,a){A(2,arguments);var c=h(a);return J(s,-c)}function ve(s,a){A(2,arguments);var c=h(a);return ee(s,-c)}function be(s,a){if(A(2,arguments),!a||se(a)!=="object")return new Date(NaN);var c=a.years?h(a.years):0,o=a.months?h(a.months):0,u=a.weeks?h(a.weeks):0,r=a.days?h(a.days):0,m=a.hours?h(a.hours):0,l=a.minutes?h(a.minutes):0,d=a.seconds?h(a.seconds):0,w=ve(s,o+c*12),j=Te(w,r+u*7),C=l+m*60,T=d+C*60,v=T*1e3,D=new Date(j.getTime()-v);return D}const je=f("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"30px",w:"100%","@md":{justify:"center",padding:"0px 20px",flexWrap:"wrap"},"@sm":{padding:"0px "}}),q=f("h2",{d:"flex",gap:"15px",w:"100%",color:"$white500"}),Ce=G({"100%":{transform:"rotate(360deg)"}}),De=f("button",{d:"flex",align:"flex-start",justify:"flex-start",color:"$white500",variants:{isLoading:{true:{color:"$gray500",pointerEvents:"none",animation:`${Ce} 1s linear`}}}}),Se=f("div",{d:"flex",align:"flex-start",justify:"flex-start",gap:"50px",w:"100%","@sm":{flexWrap:"wrap",align:"flex-start",justify:"flex-start",direction:"column",gap:"20px"}}),Ee=f("div",{d:"flex",align:"flex-start",justify:"space-between",gap:"20px",w:"100%","@md":{flexWrap:"wrap"}}),$e=f("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gap:"5px",w:"100%",maxW:"235px"}),_=f("div",{d:"flex",align:"center",justify:"flex-start",gap:"10px",color:"$white500",fs:"20px",ff:"$body",fw:"$thin",svg:{w:"25px",h:"25px"},".clock-svg stop":{stopColor:"white"}}),Ae=f("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",maxW:"235px",button:{mt:"5px",h:"35px"},"@sm":{maxW:"unset"}}),Ie=f("div",{w:"100%",minH:"175px",padding:"20px",bg:"rgba(255,255,255,0.05)",br:"5px",color:"$white500",fs:"20px",ff:"$heading",fw:"$thin",a:{ml:"5px",color:"$white500",textDecoration:"underline"}}),Re=G({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),ke=f("div",{mt:"10px",w:"100%",height:"200px",background:"linear-gradient( -90deg, rgba(3, 16, 32, 0.40), rgba(3, 16, 32, 0.75) ,rgba(3, 16, 32, 0.40))",br:"10px",backgroundSize:"400% 400%",animation:`${Re} 1.2s ease-in-out infinite`}),Me=async()=>await te({options:{code:W.PLANETAWORLD,index_position:1,limit:"10000",scope:W.PLANETAWORLD,table:ae.treasures}}),Pe=()=>ne({queryKey:[Y.treasureHuntUse],queryFn:()=>Ue(),staleTime:1e3*60*60});async function He(){return await re.invalidateQueries(Y.treasureHuntUse)}async function Ue(){try{const s=await Me();if(!s)return;const a=s.sort((o,u)=>new Date(o.start_date).getTime()-new Date(u.start_date).getTime()),c=await Fe(a);return console.log({hunts:s,formatted:c,sortedHunts:a}),c}catch(s){console.log(s);return}}async function Fe(s){const a=s.find(o=>{const u=new Date,r=new Date(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds()),m=be(r,{hours:10}),l=oe(r,{days:7}),d=ue(new Date(`${o.start_date}.000Z`),m),w=de(new Date(`${o.start_date}.000Z`),l);return!o.is_distributed&&d&&w});return Ve(a)}async function Ve(s){const{getAssetByAssetId:a}=le;if(!s)return;const c=await a(s==null?void 0:s.land_id),o=c.data.name.split(" on ");return{...s,...c.data,formattedPlanet:o[1],formattedName:o[0],localImg:`/assets/lands/${o[0]}.webp`}}const Le=g.lazy(()=>x(()=>import("./shards-ed973aab.js"),["assets/shards-ed973aab.js","assets/index-32f1a13a.js","assets/index-55fec1ff.css"])),B=g.lazy(()=>x(()=>import("./tlm-506dfd2a.js"),["assets/tlm-506dfd2a.js","assets/index-32f1a13a.js","assets/index-55fec1ff.css"])),Ne=g.lazy(()=>x(()=>import("./clock-6d40c9a3.js"),["assets/clock-6d40c9a3.js","assets/index-32f1a13a.js","assets/index-55fec1ff.css"])),Oe=g.lazy(()=>x(()=>import("./planet-bea7946a.js"),["assets/planet-bea7946a.js","assets/index-32f1a13a.js","assets/index-55fec1ff.css"])),We=g.lazy(()=>x(()=>import("./finish-flag-a477c17a.js"),["assets/finish-flag-a477c17a.js","assets/index-32f1a13a.js","assets/index-55fec1ff.css"])),ze=g.lazy(()=>x(()=>import("./land-91139c8e.js"),["assets/land-91139c8e.js","assets/index-32f1a13a.js","assets/index-55fec1ff.css"])),Qe=g.lazy(()=>x(()=>import("./treasure-c626e29b.js"),["assets/treasure-c626e29b.js","assets/index-32f1a13a.js","assets/index-55fec1ff.css"])),cs=()=>{const{data:s,isLoading:a,isFetching:c}=Pe(),{data:o,isFetching:u}=we(),{data:r,isFetching:m}=me(),l=ie(e=>e.user),d=$(e=>e.nonce),w=$(e=>e.updateIsCalculating),j=$(e=>e.updateHashExpire),[C,T]=p.useState(""),[v,D]=p.useState(""),[I,R]=p.useState(!1);async function k(){await ye(),await Q(),await He()}const K=p.useCallback(async()=>{if(s){R(!0);try{if(w(!0),await he(500),!l)return null;if(!(d!=null&&d.rand_str)){await pe();const i=new Date;j(i.setMinutes(i.getMinutes()+1))}const e=(o==null?void 0:o.current_land)===s.land_id?void 0:s.land_id;await xe(l,e)&&(await ge(l==null?void 0:l.name),await k(),await Q())}catch(e){console.log(e)}finally{w(!1),R(!1)}}},[l,o,s,d==null?void 0:d.rand_str]),M=p.useCallback(e=>{var b,P,H,U,F,V,L,N,O;const t=(e??0)/10;if(((b=r==null?void 0:r.userTools)==null?void 0:b.length)===1){const y=t*(((H=(P=r==null?void 0:r.userTools)==null?void 0:P[0])==null?void 0:H.delay)??0);return E(y,r,o)}const i=(U=r==null?void 0:r.userTools)==null?void 0:U.sort((y,X)=>X.delay-y.delay);if(((F=r==null?void 0:r.userTools)==null?void 0:F.length)===2){const y=t*((((V=i==null?void 0:i[0])==null?void 0:V.delay)??0)+(((L=i==null?void 0:i[1])==null?void 0:L.delay)??0)/2);return E(y,r,o)}const S=t*((((N=i==null?void 0:i[0])==null?void 0:N.delay)??0)+(((O=i==null?void 0:i[1])==null?void 0:O.delay)??0));return E(S,r,o)},[r,o]);function Z(e){const t=e!=null&&e.days?e.days<10?`0${e.days}d`:`${e.days}d`:"",i=e!=null&&e.hours?e.hours<10?`0${e.hours}h`:`${e.hours}h`:"",S=e!=null&&e.minutes?e.minutes<10?`0${e.minutes}m`:`${e.minutes}m`:"",b=e!=null&&e.seconds?e.seconds<10?`0${e.seconds}s`:`${e.seconds}s`:"";T(`${t} ${i} ${S} ${b}`)}return p.useEffect(()=>{const e=setInterval(()=>{const t=z(new Date((s==null?void 0:s.start_date)||""));Z(t),(t==null?void 0:t.days)===0&&(t==null?void 0:t.hours)===0&&(t==null?void 0:t.minutes)===0&&(t==null?void 0:t.seconds)===0&&(clearInterval(e),T("live"))},1e3);return()=>clearInterval(e)},[s]),p.useEffect(()=>{const e=setInterval(()=>{const t=z(M((s==null?void 0:s.delay)??0));D(fe(t)),(t==null?void 0:t.days)===0&&(t==null?void 0:t.hours)===0&&(t==null?void 0:t.minutes)===0&&(t==null?void 0:t.seconds)===0&&clearInterval(e)},1e3);return()=>clearInterval(e)},[s==null?void 0:s.delay,M]),n.jsxs(je,{children:[n.jsxs(q,{children:["TREASURE HUNT"," ",n.jsx(De,{isLoading:m||u||c,disabled:!(l!=null&&l.member),onClick:k,children:n.jsx(_e,{size:30})})]})," ",n.jsx(Se,{children:a?Array.from({length:3},e=>e).map((e,t)=>n.jsx(ke,{},t)):s?n.jsxs(Ee,{children:[n.jsxs($e,{children:[n.jsxs(_,{children:[n.jsx(Oe,{})," ",s.formattedPlanet," ( ",s.x,":",s.y," )"]}),n.jsxs(_,{children:[n.jsx(ze,{})," ",s.formattedName]}),n.jsxs(_,{children:[n.jsx(Ne,{})," ",C]}),n.jsxs(_,{children:[n.jsx(We,{})," ",s.target," ",s.target_type==="tlm"?n.jsx(B,{}):n.jsx(Le,{})]}),n.jsxs(_,{children:[n.jsx(Qe,{})," ",s.reward.replace(" TLM","")," ",n.jsx(B,{})]})]}),n.jsxs(Ae,{children:[n.jsx("img",{src:s.localImg,alt:""}),n.jsx(ce,{onClick:K,disabled:I||v!=="MINE",isLoading:I,rounded:!1,color:"solidBlue",noBorder:!0,children:v})]}),n.jsxs(Ie,{children:["Treasure Hunt rewards players who help hunt a treasure. This means you have to mine on the specified land before the treasure is found. All players who contributed in finding the treasure will get an equal share of the reward. For more details about current and upcoming Treasure Hunts, please visit"," ",n.jsxs("a",{target:"_blank",href:"https://larucheaw.online/live/index.html",rel:"noreferrer",children:[" ","here"]}),"."]})]}):n.jsx(q,{children:"No treasure hunt announced. Check back later!"})})]})};export{cs as default};
