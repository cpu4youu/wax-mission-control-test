import{s as i,e as M,g as k,S as x,T as v,a as O,Q as $,b as m,V as B,u as b,aF as R,R as g,j as n,t as A,B as h,aI as T,az as w,k as y}from"./index-4339d15f.js";import{C as D}from"./index-e0908056.js";const E=i("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),j=i("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),U=i("p",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",my:"15px",color:"$white500",fw:"400",ff:"$heading",fs:"20px",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",mt:"5px",">div":{border:"none"}},"@sm":{flexWrap:"wrap",span:{fs:"16px"}}}),W=i("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),Q=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",">div":{border:"none"}}}),F=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",m:"5px 0 10px",w:"100%"}),p=i("div",{d:"flex",align:"center",justify:"space-between",gap:"10px",px:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),l=i("p",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"14px",ff:"$heading",fw:"400"}),Y=M({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),q=i("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${Y} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),z=async e=>await k({options:{code:x.TOOLS_MC,index_position:3,key_type:"i64",limit:"10000",scope:x.TOOLS_MC,table:v.tools,reverse:!0,lower_bound:e,upper_bound:e}}),P=()=>O({queryKey:[$.toolsMc],queryFn:()=>I(),staleTime:1e3*60*20,enabled:!!m.getState().user});async function I(){try{const e=m.getState().user;if(!e)return;const a=await z(e.name);if(!a)return;const{getTemplates:s}=B,o=await s({template_id:a.map(({template_id:r})=>r).join(","),page:1,limit:100,order:"desc"});return a==null?void 0:a.map(r=>{const u=o.find(f=>f.template_id===String(r.template_id));return u?{...u.immutable_data,...r}:r})}catch(e){console.log(e);return}}async function K(e,a){const{executeTransaction:s}=b(),o=N(e,a);return!!await s(o)}function N(e,a){return{actions:[{account:x.TOOLS_MC,name:"unstake",authorization:[{actor:e.name,permission:e.requestPermission}],data:{wallet:e.name,asset_ids:a}}]}}async function V(e){const{executeTransaction:a}=b(),s=G(e);return!!await a(s)}function G(e){return{actions:[{account:x.TOOLS_MC,name:"claim",authorization:[{actor:e.name,permission:e.requestPermission}],data:{wallet:e.name}}]}}const Z=()=>{const{data:e,isLoading:a}=P(),{data:s}=R(),o=m(t=>t.user),[d,r]=g.useState(!1),[u,f]=g.useState(!1);async function S(t){if(o){r(!0);try{await K(o,[Number(t.asset_id)])&&(await T(),await w("tool.worlds"),y.success("Tool unstaked"))}catch(c){console.error("Error staking tool",c)}finally{r(!1)}}}async function C(){if(o){f(!0);try{await V(o)&&(await T(),await w("tool.worlds"),y.success("Tool unstaked"))}catch(t){console.error("Error staking tool",t)}finally{f(!1)}}}function L(t){const c=t.getFullYear(),_=t.getMonth()+1>9?t.getMonth()+1:`0${t.getMonth()+1}`;return`${t.getDate()>9?t.getDate():`0${t.getDate()}`}/${_}/${c}`}return n.jsxs(E,{children:[n.jsx(j,{children:"CLAIM YOUR TLM"}),n.jsxs(U,{children:["Claimable TLM, earned by loaning: ",A(s==null?void 0:s.deposit).toFixed(4)," TLM TLM",n.jsx(h,{disabled:u,isLoading:u,onClick:C,rounded:!1,color:"solidBlue",children:"Claim TLM"})]}),n.jsx(j,{children:"YOUR STAKED TOOLS"}),n.jsx(W,{children:a?new Array(6).fill(0).map((t,c)=>n.jsx(q,{},c)):e==null?void 0:e.map((t,c)=>n.jsx(D,{tool:t,children:n.jsxs(Q,{children:[n.jsx(h,{disabled:d,isLoading:d,onClick:()=>S(t),rounded:!1,color:"solidBlue",children:"Unstake"}),n.jsxs(F,{children:[n.jsxs(p,{children:[n.jsx(l,{children:"Since"}),n.jsx(l,{children:L(new Date(t.last_mine))})]}),n.jsxs(p,{children:[n.jsx(l,{children:"Total"}),n.jsx(l,{children:t.total_earned})]}),n.jsxs(p,{children:[n.jsx(l,{children:"Uses"}),n.jsx(l,{children:t.total_mines})]})]})]})},c))})]})};export{Z as default};
