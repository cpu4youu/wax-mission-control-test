import{s as r,e as E,S as R,u as B,aQ as F,aO as Q,b as j,R as y,t as l,j as n,B as b,aH as L,aR as C,aS as z,k,aT as N,aP as M,l as S}from"./index-31b6945f.js";import{o as O}from"./toolov-query-394d4dea.js";import{o as $}from"./inventory-query-6b5a0249.js";const Y=r("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),v=r("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),q=r("p",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",my:"15px",color:"$white500",fw:"400",ff:"$heading",fs:"20px",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",mt:"5px",">div":{border:"none"}},"@sm":{flexWrap:"wrap",span:{fs:"16px"}}}),I=r("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),H=r("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",">div":{border:"none"}}}),K=r("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",m:"5px 0 10px",w:"100%"}),u=r("div",{d:"flex",align:"center",justify:"space-between",gap:"10px",px:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),c=r("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"0px 0px 5px rgba(0, 0, 0, 0.9)",fs:"14px",ff:"$heading",fw:"400"}),V=E({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),G=r("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${V} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}});async function J(a,i){const{executeTransaction:t}=B(),o=W(a,i);return!!await t(o)}function W(a,i){return{actions:[{account:R.TOOLS_MC,name:"unstake",authorization:[{actor:a.name,permission:a.requestPermission}],data:{wallet:a.name,asset_ids:i}}]}}async function X(a,i){const{executeTransaction:t}=B(),o=Z(a,i);return!!await t(o)}function Z(a,i){return{actions:[{account:R.TOOLS_MC,name:"claim",authorization:[{actor:a.name,permission:a.requestPermission}],data:{wallet:a.name,tokens:`${i.toFixed(4)} TLM`}}]}}const se=()=>{var m,g,w,T;const{data:a,isLoading:i}=F(),{data:t}=Q(),o=j(e=>e.user),d=j(e=>e.updateTLM),[x,f]=y.useState(!1),[p,h]=y.useState(!1);async function _(e){if(o){f(!0);try{await J(o,[Number(e.asset_id)])&&(await k(2e3),await N(),await O(),await M(),await $("tool.worlds"),S.success("Tool unstaked"))}catch(s){console.error("Error staking tool",s)}finally{f(!1)}}}async function D(){if(!(!o||!(t!=null&&t.deposit))){h(!0);try{await X(o,l(t==null?void 0:t.deposit))&&(await k(2e3),await M(),await d(),await O(),await $("tool.worlds"),S.success("TLM Claimed"))}catch(e){console.error("Error staking tool",e)}finally{h(!1)}}}function A(e){const s=e.getFullYear(),P=e.getMonth()+1>9?e.getMonth()+1:`0${e.getMonth()+1}`;return`${e.getDate()>9?e.getDate():`0${e.getDate()}`}/${P}/${s}`}const U=(m=a==null?void 0:a.stakedTools)==null?void 0:m.reduce((e,s)=>e+l(s.total_earned),0);return n.jsxs(Y,{children:[n.jsx(v,{children:"CLAIM YOUR TLM"}),n.jsxs(q,{children:["Claimable TLM:"," ",l(t==null?void 0:t.deposit)>=0?l(t==null?void 0:t.deposit).toFixed(4):`- ${l(t==null?void 0:t.trialtlm).toFixed(4)}`," ","TLM",n.jsx(b,{disabled:p&&U===0,isLoading:p,onClick:D,rounded:!1,color:"solidBlue",children:"Claim TLM"})]}),n.jsx(v,{children:"YOUR STAKED TOOLS"}),n.jsx(I,{children:i?new Array(6).fill(0).map((e,s)=>n.jsx(G,{},s)):(T=(w=(g=a==null?void 0:a.stakedTools)==null?void 0:g.filter(e=>e.owned>0))==null?void 0:w.sort((e,s)=>L[e.rarity]-L[s.rarity]||C[e.shine]-C[s.shine]))==null?void 0:T.map((e,s)=>n.jsx(z,{tool:e,children:n.jsxs(H,{children:[n.jsx(b,{disabled:x,isLoading:x,onClick:()=>_(e),rounded:!1,color:"solidBlue",children:"Unstake"}),n.jsxs(K,{children:[n.jsxs(u,{children:[n.jsx(c,{children:"Since"}),n.jsx(c,{children:A(new Date(e.stakedat))})]}),n.jsxs(u,{children:[n.jsx(c,{children:"Total"}),n.jsx(c,{children:e.total_earned})]}),n.jsxs(u,{children:[n.jsx(c,{children:"Uses"}),n.jsx(c,{children:e.total_mines})]})]})]})},s))})]})};export{se as default};
