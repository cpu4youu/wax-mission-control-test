import{b as v,a as A,q as c,Q as _,am as S,av as h,aw as b,t as N}from"./index-cf7adbcf.js";const F=()=>{const s=v.getState().user;return A({queryKey:[_.UserSettingsAssets],queryFn:()=>Q(),staleTime:1e3*60*60,enabled:!!s})};async function R(){return await c.removeQueries([_.UserSettingsAssets])}async function Q(){try{const{getAssets:s}=S,a=v.getState().user,e=a==null?void 0:a.usrsettings.filter(n=>n.key.includes("toolset")),t=a==null?void 0:a.usrsettings.filter(n=>n.key.includes("land")),i=e==null?void 0:e.flatMap(({value:n})=>n.split(",")),o=t==null?void 0:t.map(({value:n})=>n.split(","));if(!i||!o)return{favoriteTools:[],favoriteLands:[]};const d=await s({limit:100,ids:i.join(",")}),l=e==null?void 0:e.map(({value:n})=>n.split(",").map(u=>{const r=d.find(({asset_id:y})=>y===u);return{...r.data,assetId:r.asset_id}})),m=await s({limit:100,ids:o.join(",")}),f=await Promise.all(h.map(async n=>{const u=await b(n);return{title:n,img:`/assets/planets/${n}.png`,data:(u==null?void 0:u.pool_buckets.map(r=>({...r,value_formatted:N(r==null?void 0:r.value)??0})))??[]}})),g=k(f),p=await Promise.all(t==null?void 0:t.map(async({value:n})=>await Promise.all(n.split(",").map(async u=>{const r=m.find(({asset_id:L})=>L===u),y=r.data.name.split(" on "),w=await M(g,y[0]),T=P(w,y[1]);return{...r.data,assetId:r.asset_id,estimated_tlm:T,planetName:y[1]||"",landName:y[0]||""}}))));return{favoriteTools:l,favoriteLands:p}}catch(s){return console.log(s),{favoriteTools:[],favoriteLands:[]}}}function k(s){return s.reduce((a,e)=>(e.data.forEach(t=>{var i,o;!a[t.key]&&t.value_formatted>0&&(a[t.key]={data:[]}),(o=(i=a[t.key])==null?void 0:i.data)==null||o.push({title:e.title,img:e.img,value:t.value,value_formatted:t.value_formatted})}),a),{})}function D(){var a;const s=c.getQueryData(_.TOOLS);return(a=s==null?void 0:s.userTools)==null?void 0:a.reduce((e,t)=>{const i=t==null?void 0:t.rarity;return e[i]?{...e,[i]:e[i]+(Number(t==null?void 0:t.mining_power)??0)}:{...e,[i]:(t==null?void 0:t.mining_power)??0}},{})}async function M(s,a){const e=D();if(!e)return;const t=[],i=Object.keys(e).map((o,d)=>{const l=c.getQueryData(_.LANDSTYPE),m=l==null?void 0:l.find(f=>f.landname===a);return s==null?void 0:s[o].data.map(f=>{const g=e[o]*((m==null?void 0:m.mining_power_mod)??0)/1e4,p=(g>=.8?.8:g)*f.value_formatted;return d===0&&t.push({estimated_tlm:0}),{...f,formatted_estimated_tlm:`${p.toFixed(5)} TLM`,estimated_tlm:p}})});return i==null?void 0:i.reduce((o,d)=>(d==null||d.forEach((l,m)=>{o[m]={...o[m],...l,estimated_tlm:o[m].estimated_tlm+l.estimated_tlm,formatted_estimated_tlm:`${(o[m].estimated_tlm+l.estimated_tlm).toFixed(5)} TLM`}}),o),t)}function P(s,a){return s==null?void 0:s.find(({title:e})=>a.toLowerCase()===e)}export{R as o,F as u};
