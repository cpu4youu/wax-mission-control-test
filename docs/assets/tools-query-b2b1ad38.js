import{c as g,g as d,S as s,T,u as _,d as A,q as y,Q as S,f as m}from"./index-8e6aa14a.js";import{a as h}from"./adapters-36c0dd3a.js";const f=g((t,n)=>({shines:[],updateShines:a=>t(e=>({...e,shines:a})),tools:[],updateTools:a=>t(e=>({...e,tools:a})),userTools:[],updateUserTools:a=>t(e=>({...e,userTools:a})),lands:[],updateLands:a=>t(e=>({...e,lands:a})),mineTrack:[],updateMineTrack:a=>t(e=>({...e,mineTrack:a}))})),O=async()=>await d({options:{code:s.HQ_MU,index_position:1,limit:"10000",scope:s.HQ_MU,table:T.AWTOOLS}}),w=async t=>{const n=await d({options:{code:s.M__FEDERATION,index_position:1,limit:"1000",scope:s.M__FEDERATION,table:T.BAGS,lower_bound:t,upper_bound:t}});return(n==null?void 0:n[0])??null};function D(t,n,a){return!t||!t[0]?[]:t==null?void 0:t.map(e=>({...e,value:String(e[n]),label:String(e[a])}))}const E=async t=>{const n=await d({options:{code:s.M__FEDERATION,index_position:1,limit:"1000",key_type:"",scope:s.M__FEDERATION,table:T.TOOL_USE,upper_bound:t,lower_bound:t}});return n?(n==null?void 0:n[0])??null:null},c={label:"None",value:"none",toolname:"none"},N=()=>{const t=_.getState().user;return A({queryKey:[S.TOOLS],queryFn:()=>U(),staleTime:1e3*60*20,enabled:!!t})};async function F(){return await y.invalidateQueries([S.TOOLS])}async function U(){try{const t=await O();if(!t){m.error("Tools not found");return}const n=M(t,"toolname"),a=R(n),e=D(a,"toolname","toolname"),o=f.getState().updateTools;o(a);const r=_.getState().user;if(!r)return m.error("User not found"),{allData:t,tools:[c,...e],userTools:void 0};const i=await w(r==null?void 0:r.name);if(!i)return{allData:t,tools:[c,...e],userTools:void 0};const l=await v(i,t),u=f.getState().updateUserTools;return u(l),{allData:t,tools:[c,...e],userTools:l}}catch(t){console.log(t);return}}function M(t,n){return Array.from(t.reduce((a,e)=>e.shine==="Stone"||e.shine==="Gold"&&!a.get(e==null?void 0:e[n])||e.shine==="Stardust"&&!a.get(e==null?void 0:e[n])||e.shine==="Antimatter"&&!a.get(e==null?void 0:e[n])||e.shine==="XDimension"&&!a.get(e==null?void 0:e[n])?a.set(e==null?void 0:e[n],e):a,new Map).values())}async function v(t,n){const{getAssetByAssetId:a}=h;return await Promise.all(t.items.map(async o=>{const r=await a(o),i=await E(o);return{...n==null?void 0:n.find(u=>u.template_id===Number(r.template.template_id)&&u.shine===r.data.shine),...r.data,...i,template_id:r.template.template_id}}))}function R(t){return t.sort((n,a)=>p[n.rarity]-p[a.rarity]||n.toolname.localeCompare(a.toolname))}const p={Mythical:0,Legendary:1,Epic:2,Rare:3,Common:4,Abundant:5},q={"X-Dimension":0,Antimatter:1,Stardust:2,Gold:3,Stone:4};export{f as a,D as f,F as o,p as r,q as s,N as u};
