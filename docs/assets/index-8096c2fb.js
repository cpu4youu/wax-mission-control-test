import{g as I,S as m,T as U,d as W,Q as b,u as A,q as E,e as L,s,j as e,E as k,R as w,_ as h,r as o,w as v,n as z,B as G}from"./index-0958298f.js";import{a as Y}from"./adapters-f2b885e5.js";import{c as P}from"./mineCooldown-392645fe.js";import{u as F}from"./use-transaction-918c7851.js";import{s as H}from"./sleep-da79c358.js";import{i as R}from"./index-1e84d731.js";import{i as Q}from"./index-8260d347.js";const q=async n=>await I({options:{code:m.GAME_MC,index_position:1,limit:"10000",scope:m.GAME_MC,table:U.PLAYERS,lower_bound:n,upper_bound:n}}),$=[{label:"prodone",value:0},{label:"prodtwo",value:1},{label:"prodthree",value:2},{label:"prodfour",value:3},{label:"prodfive",value:4},{label:"prodsix",value:5}],V=()=>W({queryKey:[b.MCP_PLAYERS],queryFn:()=>J(),staleTime:1e3*60*60,enabled:!!A.getState().user});async function K(){return E.removeQueries(b.MCP_PLAYERS),await E.invalidateQueries(b.MCP_PLAYERS)}async function J(){const n=A.getState().user;if(!n)return null;try{const r=await q(n.name);return r?Z(r):null}catch(r){return console.log(r),null}}async function Z(n){var u,p;const r=(p=(u=n==null?void 0:n[0])==null?void 0:u.buildings)==null?void 0:p.sort((c,x)=>$.findIndex(l=>l.label===c.buildingid)-$.findIndex(l=>l.label===x.buildingid)),{getAssetByAssetId:t}=Y,d=await Promise.all(r.map(async c=>({...c,staked_asset_ids:await Promise.all(c.staked_asset_ids.map(async x=>({...await t(x)})))})));return{...n[0],buildings:d}}const X=L({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),ee=s("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%","@sm":{padding:"0 15px"}}),te=s("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",maxW:"1190px","@md":{d:"flex",flexWrap:"wrap"}}),ne=s("h2",{d:"flex",align:"center",justify:"center",my:"40px",textAlign:"center",color:"$white500",fs:"30px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),se=s("div",{d:"flex",align:"center",justify:"flex-start",gap:"10px",w:"100%"}),N=s("button",{d:"flex",align:"flex-start",justify:"center",padding:"10px 20px",color:"$white500",ff:"$heading",fs:"18px",variants:{isActive:{true:{fw:"bold",bg:"rgba(0, 0, 0, 0.26)"}}},"@sm":{flexWrap:"wrap"}}),ae=s("div",{d:"flex",align:"flex-start",justify:"center",gap:"0px",padding:"50px",bg:"rgba(0, 0, 0, 0.26)",w:"100%",img:{width:"100%",maxW:"510px"},"@sm":{padding:"0px",flexWrap:"wrap"}}),re=s("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"0px",w:"100%",button:{h:"50px",w:"300px",div:{fs:"18px",border:"none"}},"@sm":{mt:"20px"}}),ie=s("div",{d:"flex",align:"center",justify:"center",position:"relative",w:"100%",maxW:"400px",mb:"30px",color:"$white500",fs:"30px",fw:"bold",ff:"$heading",textAlign:"center",gap:"10px"}),oe=s("div",{mb:"30px",w:"100%",maxW:"550px",textAlign:"center",color:"$white500",fs:"18px",ff:"$body",gap:"10px"}),le=s("div",{d:"flex",align:"center",justify:"center",mb:"30px",w:"100%",maxW:"550px",textAlign:"center",color:"$white500",fs:"18px",fw:"bold",ff:"$body",gap:"10px"});s("div",{mt:"10px",w:"100%",height:"200px",background:"linear-gradient( -90deg, rgba(3, 16, 32, 0.40), rgba(3, 16, 32, 0.75) ,rgba(3, 16, 32, 0.40))",br:"10px",backgroundSize:"400% 400%",animation:`${X} 1.2s ease-in-out infinite`});const ce=async()=>await I({options:{code:m.GAME_MC,index_position:1,reverse:!0,limit:"10000",scope:m.GAME_MC,table:U.SEASON}}),de=()=>W({queryKey:[b.SEASON],queryFn:()=>pe(),staleTime:1e3*60*60});async function ue(){return await E.invalidateQueries(b.SEASON)}async function pe(){try{const n=await ce();return n||null}catch(n){return console.log(n),null}}async function xe(n){const{executeTransaction:r}=F(),t=fe(n);return!!await r(t)}function fe(n){return{actions:[{account:m.GAME_MC,name:"regplayer",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name}}]}}const ge=s("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",h:"calc(100vh - 165px)","@sm":{padding:"0 15px"}}),me=s("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),be=s("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),we=s("div",{d:"flex",align:"center",justify:"center",direction:"column",margin:"auto",w:"100%",maxW:"1190px","@md":{d:"flex",flexWrap:"wrap"}}),T=()=>e.jsxs(ge,{children:[e.jsxs(me,{children:[e.jsx(be,{children:"Outpost Builder"}),e.jsx("img",{src:"/assets/background/bg-mcp-builder.jpeg",alt:""})]}),e.jsx(we,{children:e.jsx(k,{size:"lg",colorSchema:"light"})})]}),he=w.lazy(()=>h(()=>import("./index-6b6d34e5.js").then(n=>n.i),["assets/index-6b6d34e5.js","assets/index-0958298f.js","assets/index-55fec1ff.css","assets/mineCooldown-392645fe.js","assets/index-8260d347.js","assets/index-3d0d21bc.js","assets/use-transaction-918c7851.js","assets/toast-options-b8907df7.js","assets/sleep-da79c358.js","assets/mcpFormatNumber-1b3dda04.js","assets/index-e51e9aa8.js","assets/index-e7c31f05.js","assets/index-5c03b0a3.js","assets/use-media-0eee880c.js","assets/index-f82f4098.js"])),Se=w.lazy(()=>h(()=>import("./index-149444f4.js"),["assets/index-149444f4.js","assets/index-0958298f.js","assets/index-55fec1ff.css"])),_e=w.lazy(()=>h(()=>import("./index-ad7acd74.js"),["assets/index-ad7acd74.js","assets/index-0958298f.js","assets/index-55fec1ff.css","assets/mcpFormatNumber-1b3dda04.js"])),ye=w.lazy(()=>h(()=>import("./star-7f13adec.js"),["assets/star-7f13adec.js","assets/index-0958298f.js","assets/index-55fec1ff.css"])),je=()=>{var D,M;const{data:n,isLoading:r}=V(),{data:t}=de(),d=A(a=>a.user),[u,p]=o.useState({title:"",nextSeason:e.jsx("br",{}),disabled:!1}),[c,x]=o.useState(!1),[l,C]=o.useState("newSeason"),f=o.useCallback(()=>{var g,O;if(!(t!=null&&t[0]))return;const a=new Date,i=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());if(R(new Date(i),new Date(t[0].season_start))){const{days:S,hours:_,minutes:y,seconds:j}=P(new Date((g=t==null?void 0:t[0])==null?void 0:g.season_start));p({title:"NEW SEASON STARTING SOON",nextSeason:`Next season starting in ${S} days ${_} hours and ${y} minutes ${j} seconds`,disabled:!0});return}if(Q(new Date(i),new Date(t[0].season_end))){p({title:"WE ARE WRAPPING UP THE PREVIOUS SEASON. RETURNING NFTS, SENDING PRIZES, ....",nextSeason:e.jsx("br",{}),disabled:!0});return}if(v(new Date(i),{start:new Date(t[0].season_start),end:new Date(t[0].season_end)})){const{days:S,hours:_,minutes:y,seconds:j}=P(new Date((O=t==null?void 0:t[0])==null?void 0:O.season_end));p({title:`SEASON ENDS IN ${S} DAYS ${_} HOURS ${y} MINUTES ${j} SECONDS`,nextSeason:e.jsx("br",{}),disabled:!1});return}},[t]),B=o.useCallback(async()=>{if(d){x(!0);try{await xe(d)&&(await H(6e3),await K(),await ue())}catch(a){console.log(a)}finally{x(!1)}}},[d]);return o.useEffect(()=>{f()},[f]),o.useEffect(()=>{if(!(t!=null&&t[0]))return;const a=setInterval(()=>{const i=new Date,g=new Date(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds());R(new Date(g),new Date(t[0].season_start))&&f(),v(new Date(g),{start:new Date(t[0].season_start),end:new Date(t[0].season_end)})&&(f(),n&&t&&clearInterval(a))},1e3);return()=>clearInterval(a)},[t,n,f]),r?e.jsx(T,{}):n&&t&&v(new Date(z),{start:new Date(t[0].season_start),end:new Date(t[0].season_end)})?e.jsx(o.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(he,{season:t[0]})}):e.jsx(o.Suspense,{fallback:e.jsx(T,{}),children:e.jsxs(ee,{children:[e.jsx(Se,{}),e.jsxs(te,{children:[e.jsx(ne,{children:u.title}),e.jsxs(se,{children:[e.jsx(N,{onClick:()=>C("newSeason"),isActive:l==="newSeason",children:"New Season"}),(D=t==null?void 0:t[0])!=null&&D.new_season_prepared||(M=t==null?void 0:t[0])!=null&&M.ranking_cleared?e.jsx(N,{onClick:()=>C("prevSeason"),isActive:l==="prevSeason",children:"Previous Season"}):""]}),e.jsx(ae,{children:l==="prevSeason"?e.jsx(_e,{}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/assets/mcp/mcp-builder.png",alt:""}),e.jsxs(re,{children:[e.jsxs(ie,{children:["WELCOME TO ",e.jsx("br",{})," OUTPOST BUILDER"]}),e.jsxs(oe,{children:["Mission Control needs YOU to help gain more resources. Build an outpost on a remote planet in this seasonal idle building game. Ramp up your production and deliver resources to Mission Control in exchange for ",e.jsx(ye,{}),".",e.jsx("br",{})," ",e.jsx("br",{}),"Who will manage to to deliver the most resources to Mission Control? Who will take up the challenge for the top of the leaderboard this season?",e.jsx("br",{})," ",e.jsx("br",{}),"Ready? Then what are you waiting for?"]}),e.jsx(le,{children:u.nextSeason}),e.jsx(G,{isLoading:c,color:"solidBlue",disabled:c||u.disabled,rounded:!1,onClick:B,children:"START NOW !"})]})]})})]})]})})},Oe=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));export{T as L,de as a,$ as b,Oe as i,K as o,V as u};
