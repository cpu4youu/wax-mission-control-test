import{g,S as h,T as w,c as F,a as T,Q as A,a8 as f,m as y}from"./index-57ef95e7.js";const N=async()=>await g({options:{code:h.MISSION_CONTROL,index_position:1,limit:"10000",scope:h.MISSION_CONTROL,table:w.BLOGS}}),p={label:"All",value:"all"},S=F((t,s)=>({newsFilters:[p],updateNewsFilters:r=>m(t,r),newsFiltersSelected:p,updateNewsFiltersSelected:r=>C(t,r)}));function m(t,s){t(r=>({...r,newsFilters:[p,...s]}))}function C(t,s){t(r=>({...r,newsFiltersSelected:s}))}const R=()=>T({queryKey:[A.NEWS],queryFn:()=>O(),staleTime:1e3*60*60});async function O(){try{const t=await N();if(!t)return null;const s=x(t),r=v(s),e=S.getState().updateNewsFilters;return e(r),await I(s)}catch(t){return console.log(t),null}}function v(t){return t.map(s=>{if(s.blogid==="mining-matters"){const r=S.getState().updateNewsFiltersSelected;r({label:s.blogname,value:s.blogid})}return{label:s.blogname,value:s.blogid}})}function x(t){const s=t.map(r=>({...r,url:`https%3A%2F%2Fmedium.com%2Ffeed%2F${r.blogid}`}));return[...s,{id:s[s.length-1].id+1,blogid:"alien-articles",blogname:"Alienw.com",url:"https%3A%2F%2Falienw.com%2Ffeed"}]}async function I(t){const s=await _(t);return{all:s.reduce((e,l)=>(l.loadedArticles.length>0&&e.push(l.loadedArticles),e),[]).flat().sort((e,l)=>new Date(e.published).getTime()>new Date(l.published).getTime()?-1:1),...s.reduce((e,l)=>(e[l.blogid]=l.loadedArticles.sort((o,n)=>new Date(o.published).getTime()>new Date(n.published).getTime()?-1:1),e),{})}}const i=["https://rss-to-json-mc.vercel.app/api?url=","https://rss-to-json-serverless-api.vercel.app/api?feedURL=","https://api.rss2json.com/v1/api.json?rss_url=","https://api.apyhub.com/convert/rss-url/json"];async function _(t){const s=[];for(const r of t){let e=0,l=!1;do try{if(i[e]===i[3]){const o={method:"POST",url:"https://api.apyhub.com/convert/rss-url/json",params:{detailed:"true"},headers:{"apy-token":"APY0RZnFoIUDElOH2WDX0UTaoNLdIXvSVWsUV5vjr0hnzu94p2eV0S32khkFBrO53pz4vjBVWoWdsA","Content-Type":"application/json"},data:{url:decodeURIComponent(r.url)}},{data:n}=await f.request(o);l=!1;const a=b(n,i[e]);s.push({...r,loadedArticles:a})}else{const{data:o}=await f(`${i[e]}${r.url}`);l=!1;const n=b(o,i[e]);s.push({...r,loadedArticles:n})}await y(1e3)}catch{l=!0,e++,e===i.length&&(e=0)}while(l)}return s}function b(t,s){if(s===i[3])return t==null?void 0:t.items.map(e=>{var u,c,d;const o=new DOMParser().parseFromString(e.content_html,"text/html"),n=o.querySelector("p"),a=o.querySelector("img");return!n||!n.textContent?{...e,description:"",thumbnail:a==null?void 0:a.getAttribute("src")}:{...e,link:e.url,author:(e==null?void 0:e.authors[0].name)??((u=t==null?void 0:t.feed)==null?void 0:u.title),published:e.date_published,description:n.textContent,thumbnail:(a==null?void 0:a.getAttribute("src"))??((c=e==null?void 0:e.enclosure)==null?void 0:c.thumbnail)??((d=t==null?void 0:t.feed)==null?void 0:d.image)}});if(s===i[2])return t==null?void 0:t.items.map(e=>{var u,c,d;const o=new DOMParser().parseFromString(e.content,"text/html"),n=o.querySelector("p"),a=o.querySelector("img");return{...e,author:(e==null?void 0:e.author)??((u=t==null?void 0:t.feed)==null?void 0:u.title),published:e.pubDate,description:(n==null?void 0:n.textContent)||"",thumbnail:(a==null?void 0:a.getAttribute("src"))??((c=e==null?void 0:e.enclosure)==null?void 0:c.thumbnail)??((d=t==null?void 0:t.feed)==null?void 0:d.image)}});const{data:r}=t;return r==null?void 0:r.items.map(e=>{var u,c;const o=new DOMParser().parseFromString(e.content,"text/html"),n=o.querySelector("p"),a=o.querySelector("img");return!n||!n.textContent?{...e,description:"",thumbnail:a==null?void 0:a.getAttribute("src")}:{...e,author:(e==null?void 0:e.author)??(r==null?void 0:r.title),description:n.textContent,thumbnail:(a==null?void 0:a.getAttribute("src"))||((c=(u=e==null?void 0:e.media)==null?void 0:u.thumbnail)==null?void 0:c.url)||(r==null?void 0:r.image)}})}export{S as a,R as u};
