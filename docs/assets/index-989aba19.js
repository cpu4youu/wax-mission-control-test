import{s as a,e as T,g as j,S as p,T as w,a as y,Q as b,b as f,U as S,u as _,R as m,p as v,j as t,B as g,k as C}from"./index-7ede09bc.js";import{C as L,o as k}from"./toolov-query-04287e50.js";import{o as M}from"./inventory-query-0710924c.js";const O=a("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),h=a("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),R=a("p",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",my:"15px",color:"$white500",fw:"400",ff:"$heading",fs:"20px",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",mt:"5px",">div":{border:"none"}},"@sm":{flexWrap:"wrap",span:{fs:"16px"}}}),A=a("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),B=a("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",">div":{border:"none"}}}),U=a("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",m:"5px 0 10px",w:"100%"}),x=a("div",{d:"flex",align:"center",justify:"space-between",gap:"10px",px:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),d=a("p",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"14px",ff:"$heading",fw:"400"}),W=T({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),E=a("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${W} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),$=async e=>await j({options:{code:p.TOOLS_MC,index_position:3,key_type:"i64",limit:"10000",scope:p.TOOLS_MC,table:w.tools,reverse:!0,lower_bound:e,upper_bound:e}}),Q=()=>y({queryKey:[b.toolsMc],queryFn:()=>Y(),staleTime:1e3*60*20,enabled:!!f.getState().user});async function Y(){try{const e=f.getState().user;if(!e)return;const s=await $(e.name);if(!s)return;const{getTemplates:i}=S,c=await i({template_id:s.map(({template_id:o})=>o).join(","),page:1,limit:100,order:"desc"});return s==null?void 0:s.map(o=>{const l=c.find(n=>n.template_id===String(o.template_id));return l?{...l.immutable_data,...o}:o})}catch(e){console.log(e);return}}async function q(e,s){const{executeTransaction:i}=_(),c=D(e,s);return!!await i(c)}function D(e,s){return{actions:[{account:p.TOOLS_MC,name:"unstake",authorization:[{actor:e.name,permission:e.requestPermission}],data:{wallet:e.name,asset_ids:s}}]}}const P=()=>{const{data:e,isLoading:s}=Q(),i=f(n=>n.user),[c,u]=m.useState(!1);async function o(n){if(i){u(!0);try{await q(i,[Number(n.asset_id)])&&(await k(),await M("tool.worlds"),C.success("Tool unstaked"))}catch(r){console.error("Error staking tool",r)}finally{u(!1)}}}const l=m.useMemo(()=>e==null?void 0:e.reduce((n,r)=>n+v(r.total_earned),0),[e]);return t.jsxs(O,{children:[t.jsx(h,{children:"CLAIM YOUR TLM"}),t.jsxs(R,{children:["Claimable TLM, earned by loaning: ",l==null?void 0:l.toFixed(4)," TLM",t.jsx(g,{rounded:!1,color:"solidBlue",children:"Claim TLM"})]}),t.jsx(h,{children:"YOUR STAKED TOOLS"}),t.jsx(A,{children:s?new Array(6).fill(0).map((n,r)=>t.jsx(E,{},r)):e==null?void 0:e.map((n,r)=>t.jsx(L,{tool:n,children:t.jsxs(B,{children:[t.jsx(g,{disabled:c,isLoading:c,onClick:()=>o(n),rounded:!1,color:"solidBlue",children:"Unstake"}),t.jsxs(U,{children:[t.jsxs(x,{children:[t.jsx(d,{children:"Since"}),t.jsx(d,{children:n.last_mine})]}),t.jsxs(x,{children:[t.jsx(d,{children:"Total"}),t.jsx(d,{children:n.total_earned})]}),t.jsxs(x,{children:[t.jsx(d,{children:"Uses"}),t.jsx(d,{children:n.total_mines})]})]})]})},r))})]})};export{P as default};
