import{s as p,i as $e,k as Pe,u as be,j as a,e as Qe,t as Ve,r as L,h as je,q as Me,Q as Ce,R as H,_ as Y,B as We}from"./index-b4224ac4.js";import{a as Ge}from"./index.esm-e91661cc.js";import{F as Ke}from"./index.esm-f46667d6.js";import{f as Ue}from"./format-currency-usd-c3f487ff.js";import{f as ie}from"./formatNumber-be910684.js";import{a as we,c as q,d as N}from"./mineCooldown-b71d1ad2.js";import{u as qe}from"./use-wharfkit-0287431d.js";import{u as Be}from"./use-media-8f35a610.js";import{a as He,e as De}from"./execute-claim-contract-3b9096e9.js";import{u as $,g as Se,s as oe}from"./showTlmValueFromMine-5e0f54df.js";import{s as P}from"./sleep-da79c358.js";import{u as Ye,o as Le}from"./lands-query-ecaef765.js";import{c as se,a as re}from"./calculateShardsByLand-8c2271f5.js";import{u as Xe,r as Ee,o as Re}from"./tools-query-3908eb8f.js";import{u as Ze,o as Te}from"./user-miners-query-efff2111.js";import{u as Je,o as et}from"./lands-query-b8f96ff9.js";import{u as tt,o as nt}from"./get-user-settings-assets-query-e1872573.js";import{u as at,o as it}from"./wallets-query-3f76628d.js";import{u as ot,o as st,g as rt}from"./tool-query-c7e96d39.js";import{u as lt,f as ct,o as dt,g as pt,e as ft}from"./execute-mine-tool-contract-fc5d2383.js";import{o as mt}from"./miner-claim-2eae9dc6.js";import{o as ut}from"./toolov-query-d5083a21.js";import"./iconBase-b0c70e37.js";import"./index-d0f05756.js";import"./index-267327c3.js";import"./use-transaction-20953b97.js";import"./toast-options-57b78c68.js";import"./lands-5261054a.js";import"./adapters-ef118c17.js";import"./axios-45629df5.js";const gt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",my:"auto","@sm":{ml:"auto",my:"auto"}}),xt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",cursor:"pointer",mr:"auto",position:"relative"}),ht=p("img",{w:"100%",h:"60px",mb:"10px",objectFit:"contain","@sm":{w:"80px",h:"80px"}}),yt=p("div",{d:"flex",align:"center",justify:"center",zIndex:3,position:"absolute",bottom:"-10px",left:"0px",w:"30px",h:"30px",br:"10px","-webkit-text-stroke":"1px white",letterSpacing:"1px",color:"#00D1FF",fw:"900",fs:"20px",ff:"$heading",border:"2px solid white",background:"#D9D9D9",backdropFilter:"blur(15px)"}),wt=p("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%","@sm":{d:"none"}}),Tt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",mb:"10px",minW:"200px",w:"100%"}),bt=p("div",{d:"flex",align:"center",justify:"center",position:"relative",boxShadow:"2px 2px 10px #000000",w:"100%",h:"10px",br:"3px",bg:"#595959"}),_t=p("div",{d:"flex",align:"center",justify:"center",position:"absolute",left:"0px",maxW:"200px",h:"10px",br:"3px",bg:"linear-gradient(90deg, #07A3DD 0%, rgba(0, 186, 255, 0.5) 100%)","&::after":{content:"",position:"absolute",right:"-2px",h:"14px",w:"7px",br:"50%",bg:"$white500",filter:"blur(2px)"}}),vt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",ff:"$heading",fw:"$thin",fs:"12px",color:"$white500","@md":{ml:"auto",fs:"10px"}}),jt=p("div",{d:"flex",align:"center",justify:"space-between",w:"100%","@md":{fs:"12px"}}),Mt=p("button",{d:"flex",align:"center",justify:"center",ff:"$body",fs:"14px",fw:"$normal",color:"$red500",cursor:"pointer","&:hover":{textShadow:"1px 1px 2px red"},"@md":{fs:"12px"}}),Ct=()=>{const i=$e(),{data:y}=Pe(),l=be(j=>j.user),{unAuthorize:O}=qe(),{isSmall:E}=Be(),o=y==null?void 0:y.find(j=>j.level===(l==null?void 0:l.level)),R=((l==null?void 0:l.experience)??0)/((o==null?void 0:o.xp_to_level_up)??100)*100;return a.jsxs(gt,{children:[a.jsx(xt,{onClick:()=>i(E?"/user-settings":"/menu"),children:a.jsx(ht,{src:"/assets/icons/logo.webp",alt:"avatar icon"})}),a.jsxs(wt,{children:[a.jsxs(Tt,{children:[a.jsx(yt,{children:(l==null?void 0:l.level)??1}),a.jsx(bt,{children:a.jsx(_t,{style:{width:`${R}%`}})})]}),a.jsxs(jt,{children:[!E&&a.jsx(Mt,{onClick:O,children:"Logout"}),a.jsxs(vt,{children:[(l==null?void 0:l.experience)??0,"/",(o==null?void 0:o.xp_to_level_up)??100," ",!E&&"XP"]})]})]})]})},Dt=p("div",{d:"flex",align:"center",justify:"space-between",w:"100%",position:"relative",zIndex:20,bg:"$blue700"}),St=p("div",{d:"flex",align:"center",justify:"space-between",zIndex:20,w:"100%",px:"30px",h:"140px","@media(max-width:1224px)":{minW:"100%"},"@md":{px:"15px"},"@sm":{}}),Lt=p("div",{d:"flex",align:"center",justify:"center",gap:"20px",">a":{d:"flex",align:"center",justify:"center",svg:{h:"28px",w:"28px"}},svg:{color:"$white500",h:"22px",w:"22px"},zIndex:30,button:{"&:disabled":{opacity:.5}},"@sm":{order:-1,justify:"space-between",w:"max-content",button:{d:"none","&:last-of-type":{d:"flex",zIndex:2,svg:{h:"35px",w:"35px"}}}},"@xxsm":{">a":{top:"10px",position:"absolute"}}}),Et=Qe({"100%":{transform:"rotate(360deg)"}}),Rt=p("button",{color:"$white500",svg:{ml:"10px",color:"$white500",w:"25px",h:"25px"},variants:{isLoading:{true:{pointerEvents:"none",opacity:"0.5",svg:{animation:`${Et} 1s linear`,animationIterationCount:"infinite"}},false:{pointerEvents:"all",opacity:"1"}}}}),It=p("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"3px",w:"100%",">button":{h:"30px",minW:"150px",fs:"20px"},span:{textTransform:"uppercase",color:"$white500",fs:"10px",fw:"$bold",ff:"$heading"},"@sm":{w:"max-content",position:"absolute",left:"50%",transform:"translateX(-50%)"}}),$t=p("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"10px",width:"310px","@md":{width:"max-content",margin:"0",gap:"7px"},"@sm":{d:"none"}});p("button",{d:"flex",align:"center",justify:"center",ml:"10px"});const Bt=p("div",{d:"flex",align:"flex-end",justify:"center",gap:"20px",mt:"20px"}),le=p("div",{d:"flex",align:"center",justify:"space-between",direction:"column",color:"$white500",w:"max-content",fs:"14px",svg:{w:"25px",h:"25px"}}),ce=p("div",{d:"flex",align:"center",justify:"center",direction:"column",padding:"5px",w:"35px",h:"35px",border:"1px solid $white500",borderRadius:"$full"}),Ft=p("div",{d:"flex",align:"center",justify:"center",">button>div":{d:"flex",align:"center",justify:"center"},"@sm":{gap:"10px",">button>div":{direction:"column"}}}),At=p("div",{d:"flex",align:"center",justify:"center",gap:"5px",ml:"10px",fs:"20px",ff:"$body",color:"$white500",path:{fill:"$white500"}}),kt=p("p",{ff:"$heading",fs:"20px",fw:"$bold",textShadow:"1px 1px 2px black",color:"$yellow500"});function Nt(){const{isSmall:i}=Be(),y=$e(),{data:l,isLoading:O,isFetching:E}=Ze(),{data:o,isLoading:R,isFetching:j}=Xe(),{data:B}=Je(),{data:de,isLoading:pe}=Ye(),{data:T}=tt(),{data:h,isFetching:fe}=at(),{data:M,isLoading:X,isFetching:Q}=ot(),{data:m,isFetching:me}=lt(),e=be(t=>t.user),ue=be(t=>t.updateAuth),I=$(t=>t.nonce),b=$(t=>t.updateIsCalculating),ge=$(t=>t.isMineButtonLoading),V=$(t=>t.updateMineButtonLoading),W=$(t=>t.isCalculating),G=$(t=>t.updateNonce),xe=$(t=>t.hashExpire),Z=$(t=>t.updateHashExpire),J=$(t=>t.updateMineCooldown),K=Ve(t=>t.currentWeek),[he,A]=L.useState(new Date),[U,C]=L.useState(!1),[u,ee]=L.useState(void 0),[D,w]=L.useState(null),d=!(e!=null&&e.isMember)||(e==null?void 0:e.flagged),_e=async()=>{if(!e)return null;C(!0),b(!0);try{if(!await He(e))throw new Error("MINE error from contract");await oe(e==null?void 0:e.name)}catch(t){console.log(t)}finally{await P(800),b(!1),await z(),C(!1)}},Fe=async()=>{var t;C(!0);try{await Le(),b(!0),await P(500);const[[f,s]]=Me.getQueriesData(Ce.LANDS),_=(t=s.highestValue)==null?void 0:t.asset_id;if(!e||!_)return null;if(!(I!=null&&I.rand_str)){await Se();const g=new Date;Z(g.setMinutes(g.getMinutes()+1))}await De(e,_)&&(await oe(e==null?void 0:e.name),await z())}catch(f){console.log(f)}finally{b(!1),C(!1)}},te=({delay:t})=>{var v,g,n,c,r,x,S,k,ae;const f=(t??0)/10;if(((v=o==null?void 0:o.userTools)==null?void 0:v.length)===1){const F=f*(((n=(g=o==null?void 0:o.userTools)==null?void 0:g[0])==null?void 0:n.delay)??0);return N(F,o,l,A)}const s=(c=o==null?void 0:o.userTools)==null?void 0:c.sort((F,ze)=>ze.delay-F.delay);if(((r=o==null?void 0:o.userTools)==null?void 0:r.length)===2){const F=f*((((x=s==null?void 0:s[0])==null?void 0:x.delay)??0)+(((S=s==null?void 0:s[1])==null?void 0:S.delay)??0)/2);return N(F,o,l,A)}const _=f*((((k=s==null?void 0:s[0])==null?void 0:k.delay)??0)+(((ae=s==null?void 0:s[1])==null?void 0:ae.delay)??0));return N(_,o,l,A)},ne=()=>{var v,g;if(!B||!(T!=null&&T.favoriteLands))return null;let t=[];const f=T==null?void 0:T.favoriteLands.filter(([n])=>we(q(te({delay:n.delay})))==="MINE");if(f.length>0)t=f;else{const n=Math.min(...T.favoriteLands.map(([r])=>q(te({delay:r.delay})).difference));t=T.favoriteLands.filter(([r])=>q(te({delay:r.delay})).difference===n)}if((e==null?void 0:e.miningType)==="orange"){const n=Math.max(...t.map(([r])=>se({land:r})));return{...(v=t.filter(([r])=>se({land:r})===n).flatMap(([r])=>r).sort((r,x)=>re({landCardId:x.cardid,landsType:B,userTools:o==null?void 0:o.userTools})-re({landCardId:r.cardid,landsType:B,userTools:o==null?void 0:o.userTools})))==null?void 0:v[0]}}const s=Math.max(...t.map(([n])=>re({landCardId:n.cardid,landsType:B,userTools:o==null?void 0:o.userTools})));return{...(g=t.filter(([n])=>re({landCardId:n.cardid,landsType:B,userTools:o==null?void 0:o.userTools})===s).sort(([n],[c])=>se({land:c})-se({land:n})).flatMap(([n])=>n))==null?void 0:g[0]}},Ae=async()=>{C(!0);try{b(!0),await P(500);const t=ne();if(!e)return null;await De(e,t==null?void 0:t.assetId)&&(await oe(e==null?void 0:e.name),await z())}catch(t){console.log(t)}finally{b(!1),C(!1)}},ke=async()=>{await Te(),await it(),await mt(),await st(),await ut(),await dt()},ye=L.useCallback(async()=>{if(!M||!m)return null;const t=await Promise.all(M==null?void 0:M.toolsOv.filter(n=>{var r;const c=n.owned>0&&((n==null?void 0:n.tool_name)==="Certified Kol Digger"?!0:n.allowed===1)&&ct((e==null?void 0:e.total_points)??0,n);return((h==null?void 0:h.tempid_allow_list.length)??0)===0?c:c&&((r=h==null?void 0:h.tempid_allow_list)==null?void 0:r.some(x=>x===n.template_id))}).map(async n=>{if((n==null?void 0:n.tool_name)==="Certified Kol Digger"){const r=m==null?void 0:m.reduce((x,S)=>{const k=Number(new Date(x.readyat));return Number(new Date(S.readyat))<k?S:x},m[0]);return{...n,...r,last_use:+new Date(`${r.readyat}.000Z`)/1e3-r.cooldown_seconds}}const c=M.stakedTools.find(r=>r.template_id===n.template_id);return{...n,...c,last_use:+new Date(`${n.readyat}.000Z`)/1e3-n.cooldown_seconds}})),f=t==null?void 0:t.filter(n=>{const c=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6;return we(q(N(c,{userTools:[n],allData:[]},l)))==="MINE"});let s=null;f.length>0?s=f.sort((n,c)=>Ee[n.rarity]-Ee[c.rarity]||c.mining_power-n.mining_power)[0]:s=t==null?void 0:t.reduce((n,c)=>{const r=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6,S=+N(r,{userTools:[n],allData:[]},l),k=((c==null?void 0:c.tool_name)==="Certified Kol Digger"?500:c.cooldown_seconds)*1.6,F=+N(k,{userTools:[c],allData:[]},l);return F<S?{...c,cooldownSec:F}:{...n,cooldownSec:S}},t[0]);const _=((s==null?void 0:s.tool_name)==="Certified Kol Digger"?500:s.cooldown_seconds)*1.5,g=N(_,{userTools:[s],allData:[]},l);return A(g),s},[m,l,M,e,h]),Ne=async()=>{var t,f;C(!0);try{const s=await ye();if(!s||!e||!m)return;await Le(),b(!0),await P(500);let _=0,v,g=[];if((s==null?void 0:s.tool_name)==="Certified Kol Digger"){const c=m==null?void 0:m.reduce((r,x)=>{const S=Number(new Date(r.readyat));return Number(new Date(x.readyat))<S?x:r},m[0]);_=c.asset_ids.length*s.pow,g=c.asset_ids.map(r=>Number(r)),v="1099512958237"}else{const[c]=await rt(`${s.template_id}`);_=c.pow,g=[c.next_asset_id];let r;try{[[,r]]=Me.getQueriesData([Ce.LANDS,"red",s])}catch{r=await pt(s)}v=(t=r.highestValue)==null?void 0:t.asset_id}await ft({user:e,difficulty:_,assets_ids:g,land_asset_id:v,old_bag_assets_ids:((f=o==null?void 0:o.userTools)==null?void 0:f.map(c=>Number(c.asset_id)))??[]})&&(await oe(e==null?void 0:e.name),await z())}catch(s){console.log(s)}finally{V(!1),b(!1),C(!1)}},z=async()=>{if(await Te(),await Re(),(e==null?void 0:e.miningType)==="red"){await ke(),await P(1e3),ye();return}},Oe=()=>{const t=we(u);return J(t),t},ve=async()=>{await Re(),await et(),await Te(),await nt()};return{user:e,miners:l,mTools:m,tools:o,toolsLoaning:M,toolsWallets:h,bestLand:D,cooldown:Oe,handleRefreshLands:ve,playSound:async()=>{const t=new Audio("https://play.alienworlds.io/sounds/aw-mining-claim-sfx-02.mp3");i&&await P(1e3),t.play()},textAboveButton:()=>{var t;return d?"Not a Member":(e==null?void 0:e.miningType)==="green"?"Favorites (shards)":(e==null?void 0:e.miningType)==="orange"?"Favorites (TLM)":(e==null?void 0:e.miningType)==="gold"?"Mining":(e==null?void 0:e.miningType)==="blue"?"Mine Maximizer":(e==null?void 0:e.miningType)==="red"?`Deposit: ${je(h==null?void 0:h.deposit).toFixed(4)} TLM`:`Deposit: ${(je((t=e==null?void 0:e.HqMember)==null?void 0:t.deposit)+((e==null?void 0:e.tlm_deposit)??0)/1e4).toFixed(4)} TLM`},textBelowButton:()=>d?"Become a member to use mine":(e==null?void 0:e.miningType)==="red"?"Tool Loaning":(e==null?void 0:e.miningType)==="gold"||(e==null?void 0:e.miningType)==="blue"?`${l!=null&&l.name?l==null?void 0:l.name:""}`:`${D!=null&&D.name?D==null?void 0:D.name:""}`,buttonOnClick:async()=>{if(d)return y("/membership");if((e==null?void 0:e.miningType)==="red")return await z(),Ne(),null;if(!(I!=null&&I.rand_str)&&!W){b(!0),((e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange")&&await ve(),await Se();const t=new Date;Z(t.setMinutes(t.getMinutes()+1))}return(e==null?void 0:e.miningType)==="blue"?(Fe(),null):(e==null?void 0:e.miningType)==="gold"?(_e(),null):(e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange"?(Ae(),null):_e()},loading:()=>{const t=((u==null?void 0:u.seconds)??0)<0&&((u==null?void 0:u.minutes)??0)<0&&((u==null?void 0:u.hours)??0)<0,f=(e==null?void 0:e.miningType)==="red"?X:!1;return W||U||ge||pe||R||Q||j||O||E||fe||me||!u||t||f},miningType:()=>(e==null?void 0:e.miningType)==="gold"?"gradientYellow":(e==null?void 0:e.miningType)==="orange"?(w(ne()),"gradientOrange"):(e==null?void 0:e.miningType)==="green"?(w(ne()),"gradientGreen"):(e==null?void 0:e.miningType)==="blue"?"gradientBlue":(e==null?void 0:e.miningType)==="red"?"gradientRed":"gradientYellow",minersFetching:E,toolFetching:j,land:de,updateAuth:ue,updateNonce:G,hashExpire:xe,currentWeek:K,expireDate:he,setToolCooldown:ee,isSmall:i,favorites:T,landsType:B,setExpireDate:A,setBestLand:w,isDisableToMine:d,toolCooldown:u,updateMineCooldown:J,handleRefetch:z,navigate:y,selectBestLandOnFavorites:ne,getBestToolOnTooLoaning:ye,calcCooldown:te,nonce:I}}const Ie=H.lazy(()=>Y(()=>import("./tlm-105503b4.js"),["assets/tlm-105503b4.js","assets/index-b4224ac4.js","assets/index-55fec1ff.css"])),Ot=H.lazy(()=>Y(()=>import("./star-fcd7fd4f.js"),["assets/star-fcd7fd4f.js","assets/index-b4224ac4.js","assets/index-55fec1ff.css"])),zt=H.lazy(()=>Y(()=>import("./atom-648a77c7.js"),["assets/atom-648a77c7.js","assets/index-b4224ac4.js","assets/index-55fec1ff.css"])),Pt=H.lazy(()=>Y(()=>import("./quest-81df069e.js"),["assets/quest-81df069e.js","assets/index-b4224ac4.js","assets/index-55fec1ff.css"])),Qt=H.lazy(()=>Y(()=>import("./open-menu-31ae5764.js"),["assets/open-menu-31ae5764.js","assets/index-b4224ac4.js","assets/index-55fec1ff.css"])),Cn=()=>{var ee,D;const{user:i,miners:y,mTools:l,tools:O,toolsLoaning:E,toolsWallets:o,bestLand:R,cooldown:j,playSound:B,textAboveButton:de,textBelowButton:pe,buttonOnClick:T,loading:h,miningType:fe,updateNonce:M,hashExpire:X,currentWeek:Q,expireDate:m,setToolCooldown:me,isSmall:e,favorites:ue,landsType:I,setExpireDate:b,setBestLand:ge,isDisableToMine:V,handleRefetch:W,navigate:G,selectBestLandOnFavorites:xe,getBestToolOnTooLoaning:Z,calcCooldown:J,nonce:K}=Nt(),he=()=>V?a.jsx("span",{style:{fontSize:"15px"},children:"Membership"}):K!=null&&K.rand_str&&j()==="MINE"?"Submit":j();L.useEffect(()=>{let w=(y==null?void 0:y.delay)??0;if((i==null?void 0:i.miningType)==="blue"&&(w=15),((i==null?void 0:i.miningType)==="green"||(i==null?void 0:i.miningType)==="orange")&&R&&(w=R==null?void 0:R.delay),(i==null?void 0:i.miningType)==="red"){Z();return}J({delay:w})},[R,l,O,E,o,i]),L.useEffect(()=>{const w=setInterval(()=>{const d=q(m);me(d),((i==null?void 0:i.miningType)==="orange"||(i==null?void 0:i.miningType)==="green")&&ge(xe()),(d==null?void 0:d.hours)===0&&(d==null?void 0:d.minutes)===0&&(d==null?void 0:d.seconds)===1&&B(),(d==null?void 0:d.hours)===0&&(d==null?void 0:d.minutes)===0&&(d==null?void 0:d.seconds)===0&&clearInterval(w)},1e3);return()=>clearInterval(w)},[m,e,ue,I,y,O,i]),L.useEffect(()=>{const w=setInterval(()=>{X-new Date().getTime()<0&&M(void 0)},3e3);return()=>clearInterval(w)},[X,M]),L.useEffect(()=>{setInterval(async()=>{await W()},6e4)},[y,l,b,E,o,i]);const A=L.useMemo(()=>fe(),[i==null?void 0:i.miningType]),U=h(),C=V?!1:U,u=V?!1:U||j()!=="MINE";return a.jsx(Dt,{children:a.jsxs(St,{children:[a.jsx(Ct,{}),a.jsxs(Lt,{children:[a.jsx(Rt,{disabled:!(i!=null&&i.member),onClick:()=>W(),isLoading:U,children:a.jsx(Ke,{})}),a.jsxs(It,{children:[a.jsx("span",{children:de()}),a.jsx(We,{onClick:()=>T(),disabled:u,color:A,isLoading:C,children:he()}),a.jsx("span",{children:pe()})]}),a.jsx("button",{onClick:()=>G("/user-settings"),children:a.jsx(Ge,{})}),a.jsx("button",{onClick:()=>G("/menu"),children:a.jsx(Qt,{})})]}),a.jsxs($t,{children:[a.jsxs(Bt,{children:[a.jsxs(le,{children:[a.jsx(ce,{children:a.jsx(Pt,{})}),ie(((ee=i==null?void 0:i.userWeekly)==null?void 0:ee.total_quest_points)??0,1)]}),a.jsxs(le,{children:[a.jsx(ce,{children:a.jsx(Ot,{})}),ie((i==null?void 0:i.mcPoints)??0,1)]}),a.jsxs(le,{children:[a.jsx(ce,{children:a.jsx(zt,{color:"#F6A800"})}),ie(((i==null?void 0:i.redeemable_points)??0)/10,1)]}),a.jsxs(le,{children:[a.jsx(ce,{children:a.jsx(Ie,{})}),ie(Number((D=i==null?void 0:i.userTlm)==null?void 0:D.balance)??0,1)]})]}),a.jsx(Ft,{children:a.jsx("button",{onClick:()=>G("/week-reward"),children:a.jsxs("div",{children:[a.jsx(kt,{children:"Prize Pool"}),a.jsxs(At,{children:[Ue((Q==null?void 0:Q.initial_prize_pool_formatted)??0),a.jsx(Ie,{})]})]})})})]})]})})};export{Cn as Header};
