import{s as l,e as le,S as ce,i as pe,u as S,r as p,j as t,B as y,C as R,f as C}from"./index-457651cf.js";import{S as me}from"./index-7ee8c671.js";import{u as xe}from"./index-50b04165.js";import{u as ue}from"./user-miners-query-70794e36.js";import{u as fe,r as Q,o as q}from"./tools-query-ea03800a.js";import{u as ge,o as z}from"./inventory-query-caddd5b7.js";import{u as he}from"./lands-query-ddee5f17.js";import{u as we}from"./mine-query-a3dcb701.js";import{u as je}from"./use-transaction-a23a799a.js";import{e as Te}from"./execute-add-favorites-land-contract copy-5c035403.js";import{s as _}from"./sleep-da79c358.js";import{o as D}from"./get-user-settings-assets-query-a8b32942.js";import{e as H}from"./execute-equip-tools-contract-e99ff4b1.js";import{options as v}from"./index-4b852771.js";import{T as ye}from"./index-86249b4f.js";import{u as be}from"./get-planet-config-193dc2cf.js";import"./index.esm-bcce1617.js";import"./index-c647388e.js";import"./index-b58e52d6.js";import"./index-dbce8b39.js";import"./iconBase-baad2964.js";import"./adapters-6da0c540.js";import"./axios-45629df5.js";import"./toast-options-8e5b0f3d.js";import"./lands-804def63.js";import"./index-5e48bb26.js";import"./index.esm-2a26ee1e.js";import"./use-media-f481cfb0.js";import"./use-wharfkit-0860caf5.js";const Se=l("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",maxW:"1190px"}),Ce=l("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",mt:"30px",mb:"30px",button:{h:"50px",w:"100%",maxW:"230px",div:{fs:"16px",border:"none",br:"10px"}},w:"100%","@sm":{button:{w:"100%",maxW:"100%"}}});l("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}});const _e=l("div",{d:"flex",align:"center",justify:"center",direction:"column",margin:"auto",w:"100%","@md":{d:"flex",padding:"0 20px",flexWrap:"wrap"},"@sm":{padding:"0 10px"}}),k=l("h3",{mr:"auto",mb:"25px",fs:"29px",fw:"$bold",ff:"$heading",color:"$white500","@sm":{fs:"18px"}}),ve=l("div",{d:"flex",align:"flex-start",justify:"flex-start",gap:"20px",mt:"25px",mb:"25px","@md":{flexWrap:"wrap"}}),Le=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"230px","button:first-child":{position:"absolute",top:"-25px",left:"-25px",w:"75px",h:"75px"},"button:last-child":{h:"55px",w:"100%",minW:"100%",maxW:"100%",padding:"0px",mt:"8px",div:{fs:"16px",border:"none",br:"10px"}},"@md":{m:"auto"},"@sm":{}}),Be=l("img",{w:"75px",h:"75px"}),Pe=l("img",{w:"100%",h:"114px"}),Ne=l("div",{d:"flex",align:"center",justify:"center",gap:"2px 10px",flexWrap:"wrap",padding:"10px",w:"78%",br:"10px",bg:"rgba(255, 255, 255, 0.03)","@md":{w:"100%"},"@sm":{padding:"5px 0px"}}),G=l("div",{d:"grid",gridTemplateColumns:"1fr 1fr",gap:"1px 7px",w:"100%","@sm":{gridTemplateColumns:"1fr"}}),w=l("div",{d:"grid",gridTemplateColumns:"4fr 1fr",gap:"2px",w:"100%",span:{padding:"10px",bg:"rgba(255, 255, 255, 0.06)",color:"$white500",fs:"16px",fw:"$bold",ff:"$heading",w:"100%"},"@sm":{span:{fs:"12px"}}}),ke=l("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",mb:"25px",">div":{d:"flex",align:"flex-start",justify:"flex-start",w:"100%",button:{w:"100%",maxW:"440px"}}}),$e=l("div",{d:"flex",direction:"column",w:"100%",">button":{h:"55px",w:"100%",maxW:"340px",padding:"0px",div:{fs:"16px",br:"10px"}}}),Fe=l("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"20px",mt:"25px",w:"100%"}),O=l("div",{d:"flex",direction:"column",gap:"6px",img:{w:"220px",h:"325px"},">button":{h:"35px",w:"100%",minW:"100%",br:"10px",padding:"0px",div:{fs:"16px",br:"10px"}},"@sm":{w:"46%",img:{w:"100%",h:"auto"}}}),We=le({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Y=l("div",{d:"flex",w:"200px",h:"330px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${We} 1.2s ease-in-out infinite`,"@sm":{h:"230px",w:"46%"}});async function Ae(j,T){const{executeTransaction:u}=je(),n=Ue(j,T);return!!await u(n)}function Ue(j,T){return{actions:[{account:ce.MEMBERS_MC,name:"addfavtools",authorization:[{actor:j.name,permission:j.authorization.permission}],data:{wallet:j.name,asset_ids:T}}]}}const mt=()=>{var A,U,E;const j=pe(),{data:T}=be(),{data:u}=we(),{data:n,isLoading:$}=fe(),{data:L,isLoading:K}=ge("tool.worlds",!0,!0),{data:s}=ue(),{data:b}=he(),d=S(e=>e.user),[f,g]=p.useState(!1),[V,J]=p.useState(v.find(e=>e.value===(d==null?void 0:d.miningType))??v[1]),m=p.useMemo(()=>b==null?void 0:b.find(e=>e.landtype_id===(s==null?void 0:s.cardid)),[b,s==null?void 0:s.cardid]),i=p.useMemo(()=>{var o,a,r,c,h,I;return[((a=(o=n==null?void 0:n.userTools)==null?void 0:o[0])==null?void 0:a.cooldown_seconds)??0,((c=(r=n==null?void 0:n.userTools)==null?void 0:r[1])==null?void 0:c.cooldown_seconds)??0,((I=(h=n==null?void 0:n.userTools)==null?void 0:h[2])==null?void 0:I.cooldown_seconds)??0].toSorted((ie,de)=>de-ie)},[n==null?void 0:n.userTools]),x=p.useCallback(()=>{const e=(m==null?void 0:m.cooldown_mod)??0;return!(i!=null&&i[0])||!i?0:!(i!=null&&i[1])&&!(i!=null&&i[2])?i[0]*(e/10):i!=null&&i[2]?(i[0]+i[1])*(e/10):(i[0]+i[1]/2)*(e/10)},[i,m]),B=p.useMemo(()=>((n==null?void 0:n.userTools)||[]).reduce((o,a)=>{const r=a==null?void 0:a.rarity;return o[r]?{...o,[r]:o[r]+(Number(a==null?void 0:a.mining_power)??0)}:{...o,[r]:(a==null?void 0:a.mining_power)??0}},{}),[n==null?void 0:n.userTools]),F=p.useCallback(()=>Object.keys(B).map(e=>{const o=B[e]*((m==null?void 0:m.mining_power_mod)??0)/1e4;return{rarity:e,percentage:(o>=.8?.8:o)*100}}).filter(e=>e.percentage>0),[B,m]),P=p.useCallback(()=>F().reduce((o,a)=>{var c;const r=a.percentage/100*(((c=u==null?void 0:u.pool_buckets.find(h=>(h==null?void 0:h.key)===a.rarity))==null?void 0:c.formattedValue)??0);return o+r},0),[F,u==null?void 0:u.pool_buckets]),N=p.useCallback(()=>{var o;return(((o=n==null?void 0:n.userTools)==null?void 0:o.reduce((a,r)=>a+(r==null?void 0:r.nft_power),0))??0)*((m==null?void 0:m.nft_power_mod)??0)/100},[m,n==null?void 0:n.userTools]),M=p.useMemo(()=>x()/60,[x]),X=p.useMemo(()=>P()/(x()>=0?x():1)*3600,[P,x]),Z=p.useMemo(()=>N()/(x()>=0?x():1)*3600,[N,x]),ee=p.useMemo(()=>3600/(x()>=0?x():1),[x]);function W(e){xe.setState({selectedPage:e})}async function te(){if(!(!(s!=null&&s.current_land)||!d)){g(!0);try{if(await Te(d,s==null?void 0:s.current_land)){await _(1e3);const o=await R(d==null?void 0:d.name);S.setState(a=>({...a,user:a.user?{...a.user,...o}:null})),await D(),C.success("Current Land added to favorites")}}catch(e){console.error(e)}finally{g(!1)}}}async function ne(){var e,o;if(!(!(n!=null&&n.userTools)||!d)){g(!0);try{if(await Ae(d,(o=(e=n==null?void 0:n.userTools)==null?void 0:e.map(({asset_id:r})=>r))==null?void 0:o.join(","))){await _(1e3);const r=await R(d==null?void 0:d.name);S.setState(c=>({...c,user:c.user?{...c.user,...r}:null})),await D(),C.success("Current Tools added to favorites")}}catch(a){console.error(a)}finally{g(!1)}}}async function se(e){var o;if(!(!(n!=null&&n.userTools)||!d)){g(!0);try{const a=(o=n==null?void 0:n.userTools)==null?void 0:o.map(({asset_id:c})=>Number(c));await H(d,[...a,Number(e.asset_id)])&&(await _(1e3),await q(),await z("tool.worlds"),C.success("Tool added to current setup"))}catch(a){console.error(a)}finally{g(!1)}}}async function oe(e){var o;if(!(!(n!=null&&n.userTools)||!d)){g(!0);try{const a=(o=n==null?void 0:n.userTools)==null?void 0:o.filter(({asset_id:c})=>c!==e.asset_id).map(({asset_id:c})=>Number(c));await H(d,a)&&(await _(1e3),await q(),await z("tool.worlds"),C.success("Tool removed from current setup"))}catch(a){console.error(a)}finally{g(!1)}}}function ae(e){S.setState(o=>({...o,user:o.user?{...o.user,miningType:(e==null?void 0:e.value)??"gold"}:null})),J(e??v[1]),localStorage.setItem("miningType",(e==null?void 0:e.value)??"gold")}const re=()=>{var e,o,a;return((s==null?void 0:s.commission)??0)/100===0?(((a=(o=(e=T==null?void 0:T[(s==null?void 0:s.planetName.toLowerCase())||""])==null?void 0:e.find(({key:h})=>h==="min_commission"))==null?void 0:o.value)==null?void 0:a[1])||0)/100:((s==null?void 0:s.commission)??0)/100};return t.jsxs(Se,{children:[t.jsxs(Ce,{children:[t.jsx(y,{color:"solidBlue",onClick:()=>W("selection"),children:"Land Selection"}),t.jsx(y,{color:"solidBlue",onClick:()=>W("favorites"),children:"Favorites"}),t.jsx(y,{color:"solidBlue",onClick:()=>j("/tool-tactician"),children:"Tools Tactician"})]}),t.jsxs(_e,{children:[t.jsx(k,{children:"Current Selection"}),t.jsxs(ve,{children:[t.jsxs(Le,{children:[t.jsx(ye,{disabled:!(s!=null&&s.x)||!(s!=null&&s.y),delayDuration:10,text:`x: ${s==null?void 0:s.x}, y: ${s==null?void 0:s.y}`,children:t.jsx(Be,{src:`/assets/planets/${s==null?void 0:s.planetName.toLowerCase()}.png`,alt:s==null?void 0:s.planetName,title:s==null?void 0:s.planetName})}),t.jsx(Pe,{src:`/assets/lands/${s==null?void 0:s.landName}.webp`,alt:s==null?void 0:s.landName,title:s==null?void 0:s.landName}),t.jsx(y,{noBorder:!0,isLoading:f,disabled:f,color:"gradientYellow",onClick:te,children:"Add to favorites"})]}),t.jsxs(Ne,{children:[t.jsxs(G,{children:[t.jsxs(w,{children:[t.jsx("span",{children:"Cooldown"}),t.jsxs("span",{children:[Math.round(M)," min"]})]}),t.jsxs(w,{children:[t.jsx("span",{children:"Mines per hour"}),t.jsx("span",{children:ee.toLocaleString("US-en")})]}),t.jsxs(w,{children:[t.jsx("span",{children:"Shards per mine"}),t.jsx("span",{children:N().toLocaleString("US-en")})]}),t.jsxs(w,{children:[t.jsx("span",{children:"Shards per hour"}),t.jsx("span",{children:Z.toLocaleString("US-en")})]})]}),t.jsxs(G,{children:[t.jsxs(w,{children:[t.jsx("span",{children:"Estimated average TLM per mine"}),t.jsx("span",{children:P().toLocaleString("US-en")})]}),t.jsxs(w,{children:[t.jsx("span",{children:"Estimated average TLM per hour"}),t.jsx("span",{children:X.toLocaleString("US-en")})]}),t.jsxs(w,{children:[t.jsx("span",{children:"Commission"}),t.jsxs("span",{children:[re()," %"]})]}),t.jsxs(w,{children:[t.jsx("span",{}),t.jsx("span",{})]})]})]})]}),t.jsxs(ke,{children:[t.jsx(k,{children:"Mine Button"}),t.jsx(me,{borderColor1:"#FFB31F",borderColor2:"#FFB800",className:"select",title:"",selected:V,options:v,onSelected:ae})]}),t.jsxs($e,{children:[t.jsx(k,{children:"Tools"}),t.jsx(y,{noBorder:!0,color:"gradientYellow",onClick:ne,isLoading:f,disabled:f,children:"Add current setup to favorites"}),t.jsxs(Fe,{children:[$?Array.from({length:3}).map((e,o)=>t.jsx(Y,{},o)):(U=(A=n==null?void 0:n.userTools)==null?void 0:A.sort((e,o)=>Q[e.rarity]-Q[o.rarity]||e.delay-o.delay||e.toolname.localeCompare(o.toolname)))==null?void 0:U.map(e=>t.jsxs(O,{children:[t.jsx("img",{loading:"lazy",src:`/assets/aw-nft-images/${e.template_id}.webp`,alt:e.name,title:e.name}),t.jsx(y,{isLoading:f,disabled:f,onClick:()=>oe(e),noBorder:!0,children:"Unequip"})]},e.asset_id)),K?Array.from({length:7}).map((e,o)=>t.jsx(Y,{},o)):(E=L==null?void 0:L.filter(e=>{var o;return!((o=n==null?void 0:n.userTools)!=null&&o.some(({asset_id:a})=>a===e.asset_id))}))==null?void 0:E.map(e=>{var o;return t.jsxs(O,{children:[t.jsx("img",{src:`/assets/aw-nft-images/${e.template.template_id}.webp`,alt:e.data.name,title:e.data.name}),t.jsx(y,{isLoading:f,disabled:f||((o=n==null?void 0:n.userTools)==null?void 0:o.length)===3,onClick:()=>se(e),noBorder:!0,color:"solidBlue",children:"Equip"})]},e.asset_id)})]})]})]})]})};export{mt as default};
