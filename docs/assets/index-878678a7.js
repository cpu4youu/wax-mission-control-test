import{s as o,e as R,Y as k,h as E,X as M,S as p,u as B,V as z,W as Q,b as P,R as d,aw as v,j as a,B as $,av as V,a7 as W,q,Q as U,U as Y,k as G}from"./index-e68d1b8a.js";import{S as H}from"./index-9896a75c.js";import{u as K,C as X}from"./toolov-query-b25fab58.js";import{P as J}from"./pickaxe-a06114de.js";import{u as Z,o as tt}from"./inventory-query-7be4630f.js";import"./index.esm-c0d525fb.js";import"./index-27a0ecdf.js";import"./index-2b4adbca.js";import"./index-8fdde984.js";import"./gradient-border-06aeb2ac.js";const et=o("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),at=o("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),nt=o("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading",span:{color:"#E52251",fw:"$bold",fs:"20px"},"@sm":{flexWrap:"wrap",span:{fs:"16px"}}}),st=o("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),it=o("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),ot=o("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),C=o("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),L=o("p",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"14px",ff:"$heading",fw:"400"}),rt=R({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),ct=o("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${rt} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}});async function lt({user:t,assets_ids:c,land_asset_id:s,next_tool:l,old_bag_assets_ids:i}){const{executeTransaction:u}=B(),f=await k(l);if(!f)return!1;const x=dt(t,c,s,f,i);if(!await u(x,{broadcast:!0,sign:!0}))return!1;await E(500);const m=M.getState().updateNonce;return m(void 0),!0}function dt(t,c,s,l,i){return{actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:"cpu.mc",permission:"cosign"}],data:{wallet:t.name,type:2}},{account:p.M__FEDERATION,name:"setland",authorization:[{actor:t.name,permission:"active"}],data:{account:t.name,land_id:s}},{account:p.TOOLS_MC,name:"renttools",authorization:[{actor:t.name,permission:"active"}],data:{wallet:t.name,tools:c}},{account:p.M__FEDERATION,name:"setbag",authorization:[{actor:t.name,permission:t.requestPermission}],data:{account:t.name,items:c}},{account:p.M__FEDERATION,name:"mine",authorization:[{actor:t.name,permission:"active"}],data:{miner:t.name,nonce:l,notify:"notify.mc"}},{account:"atomicassets",name:"transfer",authorization:[{actor:t.name,permission:t.requestPermission}],data:{from:t.name,memo:"staking",to:"tools.mc",asset_ids:c}},{account:p.M__FEDERATION,name:"setbag",authorization:[{actor:t.name,permission:t.requestPermission}],data:{account:t.name,items:i}}]}}const g=[{label:"Sort by rarity",value:"rarity"}],bt=()=>{const{data:t,isLoading:c}=Z("tool.worlds"),{data:s}=K(),{data:l}=z(),{data:i}=Q(),u=P(e=>e.user),f=M(e=>e.updateIsCalculating),[x,_]=d.useState([]),[m,A]=d.useState([]),[y,w]=d.useState(!1),[j,N]=d.useState(g[0]);async function D(e){var n;if(u){w(!0);try{await W(),f(!0),await E(500);const[[r,F]]=q.getQueriesData(U.LANDS),b=(n=F.highestValue)==null?void 0:n.asset_id,S=(l==null?void 0:l.current_land)===b?void 0:b,{getAssetByAssetId:I}=Y,O=await I(String(e.next_asset_id)),T=i==null?void 0:i.allData.find(h=>h.template_id===Number(O.template.template_id));if(!S||!(i!=null&&i.userTools)||!T)return;await lt({user:u,next_tool:[T],assets_ids:[e.next_asset_id],land_asset_id:S,old_bag_assets_ids:i.userTools.map(h=>Number(h.asset_id))})&&(await tt("tool.worlds"),G.success("Tool staked"))}catch(r){console.error("Error staking tool",r)}finally{w(!1)}}}return d.useEffect(()=>{if(t){const e=t.filter(n=>s==null?void 0:s.some(r=>r.template_id===Number(n.template.template_id))).map(n=>({asset_id:n.asset_id,...n.data,...s==null?void 0:s.find(r=>r.template_id===Number(n.template.template_id))}));_(e)}},[s,t]),d.useEffect(()=>{if(j.value==="rarity"){const e=x.sort((n,r)=>v[n.rarity]-v[r.rarity]);A(e)}},[x,j.value]),a.jsxs(et,{children:[a.jsx(at,{children:"LOAN TOOLS"}),a.jsxs(nt,{children:["Deposited TLM: ",a.jsx("span",{children:"-2.3211 TLM (Deposit more TLM)"})]}),a.jsx(H,{title:"",selected:g[0],onSelected:e=>N(e||g[0]),options:g,borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),a.jsx(st,{children:c?new Array(6).fill(0).map((e,n)=>a.jsx(ct,{},n)):m==null?void 0:m.map((e,n)=>a.jsx(X,{tool:e,children:a.jsxs(it,{children:[a.jsx($,{disabled:y,isLoading:y,onClick:()=>D(e),rounded:!1,color:"solidBlue",children:"Mine"}),a.jsxs(ot,{children:[a.jsxs(C,{children:[a.jsx(J,{}),a.jsx(L,{children:e.mining_power})]}),a.jsxs(C,{children:[a.jsx(V,{}),a.jsx(L,{children:e.pow})]})]})]})},n))})]})};export{bt as default};
