import{s as l,e as de,S as J,u as K,W as ue,V as pe,U as fe,b as S,P as j,f as x,m as b,Z as xe,_ as me,$ as he,a1 as M,a3 as E,a2 as B,d as V,j as s,v as G,B as v,w as ge,l as we,L as H,n as y,a0 as Q}from"./index-c286d439.js";import{u as be}from"./index-7d3a673f.js";import{a as ve}from"./index.esm-50780120.js";import{S as je}from"./shards-753a9f49.js";import{u as ye,o as Y,e as Le}from"./execute-equip-tools-contract-3ec5cb53.js";import{o as Te}from"./inventory-query-b778a205.js";import{e as Ce}from"./execute-equip-land-contract-ec282dd5.js";const Se=l("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",w:"100%",maxW:"1190px",padding:"0 10px",">svg":{mr:"auto",mt:"20px",cursor:"pointer"}}),O=l("h3",{d:"flex",justify:"space-between",w:"100%",mr:"auto",mt:"25px",gap:"10px",fs:"29px",fw:"$bold",ff:"$heading",color:"$white500",">button":{h:"25px",div:{fs:"16px",border:"none",br:"10px"}},"@sm":{fs:"18px",flexWrap:"wrap",span:{w:"100%"}}}),Z=l("h4",{w:"100%",textAlign:"center",fs:"22px",fw:"$normal",ff:"$heading",color:"$white500","@sm":{fs:"18px"}}),Me=l("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"20px",mt:"30px",mb:"30px",w:"100%","@sm":{justify:"center"}}),Ee=l("div",{d:"flex",align:"center",justify:"center",w:"100%",variants:{isSelected:{true:{">div:last-child":{border:"3px solid #00BAFF"}}}},"@sm":{flexWrap:"wrap",justify:"center"}}),ke=l("div",{d:"flex",align:"center",justify:"flex-start",gap:"6px",w:"100%",maxW:"260px"}),Fe=l("div",{w:"82px",h:"82px",border:"3px solid $black500",overflow:"hidden",br:"5px",">img":{w:"82px",h:"82px",objectFit:"cover",objectPosition:"center 3px",scale:"1.9"},variants:{rarity:{Abundant:{borderColor:"#4c4c4c"},Common:{borderColor:"#000000"},Rare:{borderColor:"#3d74e9"},Epic:{borderColor:"#8719f0"},Legendary:{borderColor:"#da992e"},Mythical:{borderColor:"#d20066"}}}}),We=l("div",{d:"flex",align:"center",justify:"space-between",br:"8px",padding:"20px",bg:"rgba(255, 255, 255, 0.06)",w:"100%",">button":{h:"25px",br:"10px","&:first-child":{minW:"140px"},div:{fs:"16px",border:"none",br:"10px"}},"@sm":{mt:"10px",padding:"10px",flexWrap:"wrap",justify:"center",gap:"5px",">button":{w:"100%",maxW:"100%",minW:"100%"}}}),Re=l("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",margin:"auto",w:"100%","@md":{d:"flex",padding:"0 20px",flexWrap:"wrap"},"@sm":{align:"center",padding:"0px"}}),Ie=l("div",{d:"flex",align:"center",justify:"space-between",flexWrap:"wrap",gap:"50px",mt:"35px",w:"100%","@md":{d:"flex",justify:"center",padding:"0 20px"},"@sm":{padding:"0 10px"}}),_e=l("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",position:"relative",maxW:"250px",">button":{h:"40px",minH:"40px",minW:"100%",br:"10px",">div":{fs:"14px",border:"none",br:"10px"}},">div:nth-child(3)":{mt:"3px"},"@sm":{w:"100%",maxW:"unset"}}),$e=l("div",{d:"flex",align:"center",justify:"center",overflow:"hidden",h:"140px",w:"100%",borderRadius:"8px",border:"3px solid rgba(255, 255, 255, 0.06)",">img":{objectFit:"cover",h:"140px",w:"100%"},"@sm":{w:"100%",">img:nth-child(2)":{objectFit:"cover",h:"140px",w:"100%"}}}),k=l("div",{d:"flex",span:{d:"flex",align:"center",justify:"center",gap:"7px",fs:"16px",ff:"$body",color:"$white500","&:nth-child(2)":{ml:"7px"},svg:{w:"20px",h:"20px"}}}),Ae=l("img",{w:"82px",h:"82px",position:"absolute",left:"-30px",top:"-30px",zIndex:1,"@sm":{left:"-15px",top:"-20px"}}),Pe=l("div",{d:"flex",align:"center",justify:"center",direction:"row",mb:"5px",w:"100%",">button":{h:"25px",minH:"40px",minW:"unset",w:"100%",div:{fs:"16px",border:"none",br:"10px"}},"@sm":{w:"100%",">button":{w:"100%",maxW:"unset",minW:"unset"}}}),X=de({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Ne=l("div",{d:"flex",w:"100%",h:"90px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${X} 1.2s ease-in-out infinite`,"@sm":{h:"215px",w:"100%"}}),qe=l("div",{d:"flex",w:"250px",h:"280px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${X} 1.2s ease-in-out infinite`,"@sm":{w:"100%",h:"275px"}});async function Ue(a,u){const{executeTransaction:t}=K(),d=ze(a,u);return!!await t(d)}function ze(a,u){return{actions:[{account:J.MEMBERS_MC,name:"remfavtools",authorization:[{actor:a.name,permission:a.requestPermission}],data:{wallet:a.name,asset_ids:u}}]}}async function Be(a,u){const{executeTransaction:t}=K(),d=Ve(a,u);return!!await t(d)}function Ve(a,u){return{actions:[{account:J.MEMBERS_MC,name:"remfavland",authorization:[{actor:a.name,permission:a.requestPermission}],data:{wallet:a.name,asset_id:u}}]}}const Ke=()=>{var I,_;const{data:a,isLoading:u}=ye(),{data:t}=ue(),{data:d}=pe(),{data:m}=fe(),o=S(e=>e.user),h=j(e=>e.nonce),D=j(e=>e.updateHashExpire),F=j(e=>e.isCalculating),W=j(e=>e.updateIsCalculating),[p,f]=x.useState(!1),[,L]=x.useState(!1),ee=x.useCallback(e=>{var r;return(((r=t==null?void 0:t.userTools)==null?void 0:r.reduce((i,c)=>i+(c==null?void 0:c.nft_power),0))??0)*(e/10)},[t==null?void 0:t.userTools]);function ne(){be.setState({selectedPage:"main"})}const R=(I=a==null?void 0:a.favoriteTools)==null?void 0:I.findIndex(e=>e.every(n=>{var r;return(r=t==null?void 0:t.userTools)==null?void 0:r.some(i=>i.asset_id===n.assetId)}));async function se(e){if(o){f(!0);try{const n=e.map(({assetId:i})=>i).join(",");if(await Be(o,n)){await b(1e3);const i=await H(o==null?void 0:o.name);S.setState(c=>({...c,user:c.user?{...c.user,...i}:null})),await Y(),y.success("Land removed from favorites")}}catch(n){console.error(n)}finally{f(!1)}}}async function te(e){if(o){f(!0);try{const n=e.map(({assetId:i})=>i).join(",");if(await Ue(o,n)){await b(1e3);const i=await H(o==null?void 0:o.name);S.setState(c=>({...c,user:c.user?{...c.user,...i}:null})),await Y(),y.success("Current Land removed from favorites")}}catch(n){console.error(n)}finally{f(!1)}}}async function ae(e){if(!(!(t!=null&&t.userTools)||!o)){f(!0);try{const n=e==null?void 0:e.map(({assetId:i})=>Number(i));await Le(o,n)&&(await b(1e3),await Q(),await Te("tool.worlds"),y.success("Tools added to current setup"))}catch(n){console.error(n)}finally{f(!1)}}}async function re(e){if(o){f(!0);try{await Ce(o,e)&&(await b(1e3),await M(),y.success("Land added to current setup"))}catch(n){console.error(n)}finally{f(!1)}}}async function ie(){await Q(),await M()}const oe=x.useCallback(e=>{var i;const n=m==null?void 0:m.find(c=>c.landtype_id===e);return(((i=t==null?void 0:t.userTools)==null?void 0:i.reduce((c,g)=>c+(g==null?void 0:g.nft_power),0))??0)*((n==null?void 0:n.nft_power_mod)??0)/100},[t==null?void 0:t.userTools,m]),ce=x.useCallback(async e=>{f(!0);try{if(W(!0),await b(500),!o)return null;if(!(h!=null&&h.rand_str)){await xe();const i=new Date;D(i.setMinutes(i.getMinutes()+1))}const n=(d==null?void 0:d.current_land)===e?void 0:e;await me(o,n)&&(await he(o==null?void 0:o.name),await ie(),await M())}catch(n){console.log(n)}finally{W(!1),f(!1)}},[o,d,h==null?void 0:h.rand_str]),T=x.useCallback(e=>{var c,g,$,A,P,N,q,U,z;const n=(e??0)/10;if(((c=t==null?void 0:t.userTools)==null?void 0:c.length)===1){const w=n*((($=(g=t==null?void 0:t.userTools)==null?void 0:g[0])==null?void 0:$.delay)??0);return E(w,t,d)}const r=(A=t==null?void 0:t.userTools)==null?void 0:A.sort((w,le)=>le.delay-w.delay);if(((P=t==null?void 0:t.userTools)==null?void 0:P.length)===2){const w=n*((((N=r==null?void 0:r[0])==null?void 0:N.delay)??0)+(((q=r==null?void 0:r[1])==null?void 0:q.delay)??0)/2);return E(w,t,d)}const i=n*((((U=r==null?void 0:r[0])==null?void 0:U.delay)??0)+(((z=r==null?void 0:r[1])==null?void 0:z.delay)??0));return E(i,t,d)},[t,d]),C=x.useCallback(e=>B(V(T(e))),[T]);return x.useEffect(()=>{const e=setInterval(()=>{a!=null&&a.favoriteLands.every(n=>B(V(T(n[0].delay)))==="MINE")?(L(n=>!n),clearInterval(e)):L(n=>!n)},1e3);return L(n=>!n),()=>clearInterval(e)},[a==null?void 0:a.favoriteLands,d]),s.jsxs(Se,{children:[s.jsx(ve,{size:30,color:"#fff",onClick:ne}),s.jsxs(O,{children:["Tool Favorites (",a==null?void 0:a.favoriteTools.length,"/3)"]}),s.jsx(Me,{children:u?Array.from({length:3}).map((e,n)=>s.jsx(Ne,{},n)):(a==null?void 0:a.favoriteTools.length)===0?s.jsx(Z,{children:s.jsx("span",{children:"You don't have any favorite tool"})}):(_=a==null?void 0:a.favoriteTools)==null?void 0:_.map((e,n)=>s.jsxs(Ee,{isSelected:R===n,children:[s.jsx(ke,{children:e.map(r=>s.jsx(Fe,{rarity:r.rarity,title:r.name,children:s.jsx("img",{src:`https://ipfs.alienworlds.io/ipfs/${r.img}`,alt:r.name})},G()))}),s.jsxs(We,{children:[s.jsx(v,{noBorder:!0,color:"eleventh",disabled:R===n||p,isLoading:p,onClick:()=>ae(e),children:"Equip"}),s.jsx(v,{disabled:p,isLoading:p,onClick:()=>te(e),noBorder:!0,children:"Remove from favorites"})]})]},G()))}),s.jsxs(Re,{children:[s.jsx(O,{children:s.jsxs("span",{children:["Land Favorites (",a==null?void 0:a.favoriteLands.length,"/20)"]})}),s.jsx(Ie,{children:u?Array.from({length:8}).map((e,n)=>s.jsx(qe,{},n)):(a==null?void 0:a.favoriteLands.length)===0?s.jsx(Z,{children:s.jsx("span",{children:"You don't have any favorite land"})}):a==null?void 0:a.favoriteLands.flatMap(e=>s.jsxs(_e,{children:[s.jsx(Ae,{src:`/assets/planets/${e[0].planetName.toLowerCase()}.png`,alt:e[0].planetName,title:e[0].planetName}),s.jsx($e,{children:s.jsx("img",{src:`/assets/lands/${e[0].landName}.webp`,alt:e[0].landName,title:e[0].landName})}),s.jsxs(k,{children:[s.jsx("span",{children:"Estimated TLM:"}),s.jsxs("span",{children:[e[0].estimated_tlm.estimated_tlm.toFixed(4)," ",s.jsx(ge,{})]})]}),s.jsxs(k,{children:[s.jsx("span",{children:"Estimated shards:"}),s.jsxs("span",{children:[oe(e[0].cardid)," ",s.jsx(je,{})]})]}),s.jsxs(k,{children:[s.jsx("span",{children:"Estimated MCP:"}),s.jsxs("span",{children:[ee(e[0].luck).toLocaleString("US-en")," ",s.jsx(we,{})]})]}),s.jsxs(Pe,{children:[s.jsx(v,{isLoading:p,disabled:p,onClick:()=>re(e[0].assetId),color:"eleventh",children:"Select"}),s.jsx(v,{color:"eleventh",isLoading:p||F,disabled:p||F||C(e[0].delay)!=="MINE",onClick:()=>ce(e[0].assetId),children:C(e[0].delay)==="MINE"?"Mine":C(e[0].delay)})]}),s.jsx(v,{isLoading:p,disabled:p,onClick:()=>se(e),noBorder:!0,children:"Remove from favorites"})]},e[0].assetId))})]})]})};export{Ke as default};
