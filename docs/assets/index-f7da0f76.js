import{S as R,s as c,R as M,_ as O,r as g,d as P,b as C,c as h,n as w,j as o,B as b,o as T,E as A,m as $}from"./index-d7e59bbb.js";import{A as B}from"./index.esm-d4be0ef4.js";import{d as D}from"./use-transaction-4bec9fef.js";import{t as S}from"./user-miners-query-204cffef.js";import{s as I}from"./sleep-da79c358.js";import{i as N}from"./index-2b34be94.js";import{i as L}from"./index-92f9256f.js";import"./iconBase-e91f5b6e.js";import"./axios-45629df5.js";async function y(s,n,r){const{executeTransaction:e}=D(),p=F(n,r,s);return!!await e(p)}function F(s,n,r){return{actions:[{account:R.MISSION_CONTROL,name:"claimweek",authorization:[{actor:r.name,permission:r.authorization.permission}],data:{wallet:r.name,week_id:n,boost_percentage:s}}]}}async function U(s,n){const{executeTransaction:r}=D(),e=V(n,s);return!!await r(e)}function V(s,n){return{actions:[{account:R.MISSION_CONTROL,name:"claimweektlm",authorization:[{actor:n.name,permission:n.authorization.permission}],data:{wallet:n.name,week_id:s}}]}}const q=c("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",zIndex:"12",w:"100%",maxW:"1190px"}),G=c("h2",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",fs:"40px",w:"100%",mt:"60px","@sm":{fs:"26px"}}),Q=c("div",{d:"flex",align:"center",justify:"center",padding:"5px 20px 5px 10px",border:"1px solid rgba(0, 0, 0, 0.4)",br:"13px",bg:"$blue100",w:"100%",h:"85px",mt:"60px",svg:{color:"$white500",w:"25px",h:"25px",mr:"auto"},"@sm":{d:"none"}}),J=c("span",{w:"100%",color:"$white500",textAlign:"center",fs:"16px",fw:"$bold",ff:"$heading","@lg":{fs:"12px"},"@md":{fs:"10px"},"@sm":{}}),K=c("div",{d:"flex",align:"center",justify:"space-between",gap:"20px",w:"100%",mt:"30px","@md":{direction:"column",padding:"0 20px"}}),X=c("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",w:"100%",mt:"auto",">p":{color:"$white500",textAlign:"center",fs:"16px",fw:"$bold",ff:"$heading"},">button":{maxW:"200px",minW:"200px",minH:"40px",maxH:"40px",div:{gap:"5px",fs:"20px",minH:"40px",maxH:"40px"}},"@md":{direction:"column",padding:"0 20px"}}),Y=c("div",{d:"flex",align:"center",justify:"center",direction:"column",maxW:"255px",h:"386px",padding:"15px",br:"18px",bg:"rgb(3 16 32 / 70%)",">button":{mt:"auto",maxW:"200px",minW:"200px",opacity:"1 !important",minH:"40px",maxH:"40px",div:{gap:"5px",fs:"20px",minH:"40px",maxH:"40px"}},variants:{order:{0:{order:3,"@md":{order:0}},1:{order:2,"@md":{order:1}},2:{order:1,"@md":{order:2}},3:{order:0,"@md":{order:3}}}},"@md":{h:"auto",w:"100%",maxW:"100%"}}),Z=c("h4",{d:"flex",align:"center",justify:"center",color:"$white500",textTransform:"uppercase",fs:"24px",mb:"50px",w:"100%"}),W=c("span",{d:"flex",align:"center",justify:"center",color:"$white500",textAlign:"center",ff:"$heading",fs:"18px",mb:"10px",w:"100%","@md":{mb:"20px"}}),k=c("span",{textAlign:"center",ff:"$heading",fw:"$bold",fs:"18px",color:"$white500",mb:"auto",w:"100%",span:{color:"#F6A800"},"@md":{mb:"20px"}}),tt=M.lazy(()=>O(()=>import("./star-77678afd.js"),["assets/star-77678afd.js","assets/index-d7e59bbb.js","assets/index-55fec1ff.css"])),v=M.lazy(()=>O(()=>import("./tlm-63830b4c.js"),["assets/tlm-63830b4c.js","assets/index-d7e59bbb.js","assets/index-55fec1ff.css"])),lt=()=>{const s=g.useContext(P.UALContext),n=C(t=>t.user),r=C(t=>t.updateAuth),e=h(t=>t.settings),p=h(t=>t.weeklies),x=h(t=>t.currentWeek),l=h(t=>t.claimWeeks),j=h(t=>t.updateClaimWeeks),[f,m]=g.useState(!1),u=g.useMemo(()=>{const t=p==null?void 0:p.filter(i=>i.total_quest_points_user_week>0&&N(w,new Date(i==null?void 0:i.expiresDate))&&L(w,new Date((i==null?void 0:i.end_date)??"")));return[0,1,2,3].map(i=>({week_id:((x==null?void 0:x.week_id)??0)-(i+1),isAfter:!0,userTLM:0})).map(i=>{const a=t.find(({week_id:_})=>i.week_id===_);if(a){const _=((a==null?void 0:a.initial_prize_pool_formatted)??0)*((a==null?void 0:a.total_quest_points)??1)/((a==null?void 0:a.total_quest_points_week)??1);if(!(l==null?void 0:l.find(H=>H===`${a==null?void 0:a.week_id}`)))return{...a,userTLM:_,isAfter:L(w,(a==null?void 0:a.expiresDate)??w)}}return i})},[p,x,l]);async function E(t){if(!n||!((t??0)>=0))return null;m(!0);try{if(!await y(n,0,`${t}`))throw new Error("Purchase error from contract");await I(3e3),await T(),await A(),await r(s),j([...l,`${t}`]),m(!1),$.success("Claim successfully!",S)}catch(d){console.log(d),m(!1)}}async function z(t){if(!n||!((t??0)>=0))return null;m(!0);try{if(!await U(n,`${t}`))throw new Error("Purchase error from contract");await I(3e3),await T(),await A(),await r(s),j([...l,`${t}`]),m(!1),$.success("Claim successfully!",S)}catch(d){console.log(d),m(!1)}}return o.jsxs(q,{children:[o.jsx(G,{children:"Weekly Rewards"}),o.jsxs(Q,{children:[o.jsx(B,{}),o.jsx(J,{children:"Rewards are available for a maximum of 4 weeks. Any unclaimed rewards are returned to Mission Control."})]}),o.jsx(K,{children:u&&u.length>0&&(u==null?void 0:u.map((t,d)=>o.jsxs(Y,{order:d,children:[o.jsxs(Z,{children:["Week ",t.week_id]}),!(t!=null&&t.isAfter)&&o.jsxs(k,{children:["Total reward of the week:"," ",o.jsxs("span",{children:[t.userTLM.toFixed(4)," ",o.jsx(v,{})]})]}),o.jsx(W,{children:t!=null&&t.isAfter?"These rewards were either already claimed by you, or you did not participate in this week.":"To claim your reward, you have two options:"}),t!=null&&t.isAfter?o.jsx(b,{color:"gradientBlack",disabled:!0,isLoading:f,children:"Claimed"}):o.jsxs(X,{children:[o.jsx("p",{children:"CLAIM USING"}),o.jsxs(b,{color:"gradientPink",isLoading:f,disabled:f||((n==null?void 0:n.mcPoints)??0)<((e==null?void 0:e.cost_nftpoints_claim)??0),onClick:()=>E(t==null?void 0:t.week_id),children:[(e==null?void 0:e.cost_nftpoints_claim.toLocaleString("en-US",{maximumFractionDigits:0}))??0," ",o.jsx(tt,{color:"#fff"})]}),o.jsxs(b,{disabled:f,color:"gradientBlue",isLoading:f,onClick:()=>z(t==null?void 0:t.week_id),children:[(t.userTLM/2).toFixed(4)," ",o.jsx(v,{color:"#fff"})]})]})]},t.week_id)))})]})};export{lt as default};
