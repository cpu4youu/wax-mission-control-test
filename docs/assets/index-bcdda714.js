import{s as f,g as h,S as u,T as y,a as D,Q as x,b as d,i as q,n as I,q as E,u as v,R as F,_ as G,K,f as Y,d as V,j as n,B as _,o as k,h as Z,ai as J}from"./index-df6618ff.js";import{I as M}from"./info-builder-800a39cb.js";import{i as b}from"./index-8160c2b0.js";const X=f("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"100%","@sm":{px:"0px"}}),ee=f("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),te=f("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),ne=f("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"20px",w:"100%",maxWidth:"1330px",mt:"40px",px:"15px",bg:"rgba(3, 16, 32,  .55)",br:"22px",padding:"20px 35px","@sm":{padding:"20px"}}),j=f("div",{d:"grid",gridTemplateColumns:"2fr 1fr 2fr",gap:"15px",w:"100%",padding:"10px 40px ",br:"10px",bg:"rgba(255,255,255,0.03)",">div:nth-child(2)":{maxW:"180px"},"@sm":{d:"flex",align:"center",justify:"center",direction:"column",padding:"10px 10px ",maxH:"100%",button:{h:"30px",minW:"100%",maxW:"100%"}}}),C=f("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",color:"$white500",mr:"auto","@sm":{w:"100%",justify:"space-between",direction:"row"}}),S=f("div",{d:"flex",align:"flex-start",justify:"flex-start",ff:"$heading",fs:"14px",w:"100%","@md":{fs:"12px"},"@sm":{fs:"11px",fw:"$bold"}}),L=f("div",{d:"flex",align:"flex-start",justify:"flex-start",ff:"$heading",fs:"24px",w:"100%",svg:{m:"auto 5px",w:"20px",h:"20px"},"@md":{fs:"18px"},"@sm":{justify:"space-between",w:"max-content",fw:"$bold",fs:"12px",svg:{w:"15px",h:"15px"}}}),A=f("div",{d:"flex",align:"center",justify:"center",gap:"10px",padding:"5px 20px 5px 10px",w:"100%",svg:{color:"$white500",w:"25px",h:"25px",mr:"auto"},"@sm":{d:"none"}}),$=f("span",{w:"100%",color:"$white500",textAlign:"center",fs:"14px",ff:"$heading","@lg":{fs:"12px"},"@md":{fs:"10px"},"@sm":{}}),se=async()=>await h({options:{code:u.HQ_MU,index_position:1,limit:"1000",scope:u.HQ_MU,table:y.TLMDROPS}})??null,ae=async e=>await h({options:{code:u.HQ_MU,index_position:3,limit:"1000",key_type:"i64",scope:u.HQ_MU,table:y.TLMBIDS,lower_bound:e,upper_bound:e}})??null,re=()=>D({queryKey:[x.SPECIAL_MINING],queryFn:()=>ie(),staleTime:1e3*60*60*24,enabled:!!d.getState().user});async function oe(){return await E.invalidateQueries(x.SPECIAL_MINING)}async function ie(){const e=d.getState().user;if(!e)return null;try{const t=await ae(e.name),o=await se();return t?t==null?void 0:t.reduce((c,l)=>{const r=o==null?void 0:o.find(w=>w.index===l.pool_index&&q(I,new Date(w.endtime)));if(!r)return c;const m=((l==null?void 0:l.total_bid)??0)/((r==null?void 0:r.total_power)??1),N=(r==null?void 0:r.rewards.replace(" TLM",""))??"1";return c+m*Number(N)},0):0}catch(t){return console.log(t),null}}const ce=async e=>{const t=await h({options:{code:u.M__FEDERATION,index_position:1,limit:"1000",scope:u.M__FEDERATION,table:y.MINERCLAIM,lower_bound:e,upper_bound:e}});return(t==null?void 0:t[0])??null},le=()=>D({queryKey:[x.MINER_CLAIM],queryFn:()=>de(),staleTime:1e3*60*60*24,enabled:!!d.getState().user});async function ue(){return await E.invalidateQueries(x.MINER_CLAIM)}async function de(){const e=d.getState().user;if(!e)return null;try{return await ce(e.name)}catch(t){return console.log(t),null}}const me=async e=>{const t=await h({options:{code:u.M__FEDERATION,index_position:1,limit:"1000",scope:u.M__FEDERATION,table:y.LANDCOMMS,lower_bound:e,upper_bound:e}});return(t==null?void 0:t[0])??null},fe=()=>D({queryKey:[x.LAND_COMMS],queryFn:()=>pe(),staleTime:1e3*60*60*24,enabled:!!d.getState().user});async function xe(){return await E.invalidateQueries(x.LAND_COMMS)}async function pe(){const e=d.getState().user;if(!e)return null;try{return await me(e.name)}catch(t){return console.log(t),null}}const ge=async e=>{const t=await h({options:{code:u.AWLNDRATINGS,index_position:1,limit:"1000",scope:u.AWLNDRATINGS,table:y.PAYOUTS,lower_bound:e,upper_bound:e}});return(t==null?void 0:t[0])??null},he=()=>D({queryKey:[x.PAYOUTS],queryFn:()=>we(),staleTime:1e3*60*60*24,enabled:!!d.getState().user});async function ye(){return await E.invalidateQueries(x.PAYOUTS)}async function we(){const e=d.getState().user;if(!e)return null;try{return await ge(e.name)}catch(t){return console.log(t),null}}async function Te(e){const{executeTransaction:t}=v(),o=_e(e);return!!await t(o)}function _e(e){return{actions:[{account:u.M__FEDERATION,name:"claimmines",authorization:[{actor:e.name,permission:e.requestPermission}],data:{receiver:e.name}}]}}async function Me(e){const{executeTransaction:t}=v(),o=be(e);return!!await t(o)}function be(e){return{actions:[{account:u.M__FEDERATION,name:"claimcomms",authorization:[{actor:e.name,permission:e.requestPermission}],data:{receiver:e.name}}]}}async function je(e){const{executeTransaction:t}=v(),o=Ce(e);return!!await t(o)}function Ce(e){return{actions:[{account:u.AWLNDRATINGS,name:"claimpay",authorization:[{actor:e.name,permission:e.requestPermission}],data:{receiver:e.name}}]}}async function Se(e,t,o){const{executeTransaction:i}=v(),c=Le(t,o,e);return!!await i(c)}function Le(e,t,o){return{actions:t.map(c=>({account:u.MISSION_CONTROL,name:"claimweek",authorization:[{actor:o.name,permission:o.requestPermission}],data:{wallet:o.name,week_id:c,boost_percentage:e}}))}}function O(e){const t=e.getFullYear(),o=e.getMonth()+1>9?e.getMonth()+1:`0${e.getMonth()+1}`,i=e.getDate()>9?e.getDate():`0${e.getDate()}`,c=e.getHours()>9?e.getHours():`0${e.getHours()}`,l=e.getMinutes()>9?e.getMinutes():`0${e.getMinutes()}`,r=e.getSeconds()>9?e.getSeconds():`0${e.getSeconds()}`;return`${t}-${o}-${i}T${c}:${l}:${r}`}const Ae={addTLM:!1,withdrawTLM:!1,claimTLM:!1,claimMines:!1,claimComms:!1,claimPay:!1,weekReward:!1},R=F.lazy(()=>G(()=>import("./tlm-547bf4d0.js"),["assets/tlm-547bf4d0.js","assets/index-df6618ff.js","assets/index-55fec1ff.css"])),De=()=>{const e=d(s=>s.user),t=d(s=>s.updateMember),o=K(s=>s.weeklies);re();const{data:i}=le(),{data:c}=fe(),{data:l}=he(),[r,m]=F.useState(Ae),[N,w]=F.useState(""),P=o==null?void 0:o.reduce((s,a)=>{const p=((a==null?void 0:a.initial_prize_pool_formatted)??0)*((a==null?void 0:a.total_quest_points)??1)/((a==null?void 0:a.total_quest_points_week)??1);return a.week_id&&a.total_quest_points_user_week>0&&b(new Date,new Date(a==null?void 0:a.expiresDate))&&q(new Date,new Date((a==null?void 0:a.end_date)??""))?{total:s.total+p,weeks:[...s.weeks,a.week_id]}:{total:s.total,weeks:[...s.weeks]}},{total:0,weeks:[]});async function Q(){if(e){m({...r,claimMines:!0});try{if(!await Te(e))throw new Error("Claim Mines error from contract");await T()}catch(s){console.log(s)}finally{m({...r,claimMines:!1})}}}async function B(){if(e){m({...r,claimComms:!0});try{if(!await Me(e))throw new Error("Claim Comms error from contract");await T()}catch(s){console.log(s)}finally{m({...r,claimComms:!1})}}}async function U(){if(e){m({...r,claimPay:!0});try{if(!await je(e))throw new Error("Claim Pay error from contract");await T()}catch(s){console.log(s)}finally{m({...r,claimPay:!1})}}}async function H(){if(e){m({...r,weekReward:!1});try{if(!await Se(e,0,P.weeks))throw new Error("Week Reward error from contract");await T(),await k()}catch(s){console.log(s)}finally{m({...r,weekReward:!1})}}}async function T(){if(!(e!=null&&e.name))return null;await Z(500);const s=await J(e==null?void 0:e.name);d.setState(a=>({...a,user:a.user?{...a.user,userTlm:s}:null})),await t(),await oe(),await ue(),await xe(),await ye()}const z=s=>{const a=s.days?`${s.days}d`:"",p=s.hours?`${s.hours}h`:"",W=s.minutes?`${s.minutes}m`:"";return`${a}${p}${W}${s.seconds}s`};Y.useEffect(()=>{const s=setInterval(()=>{const a=new Date(`${O(g)}`),p=V(a),W=z(p);w(W),console.log(p)},1e3);return()=>clearInterval(s)},[]);const g=new Date((i==null?void 0:i.timestamp)||new Date);return n.jsxs(X,{children:[n.jsxs(ee,{children:[n.jsx(te,{children:"The Vault"}),n.jsx("img",{src:"/assets/background/bg-the-vault.webp",alt:""})]}),n.jsxs(ne,{children:[n.jsxs(j,{children:[n.jsxs(C,{children:[n.jsx(S,{children:"Alien Worlds Mining Rewards"}),n.jsxs(L,{children:[(i==null?void 0:i.amount.replace(" TLM",""))??"0.0000"," ",n.jsx(R,{})]})]}),n.jsx(_,{isLoading:r.claimMines,disabled:((i==null?void 0:i.amount)??0)===0||b(I,g),onClick:Q,rounded:!1,color:"solidBlue",children:b(I,g)?N:"Claim"}),n.jsxs(A,{children:[n.jsx(M,{}),n.jsxs($,{children:["Earned by mining in Alien Worlds",b(I,g)&&n.jsxs(n.Fragment,{children:[n.jsx("br",{}),`Available on ${new Date(`${O(g)}.000Z`).toLocaleString()}`]})]})]})]}),n.jsxs(j,{children:[n.jsxs(C,{children:[n.jsx(S,{children:"Alien Worlds Land Commission"}),n.jsxs(L,{children:[(c==null?void 0:c.comms.replace(" TLM",""))??"0.0000"," ",n.jsx(R,{})]})]}),n.jsx(_,{isLoading:r.claimComms,disabled:((c==null?void 0:c.comms)??0)===0,onClick:B,rounded:!1,color:"solidBlue",children:"Claim"}),n.jsxs(A,{children:[n.jsx(M,{}),n.jsx($,{children:"Earned by mining in Alien Worlds"})]})]}),n.jsxs(j,{children:[n.jsxs(C,{children:[n.jsx(S,{children:"Alien Worlds DTAL"}),n.jsxs(L,{children:[(l==null?void 0:l.payoutAmount.replace(" TLM",""))??"0.0000"," ",n.jsx(R,{})]})]}),n.jsx(_,{isLoading:r.claimPay,disabled:((l==null?void 0:l.payoutAmount)??0)===0,onClick:U,rounded:!1,color:"solidBlue",children:"Claim"}),n.jsxs(A,{children:[n.jsx(M,{}),n.jsx($,{children:"Earned daily by owning lands in Alien Worlds"})]})]}),n.jsxs(j,{children:[n.jsxs(C,{children:[n.jsx(S,{children:"Mission Control Weekly Rewards"}),n.jsxs(L,{children:[P.total.toFixed(4)," ",n.jsx(R,{})]})]}),n.jsx(_,{isLoading:r.weekReward,disabled:P.total===0,onClick:H,rounded:!1,color:"solidBlue",children:"Claim"}),n.jsxs(A,{children:[n.jsx(M,{}),n.jsx($,{children:"Earned daily by owning lands in Alien Worlds"})]})]})]})]})};export{De as default};
