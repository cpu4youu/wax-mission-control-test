import{s as c,e as J,R as o,_ as M,b as C,r as S,n as le,j as a,f,B as U,q as we,Q as ge,z as he}from"./index-d022a5fa.js";import{C as xe}from"./index-eca24e9d.js";import{u as ye,r as P,s as V}from"./tools-query-0156f721.js";import{u as _e,f as Te,o as Q,g as Me,e as Le}from"./execute-mine-tool-contract-d8c0652f.js";import{u as be,o as z}from"./user-miners-query-5ab9fa26.js";import{u as R,s as ve}from"./showTlmValueFromMine-691f5ea3.js";import{o as je}from"./lands-query-f60b2fd4.js";import{u as De,o as K}from"./wallets-query-61ecc503.js";import{u as Ce,o as G,g as Se}from"./tool-query-9e5121ea.js";import{u as Re,o as $}from"./miner-claim-a85a5f67.js";import{f as $e,e as Ee,o as Ie,a as Ae,b as Be}from"./format-date-to-iso-a0220e55.js";import{F as ke}from"./index.esm-280560a2.js";import{o as H}from"./toolov-query-fe038d8e.js";import{d as Ne,c as Oe,a as E}from"./mineCooldown-5c7cca0d.js";import{s as Fe}from"./sleep-da79c358.js";import{i as Ue}from"./index-ad69930e.js";import"./adapters-7a249b70.js";import"./axios-45629df5.js";import"./toast-options-f21fe7a5.js";import"./lands-73ee42a9.js";import"./use-transaction-0e3d8672.js";import"./index-0b518af5.js";import"./iconBase-3b27d292.js";import"./index-8471da80.js";const Pe=c("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),Ve=c("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),Qe=J({"100%":{transform:"rotate(360deg)"}}),ze=c("button",{color:"$white500",svg:{ml:"10px",color:"$white500",w:"25px",h:"25px"},variants:{isLoading:{true:{pointerEvents:"none",opacity:"0.5",svg:{animation:`${Qe} 1s linear`,animationIterationCount:"infinite"}},false:{pointerEvents:"all",opacity:"1"}}}}),Ke=c("div",{d:"flex",align:"center",justify:"flex-start",direction:"column",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),Ge=c("div",{d:"flex",align:"center",justify:"flex-start",gap:"5px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),He=c("div",{d:"flex",align:"center",justify:"flex-start",gap:"5px",w:"100%",color:"$white500",ff:"$heading",button:{w:"100%",minH:"30px",minW:"unset",maxW:"140px",">div":{minH:"30px",border:"none"}},"@sm":{flexWrap:"wrap"}}),Y=c("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),Ye=c("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),qe=c("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),Ze=c("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),q=c("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{filter:"drop-shadow(3px 5px 2px rgb(0 0 0 / 0.6))",w:"20px",h:"20px"}}),Z=c("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"2px 1px 4px rgba(0, 0, 0)",fs:"14px",ff:"$heading",fw:"400"}),Je=J({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Xe=c("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${Je} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),We=o.lazy(()=>M(()=>import("./pickaxe-d144ed2f.js"),["assets/pickaxe-d144ed2f.js","assets/index-d022a5fa.js","assets/index-55fec1ff.css"])),et=o.lazy(()=>M(()=>import("./settings-65590880.js"),["assets/settings-65590880.js","assets/index-d022a5fa.js","assets/index-55fec1ff.css"])),tt=o.lazy(()=>M(()=>import("./person-e7609fe3.js"),["assets/person-e7609fe3.js","assets/index-d022a5fa.js","assets/index-55fec1ff.css"])),nt=o.lazy(()=>M(()=>import("./atom-633489e5.js"),["assets/atom-633489e5.js","assets/index-d022a5fa.js","assets/index-55fec1ff.css"])),at=[{label:"Sort by rarity",value:"rarity"}],St=()=>{const{data:u}=_e(),{data:s}=De(),{data:g,isLoading:X,isFetching:W}=be(),{data:L}=ye(),{data:m,isLoading:ee}=Ce(),{data:d}=Re(),i=C(e=>e.user),te=C(e=>e.updateMember),I=R(e=>e.isCalculating),ne=R(e=>e.updateIsCalculating),A=R(e=>e.updateMineButtonLoading),[B,ae]=o.useState([]),[x,re]=o.useState([]),[y,_]=o.useState(!1),[k]=o.useState(at[0]),[,b]=o.useState(!1),[v,ie]=o.useState("");async function se(){await z(),await G(),await K(),await $(),await H(),await Q()}async function oe(e){var t,n;if(!(!i||!u)){_(!0),A(!0);try{await je(),ne(!0);let r=0,p,h=[];if(e.tool_name==="Certified Kol Digger"){const l=u==null?void 0:u.reduce((w,D)=>{const pe=Number(new Date(w.readyat));return Number(new Date(D.readyat))<pe?D:w},u[0]);r=l.asset_ids.length*e.pow,h=l.asset_ids.map(w=>Number(w)),p="1099512958237"}else{const[l]=await Se(`${e.template_id}`);r=l.pow,h=[l.next_asset_id];let w;try{[[,w]]=we.getQueriesData([ge.LANDS,"red",e])}catch{w=await Me(e)}p=(t=w.highestValue)==null?void 0:t.asset_id}await Le({user:i,difficulty:r,assets_ids:h,land_asset_id:p,old_bag_assets_ids:((n=L==null?void 0:L.userTools)==null?void 0:n.map(l=>Number(l.asset_id)))??[]})&&(await ve(i==null?void 0:i.name),await z(),await K(),await $(),await G(),await H(),await Q())}catch(r){console.error("Error on MINE tool",r)}finally{A(!1),_(!1)}}}const T=S.useCallback(e=>{const t=(e.tool_name==="Certified Kol Digger"?500:e.cooldown_seconds)*1.5;return Ne(t,{userTools:[e],allData:[]},g)},[g]),ce=S.useCallback(e=>{const t=Oe(E(T(e))),n=new Date(1e3*((e==null?void 0:e.last_use)??0)),r=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds());return+new Date((g==null?void 0:g.last_mine)??"")>+new Date(r)?{type:"miner",cooldown:t}:{type:"tool",cooldown:t}},[T,g]),N=S.useCallback(async()=>{if(!(m!=null&&m.toolsOv)||!u)return[];const e=await Promise.all(m==null?void 0:m.toolsOv.filter(t=>{var r;const n=t.owned>0&&(t.tool_name==="Certified Kol Digger"?!0:t.allowed===1)&&Te((i==null?void 0:i.total_points)??0,t);return((s==null?void 0:s.tempid_allow_list.length)??0)===0?n:n&&((r=s==null?void 0:s.tempid_allow_list)==null?void 0:r.some(p=>p===t.template_id))}).map(async t=>{if(t.tool_name==="Certified Kol Digger"){const r=u==null?void 0:u.reduce((p,h)=>{const F=Number(new Date(p.readyat));return Number(new Date(h.readyat))<F?h:p},u[0]);return{...t,...r,last_use:+new Date(`${r.readyat}.000Z`)/1e3-r.cooldown_seconds}}const n=m.stakedTools.find(r=>r.template_id===t.template_id);return{...t,...n,last_use:+new Date(`${t.readyat}.000Z`)/1e3-t.cooldown_seconds}}));ae(e)},[m,u,s==null?void 0:s.tempid_allow_list,i==null?void 0:i.total_points]);o.useEffect(()=>{N()},[N]),o.useEffect(()=>{if(k.value==="rarity"){const e=B.sort((t,n)=>P[t.rarity]-P[n.rarity]||V[t.shine]-V[n.shine]);re(e)}},[B,k.value]),o.useEffect(()=>{const e=setInterval(()=>{x.every(t=>O(E(T(t)))==="MINE")?(b(t=>!t),clearInterval(e)):b(t=>!t)},1e3);return b(t=>!t),()=>clearInterval(e)},[x,T]);const de=e=>{if(f(e==null?void 0:e.deposit)===0&&f(e==null?void 0:e.trialtlm)>0)return"red";if(f(e==null?void 0:e.deposit)>=0)return"green"},ue=e=>{if(f(e==null?void 0:e.deposit)===0&&f(e==null?void 0:e.trialtlm)>0)return`- ${f(e==null?void 0:e.trialtlm)}`;if(f(e==null?void 0:e.deposit)>=0)return f(e==null?void 0:e.deposit)};async function fe(){if(!(i!=null&&i.name))return null;await Fe(500);const e=await he(i==null?void 0:i.name);C.setState(t=>({...t,user:t.user?{...t.user,userTlm:e}:null})),await te(),await Ie(),await $(),await Ae(),await Be()}const j=o.useMemo(()=>new Date((d==null?void 0:d.timestamp)||new Date),[d==null?void 0:d.timestamp]);async function me(){if(i){_(!0);try{if(!await Ee(i))throw new Error("Claim Mines error from contract");await fe()}catch(e){console.log(e)}finally{_(!1)}}}const O=e=>{const t=e.days?`${e.days}d`:"",n=e.hours?`${e.hours}h`:"",r=e.minutes?`${e.minutes}m`:"";return`${t}${n}${r}${e.seconds}s`};return o.useEffect(()=>{const e=setInterval(()=>{const t=new Date(`${$e(j)}`),n=E(t),r=O(n);if(ie(r),!Ue(le,j)){clearInterval(e);return}},1e3);return()=>clearInterval(e)},[j]),a.jsxs(Pe,{children:[a.jsxs(Ve,{children:["LOAN TOOLS",a.jsx(ze,{isLoading:X||W,onClick:se,children:a.jsx(ke,{})})]}),a.jsxs(Ke,{children:[a.jsxs(Ge,{children:["Deposited TLM:"," ",a.jsxs(Y,{color:de(s),children:[ue(s)," TLM"," ",f(s==null?void 0:s.deposit)<0&&f(s==null?void 0:s.trialtlm)>0&&"(Deposit more TLM)"]})]}),a.jsxs(He,{children:["AW Mining Rewards:"," ",a.jsxs(Y,{color:"green",children:[(d==null?void 0:d.amount.replace(" TLM",""))??"0.0000"," TLM"]}),a.jsx(U,{isLoading:y,disabled:y||((d==null?void 0:d.amount)??0)===0||v!=="0s",onClick:me,rounded:!1,color:"solidBlue",noBorder:!0,children:v!=="0s"?v:"Claim"})]})]}),a.jsx(Ye,{children:ee?new Array(6).fill(0).map((e,t)=>a.jsx(Xe,{},t)):x==null?void 0:x.map((e,t)=>{const{cooldown:n,type:r}=ce(e);return a.jsx(xe,{showShine:!0,showNumberBracket:!0,tool:e,children:a.jsxs(qe,{children:[a.jsxs(U,{isLoading:y||I,disabled:y||I||n!=="MINE",onClick:()=>oe(e),rounded:!1,color:"solidBlue",children:[n!=="MINE"?r==="miner"?a.jsx(tt,{}):a.jsx(et,{}):"",n==="MINE"?"Mine":n]}),a.jsxs(Ze,{children:[a.jsxs(q,{children:[a.jsx(We,{}),a.jsx(Z,{children:e.mining_power/10})]}),a.jsxs(q,{children:[a.jsx(nt,{}),a.jsx(Z,{children:e.nft_power/10})]})]})]})},t)})})]})};export{St as default};
