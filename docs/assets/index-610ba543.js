import{s as a,e as k,k as j,S as l,T as M,l as x,q as v,Q as u,b as g,D as C,R as c,_ as F,n as L,j as t,I as D,F as I,m as y}from"./index-95edd66d.js";import{d as O}from"./use-transaction-817cc8d1.js";import{d as S}from"./defaultAvatar-b9bc8aac.js";import{s as A}from"./sleep-da79c358.js";import{i as B}from"./index-323f6ada.js";import"./user-miners-query-230e013a.js";import"./axios-43b00e28.js";const P=a("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",w:"100%"}),Q=a("h2",{d:"flex",align:"center",justify:"center",color:"$white500"}),q=a("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"15px",mt:"15px",bg:"rgba(255, 255, 255, 0.05)",br:"10px",w:"100%",color:"$white500"}),N=a("div",{d:"flex",align:"flex-start",justify:"center",w:"100%",padding:"15px",br:"5px",color:"$white500"}),z=a("div",{d:"flex",align:"center",justify:"center",mr:"15px",minW:"60px",maxW:"60px",h:"60px",border:"2px solid grey",br:"999px",overflow:"hidden",img:{w:"60px",h:"60px"}}),W=a("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",w:"100%",color:"$white500"}),K=k({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),f=a("div",{m:"10px 0",w:"95%",height:"120px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1) ,rgba(255, 255, 255, 0.2))",br:"10px",backgroundSize:"400% 400%",animation:`${K} 1.2s ease-in-out infinite`}),G=a("p",{d:"flex",align:"center",justify:"center",height:"320px",w:"100%",fw:"$thin",fs:"26px",ff:"$body",color:"$white500"}),U=a("span",{fw:"$thin",fs:"16px",ff:"$body",color:"$white500",svg:{w:"13px",h:"13px"}}),Y=a("button",{d:"flex",align:"center",justify:"center",gap:"5px",mt:"10px",h:"28px",minW:"65px",borderRadius:"4px",border:" 1px solid #8F8F8F",background:"rgba(0, 0, 0, 0.22)",padding:"0px 10px 0 5px",fw:"$thin",fs:"14px",ff:"$body",color:"$white500","&[disabled]":{opacity:"0.5",cursor:"not-allowed"}}),H=async()=>await j({options:{code:l.MEMBERS_MC,index_position:1,limit:"3",reverse:!0,scope:l.MEMBERS_MC,table:M.SPONSOR}}),V=()=>x({queryKey:[u.SPONSOR],queryFn:()=>J(),staleTime:1e3*60*60*24});async function w(){return await v.invalidateQueries(u.SPONSOR)}async function J(){try{const e=await H();return e?X(e):[]}catch(e){return console.log(e),null}}function X(e){return e.map(n=>({...n,avatar:n.avatar.split(";")[0],avatarCollection:n.avatar.split(";")[1]}))}async function Z(e,n,o){const{executeTransaction:s}=O(),d=ee(e,n,o);return!!await s(d)}function ee(e,n,o){return{actions:[{account:l.MEMBERS_MC,name:"like",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,type:n,contentid:o}}]}}const te=()=>x({queryKey:[u.MEMBERS],queryFn:()=>ne(),staleTime:1e3*60*60*24,enabled:!!g.getState().user});async function b(){return await v.invalidateQueries(u.MEMBERS)}async function ne(){const e=g.getState().user;if(!e)return null;try{const n=await C(e==null?void 0:e.name);return n?{...n,avatar:n.avatar.split(";")[0],avatarCollection:n.avatar.split(";")[1]}:null}catch(n){return console.log(n),null}}const re=async()=>await j({options:{code:l.MEMBERS_MC,index_position:1,limit:"10000",scope:l.MEMBERS_MC,table:M.SETTINGS}}),oe=()=>x({queryKey:[u.MC_SETTINGS],queryFn:()=>ae(),staleTime:1e3*60*60*24});async function ae(){try{const e=await re();return e!=null&&e[0]?e==null?void 0:e[0]:null}catch(e){return console.log(e),null}}const se=c.lazy(()=>F(()=>import("./fire-fill-ab46c366.js"),["assets/fire-fill-ab46c366.js","assets/index-95edd66d.js","assets/index-55fec1ff.css"])),ge=()=>{const{data:e,isLoading:n}=V(),{data:o}=te(),{data:s}=oe(),d=g(r=>r.user),i=c.useRef(null),[h,m]=c.useState(!1);async function E(r){if(!d){y.error("User not found, please login");return}try{m(!0),await Z(d,"sponsor",r)&&(y.success("Liked"),await A(800),await b(),await w())}catch(p){console.log(p)}finally{m(!1)}}function T(){i!=null&&i.current&&(i.current.src=S)}const _=c.useMemo(()=>{if(!(o!=null&&o.last_like))return!1;const r=new Date(o==null?void 0:o.last_like).getTime(),p=(s==null?void 0:s.likecd_minutes)??0,R=r+p*6e4,$=L.getTime();return!B($,R)},[o,s==null?void 0:s.likecd_minutes]);return c.useEffect(()=>{const r=setInterval(()=>{b(),w()},6e4);return()=>clearInterval(r)},[]),t.jsxs(P,{children:[t.jsx(Q,{children:"LATEST SPONSORS"}),t.jsx(q,{children:n?t.jsxs(t.Fragment,{children:[t.jsx(f,{}),t.jsx(f,{}),t.jsx(f,{})]}):(e==null?void 0:e.length)===0?t.jsx(G,{children:"No Sponsors for now"}):e==null?void 0:e.map(r=>t.jsxs(N,{children:[t.jsx(z,{children:r.avatarCollection==="alienavatars "?t.jsx("img",{src:`https://ipfs.alienworlds.io/ipfs/${r.avatar}`,style:{width:"240px",height:"400px",minWidth:"240px",minHeight:"400px",objectFit:"none",scale:"0.24",objectPosition:"45% 1.5%"}}):t.jsx("img",{ref:i,onError:T,src:r.avatar!=="-"?`${D}/ipfs/${r.avatar}`:S,alt:""})}),t.jsxs(W,{children:[t.jsx(U,{children:r.log}),t.jsx(Y,{onClick:()=>E(r.index),disabled:h||_,children:h?t.jsx(I,{size:"sm",colorSchema:"light"}):t.jsxs(t.Fragment,{children:[t.jsx(se,{}),r.likes]})})]})]},r.index))})]})};export{ge as default};
