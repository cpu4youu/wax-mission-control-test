import{s as i,e as O,a as Z,q as Y,Q as U,S as I,u as K,G as J,R as g,_ as y,b as d,f as c,j as t,k as X,d as ee,B as te,l as B,m as se}from"./index-4245a362.js";import{u as ne,L as re}from"./index-0544b49c.js";import{g as ie,u as oe}from"./tasks-config-query-2dfb824c.js";import{a as ae}from"./index.esm-86b443f6.js";const ce=i("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%"}),le=i("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0},"@md":{h:"105px",img:{h:"105px"}},"@sm":{h:"65px",img:{h:"65px"}}}),pe=i("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.8)",w:"100%","@sm":{fs:"24px"}}),ue=i("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",maxW:"1095px","@md":{px:"30px"},"@sm":{px:"15px"}}),de=i("div",{d:"flex",align:"center",justify:"center",direction:"column",w:"100%",mt:"48px"}),xe=i("h3",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",color:"$white500",fs:"32px","@sm":{fs:"24px"}}),me=i("p",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",maxW:"811px",mt:"18px",mr:"auto",fs:"16px",fw:"$thin",ff:"$body",color:"$white500","@sm":{mt:"10px",fs:"14px"}}),fe=i("div",{d:"flex",align:"center",justify:"center",direction:"column",mt:"18px",w:"100%"}),he=i("h3",{d:"flex",align:"center",justify:"space-between",gap:"10px",w:"100%",color:"$white500",fs:"18px",span:{fs:"32px"},button:{d:"flex",align:"center",justify:"center",gap:"6px",color:"$white500",fw:"$bold",fs:"25px"},"@sm":{fs:"16px",span:{fs:"28px"}}}),ge=i("div",{d:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:"15px",flexWrap:"wrap",mt:"18px",w:"100%","@sm":{gap:"5px"}}),ye=i("div",{d:"flex",align:"flex-start",justify:"space-between",direction:"column",position:"relative",w:"100%",h:"100%",pb:"5px",border:"3px solid rgba(255, 255, 255, 0.4)",img:{w:"100%",h:"100%",maxH:"135px",objectFit:"cover"},">button":{fs:"18px",padding:"0px",mt:"20px",mx:"auto",w:"95%",minW:"95%",maxW:"95%",minH:"35px",div:{minH:"35px"}},variants:{isSelected:{true:{">button":{color:"black"}}}},"@sm":{">button":{fs:"14px"}}}),we=i("div",{d:"flex",align:"center",justify:"center",position:"absolute",top:"3px",left:"10px",color:"$white500",fs:"24px",fw:"$bold",ff:"$heading",svg:{w:"45px",h:"45px",ml:"-5px"},"@sm":{fs:"16px",left:"5px",top:"0px",svg:{w:"25px",h:"25px"}}}),_e=i("h4",{d:"flex",align:"center",justify:"center",direction:"column",padding:"3px 5px",color:"$white500",fs:"18px",ff:"$heading","@sm":{fs:"14px"}}),be=i("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gap:"10px",w:"100%",my:"10px",pl:"5px",color:"$white500",fs:"13px",ff:"$body",">svg":{w:"20px",h:"20px"},"@sm":{fs:"12px"}}),je=i("p",{w:"100%",my:"auto",pl:"5px",color:"$white500",fs:"13px",ff:"$body",svg:{verticalAlign:"sub",w:"16px",h:"16px",my:"auto",mr:"3px"},"@sm":{fs:"12px"}}),Te=i("p",{w:"100%",pl:"5px",color:"$white500",fs:"14px",ff:"$body",span:{display:"inline-flex",align:"center",gap:"3px"},svg:{verticalAlign:"sub",w:"16px",h:"16px",mr:"3px"},"@sm":{fs:"12px"}}),ve=O({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Se=i("div",{d:"flex",w:"100%",maxW:"260px",h:"325px",background:"linear-gradient( -90deg, rgba(255,255,255, .05), rgba(255,255,255, 0.07) ,rgba(255,255,255, .05))",br:"10px",backgroundSize:"400% 400%",animation:`${ve} 1.2s ease-in-out infinite`,"@sm":{h:"215px",w:"100%"}}),$e=()=>Z({queryKey:[U.Tasks],queryFn:()=>ke(),staleTime:1e3*60*60});async function Ce(){return await Y.removeQueries([U.Tasks])}async function ke(){try{const n=await ie("active");return n||[]}catch(n){return console.log(n),[]}}async function Le(n,p,r,o){const{executeTransaction:x}=K(),m=await Pe(n,p,r,o);return!!await x(m,{broadcast:!0,sign:!0})}async function Pe(n,p,r,o){return o==="tlm"?{actions:[{account:I.ALIEN_WORLDS,name:"transfer",authorization:[{actor:n.name,permission:n.requestPermission}],data:{from:n.name,memo:`complete task,${p}`,quantity:`${r.toFixed(4)} TLM`,to:"emporium.mc"}}]}:{actions:[{account:I.EMPORIUM,name:"finishtask",authorization:[{actor:n.name,permission:n.requestPermission}],data:{wallet:n.name,task_id:p,currency_amount:r}}]}}function Ee(n){return J({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468-59.015.042-113.223-20.53-155.822-54.911-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184 0-101.705-82.311-184-184-184-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"}}]})(n)}const q=g.lazy(()=>y(()=>import("./shards-55751e95.js"),["assets/shards-55751e95.js","assets/index-4245a362.js","assets/index-55fec1ff.css"])),R=g.lazy(()=>y(()=>import("./tlm-7e2e9dbd.js"),["assets/tlm-7e2e9dbd.js","assets/index-4245a362.js","assets/index-55fec1ff.css"])),Me=g.lazy(()=>y(()=>import("./star-abf9becd.js"),["assets/star-abf9becd.js","assets/index-4245a362.js","assets/index-55fec1ff.css"])),qe=()=>{const{data:n,isLoading:p}=$e(),{data:r}=oe(),o=d(e=>e.user),x=d(e=>e.updateMcPoints),m=d(e=>e.updateQuestPoints),w=d(e=>e.updateTLM),z=ne(e=>e.onChangePage),[u,_]=c.useState(void 0),[W,Q]=c.useState(""),[b,j]=c.useState(!1),[f,F]=c.useState([]);async function H(e){if(o){j(!0);try{await Le(o,e.task_id,e.current_price,e.task_type)&&(await B(1500),await T(),e.task_type==="mcp"&&await x(),e.task_type==="tlm"&&await w(),e.task_type==="qp"&&await m(),se.success("Task completed successfully"))}catch(s){console.error(s)}finally{j(!1)}}}async function T(){await B(1e3),await Ce()}function V(e){if(e.task_id===u){H(e);return}_(e.task_id)}function G(){_(void 0)}const v=c.useCallback(()=>{const e=new Date(new Date().toUTCString().substring(0,25)),s=(r==null?void 0:r.progressupdate_seconds)??0,a=Math.floor(e.getTime()/1e3);return new Date((Math.floor(a/s)*s+s)*1e3)},[r==null?void 0:r.progressupdate_seconds]),S=c.useCallback(e=>{const s=e.minutes>0?`${e.minutes>9?e.minutes:`0${e.minutes}`}`:"00",a=e.seconds>9?e.seconds:`0${e.seconds}`,l=e.hours>9?e.hours:`0${e.hours}`;return e.hours>0?`${l}:${s}:${a}`:`${s}:${a}`},[]),$=c.useCallback(e=>{const s=new Date(new Date().toUTCString().substring(0,25)),a=(r==null?void 0:r.progressupdate_seconds)??1,l=(r==null?void 0:r.tick_percent_decrease)??1,k=Math.floor(s.getTime()/1e3),L=Math.floor(new Date(e==null?void 0:e.timestamp_created).getTime()/1e3),P=L/a*a,E=k/a*a,M=E-P,D=M/a,A=l*-1/100,h=e.currency_start*Math.pow(1+A,D);return console.log({progressUpdateSeconds:a,tickPercentDecrease:l,dateSinceEpoch:k,timestampCreatedSinceEpoch:L,creation_seconds:P,current_seconds:E,current_duration:M,progress_ticks:D,negative_interest_percent:A,current_price:h}),e.task_type==="tlm"?Number(h.toFixed(4)):Math.floor(h)},[r]),C=c.useCallback(e=>{switch(e){case"qp":return t.jsx(X,{});case"mcp":return t.jsx(Me,{});case"tlm":return t.jsx(R,{});default:return t.jsx(R,{})}},[]),N=c.useCallback((e,s)=>{var a,l;return e==="mcp"?((o==null?void 0:o.mcPoints)??0)<s:e==="tlm"?(Number((a=o==null?void 0:o.userTlm)==null?void 0:a.balance)??0)<s:e==="qp"?(((l=o==null?void 0:o.userWeekly)==null?void 0:l.total_quest_points)??0)<s:!0},[o]);return c.useEffect(()=>{if(n){const e=n.map(s=>({...s,current_price:$(s)}));F(e)}},[n,$]),c.useEffect(()=>{const e=setInterval(()=>{const s=ee(v());Q(S(s)),s.minutes===0&&s.seconds===1&&T()},1e3);return()=>clearInterval(e)},[r,S,v]),t.jsx(c.Suspense,{fallback:t.jsx(re,{}),children:t.jsxs(ce,{children:[t.jsxs(le,{children:[t.jsx(pe,{children:"Zappâ€™s Zap Emporium"}),t.jsx("img",{src:"/assets/background/bg-emporium.webp",alt:""})]}),t.jsxs(ue,{children:[t.jsxs(de,{children:[t.jsx(xe,{children:"Zapps Tasks"}),t.jsx(me,{children:"Zapp is currently trying to advance various customer orders. Assist him in completing these tasks, and he will reward you with shards. Since he consistently dedicates time to these tasks, each one becomes easier to complete over time. However, he only requires the assistance of one player per task."})]}),t.jsxs(fe,{children:[t.jsxs(he,{children:[t.jsxs("p",{children:["Next Task Progress: ",t.jsx("span",{children:W})]}),t.jsxs("button",{onClick:()=>z("history"),children:[t.jsx(Ee,{}),"History"]})]}),t.jsx(ge,{children:p?Array.from({length:8}).map((e,s)=>t.jsx(Se,{},s)):f==null?void 0:f.map(e=>t.jsxs(ye,{isSelected:u===e.task_id,children:[t.jsxs(we,{children:[(e.shards/10).toLocaleString("en-US")," ",t.jsx(q,{})]}),t.jsx("img",{src:`/assets/tasks/${e.image}.webp`,title:e.title,alt:e.title}),u!==e.task_id&&t.jsx(_e,{children:e.title}),u===e.task_id?t.jsxs(be,{children:[t.jsx(ae,{size:30,color:"#fff",onClick:G}),t.jsxs(je,{children:["Are you sure you want to spend"," ",t.jsxs(t.Fragment,{children:[e.current_price.toLocaleString("en-US"),C(e.task_type)]}),"to complete the task and gain"," ",(e.shards/10).toLocaleString("en-US"),t.jsx(q,{})," ?"]})]}):t.jsx(Te,{children:e.description.split("[currency]").flatMap(s=>[s,t.jsxs("span",{children:[e.current_price.toLocaleString("en-US"),C(e.task_type)]},s)]).slice(0,-1)}),t.jsx(te,{disabled:b||N(e.task_type,e.current_price),isLoading:b,onClick:()=>V(e),color:u===e.task_id?"gradientYellow":"solidBlue",noBorder:!0,rounded:!1,children:u===e.task_id?"Confirm":e.button})]},e.task_id))})]})]})]})})};export{qe as default};
