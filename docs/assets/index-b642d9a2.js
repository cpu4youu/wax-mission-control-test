import{s as i,e as E,S as R,u as j,R as y,h as l,j as n,B as L,f as b}from"./index-ad4900e9.js";import{C as F}from"./index-effd929b.js";import{u as N,o as Q}from"./tool-query-a5d61919.js";import{u as B}from"./use-transaction-33190dba.js";import{o as C}from"./toolov-query-448e1663.js";import{o as k}from"./inventory-query-13e9e9f0.js";import{u as Y,o as M}from"./wallets-query-f42a2389.js";import{s as S}from"./sleep-da79c358.js";import{r as $,s as O}from"./tools-query-74ba461c.js";import"./adapters-ddfd409f.js";import"./axios-45629df5.js";import"./toast-options-11be26c8.js";const I=i("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),v=i("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),P=i("p",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",my:"15px",color:"$white500",fw:"400",ff:"$heading",fs:"20px",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",mt:"5px",">div":{border:"none"}},"@sm":{flexWrap:"wrap",span:{fs:"16px"}}}),K=i("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),V=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",">div":{border:"none"}}}),W=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",m:"5px 0 10px",w:"100%"}),u=i("div",{d:"flex",align:"center",justify:"space-between",gap:"10px",px:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),c=i("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"0px 0px 5px rgba(0, 0, 0, 0.9)",fs:"14px",ff:"$heading",fw:"400"}),q=E({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),G=i("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${q} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}});async function H(a,o){const{executeTransaction:e}=B(),r=J(a,o);return!!await e(r)}function J(a,o){return{actions:[{account:R.TOOLS_MC,name:"unstake",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,asset_ids:o}}]}}async function X(a,o){const{executeTransaction:e}=B(),r=Z(a,o);return!!await e(r)}function Z(a,o){return{actions:[{account:R.TOOLS_MC,name:"claim",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{wallet:a.name,tokens:`${o.toFixed(4)} TLM`}}]}}const xt=()=>{var h,g,w,T;const{data:a,isLoading:o}=N(),{data:e}=Y(),r=j(t=>t.user),d=j(t=>t.updateTLM),[f,x]=y.useState(!1),[p,m]=y.useState(!1);async function D(t){if(r){x(!0);try{await H(r,[Number(t.asset_id)])&&(await S(4e3),await Q(),await C(),await M(),await k("tool.worlds"),b.success("Tool unstaked"))}catch(s){console.error("Error staking tool",s)}finally{x(!1)}}}async function _(){if(!(!r||!(e!=null&&e.deposit))){m(!0);try{await X(r,l(e==null?void 0:e.deposit))&&(await S(2e3),await M(),await d(),await C(),await k("tool.worlds"),b.success("TLM Claimed"))}catch(t){console.error("Error staking tool",t)}finally{m(!1)}}}function A(t){const s=t.getFullYear(),z=t.getMonth()+1>9?t.getMonth()+1:`0${t.getMonth()+1}`;return`${t.getDate()>9?t.getDate():`0${t.getDate()}`}/${z}/${s}`}const U=(h=a==null?void 0:a.stakedTools)==null?void 0:h.reduce((t,s)=>t+l(s.total_earned),0);return console.log(a),n.jsxs(I,{children:[n.jsx(v,{children:"CLAIM YOUR TLM"}),n.jsxs(P,{children:["Deposited TLM:"," ",l(e==null?void 0:e.deposit)>=0?l(e==null?void 0:e.deposit).toFixed(4):`- ${l(e==null?void 0:e.trialtlm).toFixed(4)}`," ","TLM",n.jsx(L,{disabled:p&&U===0,isLoading:p,onClick:_,rounded:!1,color:"solidBlue",children:"Withdraw"})]}),n.jsx(v,{children:"YOUR STAKED TOOLS"}),n.jsx(K,{children:o?new Array(6).fill(0).map((t,s)=>n.jsx(G,{},s)):(T=(w=(g=a==null?void 0:a.stakedTools)==null?void 0:g.filter(t=>t.owned>0))==null?void 0:w.sort((t,s)=>$[t.rarity]-$[s.rarity]||O[t.shine]-O[s.shine]))==null?void 0:T.map((t,s)=>n.jsx(F,{tool:t,children:n.jsxs(V,{children:[n.jsx(L,{disabled:f,isLoading:f,onClick:()=>D(t),rounded:!1,color:"solidBlue",children:"Unstake"}),n.jsxs(W,{children:[n.jsxs(u,{children:[n.jsx(c,{children:"Since"}),n.jsx(c,{children:A(new Date(t.stakedat))})]}),n.jsxs(u,{children:[n.jsx(c,{children:"Total"}),n.jsx(c,{children:t.total_earned})]}),n.jsxs(u,{children:[n.jsx(c,{children:"Uses"}),n.jsx(c,{children:t.total_mines})]})]})]})},s))})]})};export{xt as default};
