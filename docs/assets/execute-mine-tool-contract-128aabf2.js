import{k as p,S as i,T as d,l as T,q as l,Q as u,f as g}from"./index-1db229e6.js";import{r as m}from"./tools-query-6cf10a61.js";import{g as y,r as h,a as _}from"./lands-query-6deeeda8.js";import{p as M,g as w}from"./lands-fc044ba5.js";import{c as O}from"./checkIfHasCpuOnAccount-21305020.js";import{g as S,u as z}from"./showTlmValueFromMine-33ab095a.js";import{s as E}from"./sleep-da79c358.js";import{d as N}from"./use-transaction-17081ec3.js";const R=async()=>await p({options:{code:i.TOOLS_MC,index_position:1,limit:"10000",scope:i.TOOLS_MC,table:d.mtools}})||[],x=()=>T({queryKey:[u.mToolsUseState],queryFn:()=>v(),staleTime:1e3*60*20});async function K(){await l.invalidateQueries([u.mToolsUseState])}async function v(){try{return await R()}catch(a){console.log(a);return}}function k(a,t){return a<2840?t.tool_name==="Certified Kol Digger":t.tool_name==="Certified Kol Digger"?!1:a<9650?m[t.rarity]>=3:a<28430?m[t.rarity]>=2:a<78530?m[t.rarity]>=1:m[t.rarity]>=0}async function U(a){try{const t=await Promise.all(M.map(async o=>{const e=await w(o);return{title:o,img:`/assets/planets/${o}.png`,data:(e==null?void 0:e.pool_buckets.map(s=>({...s,value_formatted:g(s==null?void 0:s.value)??0})))??[]}})),c=y(t),n=await h(c,"red",a),r=_(n);return l.setQueriesData([u.LANDS,"red",a],{list:n,highestValue:r}),{list:n,highestValue:r}}catch(t){console.log(t);return}}async function V({user:a,assets_ids:t,land_asset_id:c,difficulty:n,old_bag_assets_ids:r}){const{executeTransaction:o}=N(),e=await S(n);if(!e)return!1;const s=await C(a,t,e,r,c);if(!await o(s,{broadcast:!0,sign:!0}))return!1;await E(500);const f=z.getState().updateNonce;return f(void 0),!0}async function C(a,t,c,n,r){const o=await O(),e={actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:"cpu.mc",permission:"cosign"}],data:{wallet:a.name,type:2}},{account:i.M__FEDERATION,name:"setland",authorization:[{actor:a.name,permission:"active"}],data:{account:a.name,land_id:r}},{account:i.TOOLS_MC,name:"renttools",authorization:[{actor:a.name,permission:"active"}],data:{wallet:a.name,tools:t}},{account:i.M__FEDERATION,name:"setbag",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{account:a.name,items:t}},{account:i.M__FEDERATION,name:"mine",authorization:[{actor:a.name,permission:"active"}],data:{miner:a.name,nonce:c,notify:"notify.mc"}},{account:"atomicassets",name:"transfer",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{from:a.name,memo:"Returntool",to:"tools.mc",asset_ids:t}},{account:i.M__FEDERATION,name:"setbag",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{account:a.name,items:n}}]};return o||e.actions[0].authorization.unshift({actor:a.name,permission:a.authorization.permission}),e}export{V as e,k as f,U as g,K as o,x as u};
