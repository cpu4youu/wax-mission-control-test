import{s as o,e as R,X as y,Y as k,h as M,S as f,u as A,V as D,W as z,b as B,R as m,aw as C,j as a,B as Q,av as P,a7 as $,q as V,Q as W,k as q}from"./index-013c0bc1.js";import{S as U}from"./index-46b1c469.js";import{u as Y,C as G}from"./toolov-query-d2620a6f.js";import{P as H}from"./pickaxe-5afda9de.js";import{u as K,o as X}from"./inventory-query-82aaecb8.js";import"./index.esm-12493cc7.js";import"./index-6b7cf983.js";import"./index-416464a1.js";import"./index-d9272af7.js";import"./gradient-border-b7b94d09.js";const J=o("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),Z=o("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),tt=o("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading",span:{color:"#E52251",fw:"$bold",fs:"20px"},"@sm":{flexWrap:"wrap",span:{fs:"16px"}}}),et=o("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),at=o("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),st=o("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),L=o("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),E=o("p",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"14px",ff:"$heading",fw:"400"}),nt=R({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),it=o("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${nt} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}});async function ot({user:t,assets_ids:l,land_asset_id:n,old_bag_assets_ids:d}){const{executeTransaction:i}=A(),r=y.getState().nonce;let u=r==null?void 0:r.rand_str;if(u||(u=await k()),!u)return!1;const x=rt(t,l,n,u,d);if(!await i(x,{broadcast:!0,sign:!0}))return!1;await M(500);const p=y.getState().updateNonce;return p(void 0),!0}function rt(t,l,n,d,i){return{actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:"cpu.mc",permission:"cosign"}],data:{wallet:t.name,type:3}},{account:f.M__FEDERATION,name:"setland",authorization:[{actor:t.name,permission:"active"}],data:{account:t.name,land_id:n}},{account:f.TOOLS_MC,name:"renttools",authorization:[{actor:t.name,permission:"active"}],data:{wallet:t.name,tools:l}},{account:f.M__FEDERATION,name:"setbag",authorization:[{actor:t.name,permission:t.requestPermission}],data:{account:t.name,items:l}},{account:f.M__FEDERATION,name:"mine",authorization:[{actor:t.name,permission:"active"}],data:{miner:t.name,nonce:d,notify:"notify.mc"}},{account:"atomicassets",name:"transfer",authorization:[{actor:t.name,permission:t.requestPermission}],data:{from:t.name,memo:"staking",to:"tools.mc",asset_ids:l}},{account:f.M__FEDERATION,name:"setbag",authorization:[{actor:t.name,permission:t.requestPermission}],data:{account:t.name,items:i}}]}}const g=[{label:"Sort by rarity",value:"rarity"}],yt=()=>{const{data:t,isLoading:l}=K("tool.worlds"),{data:n}=Y(),{data:d}=D(),{data:i}=z(),r=B(e=>e.user),u=y(e=>e.updateIsCalculating),[x,w]=m.useState([]),[p,N]=m.useState([]),[b,j]=m.useState(!1),[S,F]=m.useState(g[0]);async function I(e){var s,c;if(r){j(!0);try{await $(),u(!0),await M(500);const[[T,O]]=V.getQueriesData(W.LANDS),v=(s=O.highestValue)==null?void 0:s.asset_id,h=(d==null?void 0:d.current_land)===v?void 0:v;if(console.log({tool:e,user:r,assets_ids:[Number(e.asset_id)],land_asset_id:h,old_bag_assets_ids:(c=i==null?void 0:i.userTools)==null?void 0:c.map(_=>Number(_.asset_id))}),!h||!(i!=null&&i.userTools))return;await ot({user:r,assets_ids:[e.next_asset_id],land_asset_id:h,old_bag_assets_ids:i.userTools.map(_=>Number(_.asset_id))})&&(await X("tool.worlds"),q.success("Tool staked"))}catch(T){console.error("Error staking tool",T)}finally{j(!1)}}}return m.useEffect(()=>{if(t){const e=t.filter(s=>n==null?void 0:n.some(c=>c.template_id===Number(s.template.template_id))).map(s=>({asset_id:s.asset_id,...s.data,...n==null?void 0:n.find(c=>c.template_id===Number(s.template.template_id))}));w(e)}},[n,t]),m.useEffect(()=>{if(S.value==="rarity"){const e=x.sort((s,c)=>C[s.rarity]-C[c.rarity]);N(e)}},[x,S.value]),a.jsxs(J,{children:[a.jsx(Z,{children:"LOAN TOOLS"}),a.jsxs(tt,{children:["Deposited TLM: ",a.jsx("span",{children:"-2.3211 TLM (Deposit more TLM)"})]}),a.jsx(U,{title:"",selected:g[0],onSelected:e=>F(e||g[0]),options:g,borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),a.jsx(et,{children:l?new Array(6).fill(0).map((e,s)=>a.jsx(it,{},s)):p==null?void 0:p.map((e,s)=>a.jsx(G,{tool:e,children:a.jsxs(at,{children:[a.jsx(Q,{disabled:b,isLoading:b,onClick:()=>I(e),rounded:!1,color:"solidBlue",children:"Mine"}),a.jsxs(st,{children:[a.jsxs(L,{children:[a.jsx(H,{}),a.jsx(E,{children:e.mining_power})]}),a.jsxs(L,{children:[a.jsx(P,{}),a.jsx(E,{children:e.pow})]})]})]})},s))})]})};export{yt as default};
