import{u as v,q as p,Q as g,d as A,h as Q}from"./index-b1ed8d4c.js";import{a as L}from"./adapters-13f9eb4e.js";import{p as N,g as D}from"./lands-78c5604c.js";const U=()=>{const e=v.getState().user,s=p.getQueryData(g.LANDSTYPE),a=p.getQueryData(g.TOOLS);return A({queryKey:[g.UserSettingsAssets],queryFn:()=>P(),staleTime:1e3*60*60,enabled:!!e&&!!s&&!!a})};async function q(){return await p.removeQueries([g.UserSettingsAssets])}async function P(){try{const{getAssets:e}=L,s=v.getState().user,a=s==null?void 0:s.usrsettings.filter(o=>o.key.includes("toolset")),t=s==null?void 0:s.usrsettings.filter(o=>o.key.includes("land")),i=a==null?void 0:a.map(({value:o})=>o.split(",")).map(o=>o.filter(l=>l!=="")).filter(o=>o.length>0),r=t==null?void 0:t.map(({value:o})=>o.split(","));if(!i||!r)return{favoriteTools:[],favoriteLands:[]};const d=await e({limit:100,ids:i.join(",")}),u=i==null?void 0:i.map(o=>o.map(l=>{const n=d.find(({asset_id:y})=>y===l);return{...n==null?void 0:n.data,assetId:n.asset_id}})),m=await e({limit:100,ids:r.join(",")}),f=await Promise.all(N.map(async o=>{const l=await D(o);return{title:o,img:`/assets/planets/${o}.png`,data:(l==null?void 0:l.pool_buckets.map(n=>({...n,value_formatted:Q(n==null?void 0:n.value)??0})))??[]}})),_=b(f),c=await Promise.all(t==null?void 0:t.map(async({value:o})=>await Promise.all(o.split(",").map(async l=>{var T;const n=m==null?void 0:m.find(({asset_id:h})=>h===l),y=(T=n==null?void 0:n.data)==null?void 0:T.name.split(" on "),w=await E(_,y[0]),S=F(w,y[1]);return{...n==null?void 0:n.data,assetId:n==null?void 0:n.asset_id,estimated_tlm:S,planetName:y[1]||"",landName:y[0]||""}}))));return{favoriteTools:u,favoriteLands:c}}catch(e){return console.log(e),{favoriteTools:[],favoriteLands:[]}}}function b(e){return e.reduce((s,a)=>(a.data.forEach(t=>{var i,r;!s[t.key]&&t.value_formatted>0&&(s[t.key]={data:[]}),(r=(i=s[t.key])==null?void 0:i.data)==null||r.push({title:a.title,img:a.img,value:t.value,value_formatted:t.value_formatted})}),s),{})}function k(){var s;const e=p.getQueryData(g.TOOLS);return(s=e==null?void 0:e.userTools)==null?void 0:s.reduce((a,t)=>{const i=t==null?void 0:t.rarity;return a[i]?{...a,[i]:a[i]+(Number(t==null?void 0:t.mining_power)??0)}:{...a,[i]:(t==null?void 0:t.mining_power)??0}},{})}async function E(e,s){const a=k();if(!a)return;const t=[],i=Object.keys(a).map((r,d)=>{const u=p.getQueryData(g.LANDSTYPE),m=u==null?void 0:u.find(f=>f.landname===s);return e==null?void 0:e[r].data.map(f=>{const _=a[r]*((m==null?void 0:m.mining_power_mod)??0)/1e4,c=(_>=.8?.8:_)*f.value_formatted;return d===0&&t.push({estimated_tlm:0}),{...f,formatted_estimated_tlm:`${c.toFixed(5)} TLM`,estimated_tlm:c}})});return i==null?void 0:i.reduce((r,d)=>(d==null||d.forEach((u,m)=>{r[m]={...r[m],...u,estimated_tlm:r[m].estimated_tlm+u.estimated_tlm,formatted_estimated_tlm:`${(r[m].estimated_tlm+u.estimated_tlm).toFixed(5)} TLM`}}),r),t)}function F(e,s){return e==null?void 0:e.find(({title:a})=>s.toLowerCase()===a)}export{q as o,U as u};
