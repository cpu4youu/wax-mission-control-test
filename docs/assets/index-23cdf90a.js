import{s as r,e as M,g as k,S as p,T as v,a as O,Q as $,b as h,aK as B,V as R,u as C,aF as A,R as T,j as n,t as D,B as w,h as E,aJ as y,az as j,k as b}from"./index-82d41943.js";import{C as U}from"./index-686daa53.js";const W=r("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),S=r("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),Q=r("p",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%",my:"15px",color:"$white500",fw:"400",ff:"$heading",fs:"20px",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",mt:"5px",">div":{border:"none"}},"@sm":{flexWrap:"wrap",span:{fs:"16px"}}}),F=r("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),Y=r("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",maxW:"160px",h:"25px",minW:"unset",">div":{border:"none"}}}),q=r("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",m:"5px 0 10px",w:"100%"}),g=r("div",{d:"flex",align:"center",justify:"space-between",gap:"10px",px:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),l=r("p",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"14px",ff:"$heading",fw:"400"}),z=M({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),K=r("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${z} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),P=async e=>await k({options:{code:p.TOOLS_MC,index_position:3,key_type:"i64",limit:"10000",scope:p.TOOLS_MC,table:v.tools,reverse:!0,lower_bound:e,upper_bound:e}}),N=()=>O({queryKey:[$.toolsMc],queryFn:()=>I(),staleTime:1e3*60*20,enabled:!!h.getState().user});async function I(){try{const e=h.getState().user;if(!e)return;const a=await P(e.name),s=await B();if(!a)return;const{getTemplates:o}=R,u=await o({template_id:a.map(({template_id:i})=>i).join(","),page:1,limit:100,order:"desc"});return a==null?void 0:a.map(i=>{const d=u.find(f=>f.template_id===String(i.template_id)),m=s==null?void 0:s.find(f=>f.template_id===i.template_id);return d?{...d.immutable_data,...i,...m}:i})}catch(e){console.log(e);return}}async function V(e,a){const{executeTransaction:s}=C(),o=J(e,a);return!!await s(o)}function J(e,a){return{actions:[{account:p.TOOLS_MC,name:"unstake",authorization:[{actor:e.name,permission:e.requestPermission}],data:{wallet:e.name,asset_ids:a}}]}}async function G(e){const{executeTransaction:a}=C(),s=H(e);return!!await a(s)}function H(e){return{actions:[{account:p.TOOLS_MC,name:"claim",authorization:[{actor:e.name,permission:e.requestPermission}],data:{wallet:e.name}}]}}const te=()=>{const{data:e,isLoading:a}=N(),{data:s}=A(),o=h(t=>t.user),[u,x]=T.useState(!1),[i,d]=T.useState(!1);async function m(t){if(o){x(!0);try{await V(o,[Number(t.asset_id)])&&(await E(2e3),await y(),await j("tool.worlds"),b.success("Tool unstaked"))}catch(c){console.error("Error staking tool",c)}finally{x(!1)}}}async function f(){if(o){d(!0);try{await G(o)&&(await y(),await j("tool.worlds"),b.success("Tool unstaked"))}catch(t){console.error("Error staking tool",t)}finally{d(!1)}}}function _(t){const c=t.getFullYear(),L=t.getMonth()+1>9?t.getMonth()+1:`0${t.getMonth()+1}`;return`${t.getDate()>9?t.getDate():`0${t.getDate()}`}/${L}/${c}`}return n.jsxs(W,{children:[n.jsx(S,{children:"CLAIM YOUR TLM"}),n.jsxs(Q,{children:["Claimable TLM, earned by loaning: ",D(s==null?void 0:s.deposit).toFixed(4)," TLM TLM",n.jsx(w,{disabled:i,isLoading:i,onClick:f,rounded:!1,color:"solidBlue",children:"Claim TLM"})]}),n.jsx(S,{children:"YOUR STAKED TOOLS"}),n.jsx(F,{children:a?new Array(6).fill(0).map((t,c)=>n.jsx(K,{},c)):e==null?void 0:e.map((t,c)=>n.jsx(U,{tool:t,children:n.jsxs(Y,{children:[n.jsx(w,{disabled:u,isLoading:u,onClick:()=>m(t),rounded:!1,color:"solidBlue",children:"Unstake"}),n.jsxs(q,{children:[n.jsxs(g,{children:[n.jsx(l,{children:"Since"}),n.jsx(l,{children:_(new Date(t.last_mine))})]}),n.jsxs(g,{children:[n.jsx(l,{children:"Total"}),n.jsx(l,{children:t.total_earned})]}),n.jsxs(g,{children:[n.jsx(l,{children:"Uses"}),n.jsx(l,{children:t.total_mines})]})]})]})},c))})]})};export{te as default};
