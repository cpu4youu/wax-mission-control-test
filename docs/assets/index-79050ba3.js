import{s as l,S as D,R as p,_ as S,u as b,r as y,j as t,B as h,f as J,z as K,o as k,x as X,t as dt,n as V}from"./index-09b767db.js";import{o as tt,a as et,b as nt,u as ut,c as ft,d as xt,f as G,e as pt}from"./format-date-to-iso-96c5fa0a.js";import{o as at,u as mt}from"./miner-claim-0a695b6d.js";import{u as W}from"./use-transaction-1aff6dec.js";import{s as z}from"./sleep-da79c358.js";import{c as ht}from"./mineCooldown-cb36dab8.js";import"./toast-options-e734d570.js";import{I as H}from"./index-9b868740.js";import{D as wt,a as gt,b as jt,c as yt}from"./index-a8104d17.js";import{i as P}from"./index-b8d0f01a.js";import{i as bt}from"./index-cb10b680.js";import"./index-70580cd0.js";import"./index.esm-7ed58148.js";import"./iconBase-d6649a48.js";import"./index-250c504e.js";import"./index-c69fe539.js";const Tt=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",w:"100%","@sm":{px:"0px"}}),_t=l("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",h:"165px",w:"100%",zIndex:1,img:{zIndex:-1,position:"absolute",h:"165px",w:"100%",objectFit:"cover",inset:0}}),Mt=l("h2",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"40px",ff:"$heading",textShadow:"0px 4px 4px rgba(0, 0, 0, 0.5)",w:"100%","@sm":{fs:"24px"}}),vt=l("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"20px",w:"100%",maxWidth:"1330px",mt:"40px",px:"15px",bg:"rgba(3, 16, 32,  .55)",br:"22px",padding:"20px 35px","@sm":{padding:"20px"}}),v=l("div",{d:"grid",gridTemplateColumns:"2fr 1fr 2fr",gap:"15px",w:"100%",padding:"10px 40px ",br:"10px",bg:"rgba(255,255,255,0.03)","@sm":{d:"flex",align:"center",justify:"center",direction:"column",padding:"10px 10px ",maxH:"100%",button:{h:"30px",minW:"100%",maxW:"100%"}}}),$=l("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",color:"$white500",mr:"auto","@sm":{w:"100%",justify:"space-between",direction:"row"}}),U=l("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gap:"25px",h:"100%",color:"$white500",mr:"auto","@sm":{w:"100%",justify:"space-between",direction:"row"}}),Y=l("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",gap:"5px",color:"$white500",mr:"auto",">div":{mx:"auto",w:"95%",bg:"rgba(255,255,255)",br:"10px"},input:{color:"black",ff:"$heading",textAlign:"right",mr:"5px"},button:{h:"50px"},"@sm":{w:"100%",justify:"space-between"}}),C=l("div",{d:"flex",align:"flex-start",justify:"flex-start",ff:"$heading",fs:"14px",w:"100%","@md":{fs:"12px"},"@sm":{fs:"11px",fw:"$bold"}}),L=l("div",{d:"flex",align:"flex-start",justify:"flex-start",ff:"$heading",fs:"24px",w:"100%",svg:{m:"auto 5px",w:"20px",h:"20px"},"@md":{fs:"18px"},"@sm":{justify:"space-between",w:"max-content",fw:"$bold",fs:"12px",svg:{w:"15px",h:"15px"}}}),R=l("div",{d:"flex",align:"center",justify:"center",gap:"10px",padding:"5px 20px 5px 10px",w:"100%",svg:{color:"$white500",w:"25px",h:"25px",mr:"auto"},"@sm":{d:"none"}}),g=l("span",{w:"100%",color:"$white500",fs:"18px",ff:"$heading",svg:{verticalAlign:"sub",w:"23px",h:"23px"},"@lg":{fs:"12px"},"@md":{fs:"10px"},"@sm":{}}),Z=l("div",{w:"100%",h:"100%",d:"flex",align:"center",justify:"center",gap:"10px"});async function $t(e){const{executeTransaction:i}=W(),o=Ct(e);return!!await i(o)}function Ct(e){return{actions:[{account:D.M__FEDERATION,name:"claimcomms",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{receiver:e.name}}]}}async function Lt(e){const{executeTransaction:i}=W(),o=Rt(e);return!!await i(o)}function Rt(e){return{actions:[{account:D.AWLNDRATINGS,name:"claimpay",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{receiver:e.name}}]}}async function Dt(e,i,o){const{executeTransaction:a}=W(),c=St(i,o,e);return!!await a(c)}function St(e,i,o){return{actions:i.map(c=>({account:D.MISSION_CONTROL,name:"claimweek",authorization:[{actor:o.name,permission:o.authorization.permission}],data:{wallet:o.name,week_id:c,boost_percentage:e}}))}}async function Wt(e,i){const{executeTransaction:o}=W(),a=At(e,i);return!!await o(a)}function At(e,i){return{actions:[{account:D.MISSION_CONTROL,name:"withdrawqp",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,qp:i}}]}}const It=l("div",{d:"flex",align:"center",justify:"center",direction:"column",bg:"$dark_blue500",w:"80vw",maxW:"685px",h2:{ff:"$heading",fs:"22px",fw:"$bold",color:"$light_blue500"},">button":{mt:"20px",w:"100%",minW:"150px",h:"30px",fs:"16px",div:{border:"none"},svg:{w:"20px",h:"20px"}}}),Et=l("div",{d:"flex-inline",align:"flex-start",justify:"flex-start",my:"20px",color:"$white500",fs:"20px",fw:"$bold",ff:"$heading",w:"100%",svg:{mr:"5px"}});l("div",{d:"flex",align:"center",justify:"center",gap:"10px",ff:"$heading",fs:"26px",fw:"$bold",mt:"15px",ml:"0px",textAlign:"center",color:"$white500",svg:{w:"30px",h:"30px"}});l("span",{d:"flex",align:"center",justify:"center",gap:"10px",ff:"$heading",fs:"26px",fw:"$bold",mt:"15px",ml:"10px",textAlign:"center",color:"$white500",span:{color:"#EBB309"}});const Pt=l("span",{bg:"rgba(0,0,0,0.5)",padding:"10px",w:"100%",ff:"$heading",fs:"16px",fw:"$normal",mt:"15px",textAlign:"center",color:"$white500",span:{fw:"$bold"}});async function Ot(e,i){const{executeTransaction:o}=W(),a=zt(e,i);return!!await o(a)}function zt(e,i){return{actions:[{account:D.MISSION_CONTROL,name:"storeqp",authorization:[{actor:e.name,permission:e.authorization.permission}],data:{wallet:e.name,qp:i}}]}}const N=p.lazy(()=>S(()=>import("./quest-ffdb25cd.js"),["assets/quest-ffdb25cd.js","assets/index-09b767db.js","assets/index-55fec1ff.css"])),Bt=({children:e,depositRewardPoints:i,defaultRewardPointsValue:o})=>{const a=b(d=>d.user),c=b(d=>d.updateMember),[x,r]=y.useState(!1),[u,A]=y.useState(!1),m=i||o;function I(d){A(d)}async function E(){if(!(a!=null&&a.name))return null;await z(2e3);const d=await K(a==null?void 0:a.name);b.setState(T=>({...T,user:T.user?{...T.user,userTlm:d}:null})),await c(),await k(),await X(),await tt(),await at(),await et(),await nt()}async function f(){if(a){r(!0);try{if(!await Ot(a,m))throw new Error("Withdrawn TLM error from contract");await E(),await z(1e3),J.success("Successfully deposited")}catch(d){console.log(d)}finally{r(!1),A(!1)}}}return t.jsxs(wt,{onOpenChange:I,open:u,children:[t.jsx(gt,{children:e}),t.jsx(jt,{closeType:"primary",closePosition:"inside",children:t.jsxs(It,{children:[t.jsx(yt,{children:"Deposit Reward Points"}),t.jsxs(Et,{children:["You are about to spend ",m," ",t.jsx(N,{})," ",t.jsx("br",{}),"A"," ",Math.ceil(m*.1)," ",t.jsx(N,{})," fee (10%) will be applied. ",t.jsx("br",{}),"Your vault will receive ",m-Math.ceil(m*.1)," ",t.jsx(N,{})]}),t.jsx(Pt,{children:"Reward Points in your vault will not be automatically converted into TLM rewards at the end of the week and allow you to use them at a later date."}),t.jsx(h,{isLoading:x,disabled:x,onClick:f,color:"solidBlue",rounded:!1,children:"Confirm"})]})})]})},Vt={addTLM:!1,withdrawTLM:!1,claimTLM:!1,claimMines:!1,claimComms:!1,claimPay:!1,weekReward:!1},j=p.lazy(()=>S(()=>import("./info-builder-a271991f.js"),["assets/info-builder-a271991f.js","assets/index-09b767db.js","assets/index-55fec1ff.css"])),O=p.lazy(()=>S(()=>import("./tlm-3eb324c6.js"),["assets/tlm-3eb324c6.js","assets/index-09b767db.js","assets/index-55fec1ff.css"])),Nt=p.lazy(()=>S(()=>import("./star-a6bc60f3.js"),["assets/star-a6bc60f3.js","assets/index-09b767db.js","assets/index-55fec1ff.css"])),kt=p.lazy(()=>S(()=>import("./quest-ffdb25cd.js"),["assets/quest-ffdb25cd.js","assets/index-09b767db.js","assets/index-55fec1ff.css"])),ie=()=>{var q,Q,F;const e=b(n=>n.user),i=b(n=>n.updateMember),o=dt(n=>n.weeklies);ut();const{data:a}=mt(),{data:c}=ft(),{data:x}=xt(),[r,u]=p.useState(Vt),[A,m]=p.useState(""),[I,E]=p.useState(0),f=y.useRef(null),d=o==null?void 0:o.reduce((n,s)=>{const M=((s==null?void 0:s.initial_prize_pool_formatted)??0)*((s==null?void 0:s.total_quest_points)??1)/((s==null?void 0:s.total_quest_points_week)??1);return s.week_id&&s.total_quest_points_user_week>0&&P(new Date,new Date(s==null?void 0:s.expiresDate))&&bt(new Date,new Date((s==null?void 0:s.end_date)??""))?{total:n.total+M,weeks:[...n.weeks,s.week_id]}:{total:n.total,weeks:[...n.weeks]}},{total:0,weeks:[]});async function T(){if(e){u({...r,claimMines:!0});try{if(!await pt(e))throw new Error("Claim Mines error from contract");await _()}catch(n){console.log(n)}finally{u({...r,claimMines:!1})}}}async function st(){if(e){u({...r,claimComms:!0});try{if(!await $t(e))throw new Error("Claim Comms error from contract");await _()}catch(n){console.log(n)}finally{u({...r,claimComms:!1})}}}async function it(){if(e){u({...r,claimPay:!0});try{if(!await Lt(e))throw new Error("Claim Pay error from contract");await _()}catch(n){console.log(n)}finally{u({...r,claimPay:!1})}}}async function ot(){if(e){u({...r,weekReward:!1});try{if(!await Dt(e,0,d.weeks))throw new Error("Week Reward error from contract");await _(),await k()}catch(n){console.log(n)}finally{u({...r,weekReward:!1})}}}async function _(){if(!(e!=null&&e.name))return null;await z(500);const n=await K(e==null?void 0:e.name);b.setState(s=>({...s,user:s.user?{...s.user,userTlm:n}:null})),await i(),await tt(),await at(),await et(),await nt()}async function rt(){if(!(!e||!(f!=null&&f.current))){u({...r,withdrawTLM:!0});try{if(!await Wt(e,Number(f.current.value)))throw new Error("Withdrawn TLM error from contract");await z(1e3),await _(),await k(),await X(),f.current.value="0",J.success("Successfully withdrawn")}catch(n){console.log(n)}finally{u({...r,withdrawTLM:!1})}}}function lt(){f!=null&&f.current&&(f.current.value=((e==null?void 0:e.score_nft)??0).toString())}const ct=n=>{const s=n.days?`${n.days}d`:"",M=n.hours?`${n.hours}h`:"",B=n.minutes?`${n.minutes}m`:"";return`${s}${M}${B}${n.seconds}s`},w=y.useMemo(()=>new Date((a==null?void 0:a.timestamp)||new Date),[a==null?void 0:a.timestamp]);return y.useEffect(()=>{var n;E(((n=e==null?void 0:e.userWeekly)==null?void 0:n.total_quest_points)??0)},[(q=e==null?void 0:e.userWeekly)==null?void 0:q.total_quest_points]),y.useEffect(()=>{const n=setInterval(()=>{const s=new Date(`${G(w)}`),M=ht(s),B=ct(M);m(B)},1e3);return()=>clearInterval(n)},[w]),t.jsxs(Tt,{children:[t.jsxs(_t,{children:[t.jsx(Mt,{children:"The Vault"}),t.jsx("img",{src:"/assets/background/bg-the-vault.webp",alt:""})]}),t.jsxs(vt,{children:[t.jsxs(v,{children:[t.jsxs($,{children:[t.jsx(C,{children:"Alien Worlds Mining Rewards"}),t.jsxs(L,{children:[(a==null?void 0:a.amount.replace(" TLM",""))??"0.0000"," ",t.jsx(O,{})]})]}),t.jsx(h,{isLoading:r.claimMines,disabled:((a==null?void 0:a.amount)??0)===0||P(V,w),onClick:T,rounded:!1,color:"solidBlue",children:P(V,w)?A:"Claim"}),t.jsxs(R,{children:[t.jsx(j,{}),t.jsxs(g,{children:["Earned by mining in Alien Worlds",P(V,w)&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),`Available on ${new Date(`${G(w)}.000Z`).toLocaleString()}`]})]})]})]}),t.jsxs(v,{children:[t.jsxs($,{children:[t.jsx(C,{children:"Alien Worlds Land Commission"}),t.jsxs(L,{children:[(c==null?void 0:c.comms.replace(" TLM",""))??"0.0000"," ",t.jsx(O,{})]})]}),t.jsx(h,{isLoading:r.claimComms,disabled:((c==null?void 0:c.comms)??0)===0,onClick:st,rounded:!1,color:"solidBlue",children:"Claim"}),t.jsxs(R,{children:[t.jsx(j,{}),t.jsx(g,{children:"Rewarded when others mine your land"})]})]}),t.jsxs(v,{children:[t.jsxs($,{children:[t.jsx(C,{children:"Alien Worlds DTAL"}),t.jsxs(L,{children:[(x==null?void 0:x.payoutAmount.replace(" TLM",""))??"0.0000"," ",t.jsx(O,{})]})]}),t.jsx(h,{isLoading:r.claimPay,disabled:((x==null?void 0:x.payoutAmount)??0)===0,onClick:it,rounded:!1,color:"solidBlue",children:"Claim"}),t.jsxs(R,{children:[t.jsx(j,{}),t.jsx(g,{children:"Earned daily by owning lands in Alien Worlds"})]})]}),t.jsxs(v,{children:[t.jsxs($,{children:[t.jsx(C,{children:"Mission Control Weekly Rewards"}),t.jsxs(L,{children:[d.total.toFixed(4)," ",t.jsx(O,{})]})]}),t.jsx(h,{isLoading:r.weekReward,disabled:d.total===0,onClick:ot,rounded:!1,color:"solidBlue",children:"Claim"}),t.jsxs(R,{children:[t.jsx(j,{}),t.jsxs(g,{children:["Earned by playing Mission Control, costs ",t.jsx(Nt,{})," to claim"]})]})]}),t.jsxs(v,{children:[t.jsxs($,{children:[t.jsx(C,{children:"Reward Point Deposit"}),t.jsxs(L,{onClick:lt,children:[e==null?void 0:e.score_nft," ",t.jsx(kt,{})]})]}),t.jsxs(U,{children:[t.jsxs(Y,{children:[t.jsx(h,{isLoading:r.withdrawTLM,onClick:rt,disabled:!(e!=null&&e.isMember)||r.withdrawTLM,rounded:!1,color:"solidBlue",children:"Withdraw"}),t.jsx(H,{type:"number",defaultValue:0,ref:f,label:""})]}),t.jsxs(Y,{children:[t.jsx(Bt,{depositRewardPoints:I,defaultRewardPointsValue:((Q=e==null?void 0:e.userWeekly)==null?void 0:Q.total_quest_points)??0,children:t.jsx(h,{disabled:!(e!=null&&e.isMember),isLoading:r.weekReward,rounded:!1,color:"solidBlue",children:"Deposit"})}),t.jsx(H,{type:"number",defaultValue:((F=e==null?void 0:e.userWeekly)==null?void 0:F.total_quest_points)??0,label:"",value:I,onChange:n=>E(Number(n.target.value))})]})]}),t.jsx(R,{children:t.jsxs(U,{children:[t.jsxs(Z,{children:[t.jsx(j,{}),t.jsx(g,{children:"Reward Points you deposited at an earlier date"})]}),t.jsxs(Z,{children:[t.jsx(j,{}),t.jsx(g,{children:"Deposit Reward Points for later use. There is a 10% fee when depositing."})]})]})})]})]})]})};export{ie as default};
