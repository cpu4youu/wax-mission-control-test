import{b as T,a as S,q as g,Q as _,am as L,av as b,aw as h,t as N,S as E,u as M}from"./index-dcee1366.js";const C=()=>{const e=T.getState().user;return S({queryKey:[_.UserSettingsAssets],queryFn:()=>R(),staleTime:1e3*60*60,enabled:!!e})};async function O(){return await g.removeQueries([_.UserSettingsAssets])}async function R(){try{const{getAssets:e}=L,a=T.getState().user,s=a==null?void 0:a.usrsettings.filter(i=>i.key.includes("toolset")),t=a==null?void 0:a.usrsettings.filter(i=>i.key.includes("land")),n=s==null?void 0:s.flatMap(({value:i})=>i.split(",")),o=t==null?void 0:t.map(({value:i})=>i.split(","));if(!n||!o)return{favoriteTools:[],favoriteLands:[]};const l=await e({limit:100,ids:n.join(",")}),u=s==null?void 0:s.map(({value:i})=>i.split(",").map(d=>{const r=l.find(({asset_id:c})=>c===d);return{...r.data,assetId:r.asset_id}})),m=await e({limit:100,ids:o.join(",")}),f=await Promise.all(b.map(async i=>{const d=await h(i);return{title:i,img:`/assets/planets/${i}.png`,data:(d==null?void 0:d.pool_buckets.map(r=>({...r,value_formatted:N(r==null?void 0:r.value)??0})))??[]}})),p=D(f),y=await Promise.all(t==null?void 0:t.map(async({value:i})=>await Promise.all(i.split(",").map(async d=>{const r=m.find(({asset_id:A})=>A===d),c=r.data.name.split(" on "),w=await Q(p,c[0]),v=k(w,c[1]);return{...r.data,assetId:r.asset_id,estimated_tlm:v,planetName:c[1]||"",landName:c[0]||""}}))));return{favoriteTools:u,favoriteLands:y}}catch(e){return console.log(e),{favoriteTools:[],favoriteLands:[]}}}function D(e){return e.reduce((a,s)=>(s.data.forEach(t=>{var n,o;!a[t.key]&&t.value_formatted>0&&(a[t.key]={data:[]}),(o=(n=a[t.key])==null?void 0:n.data)==null||o.push({title:s.title,img:s.img,value:t.value,value_formatted:t.value_formatted})}),a),{})}function P(){var a;const e=g.getQueryData(_.TOOLS);return(a=e==null?void 0:e.userTools)==null?void 0:a.reduce((s,t)=>{const n=t==null?void 0:t.rarity;return s[n]?{...s,[n]:s[n]+(Number(t==null?void 0:t.mining_power)??0)}:{...s,[n]:(t==null?void 0:t.mining_power)??0}},{})}async function Q(e,a){const s=P();if(!s)return;const t=[],n=Object.keys(s).map((o,l)=>{const u=g.getQueryData(_.LANDSTYPE),m=u==null?void 0:u.find(f=>f.landname===a);return e==null?void 0:e[o].data.map(f=>{const p=s[o]*((m==null?void 0:m.mining_power_mod)??0)/1e4,y=(p>=.8?.8:p)*f.value_formatted;return l===0&&t.push({estimated_tlm:0}),{...f,formatted_estimated_tlm:`${y.toFixed(5)} TLM`,estimated_tlm:y}})});return n==null?void 0:n.reduce((o,l)=>(l==null||l.forEach((u,m)=>{o[m]={...o[m],...u,estimated_tlm:o[m].estimated_tlm+u.estimated_tlm,formatted_estimated_tlm:`${(o[m].estimated_tlm+u.estimated_tlm).toFixed(5)} TLM`}}),o),t)}function k(e,a){return e==null?void 0:e.find(({title:s})=>a.toLowerCase()===s)}async function U(e,a){const{executeTransaction:s}=M(),t=q(e,a);return!!await s(t)}function q(e,a){return{actions:[{account:E.M__FEDERATION,name:"setbag",authorization:[{actor:e.name,permission:e.requestPermission}],data:{account:e.name,items:a}}]}}export{U as e,O as o,C as u};
