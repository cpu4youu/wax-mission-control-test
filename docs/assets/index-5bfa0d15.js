import{s as c,i as $e,k as Ne,u as _e,j as a,e as Oe,t as ze,r as R,h as je,q as Me,Q as Ce,R as U,_ as q,B as Qe}from"./index-8e6aa14a.js";import{a as Ve}from"./index.esm-01c8cc40.js";import{F as Pe}from"./index.esm-ed147d72.js";import{f as We}from"./format-currency-usd-c3f487ff.js";import{f as ae}from"./formatNumber-be910684.js";import{d as O,a as Te,c as K}from"./mineCooldown-639e3bc7.js";import{u as Ge}from"./use-wharfkit-41e38fc2.js";import{u as Be}from"./use-media-98c0012e.js";import{a as Ke,e as De}from"./execute-claim-contract-1bf33eff.js";import{u as E,g as Se,s as ie}from"./showTlmValueFromMine-a0fd8123.js";import{s as W}from"./sleep-da79c358.js";import{u as Ue,o as Le}from"./lands-query-7ff68b8b.js";import{c as oe,a as se}from"./calculateShardsByLand-fe58dd3d.js";import{u as qe,r as Ee,o as Re}from"./tools-query-b2b1ad38.js";import{u as He,o as be}from"./user-miners-query-5f343dc6.js";import{u as Ye,o as Xe}from"./lands-query-0234a332.js";import{u as Ze,o as Je}from"./get-user-settings-assets-query-973071ba.js";import{u as et,o as tt}from"./wallets-query-f42e8571.js";import{u as nt,o as at,g as it}from"./tool-query-cdb508a3.js";import{u as ot,f as st,o as rt,g as lt,e as dt}from"./execute-mine-tool-contract-49fb07d4.js";import{o as ct}from"./miner-claim-a67f225d.js";import{o as pt}from"./toolov-query-f0f2f89f.js";import"./iconBase-aaad8e12.js";import"./index-6d6ded65.js";import"./index-c9329aee.js";import"./use-transaction-9ebaef94.js";import"./toast-options-6ff58a66.js";import"./lands-b265ae15.js";import"./adapters-36c0dd3a.js";import"./axios-45629df5.js";const ft=c("div",{d:"flex",align:"center",justify:"center",direction:"column",my:"auto","@sm":{ml:"auto",my:"auto"}}),mt=c("div",{d:"flex",align:"center",justify:"center",direction:"column",cursor:"pointer",mr:"auto",position:"relative"}),ut=c("img",{w:"100%",h:"60px",mb:"10px",objectFit:"contain","@sm":{w:"80px",h:"80px"}}),xt=c("div",{d:"flex",align:"center",justify:"center",zIndex:3,position:"absolute",bottom:"-10px",left:"0px",w:"30px",h:"30px",br:"10px","-webkit-text-stroke":"1px white",letterSpacing:"1px",color:"#00D1FF",fw:"900",fs:"20px",ff:"$heading",border:"2px solid white",background:"#D9D9D9",backdropFilter:"blur(15px)"}),gt=c("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%","@sm":{d:"none"}}),ht=c("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",mb:"10px",minW:"200px",w:"100%"}),yt=c("div",{d:"flex",align:"center",justify:"center",position:"relative",boxShadow:"2px 2px 10px #000000",w:"100%",h:"10px",br:"3px",bg:"#595959"}),wt=c("div",{d:"flex",align:"center",justify:"center",position:"absolute",left:"0px",maxW:"200px",h:"10px",br:"3px",bg:"linear-gradient(90deg, #07A3DD 0%, rgba(0, 186, 255, 0.5) 100%)","&::after":{content:"",position:"absolute",right:"-2px",h:"14px",w:"7px",br:"50%",bg:"$white500",filter:"blur(2px)"}}),Tt=c("div",{d:"flex",align:"center",justify:"center",direction:"column",ff:"$heading",fw:"$thin",fs:"12px",color:"$white500","@md":{ml:"auto",fs:"10px"}}),bt=c("div",{d:"flex",align:"center",justify:"space-between",w:"100%","@md":{fs:"12px"}}),_t=c("button",{d:"flex",align:"center",justify:"center",ff:"$body",fs:"14px",fw:"$normal",color:"$red500",cursor:"pointer","&:hover":{textShadow:"1px 1px 2px red"},"@md":{fs:"12px"}}),vt=()=>{const i=$e(),{data:y}=Ne(),d=_e(S=>S.user),{unAuthorize:z}=Ge(),{isSmall:I}=Be(),o=y==null?void 0:y.find(S=>S.level===(d==null?void 0:d.level)),D=((d==null?void 0:d.experience)??0)/((o==null?void 0:o.xp_to_level_up)??100)*100;return a.jsxs(ft,{children:[a.jsx(mt,{onClick:()=>i(I?"/user-settings":"/menu"),children:a.jsx(ut,{src:"/assets/icons/logo.webp",alt:"avatar icon"})}),a.jsxs(gt,{children:[a.jsxs(ht,{children:[a.jsx(xt,{children:(d==null?void 0:d.level)??1}),a.jsx(yt,{children:a.jsx(wt,{style:{width:`${D}%`}})})]}),a.jsxs(bt,{children:[!I&&a.jsx(_t,{onClick:z,children:"Logout"}),a.jsxs(Tt,{children:[(d==null?void 0:d.experience)??0,"/",(o==null?void 0:o.xp_to_level_up)??100," ",!I&&"XP"]})]})]})]})},jt=c("div",{d:"flex",align:"center",justify:"space-between",w:"100%",position:"relative",zIndex:20,bg:"$blue700"}),Mt=c("div",{d:"flex",align:"center",justify:"space-between",zIndex:20,w:"100%",px:"30px",h:"140px","@media(max-width:1224px)":{minW:"100%"},"@md":{px:"15px"},"@sm":{}}),Ct=c("div",{d:"flex",align:"center",justify:"center",gap:"20px",">a":{d:"flex",align:"center",justify:"center",svg:{h:"28px",w:"28px"}},svg:{color:"$white500",h:"22px",w:"22px"},zIndex:30,button:{"&:disabled":{opacity:.5}},"@sm":{order:-1,justify:"space-between",w:"max-content",button:{d:"none","&:last-of-type":{d:"flex",zIndex:2,svg:{h:"35px",w:"35px"}}}},"@xxsm":{">a":{top:"10px",position:"absolute"}}}),Dt=Oe({"100%":{transform:"rotate(360deg)"}}),St=c("button",{color:"$white500",svg:{ml:"10px",color:"$white500",w:"25px",h:"25px"},variants:{isLoading:{true:{pointerEvents:"none",opacity:"0.5",svg:{animation:`${Dt} 1s linear`,animationIterationCount:"infinite"}},false:{pointerEvents:"all",opacity:"1"}}}}),Lt=c("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"3px",w:"100%",">button":{h:"30px",minW:"150px",fs:"20px"},span:{textTransform:"uppercase",color:"$white500",fs:"10px",fw:"$bold",ff:"$heading"},"@sm":{w:"max-content",position:"absolute",left:"50%",transform:"translateX(-50%)"}}),Et=c("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"10px",width:"310px","@md":{width:"max-content",margin:"0",gap:"7px"},"@sm":{d:"none"}});c("button",{d:"flex",align:"center",justify:"center",ml:"10px"});const Rt=c("div",{d:"flex",align:"flex-end",justify:"center",gap:"20px",mt:"20px"}),re=c("div",{d:"flex",align:"center",justify:"space-between",direction:"column",color:"$white500",w:"max-content",fs:"14px",svg:{w:"25px",h:"25px"}}),le=c("div",{d:"flex",align:"center",justify:"center",direction:"column",padding:"5px",w:"35px",h:"35px",border:"1px solid $white500",borderRadius:"$full"}),It=c("div",{d:"flex",align:"center",justify:"center",">button>div":{d:"flex",align:"center",justify:"center"},"@sm":{gap:"10px",">button>div":{direction:"column"}}}),$t=c("div",{d:"flex",align:"center",justify:"center",gap:"5px",ml:"10px",fs:"20px",ff:"$body",color:"$white500",path:{fill:"$white500"}}),Bt=c("p",{ff:"$heading",fs:"20px",fw:"$bold",textShadow:"1px 1px 2px black",color:"$yellow500"});function At(){const{isSmall:i}=Be(),y=$e(),{data:d,isLoading:z,isFetching:I}=He(),{data:o,isLoading:D,isFetching:S}=qe(),{data:$}=Ye(),{data:de,isLoading:ce}=Ue(),{data:b}=Ze(),{data:w}=et(),{data:B,isLoading:pe}=nt(),{data:g}=ot(),e=_e(t=>t.user),H=_e(t=>t.updateAuth),_=E(t=>t.nonce),T=E(t=>t.updateIsCalculating),fe=E(t=>t.isMineButtonLoading),me=E(t=>t.updateMineButtonLoading),Y=E(t=>t.isCalculating),ue=E(t=>t.updateNonce),xe=E(t=>t.hashExpire),X=E(t=>t.updateHashExpire),Q=E(t=>t.updateMineCooldown),Z=ze(t=>t.currentWeek),[G,F]=R.useState(new Date),[ge,M]=R.useState(!1),[m,he]=R.useState(void 0),[L,V]=R.useState(null),P=!(e!=null&&e.isMember)||(e==null?void 0:e.flagged),J=async()=>{if(!e)return null;M(!0),T(!0);try{if(!await Ke(e))throw new Error("MINE error from contract");await ie(e==null?void 0:e.name)}catch(t){console.log(t)}finally{await W(800),T(!1),await te(),M(!1)}},ee=async()=>{var t;M(!0);try{await Le(),T(!0),await W(500);const[[f,s]]=Me.getQueriesData(Ce.LANDS),v=(t=s.highestValue)==null?void 0:t.asset_id;if(!e||!v)return null;if(!(_!=null&&_.rand_str)){await Se();const u=new Date;X(u.setMinutes(u.getMinutes()+1))}await De(e,v)&&(await ie(e==null?void 0:e.name),await te())}catch(f){console.log(f)}finally{T(!1),M(!1)}},k=({delay:t})=>{var j,u,n,l,r,x,C,N,ne;const f=(t??0)/10;if(((j=o==null?void 0:o.userTools)==null?void 0:j.length)===1){const A=f*(((n=(u=o==null?void 0:o.userTools)==null?void 0:u[0])==null?void 0:n.delay)??0);return O(A,o,d,F)}const s=(l=o==null?void 0:o.userTools)==null?void 0:l.sort((A,ke)=>ke.delay-A.delay);if(((r=o==null?void 0:o.userTools)==null?void 0:r.length)===2){const A=f*((((x=s==null?void 0:s[0])==null?void 0:x.delay)??0)+(((C=s==null?void 0:s[1])==null?void 0:C.delay)??0)/2);return O(A,o,d,F)}const v=f*((((N=s==null?void 0:s[0])==null?void 0:N.delay)??0)+(((ne=s==null?void 0:s[1])==null?void 0:ne.delay)??0));return O(v,o,d,F)},h=()=>{var j,u;if(!$||!(b!=null&&b.favoriteLands))return null;let t=[];const f=b==null?void 0:b.favoriteLands.filter(([n])=>Te(K(k({delay:n.delay})))==="MINE");if(f.length>0)t=f;else{const n=Math.min(...b.favoriteLands.map(([r])=>K(k({delay:r.delay})).difference));t=b.favoriteLands.filter(([r])=>K(k({delay:r.delay})).difference===n)}if((e==null?void 0:e.miningType)==="orange"){const n=Math.max(...t.map(([r])=>oe({land:r})));return{...(j=t.filter(([r])=>oe({land:r})===n).flatMap(([r])=>r).sort((r,x)=>se({landCardId:x.cardid,landsType:$,userTools:o==null?void 0:o.userTools})-se({landCardId:r.cardid,landsType:$,userTools:o==null?void 0:o.userTools})))==null?void 0:j[0]}}const s=Math.max(...t.map(([n])=>se({landCardId:n.cardid,landsType:$,userTools:o==null?void 0:o.userTools})));return{...(u=t.filter(([n])=>se({landCardId:n.cardid,landsType:$,userTools:o==null?void 0:o.userTools})===s).sort(([n],[l])=>oe({land:l})-oe({land:n})).flatMap(([n])=>n))==null?void 0:u[0]}},p=async()=>{M(!0);try{T(!0),await W(500);const t=h();if(!e)return null;await De(e,t==null?void 0:t.assetId)&&(await ie(e==null?void 0:e.name),await te())}catch(t){console.log(t)}finally{T(!1),M(!1)}},ye=async()=>{await at(),await be(),await tt(),await ct(),await pt(),await rt()},we=()=>{if(!B||!g)return null;const t=B==null?void 0:B.toolsOv.filter(n=>{var r;const l=n.owned>0&&((n==null?void 0:n.tool_name)==="Certified Kol Digger"?!0:n.allowed===1)&&st((e==null?void 0:e.total_points)??0,n);return((w==null?void 0:w.tempid_allow_list.length)??0)===0?l:l&&((r=w==null?void 0:w.tempid_allow_list)==null?void 0:r.some(x=>x===n.template_id))}).map(n=>{if((n==null?void 0:n.tool_name)==="Certified Kol Digger"){const r=g==null?void 0:g.reduce((x,C)=>{const N=Number(new Date(x.readyat));return Number(new Date(C.readyat))<N?C:x},g[0]);return{...r,last_use:+new Date(`${r.readyat}.000Z`)/1e3-r.cooldown_seconds}}const l=B.stakedTools.find(r=>r.template_id===n.template_id);return{...n,...l,last_use:+new Date(`${n.readyat}.000Z`)/1e3-n.cooldown_seconds}}),f=t==null?void 0:t.filter(n=>{const l=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6;return Te(K(O(l,{userTools:[n],allData:[]},d)))==="MINE"});let s=null;f.length>0?s=f.sort((n,l)=>Ee[n.rarity]-Ee[l.rarity]||l.mining_power-n.mining_power)[0]:s=t==null?void 0:t.reduce((n,l)=>{const r=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6,C=+O(r,{userTools:[n],allData:[]},d),N=((l==null?void 0:l.tool_name)==="Certified Kol Digger"?500:l.cooldown_seconds)*1.6,A=+O(N,{userTools:[l],allData:[]},d);return A<C?{...l,cooldownSec:A}:{...n,cooldownSec:C}},t[0]);const v=((s==null?void 0:s.tool_name)==="Certified Kol Digger"?500:s.cooldown_seconds)*1.5,u=O(v,{userTools:[s],allData:[]},d);return F(u),s},Ae=async()=>{var t,f;M(!0);try{const s=we();if(!s||!e||!g)return;await Le(),T(!0),await W(500);let v=0,j,u=[];if((s==null?void 0:s.tool_name)==="Certified Kol Digger"){const l=g==null?void 0:g.reduce((r,x)=>{const C=Number(new Date(r.readyat));return Number(new Date(x.readyat))<C?x:r},g[0]);v=l.asset_ids.length*s.pow,u=l.asset_ids.map(r=>Number(r)),j="1099512958237"}else{const[l]=await it(`${s.template_id}`);v=l.pow,u=[l.next_asset_id];let r;try{[[,r]]=Me.getQueriesData([Ce.LANDS,"red",s])}catch{r=await lt(s)}j=(t=r.highestValue)==null?void 0:t.asset_id}await dt({user:e,difficulty:v,assets_ids:u,land_asset_id:j,old_bag_assets_ids:((f=o==null?void 0:o.userTools)==null?void 0:f.map(l=>Number(l.asset_id)))??[]})&&(await ie(e==null?void 0:e.name),await ye())}catch(s){console.log(s)}finally{me(!1),T(!1),M(!1)}},te=async()=>{if(await be(),await Re(),(e==null?void 0:e.miningType)==="red"){await ye(),await W(500),we();return}},Fe=()=>{const t=Te(m);return Q(t),t},ve=async()=>{await Re(),await Xe(),await be(),await Je()};return{user:e,miners:d,mTools:g,tools:o,toolsLoaning:B,toolsWallets:w,bestLand:L,cooldown:Fe,handleRefreshLands:ve,playSound:async()=>{const t=new Audio("https://play.alienworlds.io/sounds/aw-mining-claim-sfx-02.mp3");i&&await W(1e3),t.play()},textAboveButton:()=>{var t;return P?"Not a Member":(e==null?void 0:e.miningType)==="green"?"Favorites (shards)":(e==null?void 0:e.miningType)==="orange"?"Favorites (TLM)":(e==null?void 0:e.miningType)==="gold"?"Mining":(e==null?void 0:e.miningType)==="blue"?"Mine Maximizer":(e==null?void 0:e.miningType)==="red"?`Deposit: ${je(w==null?void 0:w.deposit).toFixed(4)} TLM`:`Deposit: ${(je((t=e==null?void 0:e.HqMember)==null?void 0:t.deposit)+((e==null?void 0:e.tlm_deposit)??0)/1e4).toFixed(4)} TLM`},textBelowButton:()=>P?"Become a member to use mine":(e==null?void 0:e.miningType)==="red"?"Tool Loaning":(e==null?void 0:e.miningType)==="gold"||(e==null?void 0:e.miningType)==="blue"?`${d!=null&&d.name?d==null?void 0:d.name:""}`:`${L!=null&&L.name?L==null?void 0:L.name:""}`,buttonOnClick:async()=>{if(P)return y("/membership");if((e==null?void 0:e.miningType)==="red")return await ye(),Ae(),null;if(!(_!=null&&_.rand_str)&&!Y){T(!0),((e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange")&&await ve(),await Se();const t=new Date;X(t.setMinutes(t.getMinutes()+1))}return(e==null?void 0:e.miningType)==="blue"?(ee(),null):(e==null?void 0:e.miningType)==="gold"?(J(),null):(e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange"?(p(),null):J()},loading:()=>{const t=((m==null?void 0:m.seconds)??0)<0&&((m==null?void 0:m.minutes)??0)<0&&((m==null?void 0:m.hours)??0)<0,f=(e==null?void 0:e.miningType)==="red"?pe:!1;return Y||ge||z||D||!m||t||ce||fe||f},miningType:()=>(e==null?void 0:e.miningType)==="gold"?"gradientYellow":(e==null?void 0:e.miningType)==="orange"?(V(h()),"gradientOrange"):(e==null?void 0:e.miningType)==="green"?(V(h()),"gradientGreen"):(e==null?void 0:e.miningType)==="blue"?"gradientBlue":(e==null?void 0:e.miningType)==="red"?"gradientRed":"gradientYellow",minersFetching:I,toolFetching:S,land:de,updateAuth:H,updateNonce:ue,hashExpire:xe,currentWeek:Z,expireDate:G,setToolCooldown:he,isSmall:i,favorites:b,landsType:$,setExpireDate:F,setBestLand:V,isDisableToMine:P,toolCooldown:m,updateMineCooldown:Q,handleRefetch:te,navigate:y,selectBestLandOnFavorites:h,getBestToolOnTooLoaning:we,calcCooldown:k,nonce:_}}const Ie=U.lazy(()=>q(()=>import("./tlm-b46407e9.js"),["assets/tlm-b46407e9.js","assets/index-8e6aa14a.js","assets/index-55fec1ff.css"])),Ft=U.lazy(()=>q(()=>import("./star-d30e667b.js"),["assets/star-d30e667b.js","assets/index-8e6aa14a.js","assets/index-55fec1ff.css"])),kt=U.lazy(()=>q(()=>import("./atom-3a536081.js"),["assets/atom-3a536081.js","assets/index-8e6aa14a.js","assets/index-55fec1ff.css"])),Nt=U.lazy(()=>q(()=>import("./quest-69ab0696.js"),["assets/quest-69ab0696.js","assets/index-8e6aa14a.js","assets/index-55fec1ff.css"])),Ot=U.lazy(()=>q(()=>import("./open-menu-6c3c5f72.js"),["assets/open-menu-6c3c5f72.js","assets/index-8e6aa14a.js","assets/index-55fec1ff.css"])),vn=()=>{var ee,k;const{user:i,miners:y,mTools:d,tools:z,toolsLoaning:I,toolsWallets:o,bestLand:D,cooldown:S,playSound:$,textAboveButton:de,textBelowButton:ce,buttonOnClick:b,loading:w,miningType:B,minersFetching:pe,toolFetching:g,updateNonce:e,hashExpire:H,currentWeek:_,expireDate:T,setToolCooldown:fe,isSmall:me,favorites:Y,landsType:ue,setExpireDate:xe,setBestLand:X,isDisableToMine:Q,handleRefetch:Z,navigate:G,selectBestLandOnFavorites:F,getBestToolOnTooLoaning:ge,calcCooldown:M,nonce:m}=At(),he=()=>Q?a.jsx("span",{style:{fontSize:"15px"},children:"Membership"}):m!=null&&m.rand_str&&S()==="MINE"?"Submit":S();R.useEffect(()=>{let h=(y==null?void 0:y.delay)??0;if((i==null?void 0:i.miningType)==="blue"&&(h=15),((i==null?void 0:i.miningType)==="green"||(i==null?void 0:i.miningType)==="orange")&&D&&(h=D==null?void 0:D.delay),(i==null?void 0:i.miningType)==="red"){ge();return}M({delay:h})},[D,d,z,I,o,i]),R.useEffect(()=>{const h=setInterval(()=>{const p=K(T);fe(p),((i==null?void 0:i.miningType)==="orange"||(i==null?void 0:i.miningType)==="green")&&X(F()),(p==null?void 0:p.hours)===0&&(p==null?void 0:p.minutes)===0&&(p==null?void 0:p.seconds)===1&&$(),(p==null?void 0:p.hours)===0&&(p==null?void 0:p.minutes)===0&&(p==null?void 0:p.seconds)===0&&clearInterval(h)},1e3);return()=>clearInterval(h)},[T,me,Y,ue,y,z,i]),R.useEffect(()=>{const h=setInterval(()=>{H-new Date().getTime()<0&&e(void 0)},3e3);return()=>clearInterval(h)},[H,e]),R.useEffect(()=>{setInterval(async()=>{await Z()},6e4)},[y,d,xe,I,o,i]);const L=R.useMemo(()=>B(),[i==null?void 0:i.miningType]),V=w(),P=Q?!1:V,J=Q?!1:V||S()!=="MINE";return a.jsx(jt,{children:a.jsxs(Mt,{children:[a.jsx(vt,{}),a.jsxs(Ct,{children:[a.jsx(St,{disabled:!(i!=null&&i.member),onClick:()=>Z(),isLoading:pe||g,children:a.jsx(Pe,{})}),a.jsxs(Lt,{children:[a.jsx("span",{children:de()}),a.jsx(Qe,{onClick:()=>b(),disabled:J,color:L,isLoading:P,children:he()}),a.jsx("span",{children:ce()})]}),a.jsx("button",{onClick:()=>G("/user-settings"),children:a.jsx(Ve,{})}),a.jsx("button",{onClick:()=>G("/menu"),children:a.jsx(Ot,{})})]}),a.jsxs(Et,{children:[a.jsxs(Rt,{children:[a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Nt,{})}),ae(((ee=i==null?void 0:i.userWeekly)==null?void 0:ee.total_quest_points)??0,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Ft,{})}),ae((i==null?void 0:i.mcPoints)??0,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(kt,{color:"#F6A800"})}),ae(((i==null?void 0:i.redeemable_points)??0)/10,1)]}),a.jsxs(re,{children:[a.jsx(le,{children:a.jsx(Ie,{})}),ae(Number((k=i==null?void 0:i.userTlm)==null?void 0:k.balance)??0,1)]})]}),a.jsx(It,{children:a.jsx("button",{onClick:()=>G("/week-reward"),children:a.jsxs("div",{children:[a.jsx(Bt,{children:"Prize Pool"}),a.jsxs($t,{children:[We((_==null?void 0:_.initial_prize_pool_formatted)??0),a.jsx(Ie,{})]})]})})})]})]})})};export{vn as Header};
