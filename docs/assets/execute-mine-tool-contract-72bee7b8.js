import{k as p,S as n,T,l as d,q as l,Q as u,f as y}from"./index-baa9c320.js";import{r as m}from"./tools-query-a8c30530.js";import{g,r as h,a as _}from"./lands-query-bbc909a7.js";import{p as M,g as w}from"./lands-c18efc59.js";import{g as S,u as O}from"./showTlmValueFromMine-b723eef6.js";import{s as E}from"./sleep-da79c358.js";import{d as N}from"./use-transaction-dc9a5b45.js";const R=async()=>await p({options:{code:n.TOOLS_MC,index_position:1,limit:"10000",scope:n.TOOLS_MC,table:T.mtools}})||[],q=()=>d({queryKey:[u.mToolsUseState],queryFn:()=>v(),staleTime:1e3*60*20});async function x(){await l.invalidateQueries([u.mToolsUseState])}async function v(){try{return await R()}catch(a){console.log(a);return}}function I(a,t){return a<2840?t.tool_name==="Certified Kol Digger":t.tool_name==="Certified Kol Digger"?!1:a<9650?m[t.rarity]>=3:a<28430?m[t.rarity]>=2:a<78530?m[t.rarity]>=1:m[t.rarity]>=0}async function K(a){try{const t=await Promise.all(M.map(async r=>{const i=await w(r);return{title:r,img:`/assets/planets/${r}.png`,data:(i==null?void 0:i.pool_buckets.map(s=>({...s,value_formatted:y(s==null?void 0:s.value)??0})))??[]}})),c=g(t),e=await h(c,"red",a),o=_(e);return l.setQueriesData([u.LANDS,"red",a],{list:e,highestValue:o}),{list:e,highestValue:o}}catch(t){console.log(t);return}}async function U({user:a,assets_ids:t,land_asset_id:c,difficulty:e,old_bag_assets_ids:o}){const{executeTransaction:r}=N(),i=await S(e);if(!i)return!1;const s=await z(a,t,i,o,c);if(!await r(s,{broadcast:!0,sign:!0},!1))return!1;await E(500);const f=O.getState().updateNonce;return f(void 0),!0}async function z(a,t,c,e,o){return{actions:[{account:"cpu.mc",name:"paycpu",authorization:[{actor:"cpu.mc",permission:"cosign"}],data:{wallet:a.name,type:2}},{account:n.M__FEDERATION,name:"setland",authorization:[{actor:a.name,permission:"active"}],data:{account:a.name,land_id:o}},{account:n.TOOLS_MC,name:"renttools",authorization:[{actor:a.name,permission:"active"}],data:{wallet:a.name,tools:t}},{account:n.M__FEDERATION,name:"setbag",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{account:a.name,items:t}},{account:n.M__FEDERATION,name:"mine",authorization:[{actor:a.name,permission:"active"}],data:{miner:a.name,nonce:c,notify:"notify.mc"}},{account:"atomicassets",name:"transfer",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{from:a.name,memo:"Returntool",to:"tools.mc",asset_ids:t}},{account:n.M__FEDERATION,name:"setbag",authorization:[{actor:a.name,permission:a.authorization.permission}],data:{account:a.name,items:e}}]}}export{U as e,I as f,K as g,x as o,q as u};
