import{g as F,S as f,T,c as y,a as A,Q as N,ab as S,k as v}from"./index-1af419cd.js";const C=async()=>await F({options:{code:f.MISSION_CONTROL,index_position:1,limit:"10000",scope:f.MISSION_CONTROL,table:T.BLOGS}}),i={label:"All",value:"all"},w=y((t,r)=>({newsFilters:[i],updateNewsFilters:s=>m(t,s),newsFiltersSelected:i,updateNewsFiltersSelected:s=>O(t,s)}));function m(t,r){t(s=>({...s,newsFilters:[i,...r]}))}function O(t,r){t(s=>({...s,newsFiltersSelected:r}))}const R=()=>A({queryKey:[N.NEWS],queryFn:()=>x(),staleTime:1e3*60*60});async function x(){try{const t=await C();if(!t)return null;const r=q(t),s=_(r),e=w.getState().updateNewsFilters;return e(s),await I(r)}catch(t){return console.log(t),null}}function _(t){return t.map(r=>{if(r.blogid==="mining-matters"){const s=w.getState().updateNewsFiltersSelected;s({label:r.blogname,value:r.blogid})}return{label:r.blogname,value:r.blogid}})}function q(t){const r=t.map(s=>({...s,url:`https%3A%2F%2Fmedium.com%2Ffeed%2F${s.blogid}`}));return[...r,{id:r[r.length-1].id+1,blogid:"alien-articles",blogname:"Alienw.com",url:"https%3A%2F%2Falienw.com%2Ffeed"}]}async function I(t){const r=await D(t);return{all:r.reduce((e,n)=>{var o;return((o=n==null?void 0:n.loadedArticles)==null?void 0:o.length)>0&&e.push(n.loadedArticles),e},[]).flat().sort((e,n)=>new Date(e.published).getTime()>new Date(n.published).getTime()?-1:1),...r.reduce((e,n)=>{var o;return e[n.blogid]=(o=n==null?void 0:n.loadedArticles)==null?void 0:o.sort((l,a)=>new Date(l.published).getTime()>new Date(a.published).getTime()?-1:1),e},{})}}const d=["https://rss-to-json-mc.vercel.app/api?url=","https://api.rss2json.com/v1/api.json?rss_url=","https://rss-to-json-serverless-api.vercel.app/api?feedURL=","https://api.apyhub.com/convert/rss-url/json"];async function D(t){const r=[];for(const s of t){let e=0,n=!1,o=0;do{try{if(d[e]==="https://api.apyhub.com/convert/rss-url/json"){const l={method:"POST",url:"https://api.apyhub.com/convert/rss-url/json",params:{detailed:"true"},headers:{"apy-token":"APY0RZnFoIUDElOH2WDX0UTaoNLdIXvSVWsUV5vjr0hnzu94p2eV0S32khkFBrO53pz4vjBVWoWdsA","Content-Type":"application/json"},data:{url:decodeURIComponent(s.url)}},{data:a}=await S.request(l),u=g(a,d[e]);r.push({...s,loadedArticles:u})}else{const{data:l}=await S(`${d[e]}${s.url}`),a=g(l,d[e]);r.push({...s,loadedArticles:a})}n=!1}catch{n=!0,e++,e===d.length&&(o++,e=0),o===3&&(n=!1)}await v(1e3)}while(n)}return r}function g(t,r){var s;return r==="https://api.apyhub.com/convert/rss-url/json"?t==null?void 0:t.items.map(e=>{var u,c,p;const o=new DOMParser().parseFromString(e.content_html,"text/html"),l=o.querySelector("p"),a=o.querySelector("img");return!l||!l.textContent?{...e,description:"",thumbnail:a==null?void 0:a.getAttribute("src")}:{...e,link:e.url,author:(e==null?void 0:e.authors[0].name)??((u=t==null?void 0:t.feed)==null?void 0:u.title),published:e.date_published,description:l.textContent,thumbnail:(a==null?void 0:a.getAttribute("src"))??((c=e==null?void 0:e.enclosure)==null?void 0:c.thumbnail)??((p=t==null?void 0:t.feed)==null?void 0:p.image)}}):r==="https://api.rss2json.com/v1/api.json?rss_url="?t==null?void 0:t.items.map(e=>{var u,c,p;const o=new DOMParser().parseFromString(e.content,"text/html"),l=o.querySelector("p"),a=o.querySelector("img");return{...e,author:(e==null?void 0:e.author)??((u=t==null?void 0:t.feed)==null?void 0:u.title),published:e.pubDate,description:(l==null?void 0:l.textContent)||"",thumbnail:(a==null?void 0:a.getAttribute("src"))??((c=e==null?void 0:e.enclosure)==null?void 0:c.thumbnail)??((p=t==null?void 0:t.feed)==null?void 0:p.image)}}):r==="https://rss-to-json-mc.vercel.app/api?url="?(s=t==null?void 0:t.data)==null?void 0:s.items.map(e=>{var u,c,p,h,b;const o=new DOMParser().parseFromString(e.content,"text/html"),l=o.querySelector("p"),a=o.querySelector("img");return{...e,author:(e==null?void 0:e.author)??((c=(u=t==null?void 0:t.data)==null?void 0:u.feed)==null?void 0:c.title),published:e.published,description:(l==null?void 0:l.textContent)||"",thumbnail:(a==null?void 0:a.getAttribute("src"))??((p=e==null?void 0:e.enclosure)==null?void 0:p.thumbnail)??((b=(h=t==null?void 0:t.data)==null?void 0:h.feed)==null?void 0:b.image)}}):t==null?void 0:t.items.map(e=>{var u,c;const o=new DOMParser().parseFromString(e.content,"text/html"),l=o.querySelector("p"),a=o.querySelector("img");return!l||!l.textContent?{...e,description:"",thumbnail:a==null?void 0:a.getAttribute("src")}:{...e,author:(e==null?void 0:e.author)??(t==null?void 0:t.title),description:l.textContent,thumbnail:(a==null?void 0:a.getAttribute("src"))||((c=(u=e==null?void 0:e.media)==null?void 0:u.thumbnail)==null?void 0:c.url)||(t==null?void 0:t.image)}})}export{w as a,R as u};
