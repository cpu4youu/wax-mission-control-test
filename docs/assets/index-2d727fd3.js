import{s as p,i as $e,k as Ve,u as be,j as a,e as Pe,t as Qe,r as L,h as je,q as Me,Q as Ce,R as Y,_ as X,B as We}from"./index-2466537e.js";import{a as Ge}from"./index.esm-acf5a72a.js";import{F as Ke}from"./index.esm-0805f0e1.js";import{f as Ue}from"./format-currency-usd-c3f487ff.js";import{f as oe}from"./formatNumber-be910684.js";import{a as ye,c as H,d as N}from"./mineCooldown-0e17a47a.js";import{u as qe}from"./use-wharfkit-da986681.js";import{u as Be}from"./use-media-8bddcaf9.js";import{a as He,e as De}from"./execute-claim-contract-3a83b9c1.js";import{u as $,g as Se,s as se}from"./showTlmValueFromMine-06f0e0cb.js";import{s as O}from"./sleep-da79c358.js";import{u as Ye,o as Le}from"./lands-query-d612bfa3.js";import{c as re,a as le}from"./calculateShardsByLand-7afb219a.js";import{u as Xe,r as Ee,o as Re}from"./tools-query-08f112c3.js";import{u as Ze,o as Te}from"./user-miners-query-ee824d6f.js";import{u as Je,o as et}from"./lands-query-827393c6.js";import{u as tt,o as nt}from"./get-user-settings-assets-query-c49a3822.js";import{u as at,o as it}from"./wallets-query-1c0d587a.js";import{u as ot,o as st,g as rt}from"./tool-query-26ee5008.js";import{u as lt,f as ct,o as dt,g as pt,e as ft}from"./execute-mine-tool-contract-aacaaa07.js";import{o as mt}from"./miner-claim-d9c89759.js";import{o as ut}from"./toolov-query-783e19fd.js";import"./iconBase-ec043f60.js";import"./index-2ca508ba.js";import"./index-257ac99b.js";import"./use-transaction-bd1d49ca.js";import"./toast-options-46bd4b8e.js";import"./lands-2faa6538.js";import"./adapters-0a89b599.js";import"./axios-45629df5.js";const gt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",my:"auto","@sm":{ml:"auto",my:"auto"}}),xt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",cursor:"pointer",mr:"auto",position:"relative"}),ht=p("img",{w:"100%",h:"60px",mb:"10px",objectFit:"contain","@sm":{w:"80px",h:"80px"}}),wt=p("div",{d:"flex",align:"center",justify:"center",zIndex:3,position:"absolute",bottom:"-10px",left:"0px",w:"30px",h:"30px",br:"10px","-webkit-text-stroke":"1px white",letterSpacing:"1px",color:"#00D1FF",fw:"900",fs:"20px",ff:"$heading",border:"2px solid white",background:"#D9D9D9",backdropFilter:"blur(15px)"}),yt=p("div",{d:"flex",align:"flex-start",justify:"flex-start",direction:"column",w:"100%","@sm":{d:"none"}}),Tt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",position:"relative",mb:"10px",minW:"200px",w:"100%"}),bt=p("div",{d:"flex",align:"center",justify:"center",position:"relative",boxShadow:"2px 2px 10px #000000",w:"100%",h:"10px",br:"3px",bg:"#595959"}),_t=p("div",{d:"flex",align:"center",justify:"center",position:"absolute",left:"0px",maxW:"200px",h:"10px",br:"3px",bg:"linear-gradient(90deg, #07A3DD 0%, rgba(0, 186, 255, 0.5) 100%)","&::after":{content:"",position:"absolute",right:"-2px",h:"14px",w:"7px",br:"50%",bg:"$white500",filter:"blur(2px)"}}),vt=p("div",{d:"flex",align:"center",justify:"center",direction:"column",ff:"$heading",fw:"$thin",fs:"12px",color:"$white500","@md":{ml:"auto",fs:"10px"}}),jt=p("div",{d:"flex",align:"center",justify:"space-between",w:"100%","@md":{fs:"12px"}}),Mt=p("button",{d:"flex",align:"center",justify:"center",ff:"$body",fs:"14px",fw:"$normal",color:"$red500",cursor:"pointer","&:hover":{textShadow:"1px 1px 2px red"},"@md":{fs:"12px"}}),Ct=()=>{const i=$e(),{data:w}=Ve(),l=be(v=>v.user),{unAuthorize:z}=qe(),{isSmall:E}=Be(),o=w==null?void 0:w.find(v=>v.level===(l==null?void 0:l.level)),R=((l==null?void 0:l.experience)??0)/((o==null?void 0:o.xp_to_level_up)??100)*100;return a.jsxs(gt,{children:[a.jsx(xt,{onClick:()=>i(E?"/user-settings":"/menu"),children:a.jsx(ht,{src:"/assets/icons/logo.webp",alt:"avatar icon"})}),a.jsxs(yt,{children:[a.jsxs(Tt,{children:[a.jsx(wt,{children:(l==null?void 0:l.level)??1}),a.jsx(bt,{children:a.jsx(_t,{style:{width:`${R}%`}})})]}),a.jsxs(jt,{children:[!E&&a.jsx(Mt,{onClick:z,children:"Logout"}),a.jsxs(vt,{children:[(l==null?void 0:l.experience)??0,"/",(o==null?void 0:o.xp_to_level_up)??100," ",!E&&"XP"]})]})]})]})},Dt=p("div",{d:"flex",align:"center",justify:"space-between",w:"100%",position:"relative",zIndex:20,bg:"$blue700"}),St=p("div",{d:"flex",align:"center",justify:"space-between",zIndex:20,w:"100%",px:"30px",h:"140px","@media(max-width:1224px)":{minW:"100%"},"@md":{px:"15px"},"@sm":{}}),Lt=p("div",{d:"flex",align:"center",justify:"center",gap:"20px",">a":{d:"flex",align:"center",justify:"center",svg:{h:"28px",w:"28px"}},svg:{color:"$white500",h:"22px",w:"22px"},zIndex:30,button:{"&:disabled":{opacity:.5}},"@sm":{order:-1,justify:"space-between",w:"max-content",button:{d:"none","&:last-of-type":{d:"flex",zIndex:2,svg:{h:"35px",w:"35px"}}}},"@xxsm":{">a":{top:"10px",position:"absolute"}}}),Et=Pe({"100%":{transform:"rotate(360deg)"}}),Rt=p("button",{color:"$white500",svg:{ml:"10px",color:"$white500",w:"25px",h:"25px"},variants:{isLoading:{true:{pointerEvents:"none",opacity:"0.5",svg:{animation:`${Et} 1s linear`,animationIterationCount:"infinite"}},false:{pointerEvents:"all",opacity:"1"}}}}),It=p("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"3px",w:"100%",">button":{h:"30px",minW:"150px",fs:"20px"},span:{textTransform:"uppercase",color:"$white500",fs:"10px",fw:"$bold",ff:"$heading"},"@sm":{w:"max-content",position:"absolute",left:"50%",transform:"translateX(-50%)"}}),$t=p("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"10px",width:"310px","@md":{width:"max-content",margin:"0",gap:"7px"},"@sm":{d:"none"}});p("button",{d:"flex",align:"center",justify:"center",ml:"10px"});const Bt=p("div",{d:"flex",align:"flex-end",justify:"center",gap:"20px",mt:"20px"}),ce=p("div",{d:"flex",align:"center",justify:"space-between",direction:"column",color:"$white500",w:"max-content",fs:"14px",svg:{w:"25px",h:"25px"}}),de=p("div",{d:"flex",align:"center",justify:"center",direction:"column",padding:"5px",w:"35px",h:"35px",border:"1px solid $white500",borderRadius:"$full"}),Ft=p("div",{d:"flex",align:"center",justify:"center",">button>div":{d:"flex",align:"center",justify:"center"},"@sm":{gap:"10px",">button>div":{direction:"column"}}}),At=p("div",{d:"flex",align:"center",justify:"center",gap:"5px",ml:"10px",fs:"20px",ff:"$body",color:"$white500",path:{fill:"$white500"}}),kt=p("p",{ff:"$heading",fs:"20px",fw:"$bold",textShadow:"1px 1px 2px black",color:"$yellow500"});function Nt(){const{isSmall:i}=Be(),w=$e(),{data:l,isLoading:z,isFetching:E}=Ze(),{data:o,isLoading:R,isFetching:v}=Xe(),{data:B}=Je(),{data:V,isLoading:pe}=Ye(),{data:b}=tt(),{data:x,isFetching:fe}=at(),{data:j,isLoading:Z,isFetching:Q}=ot(),{data:m,isFetching:me}=lt(),e=be(t=>t.user),ue=be(t=>t.updateAuth),I=$(t=>t.nonce),_=$(t=>t.updateIsCalculating),ge=$(t=>t.isMineButtonLoading),W=$(t=>t.updateMineButtonLoading),G=$(t=>t.isCalculating),K=$(t=>t.updateNonce),xe=$(t=>t.hashExpire),J=$(t=>t.updateHashExpire),ee=$(t=>t.updateMineCooldown),U=Qe(t=>t.currentWeek),[he,A]=L.useState(new Date),[q,M]=L.useState(!1),[u,te]=L.useState(void 0),[C,y]=L.useState(null),d=!(e!=null&&e.isMember)||(e==null?void 0:e.flagged),_e=async()=>{if(!e)return null;M(!0),_(!0);try{if(!await He(e))throw new Error("MINE error from contract");await se(e==null?void 0:e.name)}catch(t){console.log(t)}finally{await O(800),_(!1),await P(),M(!1)}},Fe=async()=>{var t,f;M(!0);try{await Le(),_(!0),await O(1e3);const[[s,D]]=Me.getQueriesData(Ce.LANDS),h=((t=V==null?void 0:V.highestValue)==null?void 0:t.asset_id)||((f=D.highestValue)==null?void 0:f.asset_id);if(!e||!h)return null;if(!(I!=null&&I.rand_str)){await Se();const n=new Date;J(n.setMinutes(n.getMinutes()+1))}await De(e,h)&&(await se(e==null?void 0:e.name),await P())}catch(s){console.log(s)}finally{_(!1),M(!1)}},ne=({delay:t})=>{var h,T,n,c,r,g,S,k,ie;const f=(t??0)/10;if(((h=o==null?void 0:o.userTools)==null?void 0:h.length)===1){const F=f*(((n=(T=o==null?void 0:o.userTools)==null?void 0:T[0])==null?void 0:n.delay)??0);return N(F,o,l,A)}const s=(c=o==null?void 0:o.userTools)==null?void 0:c.sort((F,ze)=>ze.delay-F.delay);if(((r=o==null?void 0:o.userTools)==null?void 0:r.length)===2){const F=f*((((g=s==null?void 0:s[0])==null?void 0:g.delay)??0)+(((S=s==null?void 0:s[1])==null?void 0:S.delay)??0)/2);return N(F,o,l,A)}const D=f*((((k=s==null?void 0:s[0])==null?void 0:k.delay)??0)+(((ie=s==null?void 0:s[1])==null?void 0:ie.delay)??0));return N(D,o,l,A)},ae=()=>{var h,T;if(!B||!(b!=null&&b.favoriteLands))return null;let t=[];const f=b==null?void 0:b.favoriteLands.filter(([n])=>ye(H(ne({delay:n.delay})))==="MINE");if(f.length>0)t=f;else{const n=Math.min(...b.favoriteLands.map(([r])=>H(ne({delay:r.delay})).difference));t=b.favoriteLands.filter(([r])=>H(ne({delay:r.delay})).difference===n)}if((e==null?void 0:e.miningType)==="orange"){const n=Math.max(...t.map(([r])=>re({land:r})));return{...(h=t.filter(([r])=>re({land:r})===n).flatMap(([r])=>r).sort((r,g)=>re({land:r})-re({land:g})))==null?void 0:h[0]}}const s=Math.max(...t.map(([n])=>le({landCardId:n.cardid,landsType:B,userTools:o==null?void 0:o.userTools})));return{...(T=t.filter(([n])=>le({landCardId:n.cardid,landsType:B,userTools:o==null?void 0:o.userTools})===s).flatMap(([n])=>n).sort((n,c)=>le({landCardId:c.cardid,landsType:B,userTools:o==null?void 0:o.userTools})-le({landCardId:n.cardid,landsType:B,userTools:o==null?void 0:o.userTools})))==null?void 0:T[0]}},Ae=async()=>{M(!0);try{_(!0),await O(500);const t=ae();if(!e)return null;await De(e,t==null?void 0:t.assetId)&&(await se(e==null?void 0:e.name),await P())}catch(t){console.log(t)}finally{_(!1),M(!1)}},we=L.useCallback(async()=>{if(!j||!m)return null;const t=await Promise.all(j==null?void 0:j.toolsOv.filter(n=>{var r;const c=n.owned>0&&((n==null?void 0:n.tool_name)==="Certified Kol Digger"?!0:n.allowed===1)&&ct((e==null?void 0:e.total_points)??0,n);return((x==null?void 0:x.tempid_allow_list.length)??0)===0?c:c&&((r=x==null?void 0:x.tempid_allow_list)==null?void 0:r.some(g=>g===n.template_id))}).map(async n=>{if((n==null?void 0:n.tool_name)==="Certified Kol Digger"){const r=m==null?void 0:m.reduce((g,S)=>{const k=Number(new Date(g.readyat));return Number(new Date(S.readyat))<k?S:g},m[0]);return{...n,...r,last_use:+new Date(`${r.readyat}.000Z`)/1e3-r.cooldown_seconds}}const c=j.stakedTools.find(r=>r.template_id===n.template_id);return{...n,...c,last_use:+new Date(`${n.readyat}.000Z`)/1e3-n.cooldown_seconds}})),f=t==null?void 0:t.filter(n=>{const c=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6;return ye(H(N(c,{userTools:[n],allData:[]},l)))==="MINE"});let s=null;f.length>0?s=f.sort((n,c)=>Ee[n.rarity]-Ee[c.rarity]||c.mining_power-n.mining_power)[0]:s=t==null?void 0:t.reduce((n,c)=>{const r=((n==null?void 0:n.tool_name)==="Certified Kol Digger"?500:n.cooldown_seconds)*1.6,S=+N(r,{userTools:[n],allData:[]},l),k=((c==null?void 0:c.tool_name)==="Certified Kol Digger"?500:c.cooldown_seconds)*1.6,F=+N(k,{userTools:[c],allData:[]},l);return F<S?{...c,cooldownSec:F}:{...n,cooldownSec:S}},t[0]);const D=((s==null?void 0:s.tool_name)==="Certified Kol Digger"?500:s.cooldown_seconds)*1.5,T=N(D,{userTools:[s],allData:[]},l);return A(T),s},[m,l,j,e,x]),ke=async()=>{var t,f;M(!0);try{const s=await we();if(!s||!e||!m)return;await Le(),_(!0),await O(500);let D=0,h,T=[];if((s==null?void 0:s.tool_name)==="Certified Kol Digger"){const c=m==null?void 0:m.reduce((r,g)=>{const S=Number(new Date(r.readyat));return Number(new Date(g.readyat))<S?g:r},m[0]);D=c.asset_ids.length*s.pow,T=c.asset_ids.map(r=>Number(r)),h="1099512958237"}else{const[c]=await rt(`${s.template_id}`);D=c.pow,T=[c.next_asset_id];let r;try{[[,r]]=Me.getQueriesData([Ce.LANDS,"red",s])}catch{r=await pt(s)}h=(t=r.highestValue)==null?void 0:t.asset_id}await ft({user:e,difficulty:D,assets_ids:T,land_asset_id:h,old_bag_assets_ids:((f=o==null?void 0:o.userTools)==null?void 0:f.map(c=>Number(c.asset_id)))??[]})&&(await O(800),await se(e==null?void 0:e.name),await P())}catch(s){console.log(s)}finally{W(!1),_(!1),M(!1)}},P=async()=>{if(await Te(),await Re(),(e==null?void 0:e.miningType)==="red"){await Ne(),await O(1e3),we();return}},Ne=async()=>{await Te(),await it(),await mt(),await st(),await ut(),await dt()},Oe=()=>{const t=ye(u);return ee(t),t},ve=async()=>{await Re(),await et(),await Te(),await nt()};return{user:e,miners:l,mTools:m,tools:o,toolsLoaning:j,toolsWallets:x,bestLand:C,cooldown:Oe,handleRefreshLands:ve,playSound:async()=>{const t=new Audio("https://play.alienworlds.io/sounds/aw-mining-claim-sfx-02.mp3");i&&await O(1e3),t.play()},textAboveButton:()=>{var t;return d?"Not a Member":(e==null?void 0:e.miningType)==="green"?"Favorites (shards)":(e==null?void 0:e.miningType)==="orange"?"Favorites (TLM)":(e==null?void 0:e.miningType)==="gold"?"Mining":(e==null?void 0:e.miningType)==="blue"?"Mine Maximizer":(e==null?void 0:e.miningType)==="red"?`Deposit: ${je(x==null?void 0:x.deposit).toFixed(4)} TLM`:`Deposit: ${(je((t=e==null?void 0:e.HqMember)==null?void 0:t.deposit)+((e==null?void 0:e.tlm_deposit)??0)/1e4).toFixed(4)} TLM`},textBelowButton:()=>d?"Become a member to use mine":(e==null?void 0:e.miningType)==="red"?"Tool Loaning":(e==null?void 0:e.miningType)==="gold"||(e==null?void 0:e.miningType)==="blue"?`${l!=null&&l.name?l==null?void 0:l.name:""}`:`${C!=null&&C.name?C==null?void 0:C.name:""}`,buttonOnClick:async()=>{if(d)return w("/membership");if((e==null?void 0:e.miningType)==="red")return await P(),ke(),null;if(!(I!=null&&I.rand_str)&&!G){_(!0),((e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange")&&await ve(),await Se();const t=new Date;J(t.setMinutes(t.getMinutes()+1))}return(e==null?void 0:e.miningType)==="blue"?(Fe(),null):(e==null?void 0:e.miningType)==="gold"?(_e(),null):(e==null?void 0:e.miningType)==="green"||(e==null?void 0:e.miningType)==="orange"?(Ae(),null):_e()},loading:()=>{const t=((u==null?void 0:u.seconds)??0)<0&&((u==null?void 0:u.minutes)??0)<0&&((u==null?void 0:u.hours)??0)<0,f=(e==null?void 0:e.miningType)==="red"?Z:!1;return G||q||ge||pe||R||Q||v||z||E||fe||me||!u||t||f},miningType:()=>(e==null?void 0:e.miningType)==="gold"?"gradientYellow":(e==null?void 0:e.miningType)==="orange"?(y(ae()),"gradientOrange"):(e==null?void 0:e.miningType)==="green"?(y(ae()),"gradientGreen"):(e==null?void 0:e.miningType)==="blue"?"gradientBlue":(e==null?void 0:e.miningType)==="red"?"gradientRed":"gradientYellow",minersFetching:E,toolFetching:v,land:V,updateAuth:ue,updateNonce:K,hashExpire:xe,currentWeek:U,expireDate:he,setToolCooldown:te,isSmall:i,favorites:b,landsType:B,setExpireDate:A,setBestLand:y,isDisableToMine:d,toolCooldown:u,updateMineCooldown:ee,handleRefetch:P,navigate:w,selectBestLandOnFavorites:ae,getBestToolOnTooLoaning:we,calcCooldown:ne,nonce:I}}const Ie=Y.lazy(()=>X(()=>import("./tlm-6c5523a9.js"),["assets/tlm-6c5523a9.js","assets/index-2466537e.js","assets/index-55fec1ff.css"])),Ot=Y.lazy(()=>X(()=>import("./star-1879104f.js"),["assets/star-1879104f.js","assets/index-2466537e.js","assets/index-55fec1ff.css"])),zt=Y.lazy(()=>X(()=>import("./atom-75077d79.js"),["assets/atom-75077d79.js","assets/index-2466537e.js","assets/index-55fec1ff.css"])),Vt=Y.lazy(()=>X(()=>import("./quest-e5675a24.js"),["assets/quest-e5675a24.js","assets/index-2466537e.js","assets/index-55fec1ff.css"])),Pt=Y.lazy(()=>X(()=>import("./open-menu-f11d3768.js"),["assets/open-menu-f11d3768.js","assets/index-2466537e.js","assets/index-55fec1ff.css"])),Cn=()=>{var te,C;const{user:i,miners:w,mTools:l,tools:z,toolsLoaning:E,toolsWallets:o,bestLand:R,cooldown:v,playSound:B,textAboveButton:V,textBelowButton:pe,buttonOnClick:b,loading:x,miningType:fe,updateNonce:j,hashExpire:Z,currentWeek:Q,expireDate:m,setToolCooldown:me,isSmall:e,favorites:ue,landsType:I,setExpireDate:_,setBestLand:ge,isDisableToMine:W,handleRefetch:G,navigate:K,selectBestLandOnFavorites:xe,getBestToolOnTooLoaning:J,calcCooldown:ee,nonce:U}=Nt(),he=()=>W?a.jsx("span",{style:{fontSize:"15px"},children:"Membership"}):U!=null&&U.rand_str&&v()==="MINE"?"Submit":v();L.useEffect(()=>{let y=(w==null?void 0:w.delay)??0;if((i==null?void 0:i.miningType)==="blue"&&(y=15),((i==null?void 0:i.miningType)==="green"||(i==null?void 0:i.miningType)==="orange")&&R&&(y=R==null?void 0:R.delay),(i==null?void 0:i.miningType)==="red"){J();return}ee({delay:y})},[R,l,z,E,o,i]),L.useEffect(()=>{const y=setInterval(()=>{const d=H(m);me(d),((i==null?void 0:i.miningType)==="orange"||(i==null?void 0:i.miningType)==="green")&&ge(xe()),(d==null?void 0:d.hours)===0&&(d==null?void 0:d.minutes)===0&&(d==null?void 0:d.seconds)===1&&B(),(d==null?void 0:d.hours)===0&&(d==null?void 0:d.minutes)===0&&(d==null?void 0:d.seconds)===0&&clearInterval(y)},1e3);return()=>clearInterval(y)},[m,e,ue,I,w,z,i]),L.useEffect(()=>{const y=setInterval(()=>{Z-new Date().getTime()<0&&j(void 0)},3e3);return()=>clearInterval(y)},[Z,j]),L.useEffect(()=>{setInterval(async()=>{await G()},6e4)},[w,l,_,E,o,i]);const A=L.useMemo(()=>fe(),[i==null?void 0:i.miningType]),q=x(),M=W?!1:q,u=W?!1:q||v()!=="MINE";return a.jsx(Dt,{children:a.jsxs(St,{children:[a.jsx(Ct,{}),a.jsxs(Lt,{children:[a.jsx(Rt,{disabled:!(i!=null&&i.member),onClick:()=>G(),isLoading:q,children:a.jsx(Ke,{})}),a.jsxs(It,{children:[a.jsx("span",{children:V()}),a.jsx(We,{onClick:()=>b(),disabled:u,color:A,isLoading:M,children:he()}),a.jsx("span",{children:pe()})]}),a.jsx("button",{onClick:()=>K("/user-settings"),children:a.jsx(Ge,{})}),a.jsx("button",{onClick:()=>K("/menu"),children:a.jsx(Pt,{})})]}),a.jsxs($t,{children:[a.jsxs(Bt,{children:[a.jsxs(ce,{children:[a.jsx(de,{children:a.jsx(Vt,{})}),oe(((te=i==null?void 0:i.userWeekly)==null?void 0:te.total_quest_points)??0,1)]}),a.jsxs(ce,{children:[a.jsx(de,{children:a.jsx(Ot,{})}),oe((i==null?void 0:i.mcPoints)??0,1)]}),a.jsxs(ce,{children:[a.jsx(de,{children:a.jsx(zt,{color:"#F6A800"})}),oe(((i==null?void 0:i.redeemable_points)??0)/10,1)]}),a.jsxs(ce,{children:[a.jsx(de,{children:a.jsx(Ie,{})}),oe(Number((C=i==null?void 0:i.userTlm)==null?void 0:C.balance)??0,1)]})]}),a.jsx(Ft,{children:a.jsx("button",{onClick:()=>K("/week-reward"),children:a.jsxs("div",{children:[a.jsx(kt,{children:"Prize Pool"}),a.jsxs(At,{children:[Ue((Q==null?void 0:Q.initial_prize_pool_formatted)??0),a.jsx(Ie,{})]})]})})})]})]})})};export{Cn as Header};
