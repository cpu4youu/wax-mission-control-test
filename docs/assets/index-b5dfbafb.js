import{s as i,e as q,aC as z,V as K,W as Y,aD as J,b as X,X as b,R as u,f as v,a1 as Z,a2 as D,d as I,aw as N,aE as $,j as n,p as d,B as W,av as ee,a8 as te,h as ae,U as ne,aF as se,$ as re,a0 as ie,aG as ce,az as de,aH as oe,aI as ue,aJ as fe,aK as pe,q as le,Q as xe}from"./index-097c526a.js";import{C as me}from"./index-eb09b437.js";import{P as ge}from"./pickaxe-c577cfb3.js";const we=i("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),he=i("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),ye=i("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),_e=i("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),je=i("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),be=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),ve=i("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),F=i("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{filter:"drop-shadow(3px 5px 2px rgb(0 0 0 / 0.6))",w:"20px",h:"20px"}}),R=i("p",{d:"flex",align:"center",justify:"center",color:"$white500",textShadow:"2px 1px 4px rgba(0, 0, 0)",fs:"14px",ff:"$heading",fw:"400"}),Te=q({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),Le=i("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${Te} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),Se=[{label:"Sort by rarity",value:"rarity"}],Be=()=>{const{data:a}=z(),{data:f}=K(),{data:p}=Y(),{data:o,isLoading:V}=J(),m=X(e=>e.user),T=b(e=>e.isCalculating),A=b(e=>e.updateIsCalculating),L=b(e=>e.updateMineButtonLoading),[S,O]=u.useState([]),[g,P]=u.useState([]),[C,M]=u.useState(!1),[E]=u.useState(Se[0]),[,y]=u.useState(!1);async function Q(e){try{const t=await Promise.all(de.map(async l=>{const w=await oe(l);return{title:l,img:`/assets/planets/${l}.png`,data:(w==null?void 0:w.pool_buckets.map(x=>({...x,value_formatted:d(x==null?void 0:x.value)??0})))??[]}})),s=ue(t),r=await fe(s,"red",e),c=pe(r);return le.setQueriesData([xe.LANDS,"red",e],{list:r,highestValue:c}),{list:r,highestValue:c}}catch(t){console.log(t);return}}async function G(e){var t,s,r;if(m){M(!0),L(!0);try{await te(),A(!0),await ae(500);const c=await Q(e);if(!((t=c==null?void 0:c.highestValue)!=null&&t.asset_id))throw new Error("No land found");const l=(s=c.highestValue)==null?void 0:s.asset_id,w=(f==null?void 0:f.current_land)===l?void 0:l,{getAssetByAssetId:x}=ne,U=await x(String(e.next_asset_id)),B=p==null?void 0:p.allData.find(j=>j.template_id===Number(U.template.template_id));if(!B)return;await se({user:m,next_tool:[B],assets_ids:[e.next_asset_id],land_asset_id:w,old_bag_assets_ids:((r=p==null?void 0:p.userTools)==null?void 0:r.map(j=>Number(j.asset_id)))??[]})&&(await re(m==null?void 0:m.name),await ie(),await ce())}catch(c){console.error("Error on MINE tool",c)}finally{L(!1),M(!1)}}}const h=v.useCallback(e=>{const t=e.cooldown_seconds*1.6;return Z(t,{userTools:[e],allData:[]},f)},[f]),_=v.useCallback(e=>D(I(h(e))),[h]),k=v.useCallback(async()=>{if(!(o!=null&&o.toolsOv))return[];const e=await Promise.all(o==null?void 0:o.toolsOv.filter(t=>{var s;return((a==null?void 0:a.tempid_allow_list.length)??0)===0?t.owned>0&&t.allowed===1:t.owned>0&&t.allowed===1&&((s=a==null?void 0:a.tempid_allow_list)==null?void 0:s.some(r=>r===t.template_id))}).map(async t=>{const s=o.stakedTools.find(r=>r.template_id===t.template_id);return{...t,...s,last_use:+new Date(`${t.readyat}.000Z`)/1e3-t.cooldown_seconds}}));O(e)},[o]);u.useEffect(()=>{k()},[k]),u.useEffect(()=>{if(E.value==="rarity"){const e=S.sort((t,s)=>N[t.rarity]-N[s.rarity]||$[t.shine]-$[s.shine]);P(e)}},[S,E.value]),u.useEffect(()=>{const e=setInterval(()=>{g.every(t=>D(I(h(t)))==="MINE")?(y(t=>!t),clearInterval(e)):y(t=>!t)},1e3);return y(t=>!t),()=>clearInterval(e)},[g,f,h]);const H=e=>{if(d(e==null?void 0:e.deposit)===0&&d(e==null?void 0:e.trialtlm)>0)return"red";if(d(e==null?void 0:e.deposit)>=0)return"green"};return n.jsxs(we,{children:[n.jsx(he,{children:"LOAN TOOLS"}),n.jsxs(ye,{children:["Deposited TLM:"," ",n.jsxs(_e,{color:H(a),children:[d(a==null?void 0:a.deposit)>=0?d(a==null?void 0:a.deposit).toFixed(4):`- ${d(a==null?void 0:a.trialtlm).toFixed(4)}`," ","TLM"," ",d(a==null?void 0:a.deposit)<0&&d(a==null?void 0:a.trialtlm)>0&&"(Deposit more TLM)"]})]}),n.jsx(je,{children:V?new Array(6).fill(0).map((e,t)=>n.jsx(Le,{},t)):g==null?void 0:g.map((e,t)=>n.jsx(me,{showNumberBracket:!0,tool:e,children:n.jsxs(be,{children:[n.jsx(W,{isLoading:C||T,disabled:C||T||_(e)!=="MINE",onClick:()=>G(e),rounded:!1,color:"solidBlue",children:_(e)==="MINE"?"Mine":_(e)}),n.jsxs(ve,{children:[n.jsxs(F,{children:[n.jsx(ge,{}),n.jsx(R,{children:e.mining_power/10})]}),n.jsxs(F,{children:[n.jsx(ee,{}),n.jsx(R,{children:e.pow})]})]})]})},t))})]})};export{Be as default};
