import{s as i,e as U,m as G,aE as Y,aF as z,W as H,X as K,b as X,Y as N,R as d,f as _,a2 as J,a3 as E,d as M,aG as Z,ax as D,j as r,t as f,B as W,aw as ee,a8 as te,h as ae,q as se,Q as re,V as ne,aH as ie,az as oe,k as de}from"./index-e370e53a.js";import{S as ce}from"./index-c257b568.js";import{C as le}from"./index-7b54b17e.js";import{P as ue}from"./pickaxe-f92ade04.js";import"./index.esm-08c5b712.js";import"./index-a1f98780.js";import"./index-c4b4273d.js";import"./index-418e1ac5.js";import"./gradient-border-d912e994.js";const pe=i("div",{d:"flex",align:"flex-start",justify:"center",direction:"column",mt:"35px",w:"100%"}),fe=i("h2",{d:"flex",align:"center",justify:"center",fs:"20px",color:"$white500"}),me=i("p",{d:"flex",align:"center",justify:"flex-start",gap:"5px",mb:"15px",w:"100%",color:"$white500",ff:"$heading","@sm":{flexWrap:"wrap"}}),xe=i("span",{ff:"$heading",fw:"$bold",fs:"20px",variants:{color:{red:{color:"#E52251"},green:{color:"#00FF00"}}},"@sm":{fs:"16px"}}),ge=i("div",{d:"flex",align:"center",justify:"flex-start",flexWrap:"wrap",gap:"25px",mt:"15px",w:"100%","@sm":{justify:"center"}}),ye=i("div",{d:"flex",align:"center",justify:"center",direction:"column",gap:"5px",mt:"auto",w:"100%",button:{w:"100%",minH:"40px",minW:"unset",maxW:"90%",">div":{border:"none"}}}),he=i("div",{d:"flex",align:"center",justify:"center",m:"5px 0 10px",w:"100%"}),k=i("div",{d:"flex",align:"center",justify:"center",gap:"10px",w:"100%",svg:{w:"20px",h:"20px"}}),B=i("p",{d:"flex",align:"center",justify:"center",color:"$white500",fs:"14px",ff:"$heading",fw:"400"}),we=U({"0%":{backgroundPosition:"0% 0%"},"100%":{backgroundPosition:"-135% 0%"}}),be=i("div",{width:"174px",height:"259px",background:"linear-gradient( -90deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.25) ,rgba(255, 255, 255, 0.15))",br:"10px",backgroundSize:"400% 400%",animation:`${we} 1.2s ease-in-out infinite`,"@sm":{width:"70px",height:"100px"}}),y=[{label:"Sort by rarity",value:"rarity"}],Ee=()=>{const{data:x,isLoading:Q}=G("tool.worlds",!0),{data:c}=Y(),{data:a}=z(),{data:l}=H(),{data:o}=K(),j=X(e=>e.user),S=N(e=>e.isCalculating),$=N(e=>e.updateIsCalculating),[T,A]=d.useState([]),[m,R]=d.useState([]),[v,C]=d.useState(!1),[L,P]=d.useState(y[0]),[,h]=d.useState(!1);async function V(e){var t;if(j){C(!0);try{await te(),$(!0),await ae(500);const[[s,n]]=se.getQueriesData(re.LANDS),u=(t=n.highestValue)==null?void 0:t.asset_id,p=(l==null?void 0:l.current_land)===u?void 0:u,{getAssetByAssetId:q}=ne,O=await q(String(e.next_asset_id)),F=o==null?void 0:o.allData.find(b=>b.template_id===Number(O.template.template_id));if(!p||!(o!=null&&o.userTools)||!F)return;await ie({user:j,next_tool:[F],assets_ids:[e.next_asset_id],land_asset_id:p,old_bag_assets_ids:o.userTools.map(b=>Number(b.asset_id))})&&(await oe("tool.worlds"),de.success("Tool Mined"))}catch(s){console.error("Error staking tool",s)}finally{C(!1)}}}const g=_.useCallback(e=>{const t=e.delay*1.6;return J(t,{userTools:[e],allData:[]},l)},[o,l]),w=_.useCallback(e=>E(M(g(e))),[g]),I=_.useCallback(async()=>{if(!x)return[];const e=await Promise.all(x.filter(t=>c==null?void 0:c.some(s=>s.template_id===Number(t.template.template_id))).reduce((t,s)=>{if(t.some(n=>Number(n.template.template_id)===Number(s.template.template_id))){const n=t.findIndex(u=>Number(u.template.template_id)===Number(s.template.template_id));t[n].data.quantity+=1}else{const n={...s,data:{...s.data,quantity:1}};t.push({...n})}return t},[]).map(async t=>{const s=c==null?void 0:c.find(p=>p.template_id===Number(t.template.template_id)),n=x.find(p=>Number(p.template.template_id)===Number((s==null?void 0:s.template_id)||0)),u=await Z((n==null?void 0:n.asset_id)??"");return{asset_id:t.asset_id,...t.data,...s,...u}}));A(e)},[c,x]);return d.useEffect(()=>{I()},[I]),d.useEffect(()=>{if(L.value==="rarity"){const e=T.sort((t,s)=>D[t.rarity]-D[s.rarity]);R(e)}},[T,L.value]),d.useEffect(()=>{const e=setInterval(()=>{m.every(t=>E(M(g(t)))==="MINE")?(h(t=>!t),clearInterval(e)):h(t=>!t)},1e3);return h(t=>!t),()=>clearInterval(e)},[m,l,g]),r.jsxs(pe,{children:[r.jsx(fe,{children:"LOAN TOOLS"}),r.jsxs(me,{children:["Deposited TLM:"," ",r.jsxs(xe,{color:f(a==null?void 0:a.deposit)>=0?"green":"red",children:[f(a==null?void 0:a.deposit)>=0?f(a==null?void 0:a.deposit).toFixed(4):`- ${f(a==null?void 0:a.trialtlm).toFixed(4)}`," ","TLM"," ",f(a==null?void 0:a.deposit)<0&&f(a==null?void 0:a.trialtlm)>0&&"(Deposit more TLM)"]})]}),r.jsx(ce,{title:"",selected:y[0],onSelected:e=>P(e||y[0]),options:y,borderColor1:"#FFB31F",borderColor2:"#FFB31F"}),r.jsx(ge,{children:Q?new Array(6).fill(0).map((e,t)=>r.jsx(be,{},t)):m==null?void 0:m.map((e,t)=>r.jsx(le,{tool:e,children:r.jsxs(ye,{children:[r.jsx(W,{isLoading:v||S,disabled:v||S||w(e)!=="MINE",onClick:()=>V(e),rounded:!1,color:"solidBlue",children:w(e)==="MINE"?"Mine":w(e)}),r.jsxs(he,{children:[r.jsxs(k,{children:[r.jsx(ue,{}),r.jsx(B,{children:e.mining_power})]}),r.jsxs(k,{children:[r.jsx(ee,{}),r.jsx(B,{children:e.pow})]})]})]})},t))})]})};export{Ee as default};
